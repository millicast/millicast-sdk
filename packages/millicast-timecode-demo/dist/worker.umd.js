!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e;!function(){const e={MILLICAST_STREAM_NAME:"96",MILLICAST_ACCOUNT_ID:"kMH4vs"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}(),function(e){e[e.SLICE_NON_IDR=1]="SLICE_NON_IDR",e[e.SLICE_PARTITION_A=2]="SLICE_PARTITION_A",e[e.SLICE_PARTITION_B=3]="SLICE_PARTITION_B",e[e.SLICE_PARTITION_C=4]="SLICE_PARTITION_C",e[e.SLICE_IDR=5]="SLICE_IDR",e[e.SEI=6]="SEI",e[e.SPS=7]="SPS",e[e.PPS=8]="PPS",e[e.AUD=9]="AUD",e[e.END_SEQ=10]="END_SEQ",e[e.END_STREAM=11]="END_STREAM",e[e.FILLER_DATA=12]="FILLER_DATA",e[e.SPS_EXT=13]="SPS_EXT",e[e.PREFIX_NALU=14]="PREFIX_NALU",e[e.SUBSET_SPS=15]="SUBSET_SPS",e[e.DPS=16]="DPS",e[e.SLICE_AUX=19]="SLICE_AUX",e[e.SLICE_EXT=20]="SLICE_EXT",e[e.SLICE_LAYER_EXT=21]="SLICE_LAYER_EXT"}(e=e||(e={}));function r(e){if(e.length<1)throw TypeError("EOF found when reading NALU prefix");const r={forbidden_zero_bit:(_=e[0])>>7,nal_ref_idc:_>>5&3,nal_unit_type:31&_};var _;if(14===r.nal_unit_type||20===r.nal_unit_type||21===r.nal_unit_type)throw Error("TODO: implement extension");return{...r,rbsp:e.subarray(1)}}function _(e,r=new Uint8Array(e.length)){let _=0,t=0,a=2;for(;a<e.length;a++)3===e[a]&&0===e[a-1]&&0===e[a-2]&&(r.set(e.subarray(t,a),_),_+=a-t,t=a+1);return r.set(e.subarray(t,a),_),_+=a-t,r.subarray(0,_)}function t(e){if(!(e.length-e.offset<=8))throw TypeError(`unexpected trailing data found: ${e.length-e.offset} bits`);if(!e.read1()||e.read(e.length-e.offset))throw TypeError("unexpected alignment trailing bits")}const a=e=>~(-1<<e);class n{constructor(e,r=0,_=8*e.length-r){if(this.data=e,this.offset=r,this.length=_,!(r===r>>>0&&_===_>>>0&&r<=_&&_<=8*e.length))throw new TypeError("invalid offset / length")}clone(){return new n(this.data,this.offset,this.length)}read1(){if(!(this.offset<this.length))throw new Error("unexpected EOF");const e=this.offset++;return Boolean(this.data[e>>>3]>>(7&~e)&1)}read(e){if(!(e===e>>>0&&e<=32))throw TypeError(`invalid bit number ${e}`);if(!(this.offset+e<=this.length))throw Error(`unexpected EOF: expected ${e}, got ${this.length-this.offset}`);let r=e,_=this.offset>>>3,t=0;const n=8-(7&this.offset),i=Math.min(n,r);for(r-=i,t|=(this.data[_++]&a(n))>>n-i<<r;r>=8;)r-=8,t|=this.data[_++]<<r;return r&&(t|=this.data[_]>>8-r),this.offset+=e,t>>>0}readExp(){let e=0;for(;!this.read1();)e++;return this.read(e)+(a(e)>>>0)}readSExp(){const e=this.readExp();if(e<2)return e;const r=e+1>>>1;return 1&e?r:-r}}const i={};for(const e of[100,110,122,244,44,83,86,118,128,138,139,134,135])i[e]=!0;function E(e){const r=new n(e),_=r.read(8),a=r.read(8),E=r.read(8),s=r.readExp(),I=i[_]?(()=>{const e=r.readExp();return{chroma_format_idc:e,separate_colour_plane_flag:3===e?r.read1():void 0,bit_depth_luma_minus8:r.readExp(),bit_depth_chroma_minus8:r.readExp(),qpprime_y_zero_transform_bypass_flag:r.read1(),seq_scaling_matrix:o(r,3!==e?2:6)}})():void 0,c=r.readExp(),p=r.readExp(),T=0===p?{log2_max_pic_order_cnt_lsb_minus4:r.readExp()}:1===p?{delta_pic_order_always_zero_flag:r.read1(),offset_for_non_ref_pic:r.readSExp(),offset_for_top_to_bottom_field:r.readSExp(),...(()=>{const e=r.readExp();return{num_ref_frames_in_pic_order_cnt_cycle:e,offset_for_ref_frame:[...Array(e)].map((()=>r.readSExp()))}})()}:void 0,f=r.readExp(),S=r.read1(),l=r.readExp(),N=r.readExp(),u=r.read1(),R=u?void 0:r.read1(),A=r.read1(),O=!!r.read1()&&{left_offset:r.readExp(),right_offset:r.readExp(),top_offset:r.readExp(),bottom_offset:r.readExp()},P=r.read1()?function(e){const r=e.read1()?(()=>{const r=e.read(8);return{aspect_ratio_idc:r,...255===r?{sar_width:e.read(16),sar_height:e.read(16)}:void 0}})():void 0,_=e.read1()?{overscan_appropriate_flag:e.read1()}:void 0,t=e.read1()?{video_format:e.read(3),video_full_range_flag:e.read1(),colour_description:e.read1()?{colour_primaries:e.read(8),transfer_characteristics:e.read(8),matrix_coefficients:e.read(8)}:void 0}:void 0,a=e.read1()?{chroma_sample_loc_type_top_field:e.readExp(),chroma_sample_loc_type_bottom_field:e.readExp()}:void 0,n=e.read1()?{num_units_in_tick:e.read(32),time_scale:e.read(32),fixed_frame_rate_flag:e.read1()}:void 0,i=e.read1()?d(e):void 0,E=e.read1()?d(e):void 0,s=i||E?e.read1():void 0,o=e.read1(),I=e.read1()?{motion_vectors_over_pic_boundaries_flag:e.read1(),max_bytes_per_pic_denom:e.readExp(),max_bits_per_mb_denom:e.readExp(),log2_max_mv_length_horizontal:e.readExp(),log2_max_mv_length_vertical:e.readExp(),max_num_reorder_frames:e.readExp(),max_dec_frame_buffering:e.readExp()}:void 0;return{aspect_ratio_info:r,overscan_info:_,video_signal_type:t,chroma_loc_info:a,timing_info:n,nal_hrd_parameters:i,vcl_hrd_parameters:E,low_delay_hrd_flag:s,pic_struct_present_flag:o,bitstream_restriction:I}}(r):void 0;return t(r),{profile_idc:_,profile_compatibility:a,level_idc:E,seq_parameter_set_id:s,...I,log2_max_frame_num_minus4:c,pic_order_cnt_type:p,...T,max_num_ref_frames:f,gaps_in_frame_num_value_allowed_flag:S,pic_width_in_mbs_minus1:l,pic_height_in_map_units_minus1:N,frame_mbs_only_flag:u,mb_adaptive_frame_field_flag:R,direct_8x8_inference_flag:A,frame_cropping:O,vui_parameters:P}}function s(e,r){let _=8,t=8,a=!1;return{coefficients:[...Array(r.sizeOfScalingList)].map(((r,n)=>(0!==t&&(t=_+e.readSExp()&255,a=0===n&&0===t),_=0===t?_:t))),useDefaultScalingMatrix:a}}function o(e,r){return e.read1()?{ScalingList4x4:[...Array(6)].map((()=>e.read1()?s(e,{sizeOfScalingList:16}):void 0)),ScalingList8x8:[...Array(r)].map((()=>e.read1()?s(e,{sizeOfScalingList:64}):void 0))}:void 0}function d(e){const r=e.readExp();return{bit_rate_scale:e.read(4),cpb_size_scale:e.read(4),SchedSels:[...Array(r+1)].map((()=>({bit_rate_value_minus1:e.readExp(),cpb_size_value_minus1:e.readExp(),cbr_flag:e.read1()}))),initial_cpb_removal_delay_length_minus1:e.read(5),cpb_removal_delay_length_minus1:e.read(5),dpb_output_delay_length_minus1:e.read(5),time_offset_length:e.read(5)}}function I(e){if(0===e.length)return[];const r=e.length-1,_=[];let t=0;for(;t<r;){let a=0;for(;;){if(!(t<r))throw Error("EOF while reading payload type");const _=e[t++];if(a+=_,255!==_)break}let n=0;for(;;){if(!(t<r))throw Error("EOF while reading payload type");const _=e[t++];if(n+=_,255!==_)break}if(t+n>r)throw TypeError("EOF while reading payload");_.push([a,e.subarray(t,t+n)]),t+=n}return _}var c,p;function T(e){if(e.length<16)throw TypeError("EOF when reading UUID");const r=new DataView(e.buffer,e.byteOffset);return{uuid:r.getBigUint64(0)<<64n|r.getBigUint64(8),data:e.subarray(16)}}!function(e){e[e.BUFFERING_PERIOD=0]="BUFFERING_PERIOD",e[e.PIC_TIMING=1]="PIC_TIMING",e[e.PAN_SCAN_RECT=2]="PAN_SCAN_RECT",e[e.FILLER_PAYLOAD=3]="FILLER_PAYLOAD",e[e.USER_DATA_REGISTERED_ITU_T_T35=4]="USER_DATA_REGISTERED_ITU_T_T35",e[e.USER_DATA_UNREGISTERED=5]="USER_DATA_UNREGISTERED",e[e.RECOVERY_POINT=6]="RECOVERY_POINT",e[e.DEC_REF_PIC_MARKING_REPETITION=7]="DEC_REF_PIC_MARKING_REPETITION",e[e.SPARE_PIC=8]="SPARE_PIC",e[e.SCENE_INFO=9]="SCENE_INFO",e[e.SUB_SEQ_INFO=10]="SUB_SEQ_INFO",e[e.SUB_SEQ_LAYER_CHARACTERISTICS=11]="SUB_SEQ_LAYER_CHARACTERISTICS",e[e.SUB_SEQ_CHARACTERISTICS=12]="SUB_SEQ_CHARACTERISTICS",e[e.FULL_FRAME_FREEZE=13]="FULL_FRAME_FREEZE",e[e.FULL_FRAME_FREEZE_RELEASE=14]="FULL_FRAME_FREEZE_RELEASE",e[e.FULL_FRAME_SNAPSHOT=15]="FULL_FRAME_SNAPSHOT",e[e.PROGRESSIVE_REFINEMENT_SEGMENT_START=16]="PROGRESSIVE_REFINEMENT_SEGMENT_START",e[e.PROGRESSIVE_REFINEMENT_SEGMENT_END=17]="PROGRESSIVE_REFINEMENT_SEGMENT_END",e[e.MOTION_CONSTRAINED_SLICE_GROUP_SET=18]="MOTION_CONSTRAINED_SLICE_GROUP_SET",e[e.FILM_GRAIN_CHARACTERISTICS=19]="FILM_GRAIN_CHARACTERISTICS",e[e.DEBLOCKING_FILTER_DISPLAY_PREFERENCE=20]="DEBLOCKING_FILTER_DISPLAY_PREFERENCE",e[e.STEREO_VIDEO_INFO=21]="STEREO_VIDEO_INFO",e[e.POST_FILTER_HINT=22]="POST_FILTER_HINT",e[e.TONE_MAPPING_INFO=23]="TONE_MAPPING_INFO",e[e.SCALABILITY_INFO=24]="SCALABILITY_INFO",e[e.SUB_PIC_SCALABLE_LAYER=25]="SUB_PIC_SCALABLE_LAYER",e[e.NON_REQUIRED_LAYER_REP=26]="NON_REQUIRED_LAYER_REP",e[e.PRIORITY_LAYER_INFO=27]="PRIORITY_LAYER_INFO",e[e.LAYERS_NOT_PRESENT=28]="LAYERS_NOT_PRESENT",e[e.LAYER_DEPENDENCY_CHANGE=29]="LAYER_DEPENDENCY_CHANGE",e[e.SCALABLE_NESTING=30]="SCALABLE_NESTING",e[e.BASE_LAYER_TEMPORAL_HRD=31]="BASE_LAYER_TEMPORAL_HRD",e[e.QUALITY_LAYER_INTEGRITY_CHECK=32]="QUALITY_LAYER_INTEGRITY_CHECK",e[e.REDUNDANT_PIC_PROPERTY=33]="REDUNDANT_PIC_PROPERTY",e[e.TL0_DEP_REP_INDEX=34]="TL0_DEP_REP_INDEX",e[e.TL_SWITCHING_POINT=35]="TL_SWITCHING_POINT",e[e.PARALLEL_DECODING_INFO=36]="PARALLEL_DECODING_INFO",e[e.MVC_SCALABLE_NESTING=37]="MVC_SCALABLE_NESTING",e[e.VIEW_SCALABILITY_INFO=38]="VIEW_SCALABILITY_INFO",e[e.MULTIVIEW_SCENE_INFO=39]="MULTIVIEW_SCENE_INFO",e[e.MULTIVIEW_ACQUISITION_INFO=40]="MULTIVIEW_ACQUISITION_INFO",e[e.NON_REQUIRED_VIEW_COMPONENT=41]="NON_REQUIRED_VIEW_COMPONENT",e[e.VIEW_DEPENDENCY_CHANGE=42]="VIEW_DEPENDENCY_CHANGE",e[e.OPERATION_POINTS_NOT_PRESENT=43]="OPERATION_POINTS_NOT_PRESENT",e[e.BASE_VIEW_TEMPORAL_HRD=44]="BASE_VIEW_TEMPORAL_HRD",e[e.FRAME_PACKING_ARRANGEMENT=45]="FRAME_PACKING_ARRANGEMENT",e[e.MULTIVIEW_VIEW_POSITION=46]="MULTIVIEW_VIEW_POSITION",e[e.DISPLAY_ORIENTATION=47]="DISPLAY_ORIENTATION",e[e.MVCD_SCALABLE_NESTING=48]="MVCD_SCALABLE_NESTING",e[e.MVCD_VIEW_SCALABILITY_INFO=49]="MVCD_VIEW_SCALABILITY_INFO",e[e.DEPTH_REPRESENTATION_INFO=50]="DEPTH_REPRESENTATION_INFO",e[e.THREE_DIMENSIONAL_REFERENCE_DISPLAYS_INFO=51]="THREE_DIMENSIONAL_REFERENCE_DISPLAYS_INFO",e[e.DEPTH_TIMING=52]="DEPTH_TIMING",e[e.DEPTH_SAMPLING_INFO=53]="DEPTH_SAMPLING_INFO",e[e.CONSTRAINED_DEPTH_PARAMETER_SET_IDENTIFIER=54]="CONSTRAINED_DEPTH_PARAMETER_SET_IDENTIFIER",e[e.GREEN_METADATA=56]="GREEN_METADATA",e[e.MASTERING_DISPLAY_COLOUR_VOLUME=137]="MASTERING_DISPLAY_COLOUR_VOLUME",e[e.COLOUR_REMAPPING_INFO=142]="COLOUR_REMAPPING_INFO",e[e.CONTENT_LIGHT_LEVEL_INFO=144]="CONTENT_LIGHT_LEVEL_INFO",e[e.ALTERNATIVE_TRANSFER_CHARACTERISTICS=147]="ALTERNATIVE_TRANSFER_CHARACTERISTICS",e[e.AMBIENT_VIEWING_ENVIRONMENT=148]="AMBIENT_VIEWING_ENVIRONMENT",e[e.CONTENT_COLOUR_VOLUME=149]="CONTENT_COLOUR_VOLUME",e[e.EQUIRECTANGULAR_PROJECTION=150]="EQUIRECTANGULAR_PROJECTION",e[e.CUBEMAP_PROJECTION=151]="CUBEMAP_PROJECTION",e[e.SPHERE_ROTATION=154]="SPHERE_ROTATION",e[e.REGIONWISE_PACKING=155]="REGIONWISE_PACKING",e[e.OMNI_VIEWPORT=156]="OMNI_VIEWPORT",e[e.ALTERNATIVE_DEPTH_INFO=181]="ALTERNATIVE_DEPTH_INFO",e[e.SEI_MANIFEST=200]="SEI_MANIFEST",e[e.SEI_PREFIX_INDICATION=201]="SEI_PREFIX_INDICATION"}(c=c||(c={})),function(e){e[e.PROGRESSIVE=0]="PROGRESSIVE",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.TOP_BOTTOM=3]="TOP_BOTTOM",e[e.BOTTOM_TOP=4]="BOTTOM_TOP",e[e.TOP_BOTTOM_TOP=5]="TOP_BOTTOM_TOP",e[e.BOTTOM_TOP_BOTTOM=6]="BOTTOM_TOP_BOTTOM",e[e.DOUBLING=7]="DOUBLING",e[e.TRIPLING=8]="TRIPLING"}(p=p||(p={}));const f=[1,1,1,2,2,3,3,2,3];function S(e,r){if(!r.strict){const r=new Uint8Array(e.length+1);r.set(e),e=r}const _=new n(e),t={...r.CpbDpbDelaysPresentFlag?{cpb_removal_delay:_.read((r.cpb_removal_delay_length_minus1||0)+1),dpb_output_delay:_.read((r.dpb_output_delay_length_minus1||0)+1)}:void 0,...r.pic_struct_present_flag?function(){const e=_.read(4);if(!(e<f.length))throw Error(`invalid pic_struct ${e}`);const t=[...Array(f[e])].map((()=>function(){if(!_.read1())return;let e={ct_type:_.read(2),nuit_field_based_flag:_.read1(),counting_type:_.read(5),full_timestamp_flag:_.read1(),discontinuity_flag:_.read1(),cnt_dropped_flag:_.read1(),n_frames:_.read(8),time_offset:0};e.full_timestamp_flag?(e.seconds_value=_.read(6),e.minutes_value=_.read(6),e.hours_value=_.read(5)):_.read1()&&(e.seconds_value=_.read(6),_.read1()&&(e.minutes_value=_.read(6),_.read1()&&(e.hours_value=_.read(5))));return e.time_offset=_.read(r.time_offset_length||0),e}()));return{pic_struct:e,timestamps:t}}():void 0};return r.strict&&function(e){if(e.offset<e.length){if(!(e.length-e.offset<8))throw TypeError(`unexpected trailing data found: ${e.length-e.offset} bits`);if(!e.read1()||e.read(e.length-e.offset))throw TypeError("unexpected alignment trailing bits")}}(_),t}class l{constructor(){this.receivedSPS={},this.receivedPPS={}}processNALU(r){const t=r.nal_unit_type;if(t===e.SPS)return this.processSPS(r.rbsp),!0;if(t===e.PPS)return this.processPPS(r.rbsp),!0;if(t===e.SLICE_IDR||t===e.SLICE_NON_IDR||t===e.SLICE_PARTITION_A){const e=new n(_(r.rbsp.subarray(0,16)));return e.readExp(),e.readExp(),this.activate(e.readExp()),!0}return!1}processSPS(e){const r=E(_(e)),t=function(e){if(e===e>>>0&&e<32)return e;throw Error(`invalid SPS ID ${e}`)}(r.seq_parameter_set_id);this.receivedSPS[t]=r}processPPS(e){const r=function(e,r){const _=new n(e),a=_.readExp(),i=_.readExp(),E=_.read1(),s=_.read1(),d=_.readExp(),I=d>0?(()=>{const e=_.readExp(),r=[...Array(d+1)],t=0===e?{run_length_minus1:r.map((()=>_.readExp()))}:1===e?{}:2===e?{groups:r.map((()=>({top_left:_.readExp(),bottom_right:_.readExp()})))}:e>=3&&e<=5?{slice_group_change_direction_flag:_.read1(),slice_group_change_rate_minus1:_.readExp()}:6===e?{slice_group_id:[...Array(_.readExp()+1)].map((()=>_.read(Math.ceil(Math.log2(d+1)))))}:(()=>{throw Error(`invalid slice_group_map_type ${e}`)})();return{slice_group_map_type:e,...t}})():void 0,c=_.readExp(),p=_.readExp(),T=_.read1(),f=_.read(2),S=_.readSExp(),l=_.readSExp(),N=_.readSExp(),u=_.read1(),R=_.read1(),A=_.read1(),O=function(e){return!(e.length-e.offset<=8&&(e.length===e.offset||(e=e.clone()).read1()&&!e.read(e.length-e.offset)))}(_)?(()=>{const e=_.read1(),t=r.chroma_format_idc(i);return{transform_8x8_mode_flag:e,pic_scaling_matrix:o(_,e?3!==t?2:6:0),second_chroma_qp_index_offset:_.readSExp()}})():void 0;return t(_),{pic_parameter_set_id:a,seq_parameter_set_id:i,entropy_coding_mode_flag:E,bottom_field_pic_order_in_frame_present_flag:s,num_slice_groups_minus1:d,slice_group_map:I,num_ref_idx_l0_default_active_minus1:c,num_ref_idx_l1_default_active_minus1:p,weighted_pred_flag:T,weighted_bipred_idc:f,pic_init_qp_minus26:S,pic_init_qs_minus26:l,chroma_qp_index_offset:N,deblocking_filter_control_present_flag:u,constrained_intra_pred_flag:R,redundant_pic_cnt_present_flag:A,optionalTrailing:O}}(_(e),{chroma_format_idc:e=>{if(!(e in this.receivedSPS))throw Error(`referenced missing SPS ${e}`);return this.receivedSPS[e].chroma_format_idc??1}}),a=function(e){if(e===e>>>0&&e<256)return e;throw Error(`invalid PPS ID ${e}`)}(r.pic_parameter_set_id);this.receivedPPS[a]=r}activate(e){if(!(e in this.receivedPPS))throw Error(`activated missing PPS ${e}`);this.currentPPS=this.receivedPPS[e];const r=this.currentPPS.seq_parameter_set_id;if(!(r in this.receivedSPS))throw Error(`activated missing SPS ${r}`);this.currentSPS=this.receivedSPS[r]}}class N extends Error{constructor(e,r){super(N.formatMessage(e),{cause:r}),this.context=e,this.cause=r,this.name="SEIExtractorError"}static formatMessage(e){return"psManager"===e?"Error when processing parameter sets":"nalu"===e?"Error when parsing SEI NALU":"message"===e?"Error when parsing SEI message":"missingPs"===e?"Parsing failed due to missing SPS/PPS":"Unknown parsing error"}}const u=(e,r)=>r&&"SEIExtractorError"===r.name?r:new N(e,r);class R{constructor(e={}){this.options=e,this.psManager=new l,this.mutePsErrors=!0}processAU(t){const a=ArrayBuffer.isView(t)?t:new Uint8Array(t),[n,...i]=function(e,r={}){const _=[];let t=0,a=0,n=e.length-2;for(;a<n;){for(;a<n&&(0!==e[a]||0!==e[a+1]||1!==e[a+2]);)a++;a>=n&&(a=e.length);let i=a;for(;i>t&&0===e[i-1];)i--;if(0!==t||r.includeLeading)_.push(e.subarray(t,i));else if(i!==t)throw Error(`byte stream contains ${i} bytes of leading data`);t=a+=3}return _}(a,{includeLeading:!0});n.length&&this.handleError(u("byteStream",new Error(`${n.length} bytes of leading data in AU`)));const E=[];for(const e of i)try{E.push(r(e))}catch(e){this.handleError(u("byteStream",e))}const s=[];if(this.options.enablePicTiming)for(const r of E){r.nal_unit_type===e.SPS&&(this.mutePsErrors=!1);try{this.psManager.processNALU(r)}catch(e){this.handleError(u("psManager",e))}const _=r.nal_unit_type;if(_===e.SLICE_IDR||_===e.SLICE_NON_IDR||_===e.SLICE_PARTITION_A)break}const o=([e,r])=>{e===c.USER_DATA_UNREGISTERED&&(this.options.enableUserDataUnregistered??1)?s.push({type:e,...T(r)}):e===c.PIC_TIMING&&this.options.enablePicTiming&&s.push({type:e,message:S(r,this.derivePicTimingOptions())})},d=e=>{try{o(e)}catch(e){this.handleError(u("message",e))}};for(const r of E)try{r.nal_unit_type===e.SEI&&I(_(r.rbsp)).forEach(d)}catch(e){this.handleError(u("nalu",e))}return s}derivePicTimingOptions(){if(!this.psManager.currentSPS)throw new N("missingPs","cannot parse picture timing: no current SPS");const e=function(e){const r=e.vui_parameters?.nal_hrd_parameters??e.vui_parameters?.vcl_hrd_parameters;return{CpbDpbDelaysPresentFlag:Boolean(r),cpb_removal_delay_length_minus1:r?.cpb_removal_delay_length_minus1??23,dpb_output_delay_length_minus1:r?.dpb_output_delay_length_minus1??23,time_offset_length:r?.time_offset_length??24,pic_struct_present_flag:e.vui_parameters?.pic_struct_present_flag??!1}}(this.psManager.currentSPS);return this.options.forceCpbDpbDelaysPresent&&(e.CpbDpbDelaysPresentFlag=!0),e}handleError(e){if(("psManager"===e.context||"missingPs"===e.context)&&this.mutePsErrors)return;const r=this.options.errors??"log";if("log"!==r)throw"throw"===r?e:TypeError(`unknown error behavior ${r}`);console.warn(e.message+":",e.cause)}}const A={wrap:e=>[e,[]],unwrap:e=>({unwrapped:e})};function O(e,r={}){const _=((e=A)=>(r,_)=>{const t=e.unwrap(r);t&&_(t.unwrapped)})(r.wrapping),t=r=>_(r.data,(_=>{if("transformer"!==_.type)throw new Error(`received unexpected ${_.type} message`);e(_.transformer,_.options,r),r.stopImmediatePropagation()})),a=r=>_(r.transformer.options,(_=>{if("options"!==_.type)throw new Error(`received unexpected ${_.type} message`);e(r.transformer,_.options,r),r.stopImmediatePropagation()}));return self.addEventListener("message",t),self.addEventListener("rtctransform",a),()=>{self.removeEventListener("message",t),self.removeEventListener("rtctransform",a)}}function P(e,r={}){const _=((e=A)=>(r,_)=>{const[t,a]=e.wrap(r);return[t,[..._,...a]]})(r.wrapping),t=(e,r)=>{const[t,a]=_(e,r);self.postMessage(t,{transfer:a})};return O(((r,_,a)=>{const{id:n,options:i}=_,E=e(r,i,a),s=new TransformStream({start(){},transform(e,r){r.enqueue(e),(e=>{const r=E(e);r&&t({type:"metadata",id:n,metadata:r[0]},r[1])})(e)}});r.readable.pipeThrough(s).pipeTo(r.writable),t({type:"ready",id:n},[])}))}!function(e,r={}){P(((...r)=>{const _=e(...r);return e=>{const r=e,t=_(r);if(t){const[e,_]=t;return[{ts:r.timestamp,metadata:e},_]}}}),r)}((()=>{const e=new R({enableUserDataUnregistered:!0});function r(e){if(8!==e.length)throw new Error(`invalid payload length ${e.length}`);return new DataView(e.buffer,e.byteOffset,e.byteLength).getBigUint64(0)}return function(_){const t=e.processAU(_.data);console.warn("meta",t);const a=t.flatMap((e=>e.type!==c.USER_DATA_UNREGISTERED||0x9a21f3be31f04b78b0bec7f7dbb97250n!==e.uuid&&0x00112233445566778899aabbccddeeffn!==e.uuid?[]:[e.data]));if(a.length>1)throw new Error("multiple timecode metadata messages in AU");return a.length<1&&console.warn("timecode metadata not present in AU",_.timestamp),a[0]?[r(a[0]),[]]:void 0}}))}));
