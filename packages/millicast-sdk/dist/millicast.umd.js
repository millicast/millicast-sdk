(function(ie,me){typeof exports=="object"&&typeof module<"u"?me(exports):typeof define=="function"&&define.amd?define(["exports"],me):(ie=typeof globalThis<"u"?globalThis:ie||self,me(ie.millicast={}))})(this,function(ie){"use strict";var Va=Object.defineProperty,ja=Object.defineProperties;var qa=Object.getOwnPropertyDescriptors;var cr=Object.getOwnPropertySymbols;var Bs=Object.prototype.hasOwnProperty,Fs=Object.prototype.propertyIsEnumerable;var Us=(ie,me,ve)=>me in ie?Va(ie,me,{enumerable:!0,configurable:!0,writable:!0,value:ve}):ie[me]=ve,se=(ie,me)=>{for(var ve in me||(me={}))Bs.call(me,ve)&&Us(ie,ve,me[ve]);if(cr)for(var ve of cr(me))Fs.call(me,ve)&&Us(ie,ve,me[ve]);return ie},je=(ie,me)=>ja(ie,qa(me));var gt=(ie,me)=>{var ve={};for(var ke in ie)Bs.call(ie,ke)&&me.indexOf(ke)<0&&(ve[ke]=ie[ke]);if(ie!=null&&cr)for(var ke of cr(ie))me.indexOf(ke)<0&&Fs.call(ie,ke)&&(ve[ke]=ie[ke]);return ve};var Ps;var me=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ke={exports:{}};/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */var Os=ke.exports,Hn;function Ns(){return Hn||(Hn=1,function(n){(function(e){var t={};t.VERSION="1.6.1";var r,i={},o=function(l,w){return function(){return w.apply(l,arguments)}},c=function(){var l=arguments,w=l[0],g,p;for(p=1;p<l.length;p++)for(g in l[p])!(g in w)&&l[p].hasOwnProperty(g)&&(w[g]=l[p][g]);return w},a=function(l,w){return{value:l,name:w}};t.TRACE=a(1,"TRACE"),t.DEBUG=a(2,"DEBUG"),t.INFO=a(3,"INFO"),t.TIME=a(4,"TIME"),t.WARN=a(5,"WARN"),t.ERROR=a(8,"ERROR"),t.OFF=a(99,"OFF");var f=function(l){this.context=l,this.setLevel(l.filterLevel),this.log=this.info};f.prototype={setLevel:function(l){l&&"value"in l&&(this.context.filterLevel=l)},getLevel:function(){return this.context.filterLevel},enabledFor:function(l){var w=this.context.filterLevel;return l.value>=w.value},trace:function(){this.invoke(t.TRACE,arguments)},debug:function(){this.invoke(t.DEBUG,arguments)},info:function(){this.invoke(t.INFO,arguments)},warn:function(){this.invoke(t.WARN,arguments)},error:function(){this.invoke(t.ERROR,arguments)},time:function(l){typeof l=="string"&&l.length>0&&this.invoke(t.TIME,[l,"start"])},timeEnd:function(l){typeof l=="string"&&l.length>0&&this.invoke(t.TIME,[l,"end"])},invoke:function(l,w){r&&this.enabledFor(l)&&r(w,c({level:l},this.context))}};var d=new f({filterLevel:t.OFF});(function(){var l=t;l.enabledFor=o(d,d.enabledFor),l.trace=o(d,d.trace),l.debug=o(d,d.debug),l.time=o(d,d.time),l.timeEnd=o(d,d.timeEnd),l.info=o(d,d.info),l.warn=o(d,d.warn),l.error=o(d,d.error),l.log=l.info})(),t.setHandler=function(l){r=l},t.setLevel=function(l){d.setLevel(l);for(var w in i)i.hasOwnProperty(w)&&i[w].setLevel(l)},t.getLevel=function(){return d.getLevel()},t.get=function(l){return i[l]||(i[l]=new f(c({name:l},d.context)))},t.createDefaultHandler=function(l){l=l||{},l.formatter=l.formatter||function(m,I){I.name&&m.unshift("["+I.name+"]")};var w={},g=function(p,m){Function.prototype.apply.call(p,console,m)};return typeof console>"u"?function(){}:function(p,m){p=Array.prototype.slice.call(p);var I=console.log,R;m.level===t.TIME?(R=(m.name?"["+m.name+"] ":"")+p[0],p[1]==="start"?console.time?console.time(R):w[R]=new Date().getTime():console.timeEnd?console.timeEnd(R):g(I,[R+": "+(new Date().getTime()-w[R])+"ms"])):(m.level===t.WARN&&console.warn?I=console.warn:m.level===t.ERROR&&console.error?I=console.error:m.level===t.INFO&&console.info?I=console.info:m.level===t.DEBUG&&console.debug?I=console.debug:m.level===t.TRACE&&console.trace&&(I=console.trace),l.formatter(p,m),g(I,p))}},t.useDefaults=function(l){t.setLevel(l&&l.defaultLevel||t.DEBUG),t.setHandler(t.createDefaultHandler(l))},t.setDefaults=t.useDefaults,n.exports?n.exports=t:(t._prevLogger=e.Logger,t.noConflict=function(){return e.Logger=t._prevLogger,t},e.Logger=t)})(Os)}(ke)),ke.exports}var _s=Ns();const rt=ve(_s),Wn="0.6.0-RC-2",Tt=60,Vs=((Ps=window==null?void 0:window.navigator)==null?void 0:Ps.userAgent)||"No user agent available";let kt="",At="",Dt="",yt="",wt="",$n="",Mt="",Lt=0;const Pt=[];function js(n){function e(t,r){return{ts:Math.round(r.timestamp)||"",ot:t==="audio"?"a":"v",bl:r.jitterBufferDelay||0,br:Math.round(r.bitrateBitsPerSecond||0),pld:r.packetsLostDeltaPerSecond||0,j:r.jitter||0,mtp:r.packetRate||0,mid:r.mid||"",mimeType:r.mimeType||""}}return n.stats=n.stats.reduce((t,r)=>{const i=r.audio.inbounds.length!==0?r.audio.inbounds.map(c=>e("audio",c)):r.audio.outbounds.map(c=>e("audio",c)),o=r.video.inbounds.length!==0?r.video.inbounds.map(c=>e("video",c)):r.video.outbounds.map(c=>e("video",c));return t.concat([...i,...o])},[]),n}const Ae={initAccountId:n=>{kt=kt===""?n:kt},initStreamName:n=>{At=At===""?n:At},initSubscriberId:n=>{Dt=Dt===""?n:Dt},initStreamViewId:n=>{yt=yt===""?n:yt},initFeedId:n=>{wt=wt===""?n:wt},setConnectionTime:n=>{Lt=Lt===0?n:Lt},setConnectionState:n=>{$n=n},setClusterId:n=>{Mt=Mt===""?n:Mt},addStats:n=>{Pt.length===Tt&&Pt.shift(),Pt.push(n)},get:(n=Tt,e="JSON")=>{let t;!Number.isInteger(n)||n>Tt||n<=0?t=Tt:t=n;const r={client:"@millicast/millicast-sdk",version:Wn,timestamp:new Date().toISOString(),userAgent:Vs,clusterId:Mt,accountId:kt,streamName:At,subscriberId:Dt,connection:$n,stats:Pt.slice(-t),connectionDurationMs:new Date().getTime()-Lt};return wt!==""?r.feedId=wt:yt!==""&&(r.streamViewId=yt),e==="CMCD"?js(r):r}};rt.useDefaults({defaultLevel:rt.TRACE});const Ut=["TRACE","DEBUG","INFO","WARN","ERROR"],zn=(n,e)=>{n.unshift("[".concat(e.name||"Global","] ").concat(new Date().toISOString()," - ").concat(e.level.name," -"))},Kn=(n,e)=>e?n.value>=nt[e].value:n.value>=Bt.value,qs=(n,e)=>{n=Array.prototype.slice.call(n),n=n.map(t=>typeof t=="object"?JSON.stringify(t):t),zn(n,e),vt!==0?(dt.push(n.join(" ")),dt.length>=vt&&(dt=dt.slice(-vt))):dt=[]},Gs=rt.createDefaultHandler({formatter:zn});rt.setHandler((n,e)=>{qs(n,e),Kn(e.level,e.name)&&Gs(n,e);for(const{handler:t,level:r}of Xn)e.level.value>=r.value&&t(n,e)});let vt=1e4,dt=[],Bt=rt.OFF;const nt={},Xn=[],qe=je(se({},rt),{enabledFor:Kn,getHistory:()=>dt,getHistoryMaxSize:()=>vt,setHistoryMaxSize:n=>{vt=n},setLevel:n=>{Bt=n;for(const e in nt)nt[e]=n},getLevel:()=>Bt,get:n=>{nt[n]||(nt[n]=Bt);const e=rt.get(n);return e.setLevel=t=>{nt[n]=t},e.getLevel=()=>nt[n],e},setHandler:(n,e)=>{Xn.push({handler:n,level:e})},diagnose:(n={})=>{let e;const t={statsCount:60,historySize:1e3,minLogLevel:"TRACE",statsFormat:"JSON"};typeof n=="number"?(t.statsCount=n,e=t):e=se(se({},t),n);const{statsCount:r,historySize:i,minLogLevel:o,statsFormat:c}=e,a=Ae.get(r,c),f=qe.getHistory();if(!Number.isInteger(i)||i<=0)throw new Error("Invalid Argument Exception : historySize must be a positive integer.");if(!Ut.includes(o.toUpperCase()))throw new Error('Invalid Argument Exception : the minLogLevel parameter only excepts "trace", "debug", "info", "warn", and "error" as arguments.');if(Ut.includes(o.toUpperCase())){const d=Ut.slice(Ut.indexOf(o.toUpperCase())),l=f.filter(w=>d.some(g=>w.includes(g)));a.history=l.slice(-i)}return a},JSON:"JSON",CMCD:"CMCD",VERSION:Wn});var Ft={exports:{}},Yn;function ur(){if(Yn)return Ft.exports;Yn=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(S,E,b){return Function.prototype.apply.call(S,E,b)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:t=function(S){return Object.getOwnPropertyNames(S)};function r(v){console&&console.warn&&console.warn(v)}var i=Number.isNaN||function(S){return S!==S};function o(){o.init.call(this)}Ft.exports=o,Ft.exports.once=M,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function a(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");c=v}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||i(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function f(v){return v._maxListeners===void 0?o.defaultMaxListeners:v._maxListeners}o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(S){for(var E=[],b=1;b<arguments.length;b++)E.push(arguments[b]);var x=S==="error",P=this._events;if(P!==void 0)x=x&&P.error===void 0;else if(!x)return!1;if(x){var k;if(E.length>0&&(k=E[0]),k instanceof Error)throw k;var O=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw O.context=k,O}var J=P[S];if(J===void 0)return!1;if(typeof J=="function")e(J,this,E);else for(var H=J.length,ee=m(J,H),b=0;b<H;++b)e(ee[b],this,E);return!0};function d(v,S,E,b){var x,P,k;if(a(E),P=v._events,P===void 0?(P=v._events=Object.create(null),v._eventsCount=0):(P.newListener!==void 0&&(v.emit("newListener",S,E.listener?E.listener:E),P=v._events),k=P[S]),k===void 0)k=P[S]=E,++v._eventsCount;else if(typeof k=="function"?k=P[S]=b?[E,k]:[k,E]:b?k.unshift(E):k.push(E),x=f(v),x>0&&k.length>x&&!k.warned){k.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=v,O.type=S,O.count=k.length,r(O)}return v}o.prototype.addListener=function(S,E){return d(this,S,E,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(S,E){return d(this,S,E,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w(v,S,E){var b={fired:!1,wrapFn:void 0,target:v,type:S,listener:E},x=l.bind(b);return x.listener=E,b.wrapFn=x,x}o.prototype.once=function(S,E){return a(E),this.on(S,w(this,S,E)),this},o.prototype.prependOnceListener=function(S,E){return a(E),this.prependListener(S,w(this,S,E)),this},o.prototype.removeListener=function(S,E){var b,x,P,k,O;if(a(E),x=this._events,x===void 0)return this;if(b=x[S],b===void 0)return this;if(b===E||b.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete x[S],x.removeListener&&this.emit("removeListener",S,b.listener||E));else if(typeof b!="function"){for(P=-1,k=b.length-1;k>=0;k--)if(b[k]===E||b[k].listener===E){O=b[k].listener,P=k;break}if(P<0)return this;P===0?b.shift():I(b,P),b.length===1&&(x[S]=b[0]),x.removeListener!==void 0&&this.emit("removeListener",S,O||E)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(S){var E,b,x;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[S]),this;if(arguments.length===0){var P=Object.keys(b),k;for(x=0;x<P.length;++x)k=P[x],k!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=b[S],typeof E=="function")this.removeListener(S,E);else if(E!==void 0)for(x=E.length-1;x>=0;x--)this.removeListener(S,E[x]);return this};function g(v,S,E){var b=v._events;if(b===void 0)return[];var x=b[S];return x===void 0?[]:typeof x=="function"?E?[x.listener||x]:[x]:E?R(x):m(x,x.length)}o.prototype.listeners=function(S){return g(this,S,!0)},o.prototype.rawListeners=function(S){return g(this,S,!1)},o.listenerCount=function(v,S){return typeof v.listenerCount=="function"?v.listenerCount(S):p.call(v,S)},o.prototype.listenerCount=p;function p(v){var S=this._events;if(S!==void 0){var E=S[v];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function m(v,S){for(var E=new Array(S),b=0;b<S;++b)E[b]=v[b];return E}function I(v,S){for(;S+1<v.length;S++)v[S]=v[S+1];v.pop()}function R(v){for(var S=new Array(v.length),E=0;E<S.length;++E)S[E]=v[E].listener||v[E];return S}function M(v,S){return new Promise(function(E,b){function x(k){v.removeListener(S,P),b(k)}function P(){typeof v.removeListener=="function"&&v.removeListener("error",x),E([].slice.call(arguments))}F(v,S,P,{once:!0}),S!=="error"&&U(v,x,{once:!0})})}function U(v,S,E){typeof v.on=="function"&&F(v,"error",S,E)}function F(v,S,E,b){if(typeof v.on=="function")b.once?v.once(S,E):v.on(S,E);else if(typeof v.addEventListener=="function")v.addEventListener(S,function x(P){b.once&&v.removeEventListener(S,x),E(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}return Ft.exports}var Hs=ur();const Ot=ve(Hs);var Nt={exports:{}},Jn;function Ws(){if(Jn)return Nt.exports;Jn=1,Nt.exports=e,Nt.exports.filter=t;var n=ur().EventEmitter;function e(r,i,o){Array.isArray(o)||(o=[o]);var c=[];return o.forEach(function(a){var f=function(){var d=[].slice.call(arguments);d.unshift(a),i.emit.apply(i,d)};c.push(f),r.on(a,f)}),function(){o.forEach(function(f,d){r.removeListener(f,c[d])})}}function t(r,i){var o=new n;return e(r,o,i),o}return Nt.exports}var $s=Ws();const _t=ve($s);var dr={exports:{}};/*! For license information please see webrtc-stats.js.LICENSE.txt */var Zn;function zs(){return Zn||(Zn=1,function(n,e){(function(t,r){n.exports=r()})(self,()=>{return t={7:i=>{var o,c=typeof Reflect=="object"?Reflect:null,a=c&&typeof c.apply=="function"?c.apply:function(v,S,E){return Function.prototype.apply.call(v,S,E)};o=c&&typeof c.ownKeys=="function"?c.ownKeys:Object.getOwnPropertySymbols?function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:function(v){return Object.getOwnPropertyNames(v)};var f=Number.isNaN||function(v){return v!=v};function d(){d.init.call(this)}i.exports=d,i.exports.once=function(v,S){return new Promise(function(E,b){function x(k){v.removeListener(S,P),b(k)}function P(){typeof v.removeListener=="function"&&v.removeListener("error",x),E([].slice.call(arguments))}F(v,S,P,{once:!0}),S!=="error"&&function(k,O){typeof k.on=="function"&&F(k,"error",O,{once:!0})}(v,x)})},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var l=10;function w(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}function g(v){return v._maxListeners===void 0?d.defaultMaxListeners:v._maxListeners}function p(v,S,E,b){var x,P,k,O;if(w(E),(P=v._events)===void 0?(P=v._events=Object.create(null),v._eventsCount=0):(P.newListener!==void 0&&(v.emit("newListener",S,E.listener?E.listener:E),P=v._events),k=P[S]),k===void 0)k=P[S]=E,++v._eventsCount;else if(typeof k=="function"?k=P[S]=b?[E,k]:[k,E]:b?k.unshift(E):k.push(E),(x=g(v))>0&&k.length>x&&!k.warned){k.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=v,J.type=S,J.count=k.length,O=J,console&&console.warn&&console.warn(O)}return v}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(v,S,E){var b={fired:!1,wrapFn:void 0,target:v,type:S,listener:E},x=m.bind(b);return x.listener=E,b.wrapFn=x,x}function R(v,S,E){var b=v._events;if(b===void 0)return[];var x=b[S];return x===void 0?[]:typeof x=="function"?E?[x.listener||x]:[x]:E?function(P){for(var k=new Array(P.length),O=0;O<k.length;++O)k[O]=P[O].listener||P[O];return k}(x):U(x,x.length)}function M(v){var S=this._events;if(S!==void 0){var E=S[v];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}function U(v,S){for(var E=new Array(S),b=0;b<S;++b)E[b]=v[b];return E}function F(v,S,E,b){if(typeof v.on=="function")b.once?v.once(S,E):v.on(S,E);else{if(typeof v.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v);v.addEventListener(S,function x(P){b.once&&v.removeEventListener(S,x),E(P)})}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(v){if(typeof v!="number"||v<0||f(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");l=v}}),d.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||f(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this},d.prototype.getMaxListeners=function(){return g(this)},d.prototype.emit=function(v){for(var S=[],E=1;E<arguments.length;E++)S.push(arguments[E]);var b=v==="error",x=this._events;if(x!==void 0)b=b&&x.error===void 0;else if(!b)return!1;if(b){var P;if(S.length>0&&(P=S[0]),P instanceof Error)throw P;var k=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw k.context=P,k}var O=x[v];if(O===void 0)return!1;if(typeof O=="function")a(O,this,S);else{var J=O.length,H=U(O,J);for(E=0;E<J;++E)a(H[E],this,S)}return!0},d.prototype.addListener=function(v,S){return p(this,v,S,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(v,S){return p(this,v,S,!0)},d.prototype.once=function(v,S){return w(S),this.on(v,I(this,v,S)),this},d.prototype.prependOnceListener=function(v,S){return w(S),this.prependListener(v,I(this,v,S)),this},d.prototype.removeListener=function(v,S){var E,b,x,P,k;if(w(S),(b=this._events)===void 0)return this;if((E=b[v])===void 0)return this;if(E===S||E.listener===S)--this._eventsCount==0?this._events=Object.create(null):(delete b[v],b.removeListener&&this.emit("removeListener",v,E.listener||S));else if(typeof E!="function"){for(x=-1,P=E.length-1;P>=0;P--)if(E[P]===S||E[P].listener===S){k=E[P].listener,x=P;break}if(x<0)return this;x===0?E.shift():function(O,J){for(;J+1<O.length;J++)O[J]=O[J+1];O.pop()}(E,x),E.length===1&&(b[v]=E[0]),b.removeListener!==void 0&&this.emit("removeListener",v,k||S)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(v){var S,E,b;if((E=this._events)===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[v]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete E[v]),this;if(arguments.length===0){var x,P=Object.keys(E);for(b=0;b<P.length;++b)(x=P[b])!=="removeListener"&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(S=E[v])=="function")this.removeListener(v,S);else if(S!==void 0)for(b=S.length-1;b>=0;b--)this.removeListener(v,S[b]);return this},d.prototype.listeners=function(v){return R(this,v,!0)},d.prototype.rawListeners=function(v){return R(this,v,!1)},d.listenerCount=function(v,S){return typeof v.listenerCount=="function"?v.listenerCount(S):M.call(v,S)},d.prototype.listenerCount=M,d.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},156:function(i,o,c){var a=this&&this.__createBinding||(Object.create?function(w,g,p,m){m===void 0&&(m=p);var I=Object.getOwnPropertyDescriptor(g,p);I&&!("get"in I?!g.__esModule:I.writable||I.configurable)||(I={enumerable:!0,get:function(){return g[p]}}),Object.defineProperty(w,m,I)}:function(w,g,p,m){m===void 0&&(m=p),w[m]=g[p]}),f=this&&this.__exportStar||function(w,g){for(var p in w)p==="default"||Object.prototype.hasOwnProperty.call(g,p)||a(g,w,p)},d=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(o,"__esModule",{value:!0}),o.Logger=void 0;var l=c(586);Object.defineProperty(o,"Logger",{enumerable:!0,get:function(){return d(l).default}}),f(c(284),o),f(c(280),o),f(c(738),o),f(c(767),o)},185:(i,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.calculatePacketsLostRatio=o.calculateRate=o.getMediaKind=void 0,o.getMediaKind=c=>{let a=c.kind||c.mediaType;return["audio","video"].includes(a)||c.type!=="inbound-rtp"||(a=c.id.toLocaleLowerCase().includes("video")?"video":"audio"),a},o.calculateRate=(c,a,f,d)=>f&&d?(a-d)/((c-f)/1e3):0,o.calculatePacketsLostRatio=(c,a,f,d)=>{const l=c-(f!=null?f:0),w=l+(a-(d!=null?d:0));return w===0?0:l/w}},280:(i,o)=>{Object.defineProperty(o,"__esModule",{value:!0})},284:function(i,o,c){var a,f,d,l,w,g,p,m,I,R,M,U,F,v,S,E,b=this&&this.__awaiter||function(j,B,V,X){return new(V||(V=Promise))(function(Y,_){function N(z){try{W(X.next(z))}catch(K){_(K)}}function q(z){try{W(X.throw(z))}catch(K){_(K)}}function W(z){var K;z.done?Y(z.value):(K=z.value,K instanceof V?K:new V(function(ne){ne(K)})).then(N,q)}W((X=X.apply(j,B||[])).next())})},x=this&&this.__classPrivateFieldSet||function(j,B,V,X,Y){if(X==="m")throw new TypeError("Private method is not writable");if(X==="a"&&!Y)throw new TypeError("Private accessor was defined without a setter");if(typeof B=="function"?j!==B||!Y:!B.has(j))throw new TypeError("Cannot write private member to an object whose class did not declare it");return X==="a"?Y.call(j,V):Y?Y.value=V:B.set(j,V),V},P=this&&this.__classPrivateFieldGet||function(j,B,V,X){if(V==="a"&&!X)throw new TypeError("Private accessor was defined without a getter");if(typeof B=="function"?j!==B||!X:!B.has(j))throw new TypeError("Cannot read private member from an object whose class did not declare it");return V==="m"?X:V==="a"?X.call(j):X?X.value:B.get(j)},k=this&&this.__importDefault||function(j){return j&&j.__esModule?j:{default:j}};Object.defineProperty(o,"__esModule",{value:!0}),o.WebRTCStats=void 0;const O=c(7),J=k(c(586)),H=c(738),ee=c(185);class G extends O.EventEmitter{constructor(B){super(),a.add(this),f.set(this,void 0),d.set(this,void 0),l.set(this,void 0),w.set(this,null),g.set(this,void 0),p.set(this,null),this.start=()=>{P(this,g,"f").info("WebRTC statistics collection is starting..."),x(this,p,null,"f"),x(this,w,setInterval(P(this,m,"f"),P(this,d,"f")),"f")},this.stop=()=>{P(this,w,"f")&&(clearInterval(P(this,w,"f")),x(this,w,null,"f"),P(this,g,"f").info("WebRTC statistics collection has stopped."))},m.set(this,()=>b(this,void 0,void 0,function*(){let V,X;try{P(this,g,"f").trace("Requesting WebRTC statistics..."),V=yield P(this,f,"f").call(this),X=new Date().toISOString()}catch(N){return P(this,g,"f").error("Problem collecting the WebRTC statistics.",N),void this.emit("error","Problem collecting the WebRTC statistics - ".concat(N))}const Y=Array.from(V.values()),_={timestamp:X,input:{audio:[],video:[]},output:{audio:[],video:[]}};P(this,l,"f")&&(_.rawStats=V);for(let N=0;N<Object.keys(Y).length;N++){const q=Y[N];switch(q.type){case"outbound-rtp":const W=q,z=(0,ee.getMediaKind)(W);z==="audio"?yield P(this,a,"m",M).call(this,V,W,_):z==="video"&&(yield P(this,a,"m",U).call(this,V,W,_));break;case"inbound-rtp":const K=q;let ne=(0,ee.getMediaKind)(K);ne==="audio"?yield P(this,a,"m",v).call(this,V,K,_):ne==="video"&&(yield P(this,a,"m",S).call(this,V,K,_));break;case"candidate-pair":const pe=q;pe.nominated&&P(this,a,"m",E).call(this,pe,_)}}x(this,p,_,"f"),this.emit("stats",_)})),x(this,g,J.default.get("WebRTCStats"),"f"),x(this,f,B.getStats,"f"),x(this,d,B.getStatsInterval||1e3,"f"),x(this,l,!!B.includeRawStats,"f")}}o.WebRTCStats=G,f=new WeakMap,d=new WeakMap,l=new WeakMap,w=new WeakMap,g=new WeakMap,p=new WeakMap,m=new WeakMap,a=new WeakSet,I=function(j,B){if(B){const V=j.get(B);if(V)return{mimeType:V.mimeType}}return{}},R=function(j,B,V){return b(this,void 0,void 0,function*(){var X,Y,_,N;const q=(0,ee.calculateRate)(B.timestamp,B.bytesSent,V==null?void 0:V.timestamp,V==null?void 0:V.totalBytesSent),W=(0,ee.calculateRate)(B.timestamp,B.packetsSent,V==null?void 0:V.timestamp,V==null?void 0:V.totalPacketsSent),z=P(this,a,"m",I).call(this,j,B.codecId);return Object.assign({id:B.id,timestamp:B.timestamp,mid:B.mid,totalBytesSent:B.bytesSent,bytesSentDelta:B.bytesSent-((X=V==null?void 0:V.totalBytesSent)!==null&&X!==void 0?X:0),totalPacketsSent:B.packetsSent,packetsSentDelta:B.packetsSent-((Y=V==null?void 0:V.totalPacketsSent)!==null&&Y!==void 0?Y:0),bitrate:q,packetRate:W,targetBitrate:B.targetBitrate,retransmittedPacketsSent:B.retransmittedPacketsSent,retransmittedPacketsSentDelta:B.retransmittedPacketsSent-((_=V==null?void 0:V.retransmittedPacketsSent)!==null&&_!==void 0?_:0),retransmittedBytesSent:B.retransmittedBytesSent,retransmittedBytesSentDelta:B.retransmittedBytesSent-((N=V==null?void 0:V.retransmittedBytesSent)!==null&&N!==void 0?N:0)},z)})},M=function(j,B,V){return b(this,void 0,void 0,function*(){var X;const Y=(X=P(this,p,"f"))===null||X===void 0?void 0:X.output.audio.find(q=>q.id===B.id);if(Y&&B.timestamp-Y.timestamp<=0)return;const _=yield P(this,a,"m",R).call(this,j,B,Y),N=Object.assign({},_);V.output.audio.push(N)})},U=function(j,B,V){return b(this,void 0,void 0,function*(){var X;const Y=(X=P(this,p,"f"))===null||X===void 0?void 0:X.output.video.find(W=>W.id===B.id);if(Y&&B.timestamp-Y.timestamp<=0)return;const _=yield P(this,a,"m",R).call(this,j,B,Y);let N=H.QualityLimitationReason.none;B.qualityLimitationReason&&(N=B.qualityLimitationReason);const q=Object.assign(Object.assign({},_),{frameWidth:B.frameWidth,frameHeight:B.frameHeight,framesPerSecond:B.framesPerSecond,framesSent:B.framesSent,qualityLimitationReason:N,qualityLimitationDurations:B.qualityLimitationDurations});V.output.video.push(q)})},F=function(j,B,V){return b(this,void 0,void 0,function*(){var X,Y;const _=(0,ee.calculateRate)(B.timestamp,B.bytesReceived,V==null?void 0:V.timestamp,V==null?void 0:V.totalBytesReceived),N=(0,ee.calculateRate)(B.timestamp,B.packetsReceived,V==null?void 0:V.timestamp,V==null?void 0:V.totalPacketsReceived),q=(0,ee.calculatePacketsLostRatio)(B.packetsLost,B.packetsReceived,V==null?void 0:V.totalPacketsLost,V==null?void 0:V.totalPacketsReceived),W=((X=B.packetsLost)!==null&&X!==void 0?X:0)-((Y=V==null?void 0:V.totalPacketsLost)!==null&&Y!==void 0?Y:0),z=P(this,a,"m",I).call(this,j,B.codecId);return Object.assign({id:B.id,timestamp:B.timestamp,mid:B.mid,trackIdentifier:B.trackIdentifier,jitter:B.jitter,jitterBufferDelay:B.jitterBufferDelay,jitterBufferEmittedCount:B.jitterBufferEmittedCount,totalBytesReceived:B.bytesReceived,totalPacketsReceived:B.packetsReceived,totalPacketsLost:B.packetsLost,bitrate:_,packetRate:N,packetLossRatio:q,packetLossDelta:W},z)})},v=function(j,B,V){return b(this,void 0,void 0,function*(){var X;const Y=(X=P(this,p,"f"))===null||X===void 0?void 0:X.input.audio.find(N=>N.id===B.id);if(Y&&B.timestamp-Y.timestamp<=0)return;const _=yield P(this,a,"m",F).call(this,j,B,Y);V.input.audio.push(_)})},S=function(j,B,V){return b(this,void 0,void 0,function*(){var X;const Y=(X=P(this,p,"f"))===null||X===void 0?void 0:X.input.video.find(q=>q.id===B.id);if(Y&&B.timestamp-Y.timestamp<=0)return;const _=yield P(this,a,"m",F).call(this,j,B,Y),N=Object.assign(Object.assign({},_),{keyFramesDecoded:B.keyFramesDecoded,frameHeight:B.frameHeight,frameWidth:B.frameWidth,framesDecoded:B.framesDecoded,framesDropped:B.framesDropped,framesPerSecond:B.framesPerSecond,framesReceived:B.framesReceived});V.input.video.push(N)})},E=function(j,B){B.totalRoundTripTime=j.totalRoundTripTime,B.currentRoundTripTime=j.currentRoundTripTime,B.responsesReceived=j.responsesReceived,B.availableOutgoingBitrate=j.availableOutgoingBitrate,B.availableIncomingBitrate=j.availableIncomingBitrate}},586:function(i,o,c){var a,f;(function(){var d,l={VERSION:"1.6.1"},w={},g=function(U,F){return function(){return F.apply(U,arguments)}},p=function(){var U,F,v=arguments,S=v[0];for(F=1;F<v.length;F++)for(U in v[F])!(U in S)&&v[F].hasOwnProperty(U)&&(S[U]=v[F][U]);return S},m=function(U,F){return{value:U,name:F}};l.TRACE=m(1,"TRACE"),l.DEBUG=m(2,"DEBUG"),l.INFO=m(3,"INFO"),l.TIME=m(4,"TIME"),l.WARN=m(5,"WARN"),l.ERROR=m(8,"ERROR"),l.OFF=m(99,"OFF");var I=function(U){this.context=U,this.setLevel(U.filterLevel),this.log=this.info};I.prototype={setLevel:function(U){U&&"value"in U&&(this.context.filterLevel=U)},getLevel:function(){return this.context.filterLevel},enabledFor:function(U){var F=this.context.filterLevel;return U.value>=F.value},trace:function(){this.invoke(l.TRACE,arguments)},debug:function(){this.invoke(l.DEBUG,arguments)},info:function(){this.invoke(l.INFO,arguments)},warn:function(){this.invoke(l.WARN,arguments)},error:function(){this.invoke(l.ERROR,arguments)},time:function(U){typeof U=="string"&&U.length>0&&this.invoke(l.TIME,[U,"start"])},timeEnd:function(U){typeof U=="string"&&U.length>0&&this.invoke(l.TIME,[U,"end"])},invoke:function(U,F){d&&this.enabledFor(U)&&d(F,p({level:U},this.context))}};var R,M=new I({filterLevel:l.OFF});(R=l).enabledFor=g(M,M.enabledFor),R.trace=g(M,M.trace),R.debug=g(M,M.debug),R.time=g(M,M.time),R.timeEnd=g(M,M.timeEnd),R.info=g(M,M.info),R.warn=g(M,M.warn),R.error=g(M,M.error),R.log=R.info,l.setHandler=function(U){d=U},l.setLevel=function(U){for(var F in M.setLevel(U),w)w.hasOwnProperty(F)&&w[F].setLevel(U)},l.getLevel=function(){return M.getLevel()},l.get=function(U){return w[U]||(w[U]=new I(p({name:U},M.context)))},l.createDefaultHandler=function(U){(U=U||{}).formatter=U.formatter||function(S,E){E.name&&S.unshift("["+E.name+"]")};var F={},v=function(S,E){Function.prototype.apply.call(S,console,E)};return typeof console>"u"?function(){}:function(S,E){S=Array.prototype.slice.call(S);var b,x=console.log;E.level===l.TIME?(b=(E.name?"["+E.name+"] ":"")+S[0],S[1]==="start"?console.time?console.time(b):F[b]=new Date().getTime():console.timeEnd?console.timeEnd(b):v(x,[b+": "+(new Date().getTime()-F[b])+"ms"])):(E.level===l.WARN&&console.warn?x=console.warn:E.level===l.ERROR&&console.error?x=console.error:E.level===l.INFO&&console.info?x=console.info:E.level===l.DEBUG&&console.debug?x=console.debug:E.level===l.TRACE&&console.trace&&(x=console.trace),U.formatter(S,E),v(x,S))}},l.useDefaults=function(U){l.setLevel(U&&U.defaultLevel||l.DEBUG),l.setHandler(l.createDefaultHandler(U))},l.setDefaults=l.useDefaults,(f=typeof(a=l)=="function"?a.call(o,c,o,i):a)===void 0||(i.exports=f)})()},738:(i,o)=>{var c;Object.defineProperty(o,"__esModule",{value:!0}),o.QualityLimitationReason=void 0,function(a){a[a.none=0]="none",a[a.cpu=1]="cpu",a[a.bandwidth=2]="bandwidth",a[a.other=3]="other"}(c||(o.QualityLimitationReason=c={}))},767:(i,o)=>{Object.defineProperty(o,"__esModule",{value:!0})}},r={},function i(o){var c=r[o];if(c!==void 0)return c.exports;var a=r[o]={exports:{}};return t[o].call(a.exports,a,a.exports,i),a.exports}(156);var t,r})}(dr)),dr.exports}var Ks=zs();const bt=qe.get("PeerConnectionStats"),Qn={stats:"stats"},Xs=n=>{const c=n,{input:e,output:t,rawStats:r}=c,i=gt(c,["input","output","rawStats"]);return je(se({},i),{audio:{inbounds:n.input.audio.map(w=>{var g=w,{packetLossRatio:a,packetLossDelta:f,bitrate:d}=g,l=gt(g,["packetLossRatio","packetLossDelta","bitrate"]);return se({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:f,bitrateBitsPerSecond:d*8,bitrate:d},l)}),outbounds:n.output.audio.map(w=>{var g=w,{packetLossRatio:a,packetLossDelta:f,bitrate:d}=g,l=gt(g,["packetLossRatio","packetLossDelta","bitrate"]);return se({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:f,bitrateBitsPerSecond:d*8,bitrate:d},l)})},video:{inbounds:n.input.video.map(w=>{var g=w,{packetLossRatio:a,packetLossDelta:f,bitrate:d}=g,l=gt(g,["packetLossRatio","packetLossDelta","bitrate"]);return se({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:f,bitrateBitsPerSecond:d*8,bitrate:d},l)}),outbounds:n.output.video.map(w=>{var g=w,{packetLossRatio:a,packetLossDelta:f,bitrate:d}=g,l=gt(g,["packetLossRatio","packetLossDelta","bitrate"]);return se({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:f,bitrateBitsPerSecond:d*8,bitrate:d},l)})},raw:n.rawStats})};class Ys extends Ot{constructor(e,t={statsIntervalMs:1e3,autoInitStats:!0}){super(),this.peer=e,this.collection=null,this.initialized=!1,t.autoInitStats&&this.init(t.statsIntervalMs)}init(e){if(this.initialized){bt.warn("PeerConnectionStats.init() has already been called. Automatic initialization occurs when the PeerConnectionStats object is constructed.");return}bt.info("Initializing peer connection stats");const t=this.peer;try{this.collection=new Ks.WebRTCStats({getStatsInterval:e,getStats:()=>t.getStats(),includeRawStats:!0}),this.collection.on("stats",r=>{const i=Xs(r);Ae.addStats(i),this.emit(Qn.stats,i)}),this.collection.start(),this.initialized=!0}catch(r){bt.error(r)}}parseStats(e){return bt.warn("The parseStats method is deprecated and will be removed in future releases."),null}stop(){bt.info("Stopping peer connection stats"),this.collection.stop()}}var ge={},Ge={},lr={},fr={exports:{}},ei;function ti(){if(ei)return fr.exports;ei=1;var n=fr.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),fr.exports}var ri;function Js(){return ri||(ri=1,function(n){var e=function(a){return String(Number(a))===a?Number(a):a},t=function(a,f,d,l){if(l&&!d)f[l]=e(a[1]);else for(var w=0;w<d.length;w+=1)a[w+1]!=null&&(f[d[w]]=e(a[w+1]))},r=function(a,f,d){var l=a.name&&a.names;a.push&&!f[a.push]?f[a.push]=[]:l&&!f[a.name]&&(f[a.name]={});var w=a.push?{}:l?f[a.name]:f;t(d.match(a.reg),w,a.names,a.name),a.push&&f[a.push].push(w)},i=ti(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(a){var f={},d=[],l=f;return a.split(/(\r\n|\r|\n)/).filter(o).forEach(function(w){var g=w[0],p=w.slice(2);g==="m"&&(d.push({rtp:[],fmtp:[]}),l=d[d.length-1]);for(var m=0;m<(i[g]||[]).length;m+=1){var I=i[g][m];if(I.reg.test(p))return r(I,l,p)}}),f.media=d,f};var c=function(a,f){var d=f.split(/=(.+)/,2);return d.length===2?a[d[0]]=e(d[1]):d.length===1&&f.length>1&&(a[d[0]]=void 0),a};n.parseParams=function(a){return a.split(/;\s?/).reduce(c,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(a){return a.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(a){for(var f=[],d=a.split(" ").map(e),l=0;l<d.length;l+=3)f.push({component:d[l],ip:d[l+1],port:d[l+2]});return f},n.parseImageAttributes=function(a){return a.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(c,{})})},n.parseSimulcastStreamList=function(a){return a.split(";").map(function(f){return f.split(",").map(function(d){var l,w=!1;return d[0]!=="~"?l=e(d):(l=e(d.substring(1,d.length)),w=!0),{scid:l,paused:w}})})}}(lr)),lr}var hr,ni;function Zs(){if(ni)return hr;ni=1;var n=ti(),e=/%[sdv%]/g,t=function(c){var a=1,f=arguments,d=f.length;return c.replace(e,function(l){if(a>=d)return l;var w=f[a];switch(a+=1,l){case"%%":return"%";case"%s":return String(w);case"%d":return Number(w);case"%v":return""}})},r=function(c,a,f){var d=a.format instanceof Function?a.format(a.push?f:f[a.name]):a.format,l=[c+"="+d];if(a.names)for(var w=0;w<a.names.length;w+=1){var g=a.names[w];a.name?l.push(f[a.name][g]):l.push(f[a.names[w]])}else l.push(f[a.name]);return t.apply(null,l)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return hr=function(c,a){a=a||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(w){w.payloads==null&&(w.payloads="")});var f=a.outerOrder||i,d=a.innerOrder||o,l=[];return f.forEach(function(w){n[w].forEach(function(g){g.name in c&&c[g.name]!=null?l.push(r(w,g,c)):g.push in c&&c[g.push]!=null&&c[g.push].forEach(function(p){l.push(r(w,g,p))})})}),c.media.forEach(function(w){l.push(r("m",n.m[0],w)),d.forEach(function(g){n[g].forEach(function(p){p.name in w&&w[p.name]!=null?l.push(r(g,p,w)):p.push in w&&w[p.push]!=null&&w[p.push].forEach(function(m){l.push(r(g,p,m))})})})}),l.join("\r\n")+"\r\n"},hr}var ii;function Qs(){if(ii)return Ge;ii=1;var n=Js(),e=Zs();return Ge.write=e,Ge.parse=n.parse,Ge.parseParams=n.parseParams,Ge.parseFmtpConfig=n.parseFmtpConfig,Ge.parsePayloads=n.parsePayloads,Ge.parseRemoteCandidates=n.parseRemoteCandidates,Ge.parseImageAttributes=n.parseImageAttributes,Ge.parseSimulcastStreamList=n.parseSimulcastStreamList,Ge}var pr,si;function eo(){return si||(si=1,pr=function(n){const e=new Intl.Collator(n,{sensitivity:"base"});return(t,r)=>e.compare(t,r)==0}),pr}var mr,oi;function ai(){if(oi)return mr;oi=1;class n{constructor(t,r,i,o,c,a,f,d,l){this.foundation=t,this.componentId=r,this.transport=i,this.priority=o,this.address=c,this.port=a,this.type=f,this.relAddr=d,this.relPort=l}equals(t){return t.foundation===this.foundation&&t.componentId===this.componentId&&t.transport===this.transport&&t.priority===this.priority&&t.address===this.address&&t.port===this.port&&t.type===this.type&&t.relAddr===this.relAddr&&t.relPort===this.relPort}clone(){return new n(this.foundation,this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.relAddr,this.relPort)}plain(){const t={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type};return this.relAddr&&(t.relAddr=this.relAddr),this.relPort&&(t.relPort=this.relPort),t}getFoundation(){return this.foundation}getComponentId(){return this.componentId}getTransport(){return this.transport}getPriority(){return this.priority}getAddress(){return this.address}getPort(){return this.port}getType(){return this.type}getRelAddr(){return this.relAddr}getRelPort(){return this.relPort}}return n.expand=function(e){return e.constructor.name==="CandidateInfo"?e:(e=e,new n(e.foundation,e.componentId,e.transport,e.priority,e.address,e.port,e.type,e.relAddr,e.relPort))},n.clone=function(e){return e.constructor.name==="CandidateInfo"?e.clone():n.expand(e)},mr=n,mr}var gr,ci;function Vt(){if(ci)return gr;ci=1;class n{constructor(t,r){this.id=t,this.params=r||[]}clone(){return new n(this.id,this.params)}plain(){return this.params.length?{id:this.id,params:this.params}:{id:this.id}}getId(){return this.id}getParams(){return this.params}}return n.expand=function(e){return e.constructor.name==="RTCPFeedbackInfo"?e:(e=e,new n(e.id,e.params))},n.clone=function(e){return e.constructor.name==="RTCPFeedbackInfo"?e.clone():n.expand(e)},gr=n,gr}var yr,ui;function jt(){if(ui)return yr;ui=1;const n=Vt();class e{constructor(r,i,o){this.codec=r,this.type=i,this.params={},this.rtcpfbs=new Set,o&&this.addParams(o)}clone(){const r=new e(this.codec,this.type,this.params);this.hasRTX()&&r.setRTX(this.getRTX());for(const i of this.rtcpfbs)r.addRTCPFeedback(i.clone());return this.hasChannels()&&r.setChannels(this.getChannels()),r}plain(){const r={codec:this.codec,type:this.type};this.rtx&&(r.rtx=this.rtx),this.channels&&(r.channels=this.channels),Object.keys(this.params).length&&(r.params=this.params);for(const i of this.rtcpfbs)r.rtcpfbs||(r.rtcpfbs=[]),r.rtcpfbs.push(i.plain());return r}setRTX(r){this.rtx=r}getType(){return this.type}setType(r){this.type=r}getCodec(){return this.codec}getParams(){return this.params}addParams(r){for(const i in r)this.params[i]=r[i]}addParam(r,i){this.params[r]=i}hasParam(r){return Object.hasOwnProperty.call(this.params,r)}getParam(r,i=void 0){if(this.hasParam(r))return this.params[r];if(i===void 0)throw new Error("param ".concat(r," not found and no default value provided"));return""+i}hasRTX(){return this.rtx}getRTX(){return this.rtx}hasChannels(){return this.channels}getChannels(){return this.channels}setChannels(r){this.channels=r}addRTCPFeedback(r){this.rtcpfbs.add(r)}getRTCPFeedbacks(){return this.rtcpfbs}}return e.expand=function(t){if(t.constructor.name==="CodecInfo")return t;t=t;const r=new e(t.codec,t.type,t.params);t.rtx&&r.setRTX(t.rtx),t.channels&&r.setChannels(t.channels);for(const i of t.rtcpfbs||[]){const o=n.expand(i);r.addRTCPFeedback(o)}return r},e.clone=function(t){return t.constructor.name==="CodecInfo"?t.clone():e.expand(t)},e.MapFromNames=function(t,r,i){var o;const c=new Map;let a=96;for(const f of t){let d;const l=f.split(";"),w=l.shift().toLowerCase().trim();w==="pcmu"?d=0:w==="pcma"?d=8:d=++a;const g=new e(w,d);w==="opus"?g.setChannels(2):w==="multiopus"&&g.setChannels(6),r&&w!=="ulpfec"&&w!=="flexfec-03"&&w!=="red"&&g.setRTX(++a);for(const p of i||[])g.addRTCPFeedback(new n(p.id,p.params));for(const p of l){let m=p.split("=");g.addParam(m[0].trim(),(o=m[1])===null||o===void 0?void 0:o.trim())}c.set(d,g)}return c},yr=e,yr}var wr,di;function vr(){if(di)return wr;di=1;function n(){var e=this;if(!(this instanceof n))return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.call(arguments))));Array.from(arguments).forEach(function(t){e[t]=Symbol.for("MEDOOZE_SEMANTIC_SDP_"+t)})}return wr=n,wr}var br,li;function Sr(){if(li)return br;li=1;const e=vr()("ACTIVE","PASSIVE","ACTPASS","INACTIVE");return e.byValue=function(t){switch(t){case e.ACTIVE:case e.PASSIVE:case e.ACTPASS:case e.INACTIVE:return t}return e[t.toUpperCase()]},e.toString=function(t){switch(t){case e.ACTIVE:return"active";case e.PASSIVE:return"passive";case e.ACTPASS:return"actpass";case e.INACTIVE:return"inactive"}},e.reverse=function(t,r){switch(t){case e.ACTIVE:return e.PASSIVE;case e.PASSIVE:return e.ACTIVE;case e.ACTPASS:return r?e.ACTIVE:e.PASSIVE;case e.INACTIVE:return e.INACTIVE}},br=e,br}var Ir,fi;function hi(){if(fi)return Ir;fi=1;const n=Sr();class e{constructor(r,i,o){this.setup=r,this.hash=i,this.fingerprint=o}clone(){return new e(this.setup,this.hash,this.fingerprint)}plain(){return{setup:n.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}}getFingerprint(){return this.fingerprint}getHash(){return this.hash}getSetup(){return this.setup}setSetup(r){this.setup=r}}return e.expand=function(t){return t.constructor.name==="DTLSInfo"?t:(t=t,new e(t.setup?n.byValue(t.setup):n.ACTPASS,t.hash,t.fingerprint))},e.clone=function(t){return t.constructor.name==="DTLSInfo"?t.clone():e.expand(t)},Ir=e,Ir}var Er,pi;function mi(){if(pi)return Er;pi=1;class n{constructor(t,r,i,o){this.tag=t,this.suite=r,this.keyParams=i,this.sessionParams=o}clone(){return new n(this.tag,this.suite,this.keyParams,this.sessionParams)}plain(){return{tag:this.tag,suite:this.suite,keyParams:this.keyParams,sessionParams:this.sessionParams}}getSessionParams(){return this.sessionParams}getKeyParams(){return this.keyParams}getSuite(){return this.suite}getTag(){return this.tag}}return n.expand=function(e){return e.constructor.name==="CryptoInfo"?e:(e=e,new n(e.tag,e.suite,e.keyParams,e.sessionParams))},n.clone=function(e){return e.constructor.name==="CryptoInfo"?e.clone():n.expand(e)},Er=n,Er}var qt={exports:{}},Gt={exports:{}},Cr={},St={},gi;function to(){if(gi)return St;gi=1,St.byteLength=a,St.toByteArray=d,St.fromByteArray=g;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=r.length;i<o;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function c(p){var m=p.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=p.indexOf("=");I===-1&&(I=m);var R=I===m?0:4-I%4;return[I,R]}function a(p){var m=c(p),I=m[0],R=m[1];return(I+R)*3/4-R}function f(p,m,I){return(m+I)*3/4-I}function d(p){var m,I=c(p),R=I[0],M=I[1],U=new t(f(p,R,M)),F=0,v=M>0?R-4:R,S;for(S=0;S<v;S+=4)m=e[p.charCodeAt(S)]<<18|e[p.charCodeAt(S+1)]<<12|e[p.charCodeAt(S+2)]<<6|e[p.charCodeAt(S+3)],U[F++]=m>>16&255,U[F++]=m>>8&255,U[F++]=m&255;return M===2&&(m=e[p.charCodeAt(S)]<<2|e[p.charCodeAt(S+1)]>>4,U[F++]=m&255),M===1&&(m=e[p.charCodeAt(S)]<<10|e[p.charCodeAt(S+1)]<<4|e[p.charCodeAt(S+2)]>>2,U[F++]=m>>8&255,U[F++]=m&255),U}function l(p){return n[p>>18&63]+n[p>>12&63]+n[p>>6&63]+n[p&63]}function w(p,m,I){for(var R,M=[],U=m;U<I;U+=3)R=(p[U]<<16&16711680)+(p[U+1]<<8&65280)+(p[U+2]&255),M.push(l(R));return M.join("")}function g(p){for(var m,I=p.length,R=I%3,M=[],U=16383,F=0,v=I-R;F<v;F+=U)M.push(w(p,F,F+U>v?v:F+U));return R===1?(m=p[I-1],M.push(n[m>>2]+n[m<<4&63]+"==")):R===2&&(m=(p[I-2]<<8)+p[I-1],M.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),M.join("")}return St}var Ht={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var yi;function ro(){return yi||(yi=1,Ht.read=function(n,e,t,r,i){var o,c,a=i*8-r-1,f=(1<<a)-1,d=f>>1,l=-7,w=t?i-1:0,g=t?-1:1,p=n[e+w];for(w+=g,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=o*256+n[e+w],w+=g,l-=8);for(c=o&(1<<-l)-1,o>>=-l,l+=r;l>0;c=c*256+n[e+w],w+=g,l-=8);if(o===0)o=1-d;else{if(o===f)return c?NaN:(p?-1:1)*(1/0);c=c+Math.pow(2,r),o=o-d}return(p?-1:1)*c*Math.pow(2,o-r)},Ht.write=function(n,e,t,r,i,o){var c,a,f,d=o*8-i-1,l=(1<<d)-1,w=l>>1,g=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,m=r?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,c=l):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),c+w>=1?e+=g/f:e+=g*Math.pow(2,1-w),e*f>=2&&(c++,f/=2),c+w>=l?(a=0,c=l):c+w>=1?(a=(e*f-1)*Math.pow(2,i),c=c+w):(a=e*Math.pow(2,w-1)*Math.pow(2,i),c=0));i>=8;n[t+p]=a&255,p+=m,a/=256,i-=8);for(c=c<<i|a,d+=i;d>0;n[t+p]=c&255,p+=m,c/=256,d-=8);n[t+p-m]|=I*128}),Ht}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var wi;function no(){return wi||(wi=1,function(n){const e=to(),t=ro(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=U,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const h=new Uint8Array(1),s={foo:function(){return 42}};return Object.setPrototypeOf(s,Uint8Array.prototype),Object.setPrototypeOf(h,s),h.foo()===42}catch(h){return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function c(h){if(h>i)throw new RangeError('The value "'+h+'" is invalid for option "size"');const s=new Uint8Array(h);return Object.setPrototypeOf(s,a.prototype),s}function a(h,s,u){if(typeof h=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(h)}return f(h,s,u)}a.poolSize=8192;function f(h,s,u){if(typeof h=="string")return g(h,s);if(ArrayBuffer.isView(h))return m(h);if(h==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(Be(h,ArrayBuffer)||h&&Be(h.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Be(h,SharedArrayBuffer)||h&&Be(h.buffer,SharedArrayBuffer)))return I(h,s,u);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const y=h.valueOf&&h.valueOf();if(y!=null&&y!==h)return a.from(y,s,u);const T=R(h);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return a.from(h[Symbol.toPrimitive]("string"),s,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}a.from=function(h,s,u){return f(h,s,u)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function l(h,s,u){return d(h),h<=0?c(h):s!==void 0?typeof u=="string"?c(h).fill(s,u):c(h).fill(s):c(h)}a.alloc=function(h,s,u){return l(h,s,u)};function w(h){return d(h),c(h<0?0:M(h)|0)}a.allocUnsafe=function(h){return w(h)},a.allocUnsafeSlow=function(h){return w(h)};function g(h,s){if((typeof s!="string"||s==="")&&(s="utf8"),!a.isEncoding(s))throw new TypeError("Unknown encoding: "+s);const u=F(h,s)|0;let y=c(u);const T=y.write(h,s);return T!==u&&(y=y.slice(0,T)),y}function p(h){const s=h.length<0?0:M(h.length)|0,u=c(s);for(let y=0;y<s;y+=1)u[y]=h[y]&255;return u}function m(h){if(Be(h,Uint8Array)){const s=new Uint8Array(h);return I(s.buffer,s.byteOffset,s.byteLength)}return p(h)}function I(h,s,u){if(s<0||h.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<s+(u||0))throw new RangeError('"length" is outside of buffer bounds');let y;return s===void 0&&u===void 0?y=new Uint8Array(h):u===void 0?y=new Uint8Array(h,s):y=new Uint8Array(h,s,u),Object.setPrototypeOf(y,a.prototype),y}function R(h){if(a.isBuffer(h)){const s=M(h.length)|0,u=c(s);return u.length===0||h.copy(u,0,0,s),u}if(h.length!==void 0)return typeof h.length!="number"||Te(h.length)?c(0):p(h);if(h.type==="Buffer"&&Array.isArray(h.data))return p(h.data)}function M(h){if(h>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return h|0}function U(h){return+h!=h&&(h=0),a.alloc(+h)}a.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==a.prototype},a.compare=function(s,u){if(Be(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),Be(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(s)||!a.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===u)return 0;let y=s.length,T=u.length;for(let A=0,D=Math.min(y,T);A<D;++A)if(s[A]!==u[A]){y=s[A],T=u[A];break}return y<T?-1:T<y?1:0},a.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(s,u){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return a.alloc(0);let y;if(u===void 0)for(u=0,y=0;y<s.length;++y)u+=s[y].length;const T=a.allocUnsafe(u);let A=0;for(y=0;y<s.length;++y){let D=s[y];if(Be(D,Uint8Array))A+D.length>T.length?(a.isBuffer(D)||(D=a.from(D)),D.copy(T,A)):Uint8Array.prototype.set.call(T,D,A);else if(a.isBuffer(D))D.copy(T,A);else throw new TypeError('"list" argument must be an Array of Buffers');A+=D.length}return T};function F(h,s){if(a.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||Be(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);const u=h.length,y=arguments.length>2&&arguments[2]===!0;if(!y&&u===0)return 0;let T=!1;for(;;)switch(s){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return at(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return ar(h).length;default:if(T)return y?-1:at(h).length;s=(""+s).toLowerCase(),T=!0}}a.byteLength=F;function v(h,s,u){let y=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,s>>>=0,u<=s))return"";for(h||(h="utf8");;)switch(h){case"hex":return X(this,s,u);case"utf8":case"utf-8":return ee(this,s,u);case"ascii":return B(this,s,u);case"latin1":case"binary":return V(this,s,u);case"base64":return H(this,s,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,s,u);default:if(y)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),y=!0}}a.prototype._isBuffer=!0;function S(h,s,u){const y=h[s];h[s]=h[u],h[u]=y}a.prototype.swap16=function(){const s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<s;u+=2)S(this,u,u+1);return this},a.prototype.swap32=function(){const s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<s;u+=4)S(this,u,u+3),S(this,u+1,u+2);return this},a.prototype.swap64=function(){const s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<s;u+=8)S(this,u,u+7),S(this,u+1,u+6),S(this,u+2,u+5),S(this,u+3,u+4);return this},a.prototype.toString=function(){const s=this.length;return s===0?"":arguments.length===0?ee(this,0,s):v.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(s){if(!a.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:a.compare(this,s)===0},a.prototype.inspect=function(){let s="";const u=n.INSPECT_MAX_BYTES;return s=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(s+=" ... "),"<Buffer "+s+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(s,u,y,T,A){if(Be(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),!a.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(u===void 0&&(u=0),y===void 0&&(y=s?s.length:0),T===void 0&&(T=0),A===void 0&&(A=this.length),u<0||y>s.length||T<0||A>this.length)throw new RangeError("out of range index");if(T>=A&&u>=y)return 0;if(T>=A)return-1;if(u>=y)return 1;if(u>>>=0,y>>>=0,T>>>=0,A>>>=0,this===s)return 0;let D=A-T,Z=y-u;const le=Math.min(D,Z),ae=this.slice(T,A),we=s.slice(u,y);for(let ce=0;ce<le;++ce)if(ae[ce]!==we[ce]){D=ae[ce],Z=we[ce];break}return D<Z?-1:Z<D?1:0};function E(h,s,u,y,T){if(h.length===0)return-1;if(typeof u=="string"?(y=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,Te(u)&&(u=T?0:h.length-1),u<0&&(u=h.length+u),u>=h.length){if(T)return-1;u=h.length-1}else if(u<0)if(T)u=0;else return-1;if(typeof s=="string"&&(s=a.from(s,y)),a.isBuffer(s))return s.length===0?-1:b(h,s,u,y,T);if(typeof s=="number")return s=s&255,typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call(h,s,u):Uint8Array.prototype.lastIndexOf.call(h,s,u):b(h,[s],u,y,T);throw new TypeError("val must be string, number or Buffer")}function b(h,s,u,y,T){let A=1,D=h.length,Z=s.length;if(y!==void 0&&(y=String(y).toLowerCase(),y==="ucs2"||y==="ucs-2"||y==="utf16le"||y==="utf-16le")){if(h.length<2||s.length<2)return-1;A=2,D/=2,Z/=2,u/=2}function le(we,ce){return A===1?we[ce]:we.readUInt16BE(ce*A)}let ae;if(T){let we=-1;for(ae=u;ae<D;ae++)if(le(h,ae)===le(s,we===-1?0:ae-we)){if(we===-1&&(we=ae),ae-we+1===Z)return we*A}else we!==-1&&(ae-=ae-we),we=-1}else for(u+Z>D&&(u=D-Z),ae=u;ae>=0;ae--){let we=!0;for(let ce=0;ce<Z;ce++)if(le(h,ae+ce)!==le(s,ce)){we=!1;break}if(we)return ae}return-1}a.prototype.includes=function(s,u,y){return this.indexOf(s,u,y)!==-1},a.prototype.indexOf=function(s,u,y){return E(this,s,u,y,!0)},a.prototype.lastIndexOf=function(s,u,y){return E(this,s,u,y,!1)};function x(h,s,u,y){u=Number(u)||0;const T=h.length-u;y?(y=Number(y),y>T&&(y=T)):y=T;const A=s.length;y>A/2&&(y=A/2);let D;for(D=0;D<y;++D){const Z=parseInt(s.substr(D*2,2),16);if(Te(Z))return D;h[u+D]=Z}return D}function P(h,s,u,y){return ut(at(s,h.length-u),h,u,y)}function k(h,s,u,y){return ut(ct(s),h,u,y)}function O(h,s,u,y){return ut(ar(s),h,u,y)}function J(h,s,u,y){return ut(mt(s,h.length-u),h,u,y)}a.prototype.write=function(s,u,y,T){if(u===void 0)T="utf8",y=this.length,u=0;else if(y===void 0&&typeof u=="string")T=u,y=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(y)?(y=y>>>0,T===void 0&&(T="utf8")):(T=y,y=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const A=this.length-u;if((y===void 0||y>A)&&(y=A),s.length>0&&(y<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");let D=!1;for(;;)switch(T){case"hex":return x(this,s,u,y);case"utf8":case"utf-8":return P(this,s,u,y);case"ascii":case"latin1":case"binary":return k(this,s,u,y);case"base64":return O(this,s,u,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return J(this,s,u,y);default:if(D)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),D=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function H(h,s,u){return s===0&&u===h.length?e.fromByteArray(h):e.fromByteArray(h.slice(s,u))}function ee(h,s,u){u=Math.min(h.length,u);const y=[];let T=s;for(;T<u;){const A=h[T];let D=null,Z=A>239?4:A>223?3:A>191?2:1;if(T+Z<=u){let le,ae,we,ce;switch(Z){case 1:A<128&&(D=A);break;case 2:le=h[T+1],(le&192)===128&&(ce=(A&31)<<6|le&63,ce>127&&(D=ce));break;case 3:le=h[T+1],ae=h[T+2],(le&192)===128&&(ae&192)===128&&(ce=(A&15)<<12|(le&63)<<6|ae&63,ce>2047&&(ce<55296||ce>57343)&&(D=ce));break;case 4:le=h[T+1],ae=h[T+2],we=h[T+3],(le&192)===128&&(ae&192)===128&&(we&192)===128&&(ce=(A&15)<<18|(le&63)<<12|(ae&63)<<6|we&63,ce>65535&&ce<1114112&&(D=ce))}}D===null?(D=65533,Z=1):D>65535&&(D-=65536,y.push(D>>>10&1023|55296),D=56320|D&1023),y.push(D),T+=Z}return j(y)}const G=4096;function j(h){const s=h.length;if(s<=G)return String.fromCharCode.apply(String,h);let u="",y=0;for(;y<s;)u+=String.fromCharCode.apply(String,h.slice(y,y+=G));return u}function B(h,s,u){let y="";u=Math.min(h.length,u);for(let T=s;T<u;++T)y+=String.fromCharCode(h[T]&127);return y}function V(h,s,u){let y="";u=Math.min(h.length,u);for(let T=s;T<u;++T)y+=String.fromCharCode(h[T]);return y}function X(h,s,u){const y=h.length;(!s||s<0)&&(s=0),(!u||u<0||u>y)&&(u=y);let T="";for(let A=s;A<u;++A)T+=tt[h[A]];return T}function Y(h,s,u){const y=h.slice(s,u);let T="";for(let A=0;A<y.length-1;A+=2)T+=String.fromCharCode(y[A]+y[A+1]*256);return T}a.prototype.slice=function(s,u){const y=this.length;s=~~s,u=u===void 0?y:~~u,s<0?(s+=y,s<0&&(s=0)):s>y&&(s=y),u<0?(u+=y,u<0&&(u=0)):u>y&&(u=y),u<s&&(u=s);const T=this.subarray(s,u);return Object.setPrototypeOf(T,a.prototype),T};function _(h,s,u){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+s>u)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(s,u,y){s=s>>>0,u=u>>>0,y||_(s,u,this.length);let T=this[s],A=1,D=0;for(;++D<u&&(A*=256);)T+=this[s+D]*A;return T},a.prototype.readUintBE=a.prototype.readUIntBE=function(s,u,y){s=s>>>0,u=u>>>0,y||_(s,u,this.length);let T=this[s+--u],A=1;for(;u>0&&(A*=256);)T+=this[s+--u]*A;return T},a.prototype.readUint8=a.prototype.readUInt8=function(s,u){return s=s>>>0,u||_(s,1,this.length),this[s]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(s,u){return s=s>>>0,u||_(s,2,this.length),this[s]|this[s+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(s,u){return s=s>>>0,u||_(s,2,this.length),this[s]<<8|this[s+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(s,u){return s=s>>>0,u||_(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(s,u){return s=s>>>0,u||_(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},a.prototype.readBigUInt64LE=Fe(function(s){s=s>>>0,Ve(s,"offset");const u=this[s],y=this[s+7];(u===void 0||y===void 0)&&Qe(s,this.length-8);const T=u+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24,A=this[++s]+this[++s]*2**8+this[++s]*2**16+y*2**24;return BigInt(T)+(BigInt(A)<<BigInt(32))}),a.prototype.readBigUInt64BE=Fe(function(s){s=s>>>0,Ve(s,"offset");const u=this[s],y=this[s+7];(u===void 0||y===void 0)&&Qe(s,this.length-8);const T=u*2**24+this[++s]*2**16+this[++s]*2**8+this[++s],A=this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+y;return(BigInt(T)<<BigInt(32))+BigInt(A)}),a.prototype.readIntLE=function(s,u,y){s=s>>>0,u=u>>>0,y||_(s,u,this.length);let T=this[s],A=1,D=0;for(;++D<u&&(A*=256);)T+=this[s+D]*A;return A*=128,T>=A&&(T-=Math.pow(2,8*u)),T},a.prototype.readIntBE=function(s,u,y){s=s>>>0,u=u>>>0,y||_(s,u,this.length);let T=u,A=1,D=this[s+--T];for(;T>0&&(A*=256);)D+=this[s+--T]*A;return A*=128,D>=A&&(D-=Math.pow(2,8*u)),D},a.prototype.readInt8=function(s,u){return s=s>>>0,u||_(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},a.prototype.readInt16LE=function(s,u){s=s>>>0,u||_(s,2,this.length);const y=this[s]|this[s+1]<<8;return y&32768?y|4294901760:y},a.prototype.readInt16BE=function(s,u){s=s>>>0,u||_(s,2,this.length);const y=this[s+1]|this[s]<<8;return y&32768?y|4294901760:y},a.prototype.readInt32LE=function(s,u){return s=s>>>0,u||_(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},a.prototype.readInt32BE=function(s,u){return s=s>>>0,u||_(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},a.prototype.readBigInt64LE=Fe(function(s){s=s>>>0,Ve(s,"offset");const u=this[s],y=this[s+7];(u===void 0||y===void 0)&&Qe(s,this.length-8);const T=this[s+4]+this[s+5]*2**8+this[s+6]*2**16+(y<<24);return(BigInt(T)<<BigInt(32))+BigInt(u+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24)}),a.prototype.readBigInt64BE=Fe(function(s){s=s>>>0,Ve(s,"offset");const u=this[s],y=this[s+7];(u===void 0||y===void 0)&&Qe(s,this.length-8);const T=(u<<24)+this[++s]*2**16+this[++s]*2**8+this[++s];return(BigInt(T)<<BigInt(32))+BigInt(this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+y)}),a.prototype.readFloatLE=function(s,u){return s=s>>>0,u||_(s,4,this.length),t.read(this,s,!0,23,4)},a.prototype.readFloatBE=function(s,u){return s=s>>>0,u||_(s,4,this.length),t.read(this,s,!1,23,4)},a.prototype.readDoubleLE=function(s,u){return s=s>>>0,u||_(s,8,this.length),t.read(this,s,!0,52,8)},a.prototype.readDoubleBE=function(s,u){return s=s>>>0,u||_(s,8,this.length),t.read(this,s,!1,52,8)};function N(h,s,u,y,T,A){if(!a.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>T||s<A)throw new RangeError('"value" argument is out of bounds');if(u+y>h.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(s,u,y,T){if(s=+s,u=u>>>0,y=y>>>0,!T){const Z=Math.pow(2,8*y)-1;N(this,s,u,y,Z,0)}let A=1,D=0;for(this[u]=s&255;++D<y&&(A*=256);)this[u+D]=s/A&255;return u+y},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(s,u,y,T){if(s=+s,u=u>>>0,y=y>>>0,!T){const Z=Math.pow(2,8*y)-1;N(this,s,u,y,Z,0)}let A=y-1,D=1;for(this[u+A]=s&255;--A>=0&&(D*=256);)this[u+A]=s/D&255;return u+y},a.prototype.writeUint8=a.prototype.writeUInt8=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,1,255,0),this[u]=s&255,u+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,2,65535,0),this[u]=s&255,this[u+1]=s>>>8,u+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,2,65535,0),this[u]=s>>>8,this[u+1]=s&255,u+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,4,4294967295,0),this[u+3]=s>>>24,this[u+2]=s>>>16,this[u+1]=s>>>8,this[u]=s&255,u+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,4,4294967295,0),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4};function q(h,s,u,y,T){pt(s,y,T,h,u,7);let A=Number(s&BigInt(4294967295));h[u++]=A,A=A>>8,h[u++]=A,A=A>>8,h[u++]=A,A=A>>8,h[u++]=A;let D=Number(s>>BigInt(32)&BigInt(4294967295));return h[u++]=D,D=D>>8,h[u++]=D,D=D>>8,h[u++]=D,D=D>>8,h[u++]=D,u}function W(h,s,u,y,T){pt(s,y,T,h,u,7);let A=Number(s&BigInt(4294967295));h[u+7]=A,A=A>>8,h[u+6]=A,A=A>>8,h[u+5]=A,A=A>>8,h[u+4]=A;let D=Number(s>>BigInt(32)&BigInt(4294967295));return h[u+3]=D,D=D>>8,h[u+2]=D,D=D>>8,h[u+1]=D,D=D>>8,h[u]=D,u+8}a.prototype.writeBigUInt64LE=Fe(function(s,u=0){return q(this,s,u,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Fe(function(s,u=0){return W(this,s,u,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(s,u,y,T){if(s=+s,u=u>>>0,!T){const le=Math.pow(2,8*y-1);N(this,s,u,y,le-1,-le)}let A=0,D=1,Z=0;for(this[u]=s&255;++A<y&&(D*=256);)s<0&&Z===0&&this[u+A-1]!==0&&(Z=1),this[u+A]=(s/D>>0)-Z&255;return u+y},a.prototype.writeIntBE=function(s,u,y,T){if(s=+s,u=u>>>0,!T){const le=Math.pow(2,8*y-1);N(this,s,u,y,le-1,-le)}let A=y-1,D=1,Z=0;for(this[u+A]=s&255;--A>=0&&(D*=256);)s<0&&Z===0&&this[u+A+1]!==0&&(Z=1),this[u+A]=(s/D>>0)-Z&255;return u+y},a.prototype.writeInt8=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,1,127,-128),s<0&&(s=255+s+1),this[u]=s&255,u+1},a.prototype.writeInt16LE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,2,32767,-32768),this[u]=s&255,this[u+1]=s>>>8,u+2},a.prototype.writeInt16BE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,2,32767,-32768),this[u]=s>>>8,this[u+1]=s&255,u+2},a.prototype.writeInt32LE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,4,2147483647,-2147483648),this[u]=s&255,this[u+1]=s>>>8,this[u+2]=s>>>16,this[u+3]=s>>>24,u+4},a.prototype.writeInt32BE=function(s,u,y){return s=+s,u=u>>>0,y||N(this,s,u,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4},a.prototype.writeBigInt64LE=Fe(function(s,u=0){return q(this,s,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Fe(function(s,u=0){return W(this,s,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function z(h,s,u,y,T,A){if(u+y>h.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function K(h,s,u,y,T){return s=+s,u=u>>>0,T||z(h,s,u,4),t.write(h,s,u,y,23,4),u+4}a.prototype.writeFloatLE=function(s,u,y){return K(this,s,u,!0,y)},a.prototype.writeFloatBE=function(s,u,y){return K(this,s,u,!1,y)};function ne(h,s,u,y,T){return s=+s,u=u>>>0,T||z(h,s,u,8),t.write(h,s,u,y,52,8),u+8}a.prototype.writeDoubleLE=function(s,u,y){return ne(this,s,u,!0,y)},a.prototype.writeDoubleBE=function(s,u,y){return ne(this,s,u,!1,y)},a.prototype.copy=function(s,u,y,T){if(!a.isBuffer(s))throw new TypeError("argument should be a Buffer");if(y||(y=0),!T&&T!==0&&(T=this.length),u>=s.length&&(u=s.length),u||(u=0),T>0&&T<y&&(T=y),T===y||s.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(y<0||y>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),s.length-u<T-y&&(T=s.length-u+y);const A=T-y;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,y,T):Uint8Array.prototype.set.call(s,this.subarray(y,T),u),A},a.prototype.fill=function(s,u,y,T){if(typeof s=="string"){if(typeof u=="string"?(T=u,u=0,y=this.length):typeof y=="string"&&(T=y,y=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!a.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(s.length===1){const D=s.charCodeAt(0);(T==="utf8"&&D<128||T==="latin1")&&(s=D)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(u<0||this.length<u||this.length<y)throw new RangeError("Out of range index");if(y<=u)return this;u=u>>>0,y=y===void 0?this.length:y>>>0,s||(s=0);let A;if(typeof s=="number")for(A=u;A<y;++A)this[A]=s;else{const D=a.isBuffer(s)?s:a.from(s,T),Z=D.length;if(Z===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(A=0;A<y-u;++A)this[A+u]=D[A%Z]}return this};const pe={};function Re(h,s,u){pe[h]=class extends u{constructor(){super(),Object.defineProperty(this,"message",{value:s.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(h,"]"),this.stack,delete this.name}get code(){return h}set code(T){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:T,writable:!0})}toString(){return"".concat(this.name," [").concat(h,"]: ").concat(this.message)}}}Re("ERR_BUFFER_OUT_OF_BOUNDS",function(h){return h?"".concat(h," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),Re("ERR_INVALID_ARG_TYPE",function(h,s){return'The "'.concat(h,'" argument must be of type number. Received type ').concat(typeof s)},TypeError),Re("ERR_OUT_OF_RANGE",function(h,s,u){let y='The value of "'.concat(h,'" is out of range.'),T=u;return Number.isInteger(u)&&Math.abs(u)>2**32?T=De(String(u)):typeof u=="bigint"&&(T=String(u),(u>BigInt(2)**BigInt(32)||u<-(BigInt(2)**BigInt(32)))&&(T=De(T)),T+="n"),y+=" It must be ".concat(s,". Received ").concat(T),y},RangeError);function De(h){let s="",u=h.length;const y=h[0]==="-"?1:0;for(;u>=y+4;u-=3)s="_".concat(h.slice(u-3,u)).concat(s);return"".concat(h.slice(0,u)).concat(s)}function Ue(h,s,u){Ve(s,"offset"),(h[s]===void 0||h[s+u]===void 0)&&Qe(s,h.length-(u+1))}function pt(h,s,u,y,T,A){if(h>u||h<s){const D=typeof s=="bigint"?"n":"";let Z;throw s===0||s===BigInt(0)?Z=">= 0".concat(D," and < 2").concat(D," ** ").concat((A+1)*8).concat(D):Z=">= -(2".concat(D," ** ").concat((A+1)*8-1).concat(D,") and < 2 ** ")+"".concat((A+1)*8-1).concat(D),new pe.ERR_OUT_OF_RANGE("value",Z,h)}Ue(y,T,A)}function Ve(h,s){if(typeof h!="number")throw new pe.ERR_INVALID_ARG_TYPE(s,"number",h)}function Qe(h,s,u){throw Math.floor(h)!==h?(Ve(h,u),new pe.ERR_OUT_OF_RANGE("offset","an integer",h)):s<0?new pe.ERR_BUFFER_OUT_OF_BOUNDS:new pe.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(s),h)}const et=/[^+/0-9A-Za-z-_]/g;function Gn(h){if(h=h.split("=")[0],h=h.trim().replace(et,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function at(h,s){s=s||1/0;let u;const y=h.length;let T=null;const A=[];for(let D=0;D<y;++D){if(u=h.charCodeAt(D),u>55295&&u<57344){if(!T){if(u>56319){(s-=3)>-1&&A.push(239,191,189);continue}else if(D+1===y){(s-=3)>-1&&A.push(239,191,189);continue}T=u;continue}if(u<56320){(s-=3)>-1&&A.push(239,191,189),T=u;continue}u=(T-55296<<10|u-56320)+65536}else T&&(s-=3)>-1&&A.push(239,191,189);if(T=null,u<128){if((s-=1)<0)break;A.push(u)}else if(u<2048){if((s-=2)<0)break;A.push(u>>6|192,u&63|128)}else if(u<65536){if((s-=3)<0)break;A.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((s-=4)<0)break;A.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return A}function ct(h){const s=[];for(let u=0;u<h.length;++u)s.push(h.charCodeAt(u)&255);return s}function mt(h,s){let u,y,T;const A=[];for(let D=0;D<h.length&&!((s-=2)<0);++D)u=h.charCodeAt(D),y=u>>8,T=u%256,A.push(T),A.push(y);return A}function ar(h){return e.toByteArray(Gn(h))}function ut(h,s,u,y){let T;for(T=0;T<y&&!(T+u>=s.length||T>=h.length);++T)s[T+u]=h[T];return T}function Be(h,s){return h instanceof s||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===s.name}function Te(h){return h!==h}const tt=function(){const h="0123456789abcdef",s=new Array(256);for(let u=0;u<16;++u){const y=u*16;for(let T=0;T<16;++T)s[y+T]=h[u]+h[T]}return s}();function Fe(h){return typeof BigInt>"u"?te:h}function te(){throw new Error("BigInt not supported")}}(Cr)),Cr}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var vi;function io(){return vi||(vi=1,function(n,e){var t=no(),r=t.Buffer;function i(c,a){for(var f in c)a[f]=c[f]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=o);function o(c,a,f){return r(c,a,f)}o.prototype=Object.create(r.prototype),i(r,o),o.from=function(c,a,f){if(typeof c=="number")throw new TypeError("Argument must not be a number");return r(c,a,f)},o.alloc=function(c,a,f){if(typeof c!="number")throw new TypeError("Argument must be a number");var d=r(c);return a!==void 0?typeof f=="string"?d.fill(a,f):d.fill(a):d.fill(0),d},o.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return r(c)},o.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(c)}}(Gt,Gt.exports)),Gt.exports}var bi;function so(){if(bi)return qt.exports;bi=1;var n=65536,e=4294967295;function t(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var r=io().Buffer,i=me.crypto||me.msCrypto;i&&i.getRandomValues?qt.exports=o:qt.exports=t;function o(c,a){if(c>e)throw new RangeError("requested too many random bytes");var f=r.allocUnsafe(c);if(c>0)if(c>n)for(var d=0;d<c;d+=n)i.getRandomValues(f.slice(d,d+n));else i.getRandomValues(f);return typeof a=="function"?process.nextTick(function(){a(null,f)}):f}return qt.exports}var xr,Si;function Ii(){if(Si)return xr;Si=1;const n=so();class e{constructor(r,i){this.ufrag=r,this.pwd=i,this.lite=!1,this.endOfCandidates=!1}clone(){const r=new e(this.ufrag,this.pwd);return r.setLite(this.lite),r.setEndOfCandidates(this.endOfCandidates),r}plain(){const r={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(r.lite=this.lite),this.endOfCandidates&&(r.endOfCandidates=this.endOfCandidates),r}getUfrag(){return this.ufrag}getPwd(){return this.pwd}isLite(){return this.lite}setLite(r){this.lite=r}isEndOfCandidates(){return this.endOfCandidates}setEndOfCandidates(r){this.endOfCandidates=r}}return e.generate=function(t){const r=new e,i=n(8),o=n(24);return r.ufrag=i.toString("hex"),r.pwd=o.toString("hex"),r.lite=t,r},e.expand=function(t){if(t.constructor.name==="ICEInfo")return t;t=t;const r=new e(t.ufrag,t.pwd);return r.setLite(t.lite),r.setEndOfCandidates(t.endOfCandidates),r},e.clone=function(t){return t.constructor.name==="ICEInfo"?t.clone():e.expand(t)},xr=e,xr}var Rr,Ei;function Wt(){if(Ei)return Rr;Ei=1;const e=vr()("SEND","RECV");return e.byValue=function(t){return e[t.toUpperCase()]},e.toString=function(t){switch(t){case e.SEND:return"send";case e.RECV:return"recv"}},e.reverse=function(t){switch(t){case e.SEND:return e.RECV;case e.RECV:return e.SEND}},Rr=e,Rr}var Tr,Ci;function kr(){if(Ci)return Tr;Ci=1;const n=Wt();class e{constructor(r,i){this.id=r,this.direction=i,this.formats=[],this.params=new Map}clone(){var r=new e(this.id,this.direction);return r.setFormats(this.formats),r.setParams(this.params),r}plain(){var r={id:this.id,direction:n.toString(this.direction)};this.formats&&(r.formats=this.formats);for(var[i,o]of this.params.entries())r.params||(r.params={}),r.params[i]=o;return r}getId(){return this.id}getDirection(){return this.direction}setDirection(r){this.direction=r}getFormats(){return this.formats}setFormats(r){this.formats=[];for(let i=0;i<r.length;++i)this.formats.push(parseInt(r[i]))}getParams(){return this.params}setParams(r){this.params=new Map(r)}addParam(r,i){this.params.set(r,i)}}return e.expand=function(t){if(t.constructor.name==="RIDInfo")return t;t=t;const r=new e(t.id,n.byValue(t.direction));for(const[i,o]of Object.entries(t.params||{}))r.addParam(i,o);return t.formats&&r.setFormats(t.formats),r},e.clone=function(t){return t.constructor.name==="RIDInfo"?t.clone():e.expand(t)},Tr=e,Tr}var Ar,xi;function Dr(){if(xi)return Ar;xi=1;class n{constructor(t,r){this.paused=r,this.id=t}clone(){return new n(this.id,this.paused)}plain(){return{id:this.id,paused:this.paused}}isPaused(){return this.paused}getId(){return this.id}}return n.expand=function(e){return e.constructor.name==="SimulcastStreamInfo"?e:(e=e,new n(e.id,e.paused))},n.clone=function(e){return e.constructor.name==="SimulcastStreamInfo"?e.clone():n.expand(e)},Ar=n,Ar}var Mr,Ri;function Lr(){if(Ri)return Mr;Ri=1;const n=Dr(),e=Wt();class t{constructor(){this.send=[],this.recv=[]}clone(){const i=new t;for(const o of this.send)i.addSimulcastAlternativeStreams(e.SEND,o.map(c=>c.clone()));for(const o of this.recv)i.addSimulcastAlternativeStreams(e.RECV,o.map(c=>c.clone()));return i}plain(){const i={send:[],recv:[]};for(const o of this.send)i.send.push(o.map(c=>c.plain()));for(const o of this.recv)i.recv.push(o.map(c=>c.plain()));return i}addSimulcastAlternativeStreams(i,o){return i===e.SEND?this.send.push(o):this.recv.push(o)}addSimulcastStream(i,o){return i===e.SEND?this.send.push([o]):this.recv.push([o])}getSimulcastStreams(i){return i===e.SEND?this.send:this.recv}}return t.expand=function(r){if(r.constructor.name==="SimulcastInfo")return r;r=r;const i=new t;for(const o of r.send||[])i.addSimulcastAlternativeStreams(e.SEND,o.map(n.expand));for(const o of r.recv||[])i.addSimulcastAlternativeStreams(e.RECV,o.map(n.expand));return i},t.clone=function(r){return r.constructor.name==="SimulcastInfo"?r.clone():t.expand(r)},Mr=t,Mr}var Pr,Ti;function Ur(){if(Ti)return Pr;Ti=1;const e=vr()("SENDRECV","SENDONLY","RECVONLY","INACTIVE");return e.byValue=function(t){return e[t.toUpperCase()]},e.toString=function(t){switch(t){case e.SENDRECV:return"sendrecv";case e.SENDONLY:return"sendonly";case e.RECVONLY:return"recvonly";case e.INACTIVE:return"inactive"}},e.reverse=function(t){switch(t){case e.SENDRECV:return e.SENDRECV;case e.SENDONLY:return e.RECVONLY;case e.RECVONLY:return e.SENDONLY;case e.INACTIVE:return e.INACTIVE}},Pr=e,Pr}var Br,ki;function Fr(){if(ki)return Br;ki=1;class n{constructor(t,r){this.port=t,this.maxMessageSize=r}clone(){return new n(this.port,this.maxMessageSize)}plain(){return{port:this.port,maxMessageSize:this.maxMessageSize}}getPort(){return this.port}getMaxMessageSize(){return this.maxMessageSize}}return n.expand=function(e){return e.constructor.name==="DataChannelInfo"?e:(e=e,new n(e.port,e.maxMessageSize))},n.clone=function(e){return e.constructor.name==="DataChannelInfo"?e.clone():n.expand(e)},Br=n,Br}var Or,Ai;function Di(){if(Ai)return Or;Ai=1;const n=jt(),e=kr(),t=Lr(),r=Ur(),i=Wt();Vt();const o=Fr();class c{constructor(d,l){this.id=d,this.type=l,this.direction=r.SENDRECV,this.extensions=new Map,this.codecs=new Map,this.rids=new Map,this.simulcast=null,this.bitrate=0,this.control=null,this.dataChannel=null}clone(){const d=new c(this.id,this.type);d.setDirection(this.direction),d.setBitrate(this.bitrate);for(const l of this.codecs.values())d.addCodec(l.clone());for(const[l,w]of this.extensions.entries())d.addExtension(l,w);for(const l of this.rids.values())d.addRID(l.clone());return this.simulcast&&d.setSimulcast(this.simulcast.clone()),this.control&&d.setControl(this.control),this.dataChannel&&d.setDataChannel(this.dataChannel.clone()),d}plain(){const d={id:this.id,type:this.type,direction:r.toString(this.direction),codecs:[]};this.dataChannel&&(d.dataChannel=this.dataChannel.plain()),this.bitrate&&(d.bitrate=this.bitrate);for(const l of this.codecs.values())d.codecs.push(l.plain());for(const[l,w]of this.extensions.entries())d.extensions||(d.extensions={}),d.extensions[l]=w;for(const l of this.rids.values())d.rids||(d.rids=[]),d.rids.push(l.plain());return this.simulcast&&(d.simulcast=this.simulcast.plain()),this.control&&(d.control=this.control),d}getType(){return this.type}getId(){return this.id}setId(d){this.id=d}addExtension(d,l){this.extensions.set(d,l)}addRID(d){this.rids.set(d.getId(),d)}addCodec(d){this.codecs.set(d.getType(),d)}setCodecs(d){this.codecs=d}getCodecForType(d){return this.codecs.get(d)}getCodec(d){for(const l of this.codecs.values())if(l.getCodec().toLowerCase()===d.toLowerCase())return l;return null}hasCodec(d){return this.getCodec(d)!==null}getCodecs(){return this.codecs}hasRTX(){for(const d of this.codecs.values())if(d.hasRTX())return!0;return!1}getExtensions(){return this.extensions}getRIDs(){return this.rids}getRID(d){return this.rids.get(d)}getBitrate(){return this.bitrate}setBitrate(d){this.bitrate=d}getDirection(){return this.direction}setDirection(d){this.direction=d}hasControl(){return!!this.control}getControl(){return this.control}setControl(d){this.control=d}hasDataChannel(){return!!this.dataChannel}getDataChannel(){return this.dataChannel}setDataChannel(d){this.dataChannel=d}answer(d){const l=new c(this.id,this.type);if(d){l.setDirection(r.reverse(this.direction));const{codecs:w,dataChannel:g}=d;if(w){let m;Array.isArray(w)?m=n.MapFromNames(w,d.rtx,d.rtcpfbs):m=w;for(let I of this.codecs.values())for(let R of m.values()){if(R.getCodec().toLowerCase()!==I.getCodec().toLowerCase()||R.getCodec()==="h264"&&R.hasParam("packetization-mode")&&R.getParam("packetization-mode")!=I.getParam("packetization-mode","0")||R.getCodec()==="h264"&&R.hasParam("profile-level-id")&&I.hasParam("profile-level-id")&&R.getParam("profile-level-id")!=I.getParam("profile-level-id")||R.getCodec()==="multiopus"&&R.hasParam("num_streams")&&I.hasParam("num_streams")&&R.getParam("num_streams")!=I.getParam("num_streams"))continue;const M=R.clone();M.setType(I.getType()),M.hasRTX()&&M.setRTX(I.getRTX()),I.hasChannels()&&M.setChannels(I.getChannels()),M.addParams(I.getParams()),l.addCodec(M);break}}const p=new Set(d.extensions);for(let[m,I]of this.extensions)p.has(I)&&l.addExtension(m,I);if(d.simulcast&&this.simulcast){const m=new t,I=this.simulcast.getSimulcastStreams(i.SEND);if(I)for(const M of I){const U=M.map(F=>F.clone());m.addSimulcastAlternativeStreams(i.RECV,U)}const R=this.simulcast.getSimulcastStreams(i.RECV);if(R)for(const M of R){const U=M.map(F=>F.clone());m.addSimulcastAlternativeStreams(i.SEND,U)}for(const M of this.rids.values()){const U=M.clone();U.setDirection(i.reverse(M.getDirection())),l.addRID(U)}l.setSimulcast(m)}if(g&&this.dataChannel){const m=new o(this.dataChannel.getPort(),g.maxMessageSize?g.maxMessageSize:this.dataChannel.getMaxMessageSize());l.setDataChannel(m)}}else l.setDirection(r.INACTIVE);return l}getSimulcast(){return this.simulcast}setSimulcast(d){this.simulcast=d}}c.create=function(f,d,l){!l&&typeof d!="string"&&(l=d,d=f);const w=new c(f,d);if(l){const{codecs:g}=l;g&&(Array.isArray(g)?w.setCodecs(n.MapFromNames(g,l.rtx,l.rtcpfbs)):w.setCodecs(g))}else w.setDirection(r.INACTIVE);return w},c.expand=function(f){if(f.constructor.name==="MediaInfo")return f;f=f;const d=new c(f.id,f.type);if(f.direction&&d.setDirection(r.byValue(f.direction)),d.setBitrate(f.bitrate),f.dataChannel){const l=o.expand(f.dataChannel);l&&d.setDataChannel(l)}for(const[l,w]of Object.entries(f.extensions))d.addExtension(a(l),w);for(const l of f.codecs){const w=n.expand(l);w&&d.addCodec(w)}for(const l of f.rids||[]){const w=e.expand(l);d.addRID(w)}return f.simulcast&&d.setSimulcast(t.expand(f.simulcast)),f.control&&d.setControl(f.control),d},c.clone=function(f){return f.constructor.name==="MediaInfo"?f.clone():c.expand(f)};function a(f){const d=f.toString();if(!/^\d+$/.test(d))throw new Error("invalid integer ".concat(d));return parseInt(d)}return Or=c,Or}var Nr,Mi;function _r(){if(Mi)return Nr;Mi=1;class n{constructor(t,r){this.semantics=t,this.ssrcs=[];for(let i=0;i<r.length;++i)this.ssrcs.push(parseInt(r[i]))}clone(){return new n(this.semantics,this.ssrcs)}plain(){const t={semantics:this.semantics,ssrcs:[]};for(let r=0;r<this.ssrcs.length;++r)t.ssrcs.push(this.ssrcs[r]);return t}getSemantics(){return this.semantics}getSSRCs(){return this.ssrcs}}return n.expand=function(e){return e.constructor.name==="SourceGroupInfo"?e:(e=e,new n(e.semantics,e.ssrcs))},n.clone=function(e){return e.constructor.name==="SourceGroupInfo"?e.clone():n.expand(e)},Nr=n,Nr}var Vr,Li;function Pi(){if(Li)return Vr;Li=1;class n{constructor(t){this.ssrc=t}clone(){const t=new n(this.ssrc);return t.setCName(this.cname),t.setStreamId(this.streamId),t.setTrackId(this.trackId),t}plain(){const t={ssrc:this.ssrc};return this.cname&&(t.cname=this.cname),this.streamId&&(t.streamId=this.streamId),this.trackId&&(t.trackId=this.trackId),t}getCName(){return this.cname}setCName(t){this.cname=t}getStreamId(){return this.streamId}setStreamId(t){this.streamId=t}getTrackId(){return this.trackId}setTrackId(t){this.trackId=t}getSSRC(){return this.ssrc}}return n.expand=function(e){if(e.constructor.name==="SourceInfo")return e;e=e;const t=new n(e.ssrc);return t.setCName(e.cname),t.setStreamId(e.streamId),t.setTrackId(e.trackId),t},n.clone=function(e){return e.constructor.name==="SourceInfo"?e.clone():n.expand(e)},Vr=n,Vr}var jr,Ui;function qr(){if(Ui)return jr;Ui=1;const n=jt();class e{constructor(r,i=!1){this.id=r,this.paused=i,this.codecs=new Map,this.params=new Map}clone(){var r=new e(this.id,this.paused);for(let i of this.codecs.values())r.addCodec(i.clone());return r.setParams(this.params),r}plain(){var r={id:this.id,paused:this.paused,codecs:{},params:{}};for(var[i,o]of this.codecs.entries())r.codecs[i]=o.plain();for(var[i,c]of this.params.entries())r.params[i]=c;return r}getId(){return this.id}getCodecs(){return this.codecs}addCodec(r){this.codecs.set(r.getType(),r)}getParams(){return this.params}setParams(r){this.params=new Map(r)}addParam(r,i){this.params.set(r,i)}isPaused(){return this.paused}}return e.expand=function(t){if(t.constructor.name==="TrackEncodingInfo")return t;t=t;const r=new e(t.id,t.paused);for(const i of Object.values(t.codecs||{}))r.addCodec(n.expand(i));for(const[i,o]of Object.entries(t.params||{}))r.addParam(i,o);return r},e.clone=function(t){return t.constructor.name==="TrackEncodingInfo"?t.clone():e.expand(t)},jr=e,jr}var Gr,Bi;function Hr(){if(Bi)return Gr;Bi=1;const n=_r(),e=qr();class t{constructor(i,o){this.media=i,this.id=o,this.ssrcs=[],this.groups=[],this.encodings=[]}clone(){const i=new t(this.media,this.id);this.mediaId&&i.setMediaId(this.mediaId);for(let o=0;o<this.ssrcs.length;++o)i.addSSRC(this.ssrcs[o]);for(let o=0;o<this.groups.length;++o)i.addSourceGroup(this.groups[o].clone());for(let o=0;o<this.encodings.length;++o){const c=[];for(let a=0;a<this.encodings[o].length;++a)c.push(this.encodings[o][a].clone());i.addAlternativeEncodings(c)}return i}plain(){const i={media:this.media,id:this.id,ssrcs:[]};this.mediaId&&(i.mediaId=this.mediaId);for(let o=0;o<this.ssrcs.length;++o)i.ssrcs.push(this.ssrcs[o]);for(let o=0;o<this.groups.length;++o)i.groups||(i.groups=[]),i.groups.push(this.groups[o].plain());for(let o=0;o<this.encodings.length;++o){const c=[];for(let a=0;a<this.encodings[o].length;++a)c.push(this.encodings[o][a].plain());c.length&&(i.encodings||(i.encodings=[]),i.encodings.push(c))}return i}getMedia(){return this.media}setMediaId(i){this.mediaId=i}getMediaId(){return this.mediaId}getId(){return this.id}addSSRC(i){this.ssrcs.push(i)}getSSRCs(){return this.ssrcs}addSourceGroup(i){this.groups.push(i)}getSourceGroup(i){for(const o of this.groups)if(o.getSemantics().toLowerCase()===i.toLowerCase())return o;return null}getSourceGroups(){return this.groups}getSourceGroupsForMediaSSRC(i){return this.groups.filter(o=>o.getSSRCs()[0]===i)}hasSourceGroup(i){for(const o of this.groups)if(o.getSemantics().toLowerCase()===i.toLowerCase())return!0;return!1}getEncodings(){return this.encodings}addEncoding(i){this.encodings.push([i])}addAlternativeEncodings(i){this.encodings.push(i)}setEncodings(i){this.encodings=i}getEncodingSources(){const i=[];if(this.encodings.length)for(const o of this.encodings)for(const c of o){const a={id:c.getId(),rid:c.getId()},f=c.getParams(),d=f==null?void 0:f.get("ssrc");if(d!==void 0){a.media=parseInt(d);for(const l of this.getSourceGroupsForMediaSSRC(a.media))switch(l.getSemantics()){case"FID":a.rtx=l.getSSRCs()[1];break;case"FEC-FR":a.fec=l.getSSRCs()[1];break}}i.push(a)}else if(this.hasSourceGroup("SIM")){const c=this.getSourceGroup("SIM").getSSRCs();this.getSourceGroups();for(const a of c){const f={id:String(a),media:a};for(const d of this.getSourceGroupsForMediaSSRC(f.media))switch(d.getSemantics()){case"FID":f.rtx=d.getSSRCs()[1];break;case"FEC-FR":f.fec=d.getSSRCs()[1];break}i.push(f)}}else{const o={id:""};if(this.ssrcs.length){o.media=this.ssrcs[0];for(const c of this.getSourceGroupsForMediaSSRC(o.media))switch(c.getSemantics()){case"FID":o.rtx=c.getSSRCs()[1];break;case"FEC-FR":o.fec=c.getSSRCs()[1];break}}i.push(o)}return i}}return t.expand=function(r){var i,o;if(r.constructor.name==="TrackInfo")return r;r=r;const c=new t(r.media,r.id);if(r.mediaId&&c.setMediaId(r.mediaId),Array.isArray(r.ssrcs))for(const a of r.ssrcs)c.addSSRC(a);else if(((i=r.ssrcs)===null||i===void 0?void 0:i.media)!==void 0){const a=r.ssrcs.media;if(c.addSSRC(a),r.ssrcs.rtx!==void 0){const f=r.ssrcs.rtx;c.addSSRC(f),c.addSourceGroup(new n("FID",[a,f]))}if(r.ssrcs.fec!==void 0){const f=r.ssrcs.fec;c.addSSRC(f),c.addSourceGroup(new n("FEC-FR",[a,f]))}}if(r.rid){const a=new e(r.rid);((o=r.ssrcs)===null||o===void 0?void 0:o.media)!==void 0&&a.addParam("ssrc",r.ssrcs.media),c.addAlternativeEncodings([a])}for(const a of r.groups||[])c.addSourceGroup(n.expand(a));for(const a of r.encodings||[]){const f=[];for(const d of a)f.push(e.expand(d));c.addAlternativeEncodings(f)}return c},t.clone=function(r){return r.constructor.name==="TrackInfo"?r.clone():t.expand(r)},Gr=t,Gr}var Wr,Fi;function Oi(){if(Fi)return Wr;Fi=1;const n=Hr();class e{constructor(r){this.id=r,this.tracks=new Map}clone(){const r=new e(this.id);for(const i of this.tracks.values())r.addTrack(i.clone());return r}plain(){const r={id:this.id,tracks:[]};for(const i of this.tracks.values())r.tracks.push(i.plain());return r}getId(){return this.id}addTrack(r){this.tracks.set(r.getId(),r)}removeTrack(r){return this.tracks.delete(r.getId())}removeTrackById(r){return this.tracks.delete(r)}getFirstTrack(r){for(let i of this.tracks.values())if(i.getMedia().toLowerCase()===r.toLowerCase())return i;return null}getTracks(){return this.tracks}removeAllTracks(){this.tracks.clear()}getTrack(r){return this.tracks.get(r)}}return e.expand=function(t){if(t.constructor.name==="StreamInfo")return t;t=t;const r=new e(t.id);for(const i of t.tracks||[]){const o=n.expand(i);o&&r.addTrack(o)}return r},e.clone=function(t){return t.constructor.name==="StreamInfo"?t.clone():e.expand(t)},Wr=e,Wr}var $r,Ni;function oo(){if(Ni)return $r;Ni=1;const n=Qs(),e=eo()("en-US"),t=ai(),r=jt(),i=Vt(),o=hi(),c=mi(),a=Ii(),f=Di(),d=Sr(),l=Ur(),w=Wt(),g=_r(),p=Pi(),m=Oi(),I=Hr(),R=qr(),M=Lr(),U=Dr(),F=kr(),v=Fr();class S{constructor(b){this.version=b||1,this.streams=new Map,this.medias=new Array,this.candidates=new Array,this.ice=null,this.dtls=null,this.crypto=null,this.extmapAllowMixed=!0}clone(){const b=new S(this.version);for(const x of this.medias)b.addMedia(x.clone());for(const x of this.streams.values())b.addStream(x.clone());for(const x of this.candidates)b.addCandidate(x.clone());return b.setICE(this.ice.clone()),this.dtls&&b.setDTLS(this.dtls.clone()),this.crypto&&b.setCrypto(this.crypto.clone()),b.setExtmapAllowMixed(this.extmapAllowMixed),b}plain(){const b={version:this.version,streams:[],medias:[],candidates:[]};for(const x of this.medias)b.medias.push(x.plain());for(const x of this.streams.values())b.streams.push(x.plain());for(const x of this.candidates)b.candidates.push(x.plain());return this.ice&&(b.ice=this.ice.plain()),this.dtls&&(b.dtls=this.dtls.plain()),this.crypto&&(b.crypto=this.crypto.plain()),this.extmapAllowMixed||(b.extmapAllowMixedNotSupported=!this.extmapAllowMixed),b}unify(){const b=new S(this.version);for(const P of this.medias)b.addMedia(P.clone());const x={audio:b.getMediasByType("audio"),video:b.getMediasByType("video")};for(const P of this.streams.values()){const k=P.clone();for(const O of k.getTracks().values()){let J=x[O.getMedia()].pop();J||(J=this.getMedia(O.getMedia()).clone(),J.setId(O.getId()),b.addMedia(J)),O.setMediaId(J.getId())}b.addStream(k)}for(const P of this.candidates)b.addCandidate(P.clone());return this.ice&&b.setICE(this.ice.clone()),this.dtls&&b.setDTLS(this.dtls.clone()),this.crypto&&b.setCrypto(this.crypto.clone()),b}setVersion(b){this.version=b}addMedia(b){this.medias.push(b)}getMedia(b){for(let x in this.medias){let P=this.medias[x];if(e(P.getType(),b))return P}return null}getMediasByType(b){let x=[];for(let P in this.medias){let k=this.medias[P];e(k.getType(),b)&&x.push(k)}return x}getMediaById(b){for(const x of this.medias)if(e(x.getId(),b))return x;return null}replaceMedia(b){for(let x in this.medias)if(this.medias[x].getId()==b.getId())return this.medias[x]=b,!0;return!1}getMedias(){return this.medias}getVersion(){return this.version}getDTLS(){return this.dtls}setDTLS(b){this.dtls=b}hasCrypto(){return!!this.crypto}getCrypto(){return this.crypto}setCrypto(b){this.crypto=b}hasICE(){return!!this.ice}getICE(){return this.ice}setICE(b){this.ice=b}addCandidate(b){for(const x of this.candidates)if(x.equals(b))return;this.candidates.push(b)}addCandidates(b){for(const x of b)this.addCandidate(x)}getCandidates(){return this.candidates}getStream(b){return this.streams.get(b)}getStreams(){return this.streams}getFirstStream(){for(const b of this.streams.values())return b;return null}addStream(b){this.streams.set(b.getId(),b)}removeStream(b){return this.streams.delete(b.getId())}removeAllStreams(){this.streams.clear()}getTracksByMediaType(b){let x=[];for(const P of this.streams.values())for(const[k,O]of P.getTracks())e(O.getMedia(),b)&&x.push(O);return x}getTrackByMediaId(b){for(const x of this.streams.values())for(const[P,k]of x.getTracks())if(k.getMediaId()==b)return k;return null}getStreamByMediaId(b){for(const x of this.streams.values())for(const[P,k]of x.getTracks())if(k.getMediaId()==b)return x;return null}getExtmapAllowMixed(){return this.extmapAllowMixed}setExtmapAllowMixed(b){this.extmapAllowMixed=b}answer(b){const x=new S;b.ice&&(b.ice instanceof a?x.setICE(b.ice.clone()):x.setICE(a.expand(b.ice))),b.dtls&&(b.dtls instanceof o?x.setDTLS(b.dtls):x.setDTLS(o.expand(b.dtls))),b.crypto&&(b.crypto instanceof c?x.setCrypto(b.crypto):x.setCrypto(c.expand(b.crypto)));for(let P=0;b.candidates&&P<b.candidates.length;++P)b.candidates[P]instanceof t?x.addCandidate(b.candidates[P].clone()):x.addCandidate(t.expand(b.candidates[P]));for(const P of this.medias){const k=b&&b.capabilities&&b.capabilities[P.getType()];x.addMedia(P.answer(k))}return x.setExtmapAllowMixed(this.extmapAllowMixed),x}toString(){let b={version:0,media:[]};b.version=0,b.origin={username:"-",sessionId:new Date().getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"},b.name="semantic-sdp",b.connection={version:4,ip:"0.0.0.0"},b.timing={start:0,stop:0},this.hasICE()&&this.getICE().isLite()&&(b.icelite="ice-lite"),b.msidSemantic={semantic:"WMS",token:"*"},b.groups=[],this.extmapAllowMixed&&(b.extmapAllowMixed="extmap-allow-mixed");const x=[];for(const k of this.medias){let O={type:k.getType(),port:9,protocol:"",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};O.direction=l.toString(k.getDirection()),this.extmapAllowMixed&&(O.extmapAllowMixed="extmap-allow-mixed"),O.mid=k.getId(),x.push(k.getId()),k.hasControl()&&(O.control=k.getControl()),k.getBitrate()>0&&(O.bandwidth.push({type:"AS",limit:k.getBitrate()}),O.bandwidth.push({type:"TIAS",limit:k.getBitrate()*1e3}));let J=this.getCandidates();for(const H of J)O.candidates.push({foundation:H.getFoundation(),component:H.getComponentId(),transport:H.getTransport(),priority:H.getPriority(),ip:H.getAddress(),port:H.getPort(),type:H.getType(),raddr:H.getRelAddr(),rport:H.getRelPort()});if(this.getICE()&&(O.iceUfrag=this.getICE().getUfrag(),O.icePwd=this.getICE().getPwd()),e("audio",k.getType())||e("video",k.getType())){O.rtcpMux="rtcp-mux",O.rtcpRsize="rtcp-rsize",this.getDTLS()?(O.protocol="UDP/TLS/RTP/SAVPF",O.fingerprint={type:this.getDTLS().getHash(),hash:this.getDTLS().getFingerprint()},O.setup=d.toString(this.getDTLS().getSetup())):this.getCrypto()?(O.protocol="RTP/SAVPF",O.crypto=[{id:this.getCrypto().getTag(),suite:this.getCrypto().getSuite(),config:this.getCrypto().getKeyParams()}]):O.protocol="RTP/AVP";for(const G of k.getCodecs().values()){e("video",k.getType())?O.rtp.push({payload:G.getType(),codec:G.getCodec().toUpperCase(),rate:9e4}):e("opus",G.getCodec())?O.rtp.push({payload:G.getType(),codec:G.getCodec(),rate:48e3,encoding:G.getChannels()}):e("multiopus",G.getCodec())?O.rtp.push({payload:G.getType(),codec:G.getCodec(),rate:48e3,encoding:G.getChannels()}):O.rtp.push({payload:G.getType(),codec:G.getCodec(),rate:8e3});for(const B of G.getRTCPFeedbacks())O.rtcpFb.push({payload:G.getType(),type:B.getId(),subtype:B.getParams().join(" ")});G.hasRTX()&&(O.rtp.push({payload:G.getRTX(),codec:"rtx",rate:9e4}),O.fmtp.push({payload:G.getRTX(),config:"apt="+G.getType()}));const j=G.getParams();if(Object.keys(j).length){const B={payload:G.getType(),config:""};for(const V in j)B.config.length&&(B.config+=";"),Object.hasOwnProperty.call(j,V)?B.config+=V+"="+j[V]:B.config+=V;O.fmtp.push(B)}}const H=[];for(const G of O.rtp)H.push(G.payload);O.payloads=H.join(" ");for(let[G,j]of k.getExtensions().entries())O.ext.push({value:G,uri:j});for(let G of k.getRIDs().values()){let j={id:G.getId(),direction:w.toString(G.getDirection()),params:""};G.getFormats().length&&(j.params="pt="+G.getFormats().join(","));for(let[B,V]of G.getParams().entries())j.params+=(j.params.length?";":"")+B+"="+V;O.rids.push(j)}const ee=k.getSimulcast();if(ee){let G=1;O.simulcast={};const j=ee.getSimulcastStreams(w.SEND),B=ee.getSimulcastStreams(w.RECV);if(j&&j.length){let V="";for(const X of j){let Y="";for(const _ of X)Y+=(Y.length?",":"")+(_.isPaused()?"~":"")+_.getId();V+=(V.length?";":"")+Y}O.simulcast["dir"+G]="send",O.simulcast["list"+G]=V,G++}if(B&&B.length){let V="";for(const X of B){let Y="";for(const _ of X)Y+=(Y.length?",":"")+(_.isPaused()?"~":"")+_.getId();V+=(V.length?";":"")+Y}O.simulcast["dir"+G]="recv",O.simulcast["list"+G]=V,G++}}}else if(k.hasDataChannel()){O.protocol="UDP/DTLS/SCTP",O.payloads="webrtc-datachannel";const H=k.getDataChannel();O.sctpPort=H.getPort(),O.maxMessageSize=H.getMaxMessageSize()}b.media.push(O)}for(let k of this.streams.values())for(let O of k.getTracks().values())for(let J in b.media){let H=b.media[J];if(O.getMediaId()){if(O.getMediaId()==H.mid){let ee=O.getSourceGroups();for(let j in ee){let B=ee[j];H.ssrcGroups.push({semantics:B.getSemantics(),ssrcs:B.getSSRCs().join(" ")})}let G=O.getSSRCs();for(let j in G)H.ssrcs.push({id:G[j],attribute:"cname",value:k.getId()}),H.ssrcs.push({id:G[j],attribute:"msid",value:k.getId()+" "+O.getId()});H.msid=k.getId()+" "+O.getId();break}}else if(e(H.type,O.getMedia())){let ee=O.getSourceGroups();for(let j in ee){let B=ee[j];H.ssrcGroups.push({semantics:B.getSemantics(),ssrcs:B.getSSRCs().join(" ")})}let G=O.getSSRCs();for(let j in G)H.ssrcs.push({id:G[j],attribute:"cname",value:k.getId()}),H.ssrcs.push({id:G[j],attribute:"msid",value:k.getId()+" "+O.getId()});break}}const P={type:"BUNDLE",mids:x.join(" ")};return b.groups.push(P),n.write(b)}toIceFragmentString(){let b={version:0,media:[],candidates:[]};this.hasICE()&&this.getICE().isLite()&&(b.icelite="ice-lite"),this.getICE()&&(b.iceUfrag=this.getICE().getUfrag(),b.icePwd=this.getICE().getPwd());for(const x of this.getCandidates())b.candidates.push({foundation:x.getFoundation(),component:x.getComponentId(),transport:x.getTransport(),priority:x.getPriority(),ip:x.getAddress(),port:x.getPort(),type:x.getType(),raddr:x.getRelAddr(),rport:x.getRelPort()});return n.write(b).slice(10)}}return S.create=function(E){var b;const x=new S;if(E.streams)for(const J of E.streams)x.addStream(m.expand(J));E.ice&&(E.ice instanceof a?x.setICE(E.ice.clone()):x.setICE(a.expand(E.ice))),E.dtls&&(E.dtls instanceof o?x.setDTLS(E.dtls):x.setDTLS(o.expand(E.dtls))),E.crypto&&(E.crypto instanceof c?x.setCrypto(E.crypto):x.setCrypto(c.expand(E.crypto)));for(const J of E.candidates||[])J instanceof t?x.addCandidate(J.clone()):x.addCandidate(t.expand(J));let P=96,k=1,O=0;for(const[J,H]of Object.entries(E.capabilities||{}))if(E.unified&&(!((b=E.streams)===null||b===void 0)&&b.length))for(const ee of x.getTracksByMediaType(J)){const G=f.create(ee.getMediaId(),J,H);for(const[j,B]of G.getCodecs())B.getType()>=96&&B.setType(P++),B.getRTX()&&B.setRTX(P++);if(H.extensions)for(let j of H.extensions)k===15&&k++,G.addExtension(k++,j);x.addMedia(G)}else{const ee=f.create(E.unified?String(O++):J,J,H);for(const[G,j]of ee.getCodecs())j.getType()>=96&&j.setType(P++),j.getRTX()&&j.setRTX(P++);if(H.extensions)for(let G of H.extensions)k===15&&k++,ee.addExtension(k++,G);x.addMedia(ee)}return x},S.expand=function(E){if(E.constructor.name==="SDPInfo")return E;E=E;const b=new S(E.version);for(const x of E.medias||[]){const P=f.expand(x);P&&b.addMedia(P)}for(const x of E.streams||[]){const P=m.expand(x);P&&b.addStream(P)}for(const x of E.candidates||[]){const P=t.expand(x);P&&b.addCandidate(P)}return E.ice&&b.setICE(a.expand(E.ice)),E.dtls&&b.setDTLS(o.expand(E.dtls)),E.crypto&&b.setCrypto(c.expand(E.crypto)),E.extmapAllowMixedNotSupported&&(this.extmapAllowMixed=!E.extmapAllowMixedNotSupported),b},S.clone=function(E){return E.constructor.name==="SDPInfo"?E.clone():S.expand(E)},S.process=function(E){return S.parse(E)},S.parse=function(E){const b=n.parse(E),x=new S;if(x.setVersion(b.version),b.iceUfrag&&b.icePwd){const P=String(b.iceUfrag),k=String(b.icePwd),O=new a(P,k);O.setLite(b.icelite=="ice-lite"),O.setEndOfCandidates(b.endOfCandidates=="end-of-candidates"),x.setICE(O)}for(let P in b.media){const k=b.media[P],O=k.type,J=k.mid?k.mid.toString():P,H=new f(J,O);if(k.iceUfrag&&k.icePwd){const _=String(k.iceUfrag),N=String(k.icePwd),q=new a(_,N);q.setLite(b.icelite=="ice-lite"),q.setEndOfCandidates(k.endOfCandidates=="end-of-candidates"),x.setICE(q)}for(let _=0;k.candidates&&_<k.candidates.length;++_){const N=k.candidates[_],q=new t(N.foundation,N.component,N.transport,N.priority,N.ip,N.port,N.type,N.raddr,N.rport);x.addCandidate(q)}const ee=k.fingerprint||b.fingerprint;if(ee){const _=ee.type,N=ee.hash;let q=d.ACTPASS;k.setup&&(q=d.byValue(k.setup)),x.setDTLS(new o(q,_,N))}if(k.crypto){const _=k.crypto[0];x.setCrypto(new c(_.id,_.suite,_.config,_.sessionConfig))}let G=l.SENDRECV;k.direction&&(G=l.byValue(k.direction),H.setDirection(G)),k.control&&H.setControl(k.control),x.setExtmapAllowMixed(k.extmapAllowMixed=="extmap-allow-mixed"||b.extmapAllowMixed=="extmap-allow-mixed");const j=new Map;for(let _ in k.rtp){const N=k.rtp[_],q=N.payload,W=N.codec;if(W.toUpperCase()==="RED"||W.toUpperCase()==="ULPFEC")continue;let z={};for(let K in k.fmtp){const ne=k.fmtp[K];if(ne.payload===q){const pe=ne.config.split(";");for(let Re in pe){const De=pe[Re].split("="),Ue=De[0].trim(),pt=De.splice(1).join("=").trim();z[Ue]=pt}}}if(W.toUpperCase()==="RTX")j.set(parseInt(z.apt),q);else{const K=new r(W,q,z);N.encoding>1&&K.setChannels(N.encoding),H.addCodec(K)}}for(let _ of j.entries()){const N=H.getCodecForType(_[0]);N&&N.setRTX(_[1])}for(let _=0;k.rtcpFb&&_<k.rtcpFb.length;++_){const N=H.getCodecForType(k.rtcpFb[_].payload);if(N){const q=k.rtcpFb[_].type,W=k.rtcpFb[_].subtype?k.rtcpFb[_].subtype.split(" "):null;N.addRTCPFeedback(new i(q,W))}}const B=k.ext;for(let _ in B){const N=B[_];H.addExtension(N.value,N.uri)}const V=k.rids;for(let _ in V){const N=V[_],q=new F(N.id,w.byValue(N.direction));let W=[];const z=new Map;if(N.params){const K=n.parseParams(N.params);for(let ne in K)ne==="pt"?W=K[ne].split(","):z.set(ne,K[ne]);q.setFormats(W),q.setParams(z)}H.addRID(q)}const X=[];if(k.simulcast){const _=new M;if(k.simulcast.dir1){const N=w.byValue(k.simulcast.dir1),q=n.parseSimulcastStreamList(k.simulcast.list1);for(let W=0;W<q.length;++W){const z=[];for(let K=0;K<q[W].length;++K)z.push(new U(q[W][K].scid,q[W][K].paused));_.addSimulcastAlternativeStreams(N,z)}}if(k.simulcast.dir2){const N=w.byValue(k.simulcast.dir2),q=n.parseSimulcastStreamList(k.simulcast.list2);for(let W=0;W<q.length;++W){const z=[];for(let K=0;K<q[W].length;++K)z.push(new U(q[W][K].scid,q[W][K].paused));_.addSimulcastAlternativeStreams(N,z)}}for(let N of _.getSimulcastStreams(w.SEND)){const q=[];for(let W=0;W<N.length;W++){const z=new R(N[W].getId(),N[W].isPaused()),K=H.getRID(z.getId());if(K){const ne=K.getFormats();for(let pe=0;ne&&pe<ne.length;++pe){const Re=H.getCodecForType(ne[pe]);Re&&z.addCodec(Re)}z.setParams(K.getParams()),q.push(z)}}q.length&&X.push(q)}H.setSimulcast(_)}const Y=new Map;if(k.ssrcs)for(let _ in k.ssrcs){let N=k.ssrcs[_],q=N.id,W=N.attribute,z=N.value,K=Y.get(q);if(K||(K=new p(q),Y.set(K.getSSRC(),K)),e("cname",W))K.setCName(z);else if(e("msid",W)){let ne=z.split(" "),pe=ne[0],Re=ne[1];K.setStreamId(pe),K.setTrackId(Re);let De=x.getStream(pe);De||(De=new m(pe),x.addStream(De));let Ue=De.getTrack(Re);Ue||(Ue=new I(O,Re),Ue.setMediaId(J),Ue.setEncodings(X),De.addTrack(Ue)),Ue.addSSRC(q)}}if(k.msid){let _=k.msid.split(" "),N=_[0],q=_[1],W=x.getStream(N);W||(W=new m(N),x.addStream(W));let z=W.getTrack(q);z||(z=new I(O,q),z.setMediaId(J),z.setEncodings(X),W.addTrack(z));for(let[K,ne]of Y.entries())ne.getStreamId()||(ne.setStreamId(N),ne.setTrackId(q),z.addSSRC(K))}for(let[_,N]of Y.entries())if(!N.getStreamId()){let q=N.getCName(),W=J;N.setStreamId(q),N.setTrackId(W);let z=x.getStream(q);z||(z=new m(q),x.addStream(z));let K=z.getTrack(W);K||(K=new I(O,W),K.setMediaId(J),K.setEncodings(X),z.addTrack(K)),K.addSSRC(_)}if(k.ssrcGroups)for(let _ in k.ssrcGroups){let N=k.ssrcGroups[_],q=N.ssrcs.split(" "),W=new g(N.semantics,q),z=Y.get(parseInt(q[0]));z&&x.getStream(z.getStreamId()).getTrack(z.getTrackId()).addSourceGroup(W)}if(k.type=="application"&&k.payloads=="webrtc-datachannel"){const _=new v(k.sctpPort,k.maxMessageSize);H.setDataChannel(_)}x.addMedia(H)}return x},$r=S,$r}var _i;function ao(){return _i||(_i=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.SDPInfo=oo(),ge.CandidateInfo=ai(),ge.CodecInfo=jt(),ge.DTLSInfo=hi(),ge.CryptoInfo=mi(),ge.ICEInfo=Ii(),ge.MediaInfo=Di(),ge.Setup=Sr(),ge.SourceGroupInfo=_r(),ge.SourceInfo=Pi(),ge.StreamInfo=Oi(),ge.TrackInfo=Hr(),ge.RTCPFeedbackInfo=Vt(),ge.TrackEncodingInfo=qr(),ge.RIDInfo=kr(),ge.SimulcastInfo=Lr(),ge.SimulcastStreamInfo=Dr(),ge.DataChannelInfo=Fr(),ge.Direction=Ur()),ge}var it=ao(),It={exports:{}},co=It.exports,Vi;function uo(){return Vi||(Vi=1,function(n,e){(function(t,r){var i="0.7.39",o="",c="?",a="function",f="undefined",d="object",l="string",w="major",g="model",p="name",m="type",I="vendor",R="version",M="architecture",U="console",F="mobile",v="tablet",S="smarttv",E="wearable",b="embedded",x=500,P="Amazon",k="Apple",O="ASUS",J="BlackBerry",H="Browser",ee="Chrome",G="Edge",j="Firefox",B="Google",V="Huawei",X="LG",Y="Microsoft",_="Motorola",N="Opera",q="Samsung",W="Sharp",z="Sony",K="Xiaomi",ne="Zebra",pe="Facebook",Re="Chromium OS",De="Mac OS",Ue=" Browser",pt=function(te,h){var s={};for(var u in te)h[u]&&h[u].length%2===0?s[u]=h[u].concat(te[u]):s[u]=te[u];return s},Ve=function(te){for(var h={},s=0;s<te.length;s++)h[te[s].toUpperCase()]=te[s];return h},Qe=function(te,h){return typeof te===l?et(h).indexOf(et(te))!==-1:!1},et=function(te){return te.toLowerCase()},Gn=function(te){return typeof te===l?te.replace(/[^\d\.]/g,o).split(".")[0]:r},at=function(te,h){if(typeof te===l)return te=te.replace(/^\s\s*/,o),typeof h===f?te:te.substring(0,x)},ct=function(te,h){for(var s=0,u,y,T,A,D,Z;s<h.length&&!D;){var le=h[s],ae=h[s+1];for(u=y=0;u<le.length&&!D&&le[u];)if(D=le[u++].exec(te),D)for(T=0;T<ae.length;T++)Z=D[++y],A=ae[T],typeof A===d&&A.length>0?A.length===2?typeof A[1]==a?this[A[0]]=A[1].call(this,Z):this[A[0]]=A[1]:A.length===3?typeof A[1]===a&&!(A[1].exec&&A[1].test)?this[A[0]]=Z?A[1].call(this,Z,A[2]):r:this[A[0]]=Z?Z.replace(A[1],A[2]):r:A.length===4&&(this[A[0]]=Z?A[3].call(this,Z.replace(A[1],A[2])):r):this[A]=Z||r;s+=2}},mt=function(te,h){for(var s in h)if(typeof h[s]===d&&h[s].length>0){for(var u=0;u<h[s].length;u++)if(Qe(h[s][u],te))return s===c?r:s}else if(Qe(h[s],te))return s===c?r:s;return h.hasOwnProperty("*")?h["*"]:te},ar={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},ut={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Be={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,R],[/opios[\/ ]+([\w\.]+)/i],[R,[p,N+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[R,[p,N+" GX"]],[/\bopr\/([\w\.]+)/i],[R,[p,N]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[R,[p,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,R],[/quark(?:pc)?\/([-\w\.]+)/i],[R,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[R,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[p,"UC"+H]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[R,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[R,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[R,[p,"Smart Lenovo "+H]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+H],R],[/\bfocus\/([\w\.]+)/i],[R,[p,j+" Focus"]],[/\bopt\/([\w\.]+)/i],[R,[p,N+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[p,N+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[p,"MIUI "+H]],[/fxios\/([-\w\.]+)/i],[R,[p,j]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360"+Ue]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],R],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+Ue],R],[/samsungbrowser\/([\w\.]+)/i],[R,[p,q+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],R],[/metasr[\/ ]?([\d\.]+)/i],[R,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[p,R],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,pe],R],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[R,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[p,ee+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,ee+" WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[p,"Android "+H]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[R,mt,ar]],[/(webkit|khtml)\/([\w\.]+)/i],[p,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],R],[/(wolvic)\/([\w\.]+)/i],[p,R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[p,j+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[R,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[M,"amd64"]],[/(ia32(?=;))/i],[[M,et]],[/((?:i[346]|x)86)[;\)]/i],[[M,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[M,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[M,"armhf"]],[/windows (ce|mobile); ppc;/i],[[M,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[M,/ower/,o,et]],[/(sun4\w)[;\)]/i],[[M,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[M,et]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[I,q],[m,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[I,q],[m,F]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[I,k],[m,F]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[I,k],[m,v]],[/(macintosh);/i],[g,[I,k]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[I,W],[m,F]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[I,V],[m,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[I,V],[m,F]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[g,/_/g," "],[I,K],[m,F]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[I,K],[m,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[I,"OPPO"],[m,F]],[/\b(opd2\d{3}a?) bui/i],[g,[I,"OPPO"],[m,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[I,"Vivo"],[m,F]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[I,"Realme"],[m,F]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[I,_],[m,F]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[I,_],[m,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[I,X],[m,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[I,X],[m,F]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[I,"Lenovo"],[m,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[I,"Nokia"],[m,F]],[/(pixel c)\b/i],[g,[I,B],[m,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[I,B],[m,F]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[I,z],[m,F]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[I,z],[m,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[I,"OnePlus"],[m,F]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[I,P],[m,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[I,P],[m,F]],[/(playbook);[-\w\),; ]+(rim)/i],[g,I,[m,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[I,J],[m,F]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[I,O],[m,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[I,O],[m,F]],[/(nexus 9)/i],[g,[I,"HTC"],[m,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[g,/_/g," "],[m,F]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[I,"TCL"],[m,v]],[/(itel) ((\w+))/i],[[I,et],g,[m,mt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[I,"Acer"],[m,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[I,"Meizu"],[m,F]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[I,"Ulefone"],[m,F]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[I,"Nothing"],[m,F]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,g,[m,F]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,g,[m,v]],[/(surface duo)/i],[g,[I,Y],[m,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[I,"Fairphone"],[m,F]],[/(u304aa)/i],[g,[I,"AT&T"],[m,F]],[/\bsie-(\w*)/i],[g,[I,"Siemens"],[m,F]],[/\b(rct\w+) b/i],[g,[I,"RCA"],[m,v]],[/\b(venue[\d ]{2,7}) b/i],[g,[I,"Dell"],[m,v]],[/\b(q(?:mv|ta)\w+) b/i],[g,[I,"Verizon"],[m,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[I,"Barnes & Noble"],[m,v]],[/\b(tm\d{3}\w+) b/i],[g,[I,"NuVision"],[m,v]],[/\b(k88) b/i],[g,[I,"ZTE"],[m,v]],[/\b(nx\d{3}j) b/i],[g,[I,"ZTE"],[m,F]],[/\b(gen\d{3}) b.+49h/i],[g,[I,"Swiss"],[m,F]],[/\b(zur\d{3}) b/i],[g,[I,"Swiss"],[m,v]],[/\b((zeki)?tb.*\b) b/i],[g,[I,"Zeki"],[m,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],g,[m,v]],[/\b(ns-?\w{0,9}) b/i],[g,[I,"Insignia"],[m,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[I,"NextBook"],[m,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],g,[m,F]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],g,[m,F]],[/\b(ph-1) /i],[g,[I,"Essential"],[m,F]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[I,"Envizen"],[m,v]],[/\b(trio[-\w\. ]+) b/i],[g,[I,"MachSpeed"],[m,v]],[/\btu_(1491) b/i],[g,[I,"Rotor"],[m,v]],[/(shield[\w ]+) b/i],[g,[I,"Nvidia"],[m,v]],[/(sprint) (\w+)/i],[I,g,[m,F]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[I,Y],[m,F]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[I,ne],[m,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[I,ne],[m,F]],[/smart-tv.+(samsung)/i],[I,[m,S]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[I,q],[m,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,X],[m,S]],[/(apple) ?tv/i],[I,[g,k+" TV"],[m,S]],[/crkey/i],[[g,ee+"cast"],[I,B],[m,S]],[/droid.+aft(\w+)( bui|\))/i],[g,[I,P],[m,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[I,W],[m,S]],[/(bravia[\w ]+)( bui|\))/i],[g,[I,z],[m,S]],[/(mitv-\w{5}) bui/i],[g,[I,K],[m,S]],[/Hbbtv.*(technisat) (.*);/i],[I,g,[m,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,at],[g,at],[m,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,S]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,g,[m,U]],[/droid.+; (shield) bui/i],[g,[I,"Nvidia"],[m,U]],[/(playstation [345portablevi]+)/i],[g,[I,z],[m,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[I,Y],[m,U]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[g,[I,q],[m,E]],[/((pebble))app/i],[I,g,[m,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[I,k],[m,E]],[/droid.+; (glass) \d/i],[g,[I,B],[m,E]],[/droid.+; (wt63?0{2,3})\)/i],[g,[I,ne],[m,E]],[/(quest( \d| pro)?)/i],[g,[I,pe],[m,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[m,b]],[/(aeobc)\b/i],[g,[I,P],[m,b]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[m,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[m,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,F]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[p,G+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,R],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[R,mt,ut]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,mt,ut],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,De],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,R],[/\(bb(10);/i],[R,[p,J]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[p,j+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[p,ee+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Re],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,R],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,R]]},Te=function(te,h){if(typeof te===d&&(h=te,te=r),!(this instanceof Te))return new Te(te,h).getResult();var s=typeof t!==f&&t.navigator?t.navigator:r,u=te||(s&&s.userAgent?s.userAgent:o),y=s&&s.userAgentData?s.userAgentData:r,T=h?pt(Be,h):Be,A=s&&s.userAgent==u;return this.getBrowser=function(){var D={};return D[p]=r,D[R]=r,ct.call(D,u,T.browser),D[w]=Gn(D[R]),A&&s&&s.brave&&typeof s.brave.isBrave==a&&(D[p]="Brave"),D},this.getCPU=function(){var D={};return D[M]=r,ct.call(D,u,T.cpu),D},this.getDevice=function(){var D={};return D[I]=r,D[g]=r,D[m]=r,ct.call(D,u,T.device),A&&!D[m]&&y&&y.mobile&&(D[m]=F),A&&D[g]=="Macintosh"&&s&&typeof s.standalone!==f&&s.maxTouchPoints&&s.maxTouchPoints>2&&(D[g]="iPad",D[m]=v),D},this.getEngine=function(){var D={};return D[p]=r,D[R]=r,ct.call(D,u,T.engine),D},this.getOS=function(){var D={};return D[p]=r,D[R]=r,ct.call(D,u,T.os),A&&!D[p]&&y&&y.platform&&y.platform!="Unknown"&&(D[p]=y.platform.replace(/chrome os/i,Re).replace(/macos/i,De)),D},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return u},this.setUA=function(D){return u=typeof D===l&&D.length>x?at(D,x):D,this},this.setUA(u),this};Te.VERSION=i,Te.BROWSER=Ve([p,R,w]),Te.CPU=Ve([M]),Te.DEVICE=Ve([g,I,m,U,F,S,v,E,b]),Te.ENGINE=Te.OS=Ve([p,R]),n.exports&&(e=n.exports=Te),e.UAParser=Te;var tt=typeof t!==f&&(t.jQuery||t.Zepto);if(tt&&!tt.ua){var Fe=new Te;tt.ua=Fe.getResult(),tt.ua.get=function(){return Fe.getUA()},tt.ua.set=function(te){Fe.setUA(te);var h=Fe.getResult();for(var s in h)tt.ua[s]=h[s]}}})(typeof window=="object"?window:co)}(It,It.exports)),It.exports}var lo=uo();const fo=ve(lo),ho=["iOS"];class Et extends fo{constructor(){super(window.navigator.userAgent)}isChromium(){return this.getUA().match(/Chrome/i)}isChrome(){const e=this.getBrowser();if(!e.name)return!1;const t=this.getOS();let r=!0;return r=!new RegExp(ho.join("|"),"i").test(t.name),e.name.match(/Chrome/i)&&r}isFirefox(){const e=this.getBrowser();return e.name?e.name.match(/Firefox/i):!1}isOpera(){const e=this.getBrowser();return e.name?e.name.match(/Opera/i):!1}isSafari(){const e=this.getBrowser();return e.name?e.name.match(/Safari/i):!1}}const fe=qe.get("SdpParser"),ji=35,po=65,qi=96,mo=127,go=Array.from({length:po-ji+1},(n,e)=>e+ji),yo=Array.from({length:mo-qi+1},(n,e)=>e+qi),Gi=1,wo=14,Hi=16,vo=255,bo=Array.from({length:wo-Gi+1},(n,e)=>e+Gi),So=Array.from({length:vo-Hi+1},(n,e)=>e+Hi),Ie={setSimulcast(n,e){if(fe.info("Setting simulcast. Codec: ",e),!new Et().isChromium())return fe.warn("Your browser does not appear to support Simulcast. For a better experience, use a Chromium based browser."),n;if(e!=="h264"&&e!=="vp8")return fe.warn("Your selected codec ".concat(e," does not appear to support Simulcast.  To broadcast using simulcast, please use H.264 or VP8.")),n;if(!/m=video/.test(n))return fe.warn("There is no available video for simulcast to be enabled."),n;try{const r=new RegExp("m=video.*?a=ssrc:(\\d*) cname:(.+?)\\r\\n","s"),i=new RegExp("m=video.*?a=ssrc:(\\d*) msid:(.+?)\\r\\n","s"),o=r.exec(n),c=o[1],a=o[2],f=i.exec(n)[2],d=2,l=[c];for(let w=0;w<d;++w){const g=100+w*2,p=g+1;l.push(g),n+="a=ssrc-group:FID "+g+" "+p+"\r\na=ssrc:"+g+" cname:"+a+"\r\na=ssrc:"+g+" msid:"+f+"\r\na=ssrc:"+p+" cname:"+a+"\r\na=ssrc:"+p+" msid:"+f+"\r\n"}return n+="a=ssrc-group:SIM "+l.join(" ")+"\r\n",fe.info("Simulcast setted"),fe.debug("Simulcast SDP: ",n),n}catch(r){throw fe.error("Error setting SDP for simulcast: ",r),r}},setStereo(n){return fe.info("Replacing SDP response for support stereo"),n=n.replace(/useinbandfec=1/g,"useinbandfec=1; stereo=1"),fe.info("Replaced SDP response for support stereo"),fe.debug("New SDP value: ",n),n},setDTX(n){return fe.info("Replacing SDP response for support dtx"),n=n.replace("useinbandfec=1","useinbandfec=1; usedtx=1"),fe.info("Replaced SDP response for support dtx"),fe.debug("New SDP value: ",n),n},setAbsoluteCaptureTime(n){const t="a=extmap:"+Ie.getAvailableHeaderExtensionIdRange(n)[0]+" http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time\r\n",r=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return n=n.replace(r,(i,o,c)=>o+t+c),fe.info("Replaced SDP response for setting absolute capture time"),fe.debug("New SDP value: ",n),n},setDependencyDescriptor(n){const t="a=extmap:"+Ie.getAvailableHeaderExtensionIdRange(n)[0]+" https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension\r\n",r=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return n=n.replace(r,(i,o,c)=>o+t+c),fe.info("Replaced SDP response for setting depency descriptor"),fe.debug("New SDP value: ",n),n},setVideoBitrate(n,e){if(e<1)fe.info("Remove bitrate restrictions"),n=n.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");else{const t=it.SDPInfo.parse(n),r=t.getMedia("video");fe.info("Setting video bitrate"),r.setBitrate(e),n=t.toString()}return n},removeSdpLine(n,e){return fe.debug("SDP before trimming: ",n),n=n.split("\n").filter(t=>t.trim()!==e).join("\n"),fe.debug("SDP trimmed result: ",n),n},adaptCodecName(n,e,t){if(!n)return n;const r=new RegExp("".concat(e),"i");return n.replace(r,t)},setMultiopus(n,e){if(!new Et().isFirefox()&&(!e||Io(e)))if(n.includes("multiopus/48000/6"))fe.info("Multiopus already setted");else{fe.info("Setting multiopus");const i=/m=audio 9 UDP\/TLS\/RTP\/SAVPF (.*)\r\n/.exec(n)[0],o=Ie.getAvailablePayloadTypeRange(n)[0],c=i.replace("\r\n"," ")+o+"\r\na=rtpmap:"+o+" multiopus/48000/6\r\na=fmtp:"+o+" channel_mapping=0,4,1,2,3,5;coupled_streams=2;minptime=10;num_streams=4;useinbandfec=1\r\n";n=n.replace(i,c),fe.info("Multiopus offer created"),fe.debug("SDP parsed for multioups: ",n)}return n},getAvailablePayloadTypeRange(n){const e=/m=(?:.*) (?:.*) UDP\/TLS\/RTP\/SAVPF (.*)\r\n/gm,t=n.matchAll(e);let r=yo.concat(go);for(const i of t){const o=i[1].split(" ").map(c=>parseInt(c));r=r.filter(c=>!o.includes(c))}return r},getAvailableHeaderExtensionIdRange(n){const e=/a=extmap:(\d+)(?:.*)\r\n/gm,t=n.matchAll(e);let r=bo.concat(So);for(const i of t){const o=i[1].split(" ").map(c=>parseInt(c));r=r.filter(c=>!o.includes(c))}return r},renegotiate(n,e){const t=it.SDPInfo.parse(n),r=it.SDPInfo.parse(e);for(const i of t.getMedias()){let o=r.getMediaById(i.getId());if(!o){o=new it.MediaInfo(i.getId(),i.getType()),o.setDirection(it.Direction.reverse(i.getDirection()));const c=r.getMedia(i.getType());if(c){o.setCodecs(c.getCodecs());for(const[a,f]of c.getExtensions())o.addExtension(a,f)}r.addMedia(o)}}return r.toString()},updateMissingVideoExtensions(n,e){var o;const t=it.SDPInfo.parse(n),i=(o=it.SDPInfo.parse(e).getMediasByType("video")[0])==null?void 0:o.getExtensions();if(!(!i&&!i.length)){for(const c of t.getMediasByType("video")){const a=c.getExtensions();i.forEach((f,d)=>{if(!a.get(d)){const l=c.getId(),w="a=extmap:"+d+" "+f+"\r\n",g=new RegExp("(a=mid:"+l+"\r\n(?:.*\r\n)*?)","g");n=n.replace(g,(p,m,I)=>m+w)}})}return n}},getCodecPayloadType(n){const e=/a=rtpmap:(\d+) (\w+)\/\d+/g,t=n.matchAll(e),r={};for(const i of t)r[i[1]]=i[2];return r}},Io=n=>n.getAudioTracks().some(e=>e.getSettings().channelCount>2),Me={VP8:"vp8",VP9:"vp9",H264:"h264",AV1:"av1",H265:"h265"},Eo={OPUS:"opus",MULTIOPUS:"multiopus"},Co="d40e38ea-d419-4c62-94ed-20ac37b4e4fa",Q=qe.get("PeerConnection"),$t={Publisher:"Publisher",Viewer:"Viewer"},Le={track:"track",connectionStateChange:"connectionStateChange"},Wi={stereo:!1,mediaStream:null,codec:"h264",simulcast:!1,scalabilityMode:null,disableAudio:!1,disableVideo:!1,setSDPToPeer:!0};class Je extends Ot{constructor(){super(),this.mode=null,this.sessionDescription=null,this.peer=null,this.peerConnectionStats=null,this.transceiverMap=new Map}async createRTCPeer(e={autoInitStats:!0,statsIntervalMs:1e3},t=$t.Viewer){Q.info("Creating new RTCPeerConnection"),Q.debug("RTC configuration provided by user: ",e),this.peer=Ro(this,e),this.mode=t,e.autoInitStats&&this.initStats(e)}getRTCPeer(){return Q.info("Getting RTC Peer"),this.peer}async closeRTCPeer(){var e;Q.info("Closing RTCPeerConnection"),(e=this.peer)==null||e.close(),this.peer=null,this.stopStats(),this.emit(Le.connectionStateChange,"closed")}async setRTCRemoteSDP(e){Q.info("Setting RTC Remote SDP");const t={type:"answer",sdp:e};try{await this.peer.setRemoteDescription(t),Q.info("RTC Remote SDP was set successfully."),Q.debug("RTC Remote SDP new value: ",e)}catch(r){throw Q.error("Error while setting RTC Remote SDP: ",r),r}}async getRTCLocalSDP(e=Wi){Q.info("Getting RTC Local SDP"),e=se(se({},Wi),e),Q.debug("Options: ",e);const t=xo(e.mediaStream);t?Ao(this.peer,t,e):Do(this.peer,e),Q.info("Creating peer offer");const r=await this.peer.createOffer();return Q.info("Peer offer created"),Q.debug("Peer offer response: ",r.sdp),this.sessionDescription=r,e.disableAudio||(e.stereo&&(this.sessionDescription.sdp=Ie.setStereo(this.sessionDescription.sdp)),e.dtx&&(this.sessionDescription.sdp=Ie.setDTX(this.sessionDescription.sdp)),this.sessionDescription.sdp=Ie.setMultiopus(this.sessionDescription.sdp,t)),!e.disableVideo&&e.simulcast&&(this.sessionDescription.sdp=Ie.setSimulcast(this.sessionDescription.sdp,e.codec)),e.absCaptureTime&&(this.sessionDescription.sdp=Ie.setAbsoluteCaptureTime(this.sessionDescription.sdp)),e.dependencyDescriptor&&(this.sessionDescription.sdp=Ie.setDependencyDescriptor(this.sessionDescription.sdp)),e.setSDPToPeer&&(await this.peer.setLocalDescription(this.sessionDescription),Q.info("Peer local description set")),this.sessionDescription.sdp}async addRemoteTrack(e,t){return new Promise((r,i)=>{try{const o=this.peer.addTransceiver(e,{direction:"recvonly",streams:t});this.transceiverMap.set(o,r)}catch(o){i(o)}})}updateBandwidthRestriction(e,t){if(this.mode===$t.Viewer)throw Q.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");return Q.info("Updating bandwidth restriction, bitrate value: ",t),Q.debug("SDP value: ",e),Ie.setVideoBitrate(e,t)}async updateBitrate(e=0){if(this.mode===$t.Viewer)throw Q.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");if(!this.peer)throw Q.error("Cannot update bitrate. No peer found."),new Error("Cannot update bitrate. No peer found.");Q.info("Updating bitrate to value: ",e),this.sessionDescription=await this.peer.createOffer(),await this.peer.setLocalDescription(this.sessionDescription);const t=this.updateBandwidthRestriction(this.peer.remoteDescription.sdp,e);await this.setRTCRemoteSDP(t),Q.info("Bitrate restrictions updated: ","".concat(e>0?e:"unlimited"," kbps"))}getRTCPeerStatus(){if(Q.info("Getting RTC peer status"),!this.peer)return null;const e=Mo(this.peer);return Q.info("RTC peer status getted, value: ",e),e}replaceTrack(e){if(!this.peer){Q.error("Could not change track if there is not an active connection.");return}const t=this.peer.getSenders().find(r=>r.track.kind===e.kind);t?t.replaceTrack(e):Q.error("There is no ".concat(e.kind," track in active broadcast."))}static getCapabilities(e){const t=new Et,r=RTCRtpSender.getCapabilities(e);if(r){const i={};let o=new RegExp("^video/(".concat(Object.values(Me).join("|"),")x?$"),"i");e==="audio"&&(o=new RegExp("^audio/(".concat(Object.values(Eo).join("|"),")$"),"i"),t.isChrome()&&(i.multiopus={mimeType:"audio/multiopus",channels:6}));for(const c of r.codecs){const a=c.mimeType.match(o);if(a){const f=a[1].toLowerCase();if(i[f]=je(se({},i[f]),{mimeType:c.mimeType}),c.scalabilityModes){let d=i[f].scalabilityModes||[];d=[...d,...c.scalabilityModes],i[f].scalabilityModes=[...new Set(d)]}c.channels&&(i[f].channels=c.channels)}}r.codecs=Object.keys(i).map(c=>se({codec:c},i[c]))}return r}getTracks(){var e,t;return(t=(e=this.peer)==null?void 0:e.getSenders())==null?void 0:t.map(r=>r.track)}initStats(e){this.peerConnectionStats?Q.warn("PeerConnection.initStats() has already been called. Automatic initialization occurs via View.connect(), Publish.connect() or this.createRTCPeer(). See options"):this.peer?(this.peerConnectionStats=new Ys(this.peer,e),_t(this.peerConnectionStats,this,[Qn.stats])):Q.warn("Cannot init peer stats: RTCPeerConnection not initialized")}stopStats(){var e;(e=this.peerConnectionStats)==null||e.stop(),this.peerConnectionStats=null}}const $i=n=>(n==null?void 0:n.getAudioTracks().length)<=1&&(n==null?void 0:n.getVideoTracks().length)<=1,xo=n=>{if(!n)return null;if(n instanceof MediaStream&&$i(n))return n;if(!(n instanceof MediaStream)){Q.info("Creating MediaStream to add received tracks.");const e=new MediaStream;for(const t of n)e.addTrack(t);if($i(e))return e}throw Q.error("MediaStream must have 1 audio track and 1 video track, or at least one of them."),new Error("MediaStream must have 1 audio track and 1 video track, or at least one of them.")},Ro=(n,e)=>{const t=new RTCPeerConnection(e);return ko(n,t),t};async function To(n){return new Promise(e=>setTimeout(e,n))}const ko=(n,e)=>{e.ontrack=async t=>{Q.info("New track from peer."),Q.debug("Track event value: ",t);const r=n.transceiverMap.get(t.transceiver);if(r){for(;!t.transceiver.mid;)await To(100);r(t.transceiver),n.transceiverMap.delete(t.transceiver)}setTimeout(()=>{n.emit(Le.track,t)},0)},e.connectionState?e.onconnectionstatechange=t=>{Q.info("Peer connection state change: ",e.connectionState),n.emit(Le.connectionStateChange,e.connectionState)}:e.oniceconnectionstatechange=t=>{Q.info("Peer ICE connection state change: ",e.iceConnectionState),n.emit(Le.connectionStateChange,e.iceConnectionState)},e.onnegotiationneeded=async t=>{if(!e.remoteDescription)return;Q.info("Peer onnegotiationneeded, updating local description");const r=await e.createOffer();Q.info("Peer onnegotiationneeded, got local offer",r.sdp),r.sdp=Ie.updateMissingVideoExtensions(r.sdp,e.remoteDescription.sdp),await e.setLocalDescription(r);const i=Ie.renegotiate(r.sdp,e.remoteDescription.sdp);Q.info("Peer onnegotiationneeded, updating remote description",i),await e.setRemoteDescription({type:"answer",sdp:i}),Q.info("Peer onnegotiationneeded, renegotiation done")}},Ao=(n,e,t)=>{Q.info("Adding mediaStream tracks to RTCPeerConnection");for(const r of e.getTracks()){const i={streams:[e]};r.kind==="audio"&&(i.direction=t.disableAudio?"inactive":"sendonly"),r.kind==="video"&&(i.direction=t.disableVideo?"inactive":"sendonly",t.scalabilityMode&&new Et().isChrome()?(Q.debug("Video track with scalability mode: ".concat(t.scalabilityMode,".")),i.sendEncodings=[{scalabilityMode:t.scalabilityMode}]):t.scalabilityMode&&Q.warn("SVC is only supported in Google Chrome")),n.addTransceiver(r,i),Q.info("Track '".concat(r.label,"' added: "),"id: ".concat(r.id),"kind: ".concat(r.kind))}},Do=(n,e)=>{const t=new Et;if(!e.disableVideo){const r=n.addTransceiver("video",{direction:"recvonly"});t.isOpera()&&r.setCodecPreferences(RTCRtpReceiver.getCapabilities("video").codecs.filter(i=>i.mimeType!=="video/H264"||i.sdpFmtpLine.includes("profile-level-id=4")))}e.disableAudio||n.addTransceiver("audio",{direction:"recvonly"});for(let r=0;r<e.multiplexedAudioTracks;r++)n.addTransceiver("audio",{direction:"recvonly"})},Mo=n=>{var t;const e=(t=n.connectionState)!=null?t:n.iceConnectionState;switch(e){case"checking":return"connecting";case"completed":return"connected";default:return e}};var zt={},zi;function Lo(){return zi||(zi=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.TypedEmitter=ur().EventEmitter),zt}var zr,Ki;function Po(){if(Ki)return zr;Ki=1;const{TypedEmitter:n}=Lo();class e extends n{constructor(i,o){super(),this.namespace=i,this.tm=o}cmd(i,o){return this.tm.cmd(i,o,this.namespace)}event(i,o){return this.tm.event(i,o,this.namespace)}close(){return this.tm.namespaces.delete(this.namespace)}}class t extends n{constructor(i){super(),this.maxId=0,this.namespaces=new Map,this.transactions=new Map,this.transport=i,this.listener=o=>{let c;try{c=JSON.parse(o.utf8Data||o.data||o)}catch(f){return}switch(c.type){case"cmd":const{transId:f}=c,d={name:c.name,data:c.data,namespace:c.namespace,accept:w=>{this._send({type:"response",transId:f,data:w})},reject:w=>{this._send({type:"error",transId:f,data:w})}};if(d.namespace){const w=this.namespaces.get(d.namespace);w?w.emit("cmd",d):this.emit("cmd",d)}else this.emit("cmd",d);break;case"response":{const w=this.transactions.get(c.transId);if(!w)return;this.transactions.delete(c.transId),w.resolve(c.data);break}case"error":{const w=this.transactions.get(c.transId);if(!w)return;this.transactions.delete(c.transId),w.reject(c.data);break}case"event":const l={name:c.name,data:c.data,namespace:c.namespace};if(l.namespace){var a=this.namespaces.get(l.namespace);a?a.emit("event",l):this.emit("event",l)}else this.emit("event",l);break}},this.transport.addListener?this.transport.addListener("message",this.listener):this.transport.addEventListener("message",this.listener)}_send(i){this.transport.send(JSON.stringify(i))}cmd(i,o,c=void 0){return new Promise((a,f)=>{if(!i||i.length===0)throw new Error("Bad command name");const d={type:"cmd",transId:this.maxId++,name:i,data:o};c&&(d.namespace=c),this.transactions.set(d.transId,je(se({},d),{resolve:a,reject:f}));try{this._send(d)}catch(l){throw this.transactions.delete(d.transId),l}})}event(i,o,c=void 0){if(!i||i.length===0)throw new Error("Bad event name");const a={type:"event",name:i,data:o};c&&(a.namespace=c),this._send(a)}namespace(i){let o=this.namespaces.get(i);return o||(o=new e(i,this),this.namespaces.set(i,o),o)}close(){for(const i of this.namespaces.values())i.close();this.transport.removeListener?this.transport.removeListener("message",this.listener):this.transport.removeEventListener("message",this.listener)}}return zr=t,zr}var Uo=Po();const Bo=ve(Uo),he=qe.get("Signaling"),He={connectionSuccess:"wsConnectionSuccess",connectionError:"wsConnectionError",connectionClose:"wsConnectionClose",broadcastEvent:"broadcastEvent"};class Kr extends Ot{constructor(e={streamName:null,url:"ws://localhost:8080/"}){super(),this.streamName=e.streamName,this.wsUrl=e.url,this.webSocket=null,this.transactionManager=null,this.serverId=null,this.clusterId=null,this.streamViewId=null}async connect(){var e;return he.info("Connecting to Signaling Server"),this.transactionManager&&((e=this.webSocket)==null?void 0:e.readyState)===WebSocket.OPEN?(he.info("Connected to server: ",this.webSocket.url),he.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(He.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),this.webSocket):new Promise((t,r)=>{this.webSocket=new WebSocket(this.wsUrl),this.transactionManager=new Bo(this.webSocket),this.webSocket.onopen=()=>{he.info("WebSocket opened"),this.transactionManager.on("event",i=>{this.emit(He.broadcastEvent,i)}),he.info("Connected to server: ",this.webSocket.url),he.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(He.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),t(this.webSocket)},this.webSocket.onerror=()=>{he.error("WebSocket not connected: ",this.webSocket.url),this.emit(He.connectionError,this.webSocket.url),r(this.webSocket.url)},this.webSocket.onclose=()=>{this.webSocket=null,this.transactionManager=null,he.info("Connection closed with Signaling Server."),this.emit(He.connectionClose)}})}close(){var e;he.info("Closing connection with Signaling Server."),(e=this.webSocket)==null||e.close()}async subscribe(e,t,r=null,i=null){var f,d,l,w;he.info("Starting subscription to streamName: ",this.streamName),he.debug("Subcription local description: ",e);const o=Fo(t,r,i);e=Ie.adaptCodecName(e,"AV1X",Me.AV1);const c=["active","inactive","layers","viewercount","vad","updated","migrate","stopped"],a={sdp:e,streamId:this.streamName,pinnedSourceId:o.pinnedSourceId,excludedSourceIds:o.excludedSourceIds,events:c};o.vad&&(a.vad=!0),Array.isArray(o.events)&&(a.events=o.events),o.forcePlayoutDelay&&(a.forcePlayoutDelay=o.forcePlayoutDelay),o.layer&&(a.layer=o.layer),o.abrConfiguration&&(a.abrConfiguration=t.abrConfiguration),o.customKeys&&(a.customKeys=o.customKeys),o.forceSmooth&&(a.abrConfiguration=je(se({},a.abrConfiguration||{}),{forceSmooth:o.forceSmooth}));try{if(o.disableVideo&&o.disableAudio)throw new Error("Not attempting to connect as video and audio are disabled");await this.connect(),he.info("Sending view command",a);const g=await this.transactionManager.cmd("view",a),p=(w=(l=(d=(f=RTCRtpReceiver.getCapabilities)==null?void 0:f.call(RTCRtpReceiver,"video"))==null?void 0:d.codecs)==null?void 0:l.find)==null?void 0:w.call(l,m=>m.mimeType==="video/AV1X");return g.sdp=p?Ie.adaptCodecName(g.sdp,Me.AV1,"AV1X"):g.sdp,he.info("Command sent, subscriberId: ",g.subscriberId),he.debug("Command result: ",g),this.serverId=g.subscriberId,this.clusterId=g.clusterId,this.streamViewId=g.streamViewId,Ae.initStreamName(this.streamName),Ae.initSubscriberId(this.serverId),Ae.initStreamViewId(g.streamViewId),Ae.setClusterId(this.clusterId),g.sdp}catch(g){throw he.error("Error sending view command, error: ",g),g}}async publish(e,t,r=null,i=null){var d,l,w,g,p,m,I,R;const o=Oo(t,r,i);he.info("Starting publishing to streamName: ".concat(this.streamName,", codec: ").concat(o.codec)),he.debug("Publishing local description: ",e);const c=(g=(w=(l=(d=Je.getCapabilities)==null?void 0:d.call(Je,"video"))==null?void 0:l.codecs)==null?void 0:w.map(M=>M.codec))!=null?g:[],a=Object.values(Me);if(a.indexOf(o.codec)===-1)throw he.error("Invalid codec ".concat(o.codec,". Possible values are: "),a),new Error("Invalid codec ".concat(o.codec,". Possible values are: ").concat(a));if(c.length>0&&c.indexOf(o.codec)===-1)throw he.error("Unsupported codec ".concat(o.codec,". Possible values are: "),c),new Error("Unsupported codec ".concat(o.codec,". Possible values are: ").concat(c));o.codec===Me.AV1&&(e=Ie.adaptCodecName(e,"AV1X",Me.AV1));const f={name:this.streamName,sdp:e,codec:o.codec,sourceId:o.sourceId};if(o.priority)if(Number.isInteger(o.priority)&&o.priority>=-2147483648&&o.priority<=2147483647)f.priority=o.priority;else throw new Error("Invalid value for priority option. It should be a decimal integer between the range [-2^31, +2^31 - 1]");o.record!==null&&(f.record=o.record),Array.isArray(o.events)&&(f.events=o.events);try{if(o.disableVideo&&o.disableAudio)throw new Error("Not attempting to connect as video and audio are disabled");await this.connect(),he.info("Sending publish command");const M=await this.transactionManager.cmd("publish",f);if(o.codec===Me.AV1){const U=(R=(I=(m=(p=RTCRtpSender.getCapabilities)==null?void 0:p.call(RTCRtpSender,"video"))==null?void 0:m.codecs)==null?void 0:I.find)==null?void 0:R.call(I,F=>F.mimeType==="video/AV1X");M.sdp=U?Ie.adaptCodecName(M.sdp,Me.AV1,"AV1X"):M.sdp}return he.info("Command sent, publisherId: ",M.publisherId),he.debug("Command result: ",M),this.serverId=M.publisherId,this.clusterId=M.clusterId,Ae.initStreamName(this.streamName),Ae.initSubscriberId(this.serverId),Ae.initFeedId(M.feedId),Ae.setClusterId(this.clusterId),M.sdp}catch(M){throw he.error("Error sending publish command, error: ",M),M}}async cmd(e,t){return he.info("Sending cmd: ".concat(e)),this.transactionManager.cmd(e,t)}}const Fo=(n,e,t)=>{let r=typeof n=="object"?n:{};return Object.keys(r).length===0&&(r={vad:n,pinnedSourceId:e,excludedSourceIds:t}),r},Oo=(n,e,t)=>{let r=typeof n=="object"?n:{};if(Object.keys(r).length===0){const i=Me.H264;r={codec:n!=null?n:i,record:e,sourceId:t}}return r};class Kt extends Error{constructor(e,t){super(e),this.name="FetchError",this.status=t}}const lt=qe.get("Director"),No={WEBRTC:"WebRtc"};let Xi="",Yi="https://director.millicast.com";const $e={setEndpoint:n=>{Yi=n.replace(/\/$/,"")},getEndpoint:()=>Yi,setLiveDomain:n=>{Xi=n.replace(/\/$/,"")},getLiveDomain:()=>Xi,getPublisher:async(n,e=null,t=No.WEBRTC)=>{const r=_o(n,e,t);lt.info("Getting publisher connection path for stream name: ",r.streamName);const i={streamName:r.streamName,streamType:r.streamType},o={"Content-Type":"application/json",Authorization:"Bearer ".concat(r.token)},c="".concat($e.getEndpoint(),"/api/director/publish");try{const a=await fetch(c,{method:"POST",headers:o,body:JSON.stringify(i)});let f=await a.json();if(f.status==="fail")throw new Kt(f.data.message,a.status);return f=Ji(f),lt.debug("Getting publisher response: ",f),Ae.initAccountId(f.data.streamAccountId),f.data}catch(a){throw lt.error("Error while getting publisher connection path. ",a),a}},getSubscriber:async(n,e=null,t=null)=>{const r=Vo(n,e,t);Ae.initAccountId(r.streamAccountId),lt.info("Getting subscriber connection data for stream name: ".concat(r.streamName," and account id: ").concat(r.streamAccountId));const i={streamAccountId:r.streamAccountId,streamName:r.streamName};let o={"Content-Type":"application/json"};r.subscriberToken&&(o=je(se({},o),{Authorization:"Bearer ".concat(r.subscriberToken)}));const c="".concat($e.getEndpoint(),"/api/director/subscribe");try{const a=await fetch(c,{method:"POST",headers:o,body:JSON.stringify(i)});let f=await a.json();if(f.status==="fail")throw new Kt(f.data.message,a.status);return f=Ji(f),lt.debug("Getting subscriber response: ",f),r.subscriberToken&&(f.data.subscriberToken=r.subscriberToken),f.data}catch(a){throw lt.error("Error while getting subscriber connection path. ",a),a}}},_o=(n,e,t)=>{let r=typeof n=="object"?n:{};return Object.keys(r).length===0&&(r={token:n,streamName:e,streamType:t}),r},Vo=(n,e,t)=>{let r=typeof n=="object"?n:{};return Object.keys(r).length===0&&(r={streamName:n,streamAccountId:e,subscriberToken:t}),r},Ji=n=>{if($e.getLiveDomain()){const e=/\/\/(.*?)\//,t=n.data.urls.map(r=>{const i=e.exec(r);return r.replace(i[1],$e.getLiveDomain())});n.data.urls=t}if(n.data.drmObject){const e=n.data.drmObject.playReadyUrl;e&&(n.data.drmObject.playReadyUrl="".concat($e.getEndpoint()).concat(e));const t=n.data.drmObject.widevineUrl;t&&(n.data.drmObject.widevineUrl="".concat($e.getEndpoint()).concat(t));const r=n.data.drmObject.fairPlayUrl;r&&(n.data.drmObject.fairPlayUrl="".concat($e.getEndpoint()).concat(r));const i=n.data.drmObject.fairPlayCertUrl;i&&(n.data.drmObject.fairPlayCertUrl="".concat($e.getEndpoint()).concat(i))}return n};function Xr(n){this.message=n}Xr.prototype=new Error,Xr.prototype.name="InvalidCharacterError";var Zi=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Xr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,c="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?c+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return c};function jo(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Zi(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return Zi(e)}}function Xt(n){this.message=n}function Qi(n,e){if(typeof n!="string")throw new Xt("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(jo(n.split(".")[t]))}catch(r){throw new Xt("Invalid token specified: "+r.message)}}Xt.prototype=new Error,Xt.prototype.name="InvalidTokenError";var Yt={exports:{}},es;function qo(){return es||(es=1,function(n,e){(function(t){if(e!=null&&typeof e.nodeType!="number")n.exports=t();else{var r=t(),i=typeof self<"u"?self:$.global;typeof i.btoa!="function"&&(i.btoa=r.btoa),typeof i.atob!="function"&&(i.atob=r.atob)}})(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(c){this.message=c}r.prototype=new Error,r.prototype.name="InvalidCharacterError";function i(c){for(var a=String(c),f,d,l,w,g=0,p="";g<a.length;){if(f=a.charCodeAt(g++),d=a.charCodeAt(g++),l=a.charCodeAt(g++),f>255||d>255||l>255)throw new r("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");w=f<<16|d<<8|l,p+=t.charAt(w>>18&63)+t.charAt(w>>12&63)+t.charAt(w>>6&63)+t.charAt(w&63)}switch(a.length%3){case 0:return p;case 1:return p.slice(0,-2)+"==";case 2:return p.slice(0,-1)+"="}}function o(c){var a=String(c).replace(/[=]+$/,"");if(a.length%4===1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var f=0,d,l,w=0,g="";l=a.charAt(w++);~l&&(d=f%4?d*64+l:l,f++%4)?g+=String.fromCharCode(255&d>>(-2*f&6)):0)l=t.indexOf(l);return g}return{btoa:i,atob:o}})}(Yt,Yt.exports)),Yt.exports}var Go=qo(),ze;function ts(n){var e,t,r;return{lang:(e=n==null?void 0:n.lang)!=null?e:ze==null?void 0:ze.lang,message:n==null?void 0:n.message,abortEarly:(t=n==null?void 0:n.abortEarly)!=null?t:ze==null?void 0:ze.abortEarly,abortPipeEarly:(r=n==null?void 0:n.abortPipeEarly)!=null?r:ze==null?void 0:ze.abortPipeEarly}}var Yr;function Ho(n){return Yr==null?void 0:Yr.get(n)}var Jr;function Wo(n){return Jr==null?void 0:Jr.get(n)}var Zr;function $o(n,e){var t;return(t=Zr==null?void 0:Zr.get(n))==null?void 0:t.get(e)}function rs(n){var t,r,i;const e=typeof n;return e==="string"?'"'.concat(n,'"'):e==="number"||e==="bigint"||e==="boolean"?"".concat(n):e==="object"||e==="function"?(i=n&&((r=(t=Object.getPrototypeOf(n))==null?void 0:t.constructor)==null?void 0:r.name))!=null?i:"null":e}function Ke(n,e,t,r,i){var w,g,p,m,I,R,M,U;const o=i&&"input"in i?i.input:t.value,c=(g=(w=i==null?void 0:i.expected)!=null?w:n.expects)!=null?g:null,a=(p=i==null?void 0:i.received)!=null?p:rs(o),f={kind:n.kind,type:n.type,input:o,expected:c,received:a,message:"Invalid ".concat(e,": ").concat(c?"Expected ".concat(c," but r"):"R","eceived ").concat(a),requirement:n.requirement,path:i==null?void 0:i.path,issues:i==null?void 0:i.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},d=n.kind==="schema",l=(U=(M=(R=(I=(m=i==null?void 0:i.message)!=null?m:n.message)!=null?I:$o(n.reference,f.lang))!=null?R:d?Wo(f.lang):null)!=null?M:r.message)!=null?U:Ho(f.lang);l!==void 0&&(f.message=typeof l=="function"?l(f):l),d&&(t.typed=!1),t.issues?t.issues.push(f):t.issues=[f]}function Xe(n){return{version:1,vendor:"valibot",validate(e){return n["~run"]({value:e},ts())}}}function zo(n,e){return Object.hasOwn(n,e)&&e!=="__proto__"&&e!=="prototype"&&e!=="constructor"}function ns(n,e){var r;const t=[...new Set(n)];return t.length>1?"(".concat(t.join(" ".concat(e," ")),")"):(r=t[0])!=null?r:"never"}var Ko=class extends Error{constructor(n){super(n[0].message),this.name="ValiError",this.issues=n}};function Xo(n,e,t){return typeof n.fallback=="function"?n.fallback(e,t):n.fallback}function is(n,e,t){return typeof n.default=="function"?n.default(e,t):n.default}function Qr(n,e){return{kind:"schema",type:"array",reference:Qr,expects:"Array",async:!1,item:n,message:e,get"~standard"(){return Xe(this)},"~run"(t,r){var o;const i=t.value;if(Array.isArray(i)){t.typed=!0,t.value=[];for(let c=0;c<i.length;c++){const a=i[c],f=this.item["~run"]({value:a},r);if(f.issues){const d={type:"array",origin:"value",input:i,key:c,value:a};for(const l of f.issues)l.path?l.path.unshift(d):l.path=[d],(o=t.issues)==null||o.push(l);if(t.issues||(t.issues=f.issues),r.abortEarly){t.typed=!1;break}}f.typed||(t.typed=!1),t.value.push(f.value)}}else Ke(this,"type",t,r);return t}}}function Ne(n){return{kind:"schema",type:"boolean",reference:Ne,expects:"boolean",async:!1,message:n,get"~standard"(){return Xe(this)},"~run"(e,t){return typeof e.value=="boolean"?e.typed=!0:Ke(this,"type",e,t),e}}}function en(n,e){return{kind:"schema",type:"loose_object",reference:en,expects:"Object",async:!1,entries:n,message:e,get"~standard"(){return Xe(this)},"~run"(t,r){var o;const i=t.value;if(i&&typeof i=="object"){t.typed=!0,t.value={};for(const c in this.entries){const a=this.entries[c];if(c in i||(a.type==="exact_optional"||a.type==="optional"||a.type==="nullish")&&a.default!==void 0){const f=c in i?i[c]:is(a),d=a["~run"]({value:f},r);if(d.issues){const l={type:"object",origin:"value",input:i,key:c,value:f};for(const w of d.issues)w.path?w.path.unshift(l):w.path=[l],(o=t.issues)==null||o.push(w);if(t.issues||(t.issues=d.issues),r.abortEarly){t.typed=!1;break}}d.typed||(t.typed=!1),t.value[c]=d.value}else if(a.fallback!==void 0)t.value[c]=Xo(a);else if(a.type!=="exact_optional"&&a.type!=="optional"&&a.type!=="nullish"&&(Ke(this,"key",t,r,{input:void 0,expected:'"'.concat(c,'"'),path:[{type:"object",origin:"key",input:i,key:c,value:i[c]}]}),r.abortEarly))break}if(!t.issues||!r.abortEarly)for(const c in i)zo(i,c)&&!(c in this.entries)&&(t.value[c]=i[c])}else Ke(this,"type",t,r);return t}}}function be(n,e){return{kind:"schema",type:"nullish",reference:be,expects:"(".concat(n.expects," | null | undefined)"),async:!1,wrapped:n,default:e,get"~standard"(){return Xe(this)},"~run"(t,r){return(t.value===null||t.value===void 0)&&(this.default!==void 0&&(t.value=is(this,t,r)),t.value===null||t.value===void 0)?(t.typed=!0,t):this.wrapped["~run"](t,r)}}}function Jt(n){return{kind:"schema",type:"number",reference:Jt,expects:"number",async:!1,message:n,get"~standard"(){return Xe(this)},"~run"(e,t){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:Ke(this,"type",e,t),e}}}function tn(n,e){return{kind:"schema",type:"picklist",reference:tn,expects:ns(n.map(rs),"|"),async:!1,options:n,message:e,get"~standard"(){return Xe(this)},"~run"(t,r){return this.options.includes(t.value)?t.typed=!0:Ke(this,"type",t,r),t}}}function rn(n){return{kind:"schema",type:"string",reference:rn,expects:"string",async:!1,message:n,get"~standard"(){return Xe(this)},"~run"(e,t){return typeof e.value=="string"?e.typed=!0:Ke(this,"type",e,t),e}}}function ss(n){let e;if(n)for(const t of n)e?e.push(...t.issues):e=t.issues;return e}function os(n,e){return{kind:"schema",type:"union",reference:os,expects:ns(n.map(t=>t.expects),"|"),async:!1,options:n,message:e,get"~standard"(){return Xe(this)},"~run"(t,r){let i,o,c;for(const a of this.options){const f=a["~run"]({value:t.value},r);if(f.typed)if(f.issues)o?o.push(f):o=[f];else{i=f;break}else c?c.push(f):c=[f]}if(i)return i;if(o){if(o.length===1)return o[0];Ke(this,"type",t,r,{issues:ss(o)}),t.typed=!0}else{if((c==null?void 0:c.length)===1)return c[0];Ke(this,"type",t,r,{issues:ss(c)})}return t}}}function nn(){return{kind:"schema",type:"unknown",reference:nn,expects:"unknown",async:!1,get"~standard"(){return Xe(this)},"~run"(n){return n.typed=!0,n}}}function Yo(n,e,t){const r=n["~run"]({value:e},ts(t));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}let ft;const Jo=32e3,as=1e3;class cs extends Ot{constructor(e,t,r,i){if(super(),ft=r,!t)throw ft.error("Token generator is required to construct this module."),new Error("Token generator is required to construct this module.");this.webRTCPeer=new Je,this.signaling=null,this.autoReconnect=i,this.reconnectionInterval=as,this.alreadyDisconnected=!1,this.firstReconnection=!0,this.stopReconnection=!1,this.isReconnecting=!1,this.tokenGenerator=t,this.options=null}getRTCPeerConnection(){return this.webRTCPeer?this.webRTCPeer.getRTCPeer():null}stop(){var e;ft.info("Stopping"),this.webRTCPeer.closeRTCPeer(),(e=this.signaling)==null||e.close(),this.signaling=null,this.stopReconnection=!0,this.webRTCPeer=new Je}isActive(){const e=this.webRTCPeer.getRTCPeerStatus();return ft.info("Broadcast status: ",e||"not_established"),e==="connected"}setReconnect(){this.signaling.on("migrate",()=>this.replaceConnection()),this.autoReconnect&&(this.signaling.on(He.connectionError,()=>{(this.firstReconnection||!this.alreadyDisconnected)&&(this.firstReconnection=!1,this.reconnect({error:new Error("Signaling error: wsConnectionError")}))}),this.webRTCPeer.on(Le.connectionStateChange,e=>{Ae.setConnectionState(e),e==="connected"&&Ae.setConnectionTime(new Date),(e==="failed"||e==="disconnected"&&this.alreadyDisconnected)&&this.firstReconnection?(this.firstReconnection=!1,this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")})):e==="disconnected"?(this.alreadyDisconnected=!0,setTimeout(()=>this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")}),1500)):this.alreadyDisconnected=!1}))}async reconnect(e){try{ft.info("Attempting to reconnect..."),!this.isActive()&&!this.stopReconnection&&!this.isReconnecting&&(this.stop(),this.emit("reconnect",{timeout:us(this.reconnectionInterval),error:e!=null&&e.error?e==null?void 0:e.error:new Error("Attempting to reconnect")}),this.isReconnecting=!0,await this.connect(this.options),this.alreadyDisconnected=!1,this.reconnectionInterval=as,this.firstReconnection=!0,this.isReconnecting=!1)}catch(t){this.isReconnecting=!1,this.reconnectionInterval=us(this.reconnectionInterval),ft.error("Reconnection failed, retrying in ".concat(this.reconnectionInterval,"ms. "),t),setTimeout(()=>this.reconnect({error:t}),this.reconnectionInterval)}}}const us=n=>n<Jo?n*2:n,sn=window.RTCRtpSender&&!!RTCRtpSender.prototype.createEncodedStreams&&window.RTCRtpReceiver&&!!RTCRtpReceiver.prototype.createEncodedStreams,ds="RTCRtpScriptTransform"in window,ls='(function(){"use strict";function z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var U={exports:{}};/*!\n * js-logger - http://github.com/jonnyreeves/js-logger\n * Jonny Reeves, http://jonnyreeves.co.uk/\n * js-logger may be freely distributed under the MIT license.\n */var q=U.exports,D;function V(){return D||(D=1,function(t){(function(n){var e={};e.VERSION="1.6.1";var i,r={},o=function(s,u){return function(){return u.apply(s,arguments)}},a=function(){var s=arguments,u=s[0],h,c;for(c=1;c<s.length;c++)for(h in s[c])!(h in u)&&s[c].hasOwnProperty(h)&&(u[h]=s[c][h]);return u},d=function(s,u){return{value:s,name:u}};e.TRACE=d(1,"TRACE"),e.DEBUG=d(2,"DEBUG"),e.INFO=d(3,"INFO"),e.TIME=d(4,"TIME"),e.WARN=d(5,"WARN"),e.ERROR=d(8,"ERROR"),e.OFF=d(99,"OFF");var l=function(s){this.context=s,this.setLevel(s.filterLevel),this.log=this.info};l.prototype={setLevel:function(s){s&&"value"in s&&(this.context.filterLevel=s)},getLevel:function(){return this.context.filterLevel},enabledFor:function(s){var u=this.context.filterLevel;return s.value>=u.value},trace:function(){this.invoke(e.TRACE,arguments)},debug:function(){this.invoke(e.DEBUG,arguments)},info:function(){this.invoke(e.INFO,arguments)},warn:function(){this.invoke(e.WARN,arguments)},error:function(){this.invoke(e.ERROR,arguments)},time:function(s){typeof s=="string"&&s.length>0&&this.invoke(e.TIME,[s,"start"])},timeEnd:function(s){typeof s=="string"&&s.length>0&&this.invoke(e.TIME,[s,"end"])},invoke:function(s,u){i&&this.enabledFor(s)&&i(u,a({level:s},this.context))}};var f=new l({filterLevel:e.OFF});(function(){var s=e;s.enabledFor=o(f,f.enabledFor),s.trace=o(f,f.trace),s.debug=o(f,f.debug),s.time=o(f,f.time),s.timeEnd=o(f,f.timeEnd),s.info=o(f,f.info),s.warn=o(f,f.warn),s.error=o(f,f.error),s.log=s.info})(),e.setHandler=function(s){i=s},e.setLevel=function(s){f.setLevel(s);for(var u in r)r.hasOwnProperty(u)&&r[u].setLevel(s)},e.getLevel=function(){return f.getLevel()},e.get=function(s){return r[s]||(r[s]=new l(a({name:s},f.context)))},e.createDefaultHandler=function(s){s=s||{},s.formatter=s.formatter||function(p,_){_.name&&p.unshift("["+_.name+"]")};var u={},h=function(c,p){Function.prototype.apply.call(c,console,p)};return typeof console>"u"?function(){}:function(c,p){c=Array.prototype.slice.call(c);var _=console.log,g;p.level===e.TIME?(g=(p.name?"["+p.name+"] ":"")+c[0],c[1]==="start"?console.time?console.time(g):u[g]=new Date().getTime():console.timeEnd?console.timeEnd(g):h(_,[g+": "+(new Date().getTime()-u[g])+"ms"])):(p.level===e.WARN&&console.warn?_=console.warn:p.level===e.ERROR&&console.error?_=console.error:p.level===e.INFO&&console.info?_=console.info:p.level===e.DEBUG&&console.debug?_=console.debug:p.level===e.TRACE&&console.trace&&(_=console.trace),s.formatter(c,p),h(_,c))}},e.useDefaults=function(s){e.setLevel(s&&s.defaultLevel||e.DEBUG),e.setHandler(e.createDefaultHandler(s))},e.setDefaults=e.useDefaults,t.exports?t.exports=e:(e._prevLogger=n.Logger,e.noConflict=function(){return n.Logger=e._prevLogger,e},n.Logger=e)})(q)}(U)),U.exports}var j=V(),R=z(j);class w{constructor(n){this.data=n,this.bitOffset=0}readBits(n){if(this.bitOffset+n>this.data.length*8)throw new Error("Attempted to read past the end of the bitstream");let e=0;for(let i=0;i<n;i++){const r=Math.floor(this.bitOffset/8),o=7-this.bitOffset%8,a=this.data[r]>>o&1;e|=a<<n-1-i,this.bitOffset++}return e}skip(n){this.bitOffset+=n}readExpGolombUnsigned(){let n=-1;for(let e=0;e===0;n++)e=this.readBits(1);return(1<<n)-1+this.readBits(n)}readExpGolombSigned(){const n=this.readExpGolombUnsigned();return n%2===0?-(n/2):(n+1)/2}}const m={SLICE_NON_IDR:1,SLICE_PARTITION_A:2,SLICE_IDR:5,SEI_H264:6,SEI_H265_PREFIX:39,SEI_H265_SUFFIX:40,SPS_H264:7,SPS_H265:33,PPS_H264:8,PPS_H265:34},G={PIC_TIMING:1,USER_DATA_UNREGISTERED:5},E={LEGACY:1,NEW:2,TIMECODE:3,OTHER:4},Y="6e9cfd2a-5907-49ff-b363-8978a6e8340e",X="9a21f3be-31f0-4b78-b0be-c7f7dbb97250",P="d40e38ea-d419-4c62-94ed-20ac37b4e4fa";class ${constructor(n="H264"){this.sps=new Map,this.pps=new Map,this.activeSPS=null,this.codec=n}collectPPS(n){this.codec==="H264"?this.collectH264PPS(n):this.collectH265PPS(n)}collectSPS(n){this.codec==="H264"?this.collectH264SPS(n):this.collectH265SPS(n)}collectH264SPS(n){const e=new w(n),i=e.readBits(8),r=[100,110,122,244,44,83,86,118,128,138,139,134,135];e.skip(8),e.skip(8);const o=e.readExpGolombUnsigned();if(o>31||o<0)throw new Error("Invalid seq_parameter_set_id");if(r.includes(i)){const l=e.readExpGolombUnsigned();if(l===3&&e.skip(1),e.readExpGolombUnsigned(),e.readExpGolombUnsigned(),e.skip(1),e.readBits(1)){const s=l!==3?8:12;for(let u=0;u<s;u++)if(e.readBits(1)){const h=u<6?16:64;let c=8,p=8;for(let _=0;_<h;_++){if(p!==0){const g=e.readExpGolombSigned();p=(c+g+256)%256}c=p===0?c:p}}}}e.readExpGolombUnsigned();const a=e.readExpGolombUnsigned();if(a===0)e.readExpGolombUnsigned();else if(a===1){e.skip(1),e.readExpGolombSigned(),e.readExpGolombSigned();const l=e.readExpGolombUnsigned();for(let f=0;f<l;f++)e.readExpGolombSigned()}e.readExpGolombUnsigned(),e.skip(1),e.readExpGolombUnsigned(),e.readExpGolombUnsigned(),e.readBits(1)===0&&e.skip(1),e.skip(1),e.readBits(1)&&(e.readExpGolombUnsigned(),e.readExpGolombUnsigned(),e.readExpGolombUnsigned(),e.readExpGolombUnsigned());let d;if(e.readBits(1)){let f=function(c){const p=c.readExpGolombUnsigned();c.skip(4),c.skip(4);for(let x=0;x<=p;x++)c.readExpGolombUnsigned(),c.readExpGolombUnsigned(),c.skip(1);c.skip(5);const _=c.readBits(5),g=c.readBits(5),B=c.readBits(5);return{cpb_removal_delay_length_minus1:_,dpb_output_delay_length_minus1:g,time_offset_length:B}};e.readBits(1)&&e.readBits(8)===255&&(e.skip(16),e.skip(16)),e.readBits(1)&&e.skip(1),e.readBits(1)&&(e.skip(3),e.skip(1),e.readBits(1)&&e.skip(24)),e.readBits(1)&&(e.readExpGolombUnsigned(),e.readExpGolombUnsigned());const l=e.readBits(1)?{num_units_in_tick:e.readBits(32),time_scale:e.readBits(32),fixed_frame_rate_flag:e.readBits(1)}:void 0,s=e.readBits(1)?f(e):void 0,u=e.readBits(1)?f(e):void 0;(s||u)&&e.skip(1);const h=e.readBits(1);d={timing_info:l,nal_hrd_parameters:s,vcl_hrd_parameters:u,pic_struct_present_flag:h}}this.sps.set(o,{vui_parameters:d})}collectH265SPS(n){}collectH264PPS(n){const e=new w(n),i=e.readExpGolombUnsigned();if(i>255||i<0)throw new Error("Invalid pic_parameter_set_id");const r=e.readExpGolombUnsigned();this.pps.set(i,{seq_parameter_set_id:r})}collectH265PPS(n){}findActiveSPS(n){const e=new w(n);e.readExpGolombUnsigned(),e.readExpGolombUnsigned();const i=e.readExpGolombUnsigned(),r=this.pps.get(i);if(r){const o=this.sps.get(r.seq_parameter_set_id);if(o){this.activeSPS=o;return}}throw new Error("Cannot find the active SPS")}}const S=new $;function O(t,n){for(;n<t.byteLength-4;){if(t[n]===0&&t[n+1]===0&&(t[n+2]===1||t[n+2]===0&&t[n+3]===1))return n;n+=1}return-1}function T(t){const n=new Uint8Array(t.byteLength);let e=0,i=0;for(let r=2;r<t.byteLength;r++)t[r]===3&&t[r-1]===0&&t[r-2]===0&&(n.set(t.subarray(i,r),e),e+=r-i,i=r+1);return i<t.byteLength&&n.set(t.subarray(i),e),n}function J(t,n){let e=0;const i=n==="H264"?1:2,r=[];for(;e<t.byteLength-4;){const o=O(t,e);if(o>=e){const a=t[o+2]===1?3:4,d=O(t,o+a+i);if(d>o)r.push(t.subarray(o,d)),e=d;else{r.push(t.subarray(o));break}}else break}return r}function K(t,n){let e=!0;return J(t,n).filter(i=>{const r=i[2]===1?3:4,o=n==="H264"?1:2,a=i[r],d=n==="H264"?a&31:a>>1&63;if(e)switch(d){case m.PPS_H264:case m.PPS_H265:S.collectPPS(T(i.subarray(r+o)));break;case m.SPS_H264:case m.SPS_H265:S.collectSPS(T(i.subarray(r+o)));break;case m.SLICE_IDR:case m.SLICE_NON_IDR:case m.SLICE_PARTITION_A:try{S.findActiveSPS(T(i.subarray(r+o))),e=!1}catch(l){console.info("Failed to find active SPS. Will not be able to extract PIC timing metadata")}break}return[m.SEI_H264,m.SEI_H265_PREFIX,m.SEI_H265_SUFFIX].includes(d)})}function Z(t){let n=0,e=0;for(;t[e]===255;)n+=255,e++;n+=t[e],e++;let i=0;for(;t[e]===255;)i+=255,e++;return i+=t[e],e++,{type:n,content:t.subarray(e,e+i)}}function Q(t){const n=new Uint8Array(L(X)),e=new Uint8Array(L(Y)),i=new Uint8Array(L(P));return n.every((r,o)=>r===t[o])?E.TIMECODE:e.every((r,o)=>r===t[o])?E.LEGACY:i.every((r,o)=>r===t[o])?E.NEW:E.OTHER}function ee(t,n){let e=0;t.uuid=n.subarray(e,e+16),e+=16;const i=Q(t.uuid),r=n.subarray(e);switch(i){case E.LEGACY:case E.OTHER:t.unregistered=r;break;case E.TIMECODE:t.timecode=C(r);break;case E.NEW:{let o=0;const a=H(Date.now()).length,d=r.subarray(o,a);o+=a;const l=r.subarray(o);t.timecode=C(d),t.unregistered=l;break}}}function C(t){const n=t.reduce((o,a)=>(o<<BigInt(8))+BigInt(a),BigInt(0)),e=Number(n),i=new Date(e);return new TextEncoder().encode(i.toISOString())}function te(t,n){var f,s,u,h,c;if(!S.activeSPS){console.warn("Cannot find the active SPS");return}const e=(f=S.activeSPS.vui_parameters.nal_hrd_parameters)!=null?f:S.activeSPS.vui_parameters.vcl_hrd_parameters,i={cpb_dpb_delays_present_flag:e?1:0,cpb_removal_delay_length_minus1:(s=e==null?void 0:e.cpb_removal_delay_length_minus1)!=null?s:23,dpb_output_delay_length_minus1:(u=e==null?void 0:e.dpb_output_delay_length_minus1)!=null?u:23,time_offset_length:e?(h=e.time_offset_length)!=null?h:24:void 0,pic_struct_present_flag:(c=S.activeSPS.vui_parameters.pic_struct_present_flag)!=null?c:0};if(!i.pic_struct_present_flag){console.warn("pic_struct_present_flag is not present");return}const r=new w(n);i.cpb_dpb_delays_present_flag&&(r.skip(i.cpb_removal_delay_length_minus1+1),r.skip(i.dpb_output_delay_length_minus1+1));const o=[1,1,1,2,2,3,3,2,3],a=r.readBits(4);if(a>=o.length)throw new Error("Invalid pic_struct");const d=o[a],l=[];for(let p=0;p<d;p++)if(r.readBits(1)){const g={};r.skip(2),r.skip(1),r.skip(5);const B=r.readBits(1);if(r.skip(2),g.n_frames=r.readBits(8),B?(g.seconds_value=r.readBits(6),g.minutes_value=r.readBits(6),g.hours_value=r.readBits(5)):r.readBits(1)&&(g.seconds_value=r.readBits(6),r.readBits(1)&&(g.minutes_value=r.readBits(6),r.readBits(1)&&(g.hours_value=r.readBits(5)))),i.time_offset_length)try{g.time_offset=r.readBits(i.time_offset_length)}catch(x){console.error("Failed to read time_offset",x),g.time_offset=0}else g.time_offset=0;l.push(g)}t.seiPicTimingTimeCodeArray=l}function ne(t,n){if(n!=="H264"&&n!=="H265")throw new Error("Unsupported codec ".concat(n));const e={};return S.codec=n,K(new Uint8Array(t.data),n).forEach(i=>{const r=i[2]===1?3:4,o=n==="H264"?1:2,a=T(i.subarray(r+o)),d=Z(a);switch(d.type){case G.PIC_TIMING:te(e,d.content);break;case G.USER_DATA_UNREGISTERED:ee(e,d.content);break}}),e}function re(t){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(t)}function L(t){return t.replace(/-/g,"").match(/.{1,2}/g).map(n=>parseInt(n,16))}function ie(t,n,e){const i=new Uint8Array(L(t)),r=H(e),o=new TextEncoder().encode(JSON.stringify(n)),a=new Uint8Array(i.length+r.length+o.length);return a.set(i),a.set(r,i.length),a.set(o,r.length+i.length),a}function se(t){const n=[],e=Math.floor(t.byteLength/255),i=t.byteLength%255;for(let r=0;r<e;r++)n.push(255);return n.push(i),new Uint8Array([5,...n])}function oe(t){const n=[];for(let e=0;e<t.byteLength;e++)e+2<t.byteLength&&[0,1,2,3].includes(t[e+2])&&t[e]===0&&t[e+1]===0?(n.push(t[e]),n.push(t[e+1]),e+=2,n.push(3)):n.push(t[e]);return n.push(128),new Uint8Array(n)}function H(t){const n=[];if(!isNaN(t)){const e=BigInt(t);for(let i=0;i<Math.ceil(Math.floor(Math.log2(new Number(t))+1)/8);i++)n.unshift(new Number(e>>BigInt(8*i)&BigInt(255)))}return new Uint8Array(n)}function ae({uuid:t,payload:n,timecode:e}){const i=[0,0,0,1],r=[102],o=ie(t,n,e),a=se(o),d=oe(o),l=new Uint8Array(i.length+r.length+a.length+d.length);return l.set(i),l.set(r,i.length),l.set(a,i.length+r.length),l.set(d,i.length+r.length+a.length),l}function ce({uuid:t,payload:n,timecode:e},i){if(t===""||n==="")throw new Error("uuid and payload cannot be empty");re(t)||(console.warn("Invalid UUID. Using default UUID."),t=P,e=Date.now());const r=ae({uuid:t,payload:n,timecode:e}),o=new DataView(i.data),a=new ArrayBuffer(i.data.byteLength+r.byteLength),d=new DataView(a);for(let l=0;l<i.data.byteLength;l++)d.setUint8(l,o.getUint8(l));for(let l=0;l<r.byteLength;l++)d.setUint8(i.data.byteLength+l,r[l]);i.data=a}R.get("TransformWorker").setLevel(R.DEBUG);const le=2e3,b=[];let y="",k={};const v={};let I=[];function M(t){return new TransformStream({start(){},flush(){},async transform(n,e){var i,r;if(N(n)){const o=((i=k[n.getMetadata().payloadType])==null?void 0:i.toUpperCase())||(y==null?void 0:y.toUpperCase());if(o==="H264"){const a=ne(n,o);(a.timecode||a.unregistered||((r=a.seiPicTimingTimeCodeArray)==null?void 0:r.length)>0)&&self.postMessage({event:"metadata",mid:t,metadata:a})}self.postMessage({event:"complete",frame:{type:n.type,timestamp:n.timestamp,data:n.data}})}e.enqueue(n)}})}function N(t){if(typeof RTCEncodedVideoFrame<"u")try{if(t instanceof RTCEncodedVideoFrame)return!0}catch(n){}return!!(t.constructor&&t.constructor.name==="RTCEncodedVideoFrame"||typeof t.width=="number"&&typeof t.height=="number"||t.type==="video")}function F(){Object.keys(v).sort().join()===I.sort().join()&&(b.shift(),I=[])}function de(t){const n=new Date().getTime();v[t]=n,Object.keys(v).filter(i=>n-v[i]>le).forEach(i=>{delete v[i],delete I[i]}),F()}function W(){return new TransformStream({start(){},flush(){},async transform(t,n){if(N(t)){const i=t.getMetadata().synchronizationSource;if(de(i),!I.includes(i)&&b.length)try{if(!/(h26[4])/.test(y))throw new Error("Sending metadata is not supported with any other codec other than H.264");b[0].uuid===P&&(b[0].timecode=Date.now()),ce(b[0],t),I.push(i)}catch(r){console.error(r)}finally{F()}}n.enqueue(t)}})}function A({readable:t,writable:n},e){t.pipeThrough(e).pipeTo(n)}addEventListener("rtctransform",t=>{let n;if(t.transformer.options.name==="senderTransform")y=t.transformer.options.codec,n=W();else if(t.transformer.options.name==="receiverTransform")k=t.transformer.options.payloadTypeCodec||{},y=t.transformer.options.codec||"",n=M(t.transformer.options.mid);else return;A(t.transformer,n)}),addEventListener("message",t=>{const{action:n}=t.data;switch(n){case"insertable-streams-sender":y=t.data.codec,A(t.data,W());break;case"insertable-streams-receiver":k=t.data.payloadTypeCodec||{},y=t.data.codec||"",A(t.data,M(t.data.mid));break;case"metadata-sei-user-data-unregistered":b.push({uuid:t.data.uuid,payload:t.data.payload});break}})})();\n',fs=typeof self<"u"&&self.Blob&&new Blob([ls],{type:"text/javascript;charset=utf-8"});function on(n){let e;try{if(e=fs&&(self.URL||self.webkitURL).createObjectURL(fs),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch(t){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(ls),{name:n==null?void 0:n.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}const Ce=qe.get("Publish"),an={mediaStream:null,bandwidth:0,metadata:!1,disableVideo:!1,disableAudio:!1,codec:Me.H264,simulcast:!1,scalabilityMode:null,peerConfig:{autoInitStats:!0,statsIntervalMs:1e3}};class Zo extends cs{constructor(e,t,r=!0){e&&Ce.warn("The streamName property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, set via token generator"),super(null,t,Ce,r)}async connect(e=an){Qo(e),this.options=je(se(se({},an),e),{peerConfig:se(se({},an.peerConfig),e.peerConfig),setSDPToPeer:!1}),this.options.metadata=this.options.metadata&&this.options.codec===Me.H264&&!this.options.disableVideo,await this.initConnection({migrate:!1})}async reconnect(e){var t,r;this.options.mediaStream=(r=(t=this.webRTCPeer)==null?void 0:t.getTracks())!=null?r:this.options.mediaStream,super.reconnect(e)}async replaceConnection(){var e,t;Ce.info("Migrating current connection"),this.options.mediaStream=(t=(e=this.webRTCPeer)==null?void 0:e.getTracks())!=null?t:this.options.mediaStream,await this.initConnection({migrate:!0})}async record(){var e;this.recordingAvailable?(this.options.record=!0,await((e=this.signaling)==null?void 0:e.cmd("record")),Ce.info("Broadcaster start recording")):Ce.error("Record not available")}async unrecord(){var e;this.recordingAvailable?(this.options.record=!1,await((e=this.signaling)==null?void 0:e.cmd("unrecord")),Ce.info("Broadcaster stop recording")):Ce.error("Unrecord not available")}stop(){var e;super.stop(),(e=this.worker)==null||e.terminate(),this.worker=null}async initConnection(e){var I,R;Ce.debug("Broadcast option values: ",this.options),this.stopReconnection=!1;let t;if(!this.options.mediaStream)throw Ce.error("Error while broadcasting. MediaStream required"),new Error("MediaStream required");if(!e.migrate&&this.isActive())throw Ce.warn("Broadcast currently working"),new Error("Broadcast currently working");let r;try{r=await this.tokenGenerator(),this.options.peerConfig.iceServers=r==null?void 0:r.iceServers,this.options.peerConfig.encodedInsertableStreams=this.options.metadata}catch(M){throw Ce.error("Error generating token."),M instanceof Kt&&(M.status===401||!this.autoReconnect?this.stopReconnection=!0:this.reconnect()),M}if(!r)throw Ce.error("Error while broadcasting. Publisher data required"),new Error("Publisher data required");const i=Qi(r.jwt);if(this.streamName=i.millicast.streamName,this.recordingAvailable=i[Go.atob("bWlsbGljYXN0")].record,this.options.record&&!this.recordingAvailable)throw Ce.error("Error while broadcasting. Record option detected but recording is not available"),new Error("Record option detected but recording is not available");const o=new Kr({streamName:this.streamName,url:"".concat(r.urls[0],"?token=").concat(r.jwt)}),c=e.migrate?new Je:this.webRTCPeer;await c.createRTCPeer(this.options.peerConfig,$t.Publisher),(I=this.stopReemitingWebRTCPeerInstanceEvents)==null||I.call(this),(R=this.stopReemitingSignalingInstanceEvents)==null||R.call(this),this.stopReemitingWebRTCPeerInstanceEvents=_t(c,this,[Le.connectionStateChange]),this.stopReemitingSignalingInstanceEvents=_t(o,this,[He.broadcastEvent]);const a=c.getRTCLocalSDP(this.options),f=o.connect();t=await Promise.all([a,f]);const d=t[0];this.options.metadata&&(this.worker||(this.worker=new on),this.getRTCPeerConnection().getSenders().forEach(U=>{if(ds)U.transform=new RTCRtpScriptTransform(this.worker,{name:"senderTransform",codec:this.options.codec});else if(sn){const{readable:F,writable:v}=U.createEncodedStreams();this.worker.postMessage({action:"insertable-streams-sender",codec:this.options.codec,readable:F,writable:v},[F,v])}}));let l=this.signaling;this.signaling=o;const w=this.signaling.publish(d,this.options),g=c.peer.setLocalDescription(c.sessionDescription);t=await Promise.all([w,g]);let p=t[0];!this.options.disableVideo&&this.options.bandwidth>0&&(p=c.updateBandwidthRestriction(p,this.options.bandwidth)),await c.setRTCRemoteSDP(p),Ce.info("Broadcasting to streamName: ",this.streamName);let m=this.webRTCPeer;this.webRTCPeer=c,this.setReconnect(),e.migrate&&this.webRTCPeer.on(Le.connectionStateChange,M=>{var U,F;["connected","disconnected","failed","closed"].includes(M)&&((U=l==null?void 0:l.close)==null||U.call(l),(F=m==null?void 0:m.closeRTCPeer)==null||F.call(m),l=m=null)})}sendMetadata(e,t=Co){var r;if((r=this.options)!=null&&r.metadata&&this.worker)this.worker.postMessage({action:"metadata-sei-user-data-unregistered",uuid:t,payload:e});else{let i="Could not send metadata due to:";this.options?this.options.metadata?this.worker||(i+="\n- Stream not being published."):(i+="\n- Metadata option is not enabled.",this.options.codec!==Me.H264&&(i+="\n- Incompatible codec. Only H264 available."),this.options.disableVideo&&(i+="\n- Video disabled.")):i+="\n- Stream not being published.",Ce.warn(i)}}}let cn;const Qo=n=>{cn=cn||en({sourceId:be(rn()),stereo:be(Ne()),dtx:be(Ne()),absCaptureTime:be(Ne()),dependencyDescriptor:be(Ne()),mediaStream:be(os([Qr(nn()),nn()])),bandwidth:be(Jt()),metadata:be(Ne()),disableVideo:be(Ne()),disableAudio:be(Ne()),codec:be(tn(Object.values(Me))),simulcast:be(Ne()),scalabilityMode:be(rn()),peerConfig:be(en({autoInitStats:be(Ne()),statsIntervalMs:be(Jt())})),record:be(Ne()),events:be(Qr(tn(["active","inactive","viewercount"]))),priority:be(Jt())});const{success:e,issues:t}=Yo(cn,n);e||Ce.warn(new Ko(t),n)};function hs(n){if(!n)return new Uint8Array;const e=n.length,t=new Uint8Array(e/2);for(let r=0;r<e;r+=2)t[r/2]=parseInt(n.substr(r,2),16);return t}function ps(n,e,t){if(Object.prototype.hasOwnProperty.call(n,t)&&Object.prototype.hasOwnProperty.call(e,t)){const r=n[t];n[t]=e[t],e[t]=r}else console.error('One or both objects do not have the property "'.concat(t,'"'))}function un(n,e,t,r){return new(t||(t=Promise))(function(i,o){function c(d){try{f(r.next(d))}catch(l){o(l)}}function a(d){try{f(r.throw(d))}catch(l){o(l)}}function f(d){var l;d.done?i(d.value):(l=d.value,l instanceof t?l:new t(function(w){w(l)})).then(c,a)}f((r=r.apply(n,e||[])).next())})}const We=ln;var dn;function ln(n,e){const t=mn();return(ln=function(r,i){return t[r-=440]})(n,e)}(function(){const n=ln,e=mn();for(;;)try{if(-parseInt(n(447))/1+parseInt(n(445))/2+parseInt(n(449))/3*(parseInt(n(454))/4)+parseInt(n(453))/5+-parseInt(n(456))/6+parseInt(n(450))/7+-parseInt(n(441))/8*(-parseInt(n(455))/9)===847340)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const fn=navigator&&navigator[We(448)]||"",ea=navigator&&navigator[We(443)]||"",ta=!!(window!=null&&window.RTCRtpScriptTransform),Zt=fn.includes("Firefox"),hn=!Zt&&ea.includes("Apple"),ms=!Zt&&!hn&&fn[We(440)](We(451)),ra=!Zt&&!hn&&!ms&&fn[We(440)](We(446)),pn=((dn=navigator==null?void 0:navigator[We(442)])===null||dn===void 0?void 0:dn[We(452)])||(navigator==null?void 0:navigator[We(452)])||"";function mn(){const n=["1583117AOxBcs","userAgent","153Sdjzsk","5371359GvUFPp","Edg","platform","7141470dfeDnP","10068LWEgOs","243621EPkoPw","8310150fEFCnA","includes","328VMcnkw","userAgentData","vendor","Win32","763310RGZQro","Chrome"];return(mn=function(){return n})()}const Ye={supportsRtpScriptTransform:ta,isFirefox:Zt,isSafari:hn,isEdge:ms,isChrome:ra,platform:pn,isWindows:pn==="Windows"||pn===We(444)},Pe=Qt;function Qt(n,e){const t=gn();return(Qt=function(r,i){return t[r-=300]})(n,e)}(function(){const n=Qt,e=gn();for(;;)try{if(-parseInt(n(327))/1+parseInt(n(304))/2*(parseInt(n(300))/3)+-parseInt(n(332))/4*(parseInt(n(316))/5)+-parseInt(n(322))/6*(parseInt(n(311))/7)+parseInt(n(308))/8*(-parseInt(n(307))/9)+parseInt(n(314))/10*(parseInt(n(302))/11)+parseInt(n(329))/12===997665)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();class na{constructor(e){this[Qt(310)]=e}[Pe(323)](...e){const t=Pe;Oe[t(319)]>=4&&console[t(323)](this[t(310)],...e)}[Pe(331)](...e){const t=Pe;Oe[t(319)]>=3&&console[t(331)](this[t(310)],...e)}[Pe(320)](...e){const t=Pe;Oe[t(319)]>=2&&console[t(320)](this[t(310)],...e)}error(...e){Oe[Pe(319)]>=1&&console.error(this.tag,...e)}}function er(n){return new na(n)}const Oe={logLevel:3,mediaDumps:{video:{in:{durationMs:0,delimited:!0},out:{durationMs:0}},audio:{in:{durationMs:0},out:{durationMs:0}}}};function tr(){return new Date()[Pe(317)]().slice(11,-1)}function gn(){const n=["mediaBuffer","click","529321KfbOwo","endTimestampMs","28972188cmcnxe","containerFileExt","info","4ZlZeJQ","9kyfNFe","mediaType","172953TzXwsI","byteLength","1327806tybvjI","href","createObjectURL","1089qysnCz","112088WLFXHK","substring","tag","692993ZcAeLj","set","download","810qiScYX","startTimestampMs","8821555KArxhe","toISOString","application/octet-stream","logLevel","warn","revokeObjectURL","42PDuKrJ","debug","targetDurationMs"];return(gn=function(){return n})()}class yn{constructor(e,t,r){const i=Pe;this[i(325)]=null,this[i(315)]=-1,this.endTimestampMs=-1,this[i(301)]=e,this[i(330)]=t,this[i(324)]=r,r>0&&(this[i(325)]=new Uint8Array)}append(e,t){const r=Pe;if(!this[r(325)])return!1;if(this[r(325)]=function(i,o){const c=Pe,a=new Uint8Array((0|i[c(303)])+(0|o.byteLength));return a[c(312)](i,0),a[c(312)](o,0|i.byteLength),a}(this[r(325)],e),t!==void 0){if(this[r(315)]===-1)this.startTimestampMs=t,this[r(328)]=t+this[r(324)];else if(t>=this[r(328)]){const i=new Date()[r(317)]()[r(309)](0,19).replace(/:/g,"-"),o=this.mediaType+"-"+i+"."+this.containerFileExt;return function(c,a,f=Pe(318)){const d=Pe,l=document.createElement("a"),w=new Blob([c],{type:f});l.href=URL[d(306)](w),l[d(313)]=a,l[d(326)](),URL[d(321)](l[d(305)])}(this[r(325)],o),this.mediaBuffer=null,!1}}return!0}}const C=wn;(function(){const n=wn,e=Sn();for(;;)try{if(parseInt(n(160))/1+-parseInt(n(363))/2+-parseInt(n(321))/3*(-parseInt(n(401))/4)+parseInt(n(229))/5+-parseInt(n(276))/6+parseInt(n(400))/7*(-parseInt(n(153))/8)+-parseInt(n(223))/9===858456)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const Se=er("[MUX]"),ia=Ye[C(387)];function gs(n,e){const t=C;let r=new Uint8Array((0|n[t(413)])+(0|e[t(413)]));return r.set(n,0),r[t(251)](e,0|n[t(413)]),r}const sa=(n,e,t,r)=>{const i=C,o=r[i(425)]||1;e*=o,t*=o;const c=(d=n)instanceof ArrayBuffer?d:d[C(366)],a=(n[i(188)]||0)+n[i(413)],f=(n[i(188)]||0)+e;var d;let l=Math[i(177)](0,Math[i(291)](f,a)),w=Math[i(291)](l+Math[i(177)](t,0),a);return l/=o,w/=o,new r(c,l,w-l)};function wn(n,e){const t=Sn();return(wn=function(r,i){return t[r-=147]})(n,e)}function vn(n,e=0,t=1/0){return sa(n,e,t,Uint8Array)}function ys(n){const e=C,t=Array.from(n)[e(238)](r=>r[e(384)](0));return new Uint8Array(t)}function oa(n){const e=function(t){const r=C;let i="";for(let o=0;o<t[r(268)];o+=16e3){const c=t.subarray(o,o+16e3);i+=String[r(358)].apply(null,c)}return i}(vn(n));return btoa(e)}class ue{static get[C(449)](){return 1}static get[C(427)](){return 5}static get SEI(){return 6}static get[C(324)](){return 7}static get[C(379)](){return 8}static get[C(272)](){return 9}static get[C(159)](){const e=C;return{[ue[e(427)]]:e(427),[ue[e(273)]]:e(273),[ue[e(324)]]:e(324),[ue.PPS]:"PPS",[ue[e(449)]]:"NDR",[ue.AUD]:e(272)}}static[C(234)](e){const t=C;return e[t(186)]in ue[t(159)]?ue[t(159)][e.ntype]:t(344)}constructor(e){const t=C;this[t(452)]=e,this[t(402)]=(96&this[t(452)][0])>>5,this[t(186)]=31&this[t(452)][0],this.isvcl=this[t(186)]==1||this[t(186)]==5,this[t(309)]="",this.isfmb=!1}[C(365)](){const e=C;return ue[e(234)](this)+": NRI: "+this[e(209)]()}[C(209)](){return this[C(402)]}[C(234)](){return this[C(186)]}[C(306)](){return this[C(186)]===ue.IDR}[C(203)](){return this[C(452)]}[C(327)](){return this[C(452)].byteLength}[C(194)](){return 4+this[C(327)]()}[C(341)](){const e=C,t=new Uint8Array(this[e(194)]());return new DataView(t[e(366)]).setUint32(0,this[e(194)]()-4),t[e(251)](this.getPayload(),4),t}}class ws{constructor(e){const t=C;this[t(316)]=e,this[t(368)]=0,this[t(157)]=8*e.byteLength}[C(433)](e){const t=C;this.data=e,this[t(368)]=0,this.bitLength=8*e[t(413)]}get[C(451)](){return this[C(157)]-this.index}skipBits(e){const t=C;if(this[t(451)]<e)return!1;this[t(368)]+=e}[C(338)](e,t=!0){const r=C;return this[r(259)](e,this[r(368)],t)}getBits(e,t,r=!0){const i=C;if(this[i(451)]<e)return 0;const o=t%8,c=this.data[t/8|0]&255>>>o,a=8-o;if(a>=e)return r&&(this[i(368)]+=e),c>>a-e;{r&&(this[i(368)]+=a);const f=e-a;return c<<f|this[i(259)](f,t+a,r)}}[C(444)](){const e=C;let t;for(t=0;t<this[e(157)]-this[e(368)];++t)if(this[e(259)](1,this[e(368)]+t,!1)!==0)return this[e(368)]+=t,t;return t}[C(334)](){const e=C;this[e(155)](1+this[e(444)]())}skipEG(){const e=C;this[e(155)](1+this[e(444)]())}[C(179)](){const e=C,t=this.skipLZ();return this[e(338)](t+1)-1}[C(248)](){const e=this[C(179)]();return 1&e?1+e>>>1:-1*(e>>>1)}[C(239)](){return this[C(338)](1)===1}[C(419)](e=1){return this.readBits(8*e)}[C(232)](){return this.readBits(16)}readUInt(){return this[C(338)](32)}}class st{static[C(267)](e,t){const r=C;let i=[],o=!1,c=!1,a=!1,f=!1,d=0,l=0,w=0,g=[];for(;d<=e.byteLength;){if(d<e.byteLength){const I=e[d++];I!==0?(I===1&&l>1&&(w=l>2?4:3,g.push(d)),l=0):++l}else w=0,g.push(d++);if(g.length>1){const I=g.shift(),R=g[0]-w;if(I<R){let M=!1;const U=31&e[I];if(U===ue.NDR?c=!0:U===ue.IDR?o=!0:U===ue.SPS?(M=a,a=!0):U===ue.PPS&&(M=f,f=!0),!M)if(!t||U!==ue.NDR&&U!==ue.IDR)i.push(e.subarray(I,R));else{const F=new Uint8Array(R-I);let v=0;for(d=I,l=0;d<R;){let S=e[d++];l>1&&S===3&&(l=0,S=e[d++]),S!==0?l=0:++l,F[v++]=S}i.push(F.subarray(0,v))}}}}let p=!0,m=!1;return c||o?c&&o&&(Se[r(265)](r(331)),p=!1):(Se[r(265)]("[H264Parser] No VCL NALUs found"),p=!1),o&&(a&&f?m=!0:Se.warn(r(158))),{valid:p,idr:m,nalus:i}}static[C(333)](e,t){let r,i=8,o=8;for(let c=0;c<t;c++)o!==0&&(r=e.readEG(),o=(i+r+256)%256),i=o===0?i:o}static[C(432)](e){const t=C;let r,i,o,c,a,f,d=new ws(e),l=0,w=0,g=0,p=0,m=1;if(d.readUByte(),r=d[t(419)](),d.readBits(5),d[t(155)](3),d[t(419)](),d[t(334)](),r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128){var I=d.readUEG();if(I===3&&d[t(155)](1),d[t(334)](),d[t(334)](),d[t(155)](1),d[t(239)]()){f=I!==3?8:12;for(let M=0;M<f;++M)d[t(239)]()&&(M<6?st[t(333)](d,16):st[t(333)](d,64))}}d[t(334)]();var R=d[t(179)]();if(R===0)d.readUEG();else if(R===1){d.skipBits(1),d[t(221)](),d[t(221)](),i=d[t(179)]();for(let M=0;M<i;++M)d[t(221)]()}if(d[t(334)](),d.skipBits(1),o=d[t(179)](),c=d.readUEG(),a=d[t(338)](1),a===0&&d[t(155)](1),d[t(155)](1),d.readBoolean()&&(l=d[t(179)](),w=d[t(179)](),g=d[t(179)](),p=d[t(179)]()),d[t(239)]()){if(d.readBoolean()){let M;switch(d.readUByte()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:M=[d[t(419)]()<<8|d[t(419)](),d[t(419)]()<<8|d[t(419)]()]}M&&M[0]>0&&M[1]>0&&(m=M[0]/M[1])}d.readBoolean()&&d[t(155)](1),d[t(239)]()&&(d[t(155)](4),d[t(239)]()&&d[t(155)](24)),d[t(239)]()&&(d[t(334)](),d[t(334)]()),d.readBoolean()&&(d.readUInt(),d[t(187)](),d.readBoolean())}return{width:Math[t(440)]((16*(o+1)-2*l-2*w)*m),height:(2-a)*(c+1)*16-(a?2:4)*(g+p)}}static[C(386)](e){const t=C;let r=new ws(e[t(203)]());r[t(419)](),e[t(196)]=r[t(179)]()===0,e[t(309)]=r[t(179)]()}constructor(e){const t=C;this.remuxer=e,this[t(233)]=e.mp4track}[C(256)](e){const t=C;var r=st[t(432)](new Uint8Array(e));this.track[t(237)]=r.width,this[t(233)].height=r.height,this.track[t(382)]=[new Uint8Array(e)],this.track[t(210)]=t(292);let i=new DataView(e.buffer,e[t(188)]+1,4);for(let c=0;c<3;++c){var o=i[t(313)](c)[t(365)](16);o[t(268)]<2&&(o="0"+o),this.track[t(210)]+=o}}[C(345)](e){const t=C;this[t(233)][t(434)]=[new Uint8Array(e)]}[C(378)](e){const t=C;if(!e)return!1;let r=!1;switch(e[t(234)]()){case ue[t(427)]:case ue.NDR:r=!0;break;case ue[t(379)]:!this[t(233)][t(434)]&&(this[t(345)](e.getPayload()),!this[t(175)][t(296)]&&this[t(233)][t(434)]&&this.track[t(382)]&&(this.remuxer[t(296)]=!0)),r=!0;break;case ue[t(324)]:!this.track.sps&&(this[t(256)](e[t(203)]()),!this[t(175)][t(296)]&&this[t(233)].pps&&this[t(233)][t(382)]&&(this.remuxer[t(296)]=!0)),r=!0;break;case ue[t(272)]:break;case ue.SEI:r=!0}return r}}class bn{constructor(e){const t=C;this.listener={},this[t(234)]=""|e}on(e,t){const r=C;return!this[r(270)][e]&&(this.listener[e]=[]),this[r(270)][e].push(t),!0}off(e,t){const r=C;if(this[r(270)][e]){var i=this[r(270)][e].indexOf(t);return i>-1&&this[r(270)][e][r(369)](i,1),!0}return!1}[C(219)](){this.listener={}}[C(225)](e,t){const r=C;return!!this[r(270)][e]&&(this[r(270)][e].map(i=>{i[r(200)](null,[t])}),!0)}}class L{constructor(e){var l,w;const t=C;this[t(285)]=e,this.saiIvSize={video:((l=e.config[t(415)])==null?void 0:l[t(201)])==="cenc"?16:0,audio:((w=e[t(154)][t(407)])==null?void 0:w[t(201)])==="cenc"?16:0},L[t(212)]={avc1:[],encv:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],Opus:[],dOps:[],enca:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],pssh:[],sinf:[],frma:[],schm:[],schi:[],tenc:[],saiz:[],saio:[],senc:[]};for(let g in L[t(212)])L.types[g]=[g[t(384)](0),g[t(384)](1),g[t(384)](2),g.charCodeAt(3)];const r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:r,audio:i};const o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),c=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L[t(377)]=L[t(213)]=c,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L[t(438)]=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L[t(307)]=new Uint8Array([0,0,0,0,0,0,0,0]),L[t(168)]=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);L[t(183)]=L[t(347)](L[t(212)].ftyp,a,d,a,f),L[t(147)]=L[t(347)](L.types.dinf,L[t(347)](L[t(212)][t(280)],o))}static box(e,...t){const r=C;let i,o=8,c=t.length,a=c;for(;c--;)t[c]&&(o+=t[c].byteLength);for(i=new Uint8Array(o),i[0]=o>>>24,i[1]=o>>>16&255,i[2]=o>>>8&255,i[3]=255&o,i[r(251)](e,4),c=0,o=8;c<a;++c)t[c]&&(i[r(251)](t[c],o),o+=t[c][r(413)]);return i}[C(190)](e){const t=C;return L[t(347)](L[t(212)][t(190)],L[t(418)][e])}[C(244)](e){const t=C;return L[t(347)](L[t(212)][t(244)],e)}[C(380)](e,t){const r=C;return L[r(347)](L[r(212)][r(380)],new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e,0,0,0,0,85,196,0,0]))}[C(215)](e){const t=C;return L[t(347)](L[t(212)].mdia,this[t(380)](e[t(274)],e[t(290)]),this[t(190)](e[t(234)]),this[t(230)](e))}[C(443)](e){const t=C;return L.box(L[t(212)][t(443)],new Uint8Array([0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e]))}[C(230)](e){const t=C;return e[t(234)]===t(407)?L[t(347)](L[t(212)][t(230)],L.box(L.types[t(255)],L.SMHD),L[t(147)],this[t(362)](e)):L[t(347)](L.types[t(230)],L[t(147)],this[t(362)](e),L[t(347)](L[t(212)].vmhd,L[t(438)]))}[C(370)](e,t,r){const i=C;return L[i(347)](L.types.moof,this[i(443)](e),this[i(293)](r,t))}[C(295)](e,t,r){const i=C;let o=e[i(268)],c=[];for(;o--;)c[o]=this.trak(e[o]);return L.box[i(200)](null,[L[i(212)][i(295)],this[i(240)](r,t),this[i(447)](e)][i(389)](c)[i(389)](this[i(322)](e)))}[C(322)](e){const t=C;let r=e[t(268)],i=[];for(;r--;)i[r]=this[t(305)](e[r]);return L[t(347)][t(200)](null,[L[t(212)][t(322)]][t(389)](i))}[C(240)](e,t){const r=C;let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L[r(347)](L.types.mvhd,i)}[C(420)](e){const t=C;let r=e[t(428)]||[],i=new Uint8Array(4+r.length);for(let o=0;o<r[t(268)];o++){const c=r[o][t(375)];i[o+4]=c.dependsOn<<4|c[t(149)]<<2|c[t(422)]}return L[t(347)](L[t(212)][t(420)],i)}[C(362)](e){const t=C;return L[t(347)](L.types[t(362)],this[t(165)](e),L.box(L[t(212)][t(329)],L[t(421)]),L[t(347)](L.types[t(227)],L[t(377)]),L[t(347)](L.types[t(235)],L[t(218)]),L[t(347)](L[t(212)].stco,L[t(213)]))}[C(303)](e){const t=C;let r,i,o,c=[],a=[];for(r=0;r<e[t(382)].length;r++)i=e.sps[r],o=i[t(413)],c.push(o>>>8&255),c.push(255&o),c=c[t(389)](Array.prototype[t(314)][t(395)](i));for(r=0;r<e[t(434)][t(268)];r++)i=e[t(434)][r],o=i[t(413)],a[t(406)](o>>>8&255),a[t(406)](255&o),a=a.concat(Array.prototype[t(314)].call(i));const f=L[t(347)](L[t(212)][t(408)],new Uint8Array([1,c[3],c[4],c[5],255,224|e.sps[t(268)]].concat(c)[t(389)]([e[t(434)][t(268)]]).concat(a))),d=e[t(237)],l=e[t(374)],w=L[t(347)](L.types[t(441)],L.box(L[t(212)][t(318)],new Uint8Array([97,118,99,49])),L[t(347)](L[t(212)][t(349)],new Uint8Array([0,0,0,0,...ys(this[t(285)][t(154)][t(415)][t(201)]),0,1,0,0])),L.box(L.types[t(217)],this[t(298)](t(415))));return L[t(347)](L[t(212)].encv,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>>8&255,255&d,l>>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,65,86,67,32,67,111,100,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),f,w)}[C(372)](e){const t=C;let r=e[t(154)][t(413)],i=new Uint8Array(26+r+3);return i[t(251)]([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5,r]),i[t(251)](e[t(154)],26),i.set([6,1,2],26+r),i}[C(403)](e){const t=C,r=e[t(354)];return L[t(347)](L[t(212)][t(403)],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,r>>>8&255,255&r,0,0]),L[t(347)](L[t(212)][t(372)],this[t(372)](e)))}[C(266)](e){const t=C,r=e[t(354)];return new Uint8Array([0,e[t(390)],1,56,0,0,r>>>8&255,255&r,0,0,0])}[C(416)](e){const t=C,r=e.audiosamplerate;return L[t(347)](L.types[t(416)],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,r>>>8&255,255&r,0,0]),L[t(347)](L[t(212)][t(266)],this[t(266)](e)))}[C(394)](e){const t=C,r=L[t(347)](L.types[t(266)],this.dOps(e)),i=L[t(347)](L.types[t(441)],L.box(L.types.frma,new Uint8Array([79,112,117,115])),L[t(347)](L.types.schm,new Uint8Array([0,0,0,0,...ys(this[t(285)][t(154)].audio[t(201)]),0,1,0,0])),L.box(L.types[t(217)],this[t(298)](t(407)))),o=e[t(354)];return L[t(347)](L[t(212)].enca,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,o>>>8&255,255&o,0,0]),r,i)}[C(165)](e){const t=C;return e[t(234)]===t(407)?L[t(347)](L[t(212)][t(165)],L[t(168)],e[t(199)]?this[t(394)](e):this[t(416)](e)):L[t(347)](L.types[t(165)],L[t(168)],this[t(303)](e))}[C(278)](e){const t=C,r=e.id,i=e[t(290)],o=e[t(237)],c=e[t(374)],a=e[t(388)];return L[t(347)](L[t(212)].tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24,r>>>16&255,r>>>8&255,255&r,0,0,0,0,i>>>24,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,255&a,a%1*10&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>>8&255,255&o,0,0,c>>>8&255,255&c,0,0]))}[C(293)](e,t){var l;const r=C,i=e.id,o=e[r(428)][0][r(171)],c=e.samples[0][r(290)],a=e[r(428)][0].flags,f=L[r(347)](L[r(212)].tfhd,new Uint8Array([0,2,0,58,i>>>24,i>>>16&255,i>>>8&255,255&i,0,0,0,1,c>>>24,i>>>16&255,c>>>8&255,255&c,o>>>24,o>>>16&255,o>>>8&255,255&o,0,a[r(264)],0,0])),d=L[r(347)](L[r(212)].tfdt,new Uint8Array([0,0,0,0,t>>>24,t>>>16&255,t>>>8&255,255&t]));if(e.encrypted){let w,g;if(e[r(234)]===r(415)?(w=!0,g=this[r(350)][r(415)]+((l=e.samples[0][r(191)])==null?void 0:l.byteLength)):(w=!1,g=this[r(350)].audio),g>0){const p=this[r(242)](g),m=this[r(340)](e[r(428)],w),I=p[r(268)]+20+m[r(268)]+f[r(268)]+d[r(268)]+8+16+8+8,R=this[r(271)](e,I);return L[r(347)](L[r(212)][r(293)],f,d,R,p,this.saio(I-m[r(268)]+R.length+8),m)}{const p=this[r(340)](null,!1),m=p.length+f[r(268)]+d[r(268)]+8+16+8+8,I=this[r(271)](e,m);return L[r(347)](L.types[r(293)],f,d,I,p)}}return L.box(L[r(212)].traf,f,d,this.trun(e,f[r(268)]+d.length+8+16+8+8))}trak(e){const t=C;return e.duration=e[t(290)]||4294967295,L.box(L[t(212)].trak,this[t(278)](e),this[t(215)](e))}[C(305)](e){const t=C,r=e.id;return L[t(347)](L.types[t(305)],new Uint8Array([0,0,0,0,r>>>24,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,16,0,0,0,0,0,0,0,0]))}trun(e,t){const r=C;let i=(e[r(428)]||[])[r(268)],o=new Uint8Array(12);return t+=20,o.set([0,0,0,1,i>>>24,i>>>16&255,i>>>8&255,255&i,t>>>24,t>>>16&255,t>>>8&255,255&t],0),L[r(347)](L.types[r(271)],o)}[C(224)](e,t){const r=C,i=r(445),o=oa(function(c){const a=C,f=[];return f[a(406)](c[3]),f[a(406)](c[2]),f.push(c[1]),f.push(c[0]),f[a(406)](c[5]),f[a(406)](c[4]),f.push(c[7]),f.push(c[6]),(c=vn(c))[a(251)](f,0),c}(e));return vn(function(c,a){const f=C,d=new Uint8Array(2*c[f(268)]),l=new DataView(d[f(366)]);for(let w=0;w<c[f(268)];++w){const g=c.charCodeAt(w);l[f(253)](2*w,g,a)}return d[f(366)]}([r(328)+i+'" version="4.3.0.0">',r(308),"<PROTECTINFO>",r(398),r(353),r(216)+o+'"',">",r(412),r(249),r(391),t?"<LA_URL>"+t+r(423):"",r(351),r(269)].join(""),!0))}pssh(e){const t=C;if(this[t(285)][t(383)][t(202)](t(178)))return L[t(347)](L.types[t(447)],new Uint8Array([0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,18,18,16,...this[t(285)][t(154)][e[0][t(234)]].keyId]));if(this[t(285)][t(383)]===t(356)){const r=this[t(224)](this[t(285)][t(154)][e[0][t(234)]][t(429)],this.drm[t(371)]),i=r[t(413)];return L[t(347)](L[t(212)][t(447)],new Uint8Array([0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,i>>>24,i>>>16&255,i>>>8&255,255&i,...r]))}return this.drm[t(383)]===t(323)?L[t(347)](L[t(212)][t(447)],new Uint8Array([1,0,0,0,16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75,0,0,0,1,...this.drm[t(154)][e[0].type].keyId,0,0,0,0])):this.drm[t(383)]===t(397)?null:void Se[t(189)](t(393)+this[t(285)][t(383)])}[C(298)](e){const t=C;let r,i,o=this[t(285)][t(154)][e];return o[t(201)]===t(226)?(r=new Uint8Array([16,...o.iv]),i=25):(r=new Uint8Array([]),i=0),L[t(347)](L[t(212)][t(298)],new Uint8Array([1,0,0,0,0,i,1,this[t(350)][e],...o[t(429)],...r]))}[C(242)](e){const t=C;return L[t(347)](L[t(212)][t(242)],new Uint8Array([0,0,0,0,e,0,0,0,1]))}[C(204)](e){const t=C;return L[t(347)](L[t(212)][t(204)],new Uint8Array([0,0,0,0,0,0,0,1,e>>>24,e>>>16&255,e>>>8&255,255&e]))}[C(340)](e,t){const r=C;let i=null;return e&&(e[r(268)]!==1&&Se[r(189)](r(182)+e[r(268)]+" samples - expected 1"),i=e[0][r(191)]),i&&i[r(413)]?L[r(347)](L[r(212)].senc,new Uint8Array([0,0,0,t?2:0,0,0,0,1,...i])):L.box(L[r(212)][r(340)],new Uint8Array([0,0,0,0,0,0,0,1]))}[C(439)](e,t,r){const i=C,o=this[i(295)](e,t,r);let c=new Uint8Array(L[i(183)].byteLength+o[i(413)]);return c[i(251)](L[i(183)]),c[i(251)](o,L[i(183)][i(413)]),c}}let aa=1;class rr{constructor(){this.seq=1}static[C(411)](){return aa++}[C(246)](){const e=C;this.mp4track[e(263)]=0,this[e(207)][e(428)]=[]}[C(211)](){const e=C;return!(!this[e(296)]||!this[e(428)][e(268)])}}class ca extends rr{constructor(e){const t=C;super(),this[t(296)]=!0,this[t(222)]=0,this.dts=0,this.mp4track={id:rr[t(411)](),type:t(407),channelCount:2,audiosamplerate:48e3,len:0,fragmented:!0,timescale:e,duration:e,samples:[],codec:t(364),encrypted:!0},this[t(428)]=[]}resetTrack(){const e=C;this[e(437)]=1,this[e(222)]=0,this[e(336)]=0}[C(181)](e,t,r){const i=C;if(e[i(268)]>0)for(let o=0;o<e.length;o++){let c=e[o],a=c[i(392)],f=a[i(413)];this.samples[i(406)]({units:a,size:f,duration:c.duration,sampleAuxInfo:t,timestamp:r}),this[i(207)][i(263)]+=f}}[C(161)](){const e=C;if(!this.samples)return null;let t,r=this[e(207)][e(428)];for(;this[e(428)][e(268)];){let i=this.samples[e(342)](),o=(1e3*i.timestamp|0)-this[e(222)]|0;o<5&&(o=5),this[e(336)]=this[e(222)],this.nextDts+=o,t={size:i[e(171)],duration:o,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1},sampleAuxInfo:i[e(191)]};let c=new Uint8Array(i[e(171)]);return c[e(251)](i.units,0),r[e(406)](t),new Uint8Array(c[e(366)],0,i[e(171)])}return null}}class ua extends rr{constructor(e,t){const r=C;super(),this[r(296)]=!1,this[r(222)]=0,this[r(336)]=0,this[r(361)]=t,this[r(207)]={id:rr[r(411)](),type:r(415),len:0,fragmented:!0,sps:"",pps:"",width:0,height:0,timescale:e,duration:e,samples:[],encrypted:!0},this[r(428)]=[],this[r(302)]=new st(this)}[C(297)](){const e=C;this[e(437)]=1,this[e(296)]=!1,this[e(207)][e(382)]="",this.mp4track[e(434)]="",this.nextDts=0,this.dts=0}remux(e,t,r){const i=C;for(let o of e){let c=[],a=0;for(let f of o[i(392)])this[i(302)].parseNAL(f)&&(c[i(406)](f),a+=f[i(194)]());c[i(268)]>0&&this.readyToDecode&&(this[i(207)][i(263)]+=a,this[i(428)].push({units:c,size:a,keyFrame:o.keyFrame,duration:o[i(290)],sampleAuxInfo:t,timestamp:r}))}}[C(161)](){const e=C;if(!this[e(211)]()||!this[e(428)])return null;let t,r=this.mp4track[e(428)],i=this.samples[e(342)](),o=i.units,c=(1e3*i[e(332)]|0)-this[e(222)]|0;c<5&&(c=5),c>5e3&&Se[e(381)](e(430)+(c/1e3|0)+" s"),this.dts=this[e(222)],this[e(222)]+=c,t={size:i.size,duration:c,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:i[e(148)]?0:1,dependsOn:i[e(148)]?2:1},sampleAuxInfo:i[e(191)]};let a=0;for(const l of o)a+=l[e(194)]();let f=0,d=new Uint8Array(a);for(const l of o)d[e(251)](l[e(341)](),f),f+=l[e(194)]();return r.push(t),new Uint8Array(d[e(366)],0,a)}}class da extends bn{constructor(e,t){const r=C;super(r(175)),this[r(260)]=!1,this.trackTypes=[],this[r(357)]={},this[r(274)]=1e3,this[r(163)]=0,this[r(361)]=e,this.mp4=t}[C(281)](e){const t=C;(e==="video"||e==="both")&&(this[t(357)][t(415)]=new ua(this.timescale,this[t(361)]),this[t(335)][t(406)](t(415))),(e===t(407)||e===t(417))&&(this[t(357)][t(407)]=new ca(this.timescale),this.trackTypes[t(406)](t(407)))}[C(250)](){const e=C;for(let t of this[e(335)])this.tracks[t].resetTrack();this[e(260)]=!1}[C(262)](){const e=C;this.tracks={},this[e(219)]()}[C(246)](){const e=C;if(this[e(260)])for(let t of this[e(335)]){let r=this[e(357)][t];for(;;){let i=r[e(161)]();if(!i||!i.byteLength)break;let o={type:t,payload:gs(this[e(164)][e(370)](r[e(437)]++,r[e(336)],r[e(207)]),this.mp4[e(244)](i)),dts:r[e(336)]};this[e(225)](e(366),o),r[e(246)]()}}else this[e(211)]()&&(this[e(225)]("ready"),this.initSegment(),this[e(260)]=!0,this[e(246)]())}[C(439)](){const e=C;for(let t of this[e(335)]){let r=this[e(357)][t],i={type:t,payload:this[e(164)][e(439)]([r[e(207)]],this[e(163)],this.timescale)};this[e(225)]("buffer",i)}}isReady(){const e=C;for(let t of this[e(335)])if(!this.tracks[t][e(296)]||!this[e(357)][t][e(428)][e(268)])return!1;return!0}[C(181)](e){const t=C;for(let r of this[t(335)]){let i=e[r];i.length>0&&this[t(357)][r][t(181)](i,r==="audio"?e.audioSampleAuxInfo:e[t(310)],e[t(332)])}this[t(246)]()}}function Sn(){const n=["stsd","isSupported","src","STSD","endMSE","abort","size","appendBufferError","addSourceBuffer","setupMSE","remuxer","addEventListener","max","com.widevine","readUEG"," - ","remux","Received ","FTYP","readyState","valid","ntype","readUInt","byteOffset","error","hdlr","sampleAuxInfo","webkitsourceopen","Checking codec","getSize","irrecoverableError","isfmb","[MSE] buffer error:","url","encrypted","apply","encryption","startsWith","getPayload","saio","open","[MSE] source buffer error","mp4track","append","getNri","codec","isReady","types","STCO","feed","mdia",'VALUE="',"schi","STSZ","offAll","jmuxer","skipEG","nextDts","1036611gAoRea","generatePlayReadyHeader","dispatch","cbcs","stsc","endOfStream","6576815frVeWy","minf","releaseBuffer","readUShort","track","type","stsz","isvcl","width","map","readBoolean","mvhd","onReady","saiz","reportDiscontinuity","mdat","bufferControllers","flush","patchSampleAuxinfo","readEG","</KIDS>","reset","set","onMSEClose","setUint16","idr","smhd","parseSPS","bind","message","getBits","initialized","sourceBuffer","destroy","len","isNonSync","warn","dOps","extractNALUs","length","</WRMHEADER>","listener","trun","AUD","SEI","timescale","Num frames in chunk: ","7620738FWzrwf","mode","tkhd","dbgMediaDump","dref","addTrack","doAppend","options","[MSE] sourceclose","drm","mediaSource","Failure: Browser doesn't support MSE/MMS",'/mp4; codecs="',"function","duration","min","avc1.","traf","[MSE] sourceopen","moov","readyToDecode","resetTrack","tenc","onMSEOpen","MediaSource","removeSourceBuffer","h264","encv","sourceopen","trex","isKeyframe","SMHD","<DATA>","stype","videoSampleAuxInfo","ended","getElementById","getUint8","slice","audioSampleAuxInfo","data","ready","frma","mseReady","string","4760043VatbTq","mvex","org.w3.clearkey","SPS","buffered","no video element were found to render, provide a valid video element","getPayloadSize",'<WRMHEADER xmlns="',"stts","start","[H264Parser] Both IDR and non-IDR VCL NALUs found in the same frame","timestamp","skipScalingList","skipUEG","trackTypes","dts","queue","readBits","mseEnded","senc","getData","shift","[MSE] error: ","UNKNOWN","parsePPS","appendBuffer","box","initBrowser","schm","saiIvSize","</DATA>","out",'<KID ALGID="AESCTR" ',"audiosamplerate","reduce","com.microsoft.playready.recommendation","tracks","fromCharCode","updating","calculateExpectedSizeFromSai","videoElement","stbl","1159252OkMfWN","opus","toString","buffer","nalus","index","splice","moof","licenseUrl","esds","disableRemotePlayback","height","flags","createBuffer","STSC","parseNAL","PPS","mdhd","debug","sps","keySystem","charCodeAt","mse","parseHeader","isSafari","volume","concat","channelCount","</PROTECTINFO>","units","Unsupported DRM type ","enca","call","POSITIVE_INFINITY","com.apple.fps","<KIDS>","getVideoFrames","646233hEZDuD","4LuRDMh","nri","mp4a","ManagedMediaSource","buffer error","push","audio","avcC","onError","Buffered range ","getTrackID","</KID>","byteLength","No A/V data","video","Opus","both","HDLR_TYPES","readUByte","sdtp","STTS","hasRedundancy","</LA_URL>","revokeObjectURL","BYTES_PER_ELEMENT","webkitsourceclose","IDR","samples","keyId","timestamp gap: ","node","readSPS","setData","pps","onBuffer","remuxController","seq","VMHD","initSegment","ceil","sinf","sourceclose","mfhd","skipLZ","http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader","Browser does not support codec","pssh","mediasource is not available to end: ","NDR","isReset","bitsAvailable","payload","DINF","keyFrame","isDependedOn","isTypeSupported","assign","waitingForIdr","8hmeyto","config","skipBits","remove","bitLength","[H264Parser] IDR without SPS/PPS, not suitable for recovery","TYPES","13659xNePtU","getFramePayload","onBufferError","mediaDuration","mp4"];return(Sn=function(){return n})()}class la extends bn{constructor(e,t,r){var c;const i=C;super(i(366)),this[i(234)]=t,this[i(337)]=new Uint8Array;const o=(c=Oe.mediaDumps[t])==null?void 0:c[i(352)].durationMs;o>0&&(this[i(279)]=new yn(t,i(164),o)),this.sourceBuffer=e,this[i(385)]=r,this[i(195)]=!1,this[i(261)].addEventListener(i(189),a=>{const f=i;Se.warn(f(206),a,this.type),this[f(195)]=!0,this.dispatch("error",{type:this[f(234)],name:f(366),error:f(405)})})}[C(262)](){const e=C;this[e(337)]=null,this[e(279)]=null;try{this[e(261)]&&(this.sourceBuffer[e(170)](),this.mse[e(301)](this[e(261)]),this.sourceBuffer=null)}catch(t){}this.offAll()}[C(282)](){const e=C;if(this[e(337)][e(268)]&&this[e(261)]&&!this.sourceBuffer.updating){if(this[e(261)].buffered.length>1){for(let t=0;t<this[e(261)][e(325)][e(268)];++t){const r=t<this[e(261)].buffered.length-1;Se[e(381)](e(410)+t+(r?" (remove)":"")+": "+this[e(261)][e(325)][e(330)](t)+e(180)+this[e(261)][e(325)].end(t)),r&&this[e(261)][e(156)](this[e(261)].buffered[e(330)](t),this[e(261)][e(325)].end(t))}if(this[e(261)][e(359)])return}try{this[e(261)][e(346)](this[e(337)]),this[e(337)]=new Uint8Array}catch(t){this[e(225)](e(189),{type:this.type,name:e(172),error:t})}}}[C(214)](e,t){const r=C;this.dbgMediaDump&&(this[r(279)][r(208)](e,t)||(this[r(279)]=null)),this[r(195)]||(this.queue=gs(this.queue,e)),this[r(282)]()}}class In extends bn{static isSupported(e){const t=C;return window[t(404)]?window.ManagedMediaSource[t(150)](e):!!window[t(300)]&&window[t(300)][t(150)](e)}constructor(e){const t=C;super(t(220)),this[t(195)]=!1,this[t(152)]=!0,this[t(450)]=!1,this[t(319)]=!1,this.mseEnded=!1;let r={node:"",mode:t(415),debug:!1,onReady:function(){},onError:function(i){}};this.options=Object[t(151)]({},r,e),this[t(431)]=typeof this.options[t(431)]===t(320)?document[t(312)](this[t(283)][t(431)]):this[t(283)][t(431)],this[t(285)]=e.drm,this[t(164)]=new L(this[t(285)]),this[t(436)]=new da(this.node,this[t(164)]),this[t(436)][t(281)](this[t(283)][t(277)]),this[t(436)].on(t(366),this.onBuffer[t(257)](this)),this[t(436)].on(t(317),this[t(376)][t(257)](this)),this[t(348)]()}[C(348)](){const e=C;typeof this[e(283)][e(431)]===e(320)&&this.options[e(431)]==""&&Se[e(189)](e(326)),this[e(319)]=!1,this[e(174)]()}[C(174)](){const e=C;if(!window.ManagedMediaSource&&!window[e(300)])throw e(287);window.ManagedMediaSource?(this.node[e(373)]=!0,this[e(286)]=new ManagedMediaSource):this[e(286)]=new MediaSource,this[e(198)]=URL.createObjectURL(this[e(286)]),this.node[e(167)]=this[e(198)],this[e(339)]=!1,this[e(286)][e(176)](e(304),this[e(299)][e(257)](this)),this.mediaSource.addEventListener(e(442),this[e(252)][e(257)](this)),this.mediaSource.addEventListener(e(192),this[e(299)][e(257)](this)),this[e(286)][e(176)](e(426),this[e(252)][e(257)](this)),this[e(286)][e(176)](e(189),function(t){const r=e;Se[r(189)](r(343),t[r(258)])})}[C(169)](){const e=C;if(!this.mseEnded)try{this[e(339)]=!0,this[e(286)][e(184)]===e(205)&&this[e(286)][e(228)]()}catch(t){Se[e(189)](e(448),t)}}[C(243)](){const e=C;Se[e(381)]("Discontinuity!"),this[e(152)]=!0}feed(e){const t=C;let r={video:[],audio:[]};if(this[t(195)]||this[t(339)]||!e||!this.remuxController)return-1;if(e[t(415)]){r[t(332)]=e.timestamp;const i=this[t(360)](e[t(310)],this[t(164)][t(350)][t(415)]),o=i!=e.video[t(413)];let c=st[t(267)](e[t(415)],o);if(!c[t(185)]||c[t(367)].length<1)return 0;if(this.waitingForIdr){if(!c[t(254)])return 0;this[t(152)]=!1}if(!ia&&e[t(310)]){const a=c[t(367)][t(355)]((f,d)=>f+4+d[t(413)],0);a!==i&&this.patchSampleAuxinfo(e[t(310)],this[t(164)][t(350)][t(415)],a-i)}r[t(415)]=this[t(399)](c[t(367)]),r[t(310)]=e[t(310)]}return e[t(407)]&&(r[t(332)]=e.timestamp,r[t(407)]=[{units:e[t(407)]}],r[t(315)]=e[t(315)]),e[t(415)]||e[t(407)]?(this[t(436)][t(181)](r),0):(Se[t(189)](t(414)),0)}[C(399)](e){const t=C;let r=[],i=[],o=!1,c=!1;for(let a of e){let f=new ue(a);f[t(234)]()!==ue[t(427)]&&f[t(234)]()!==ue[t(449)]||st[t(386)](f),r.length&&c&&(f[t(196)]||!f[t(236)])&&(i[t(406)]({units:r,keyFrame:o}),r=[],o=!1,c=!1),r.push(f),o=o||f.isKeyframe(),c=c||f[t(236)]}if(r[t(268)])if(c)i.push({units:r,keyFrame:o});else{let a=i[t(268)]-1;a>=0&&(i[a][t(392)]=i[a][t(392)].concat(r))}return i[t(268)]!==1&&Se.warn(t(275)+i[t(268)]),i}[C(360)](e,t){if(!e)return 0;const r=(e[0]<<8)+e[1],i=t+2+4;let o=0,c=2;for(;0<r&&c+i<=e.byteLength;){c+=t;const a=(e[c]<<8)+e[c+1],f=(e[c+2]<<24)+(e[c+3]<<16)+(e[c+4]<<8)+e[c+5];c+=6,o+=a+f}return o}[C(247)](e,t,r){let i=2;if(0<(e[0]<<8)+e[1]&&i+(t+2+4)<=e.byteLength){i+=t;let o=(e[i]<<8)+e[i+1];o+=r,o>=0&&(e[i]=o>>>8&255,e[i+1]=255&o)}return 0}[C(376)](){const e=C;if(this[e(319)]&&this[e(436)]&&this[e(436)][e(211)]()&&!this[e(245)]){this[e(245)]={};for(let t in this[e(436)][e(357)]){let r=this.remuxController[e(357)][t];const i=""[e(389)](t,e(288)).concat(r.mp4track[e(210)],'"');if(Se[e(381)](e(193),i),!In[e(166)](i))return Se.error(e(446)),!1;let o=this.mediaSource[e(173)](i);this[e(245)][t]=new la(o,t,this[e(286)]),this[e(245)][t].on(e(189),this[e(162)][e(257)](this))}}}[C(231)](){const e=C;for(let t in this.bufferControllers)this[e(245)][t][e(282)]()}[C(435)](e){const t=C;this[t(319)]&&this[t(245)]&&this[t(245)][e[t(234)]]&&this[t(245)][e[t(234)]].feed(e[t(452)],e[t(336)])}onMSEOpen(){const e=C;Se[e(381)](e(294)),this[e(286)].readyState!==e(311)&&(this[e(286)][e(290)]=Number[e(396)],this[e(319)]=!0,typeof this[e(283)].onReady===e(289)&&this[e(283)][e(241)][e(395)](null,this.isReset),URL[e(424)](this[e(198)]),this[e(376)]())}[C(252)](){const e=C;Se[e(381)](e(284)),this.mseReady=!1,this[e(169)]()}onBufferError(e){const t=C;Se.warn(t(197),e),this[t(195)]=!0,this.endMSE(),typeof this.options[t(409)]===t(289)&&this[t(283)][t(409)][t(395)](null,e)}}function vs(n,e){const t=En();return(vs=function(r,i){return t[r-=182]})(n,e)}(function(){const n=vs,e=En();for(;;)try{if(parseInt(n(182))/1+parseInt(n(192))/2*(parseInt(n(184))/3)+-parseInt(n(185))/4+-parseInt(n(187))/5+parseInt(n(193))/6+-parseInt(n(183))/7*(parseInt(n(190))/8)+-parseInt(n(186))/9===553943)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();function En(){const n=["1247170HwkwNv","__dev_time__","gitVersion","352GaBvIm","toISOString","14XlATBT","2568948xDjIMf","1027225mjPCDe","19691yiLZrh","195999uPnZlk","3038288UlnUQm","2033937CLMUfn"];return(En=function(){return n})()}const ye=xn;function Cn(){const n=["1236858jPUtaw","certificate","11225xsjioT","275391VrsSlK","5816evMpkd","CrsCCAMSEKDc0WAwLAQT1SB2ogyBJEwYv4Tx7gUijgIwggEKAoIBAQC8Xc/GTRwZDtlnBThq8","7299lkgbxa","1470Lkqtku","production","Development","charCodeAt","xUuwokpsqVIHZrJfu62ar+BF8UVUKdK5oYQoiTZd9OzK3kr29kqGGk3lSgM0/p499p/FUL8oH","baseUrl","375060LzZhzk","230861ZKueQt","12pvGCSu","https://lic.drmtoday.com","35fxICRY","pQnNI61gzHO42XZOMuxytMm0F6puNHTTqhyY3Z290YqvSDdOB+UY5QJuXJgjhvOUD9+oaLlvT","Production","development","https://lic.test.drmtoday.com","UrTEfQxfPR4dJTquE+IDLAi5yeVVxzbAgMBAAE6DGNhc3RsYWJzLmNvbUABEoADMmGXpXg/0q","from","RL9KsD0v7ysBQVdUXEbJotcFz71tI5qc3jwr6GjYIPA3VzusD17PN6AGQniMwxJV12z/EgnUo","baigovcoURAZcr1d/G0rpREjLdVLG0Gjqk63Gx688W5gh3TKemsK3R1jV0dOfj3e6uV/kTpsN","pcFB13osydpD2AaDsgWo5RWJcNf+fzCgtUQx/0Au9+xVm5LQBdv8Ja4f2oiHN3dw","V382D1oJAM0F/YgCQtNDLz7vTWJ+QskNGi5Dd2qzO4s48Cnx5BLvL4H0xCRSw2Ed6ekHSdrRU","27eI5MATX39gYtCnn7dDXVxo4/rCYK0A4VemC3HRai2X3pSGcsKY7+6we7h4IycjqtuGtYg8A","HzgsJ7Hajdsyzn0Vs3+VysAgaJAkXZ+k+N6Ka0WBiZlCtcunVJDiHQbz1sF9GvcePUUi2fM/h","Staging","staging","name"];return(Cn=function(){return n})()}(function(){const n=xn,e=Cn();for(;;)try{if(parseInt(n(326))/1+parseInt(n(325))/2+parseInt(n(315))/3+parseInt(n(327))/4*(-parseInt(n(314))/5)+-parseInt(n(312))/6+parseInt(n(329))/7*(parseInt(n(316))/8)+-parseInt(n(318))/9*(parseInt(n(319))/10)===181728)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const fa=ye(317)+ye(306)+"wyoYOE+M/t1oIbccwlTQ7o+BpV1X6TB7fxFyx1jsBtRsBWphU65w121zqmSiwzZzJ4xsXVQCJ"+ye(330)+"+vwmV2/NJWxKqHBKdL9JqvOnNiQUF0hDI7Wf8Wb63RYSXKE27Ky31hKgx1wuq7TTWkA+kHnJT"+ye(334)+ye(323)+ye(308)+"7hyskG5ZLAyJMzTvgnV3D8/I5Y6mCFBPb/+/Ri+9bEvquPF3Ff9ip3yEHu9mcQeEYCeGe9zR/"+ye(307)+ye(304)+ye(336)+ye(305),ha=Uint8Array[ye(335)](window.atob(fa),n=>n[ye(322)](0));class _e{constructor(e){this[ye(311)]=e}toString(){return this.name}[ye(324)](){const e=ye;switch(this[e(311)]){case"staging":return"https://lic.staging.drmtoday.com";case"development":return e(333);default:return e(328)}}[ye(313)](){return ha}}function xn(n,e){const t=Cn();return(xn=function(r,i){return t[r-=304]})(n,e)}_e[ye(309)]=new _e(ye(310)),_e[ye(331)]=new _e(ye(320)),_e[ye(321)]=new _e(ye(332));const Rn=Tn;function Tn(n,e){const t=kn();return(Tn=function(r,i){return t[r-=252]})(n,e)}function kn(){const n=["SampleAuxInfo corrupted","error","50012RXzLep","3301necisu","[RTC-DRM]","subarray","buffer","64zGPhLV","162pDdDkb","659466dfDPqj","SampleAuxInfo corrupted (postfix not found)","data","4199670WddvRf","95WaGAXy","getUint8","137436hbCkvG","1351035XuhSnW","getUint16","byteLength","184863QcuifQ"];return(kn=function(){return n})()}(function(){const n=Tn,e=kn();for(;;)try{if(-parseInt(n(253))/1*(parseInt(n(258))/2)+parseInt(n(259))/3+parseInt(n(252))/4*(-parseInt(n(263))/5)+-parseInt(n(265))/6+-parseInt(n(269))/7*(-parseInt(n(257))/8)+-parseInt(n(266))/9+parseInt(n(262))/10===173102)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const Ct=er(Rn(254));(function(){const n=An,e=Mn();for(;;)try{if(parseInt(n(369))/1+parseInt(n(374))/2+parseInt(n(366))/3+-parseInt(n(373))/4+-parseInt(n(365))/5+-parseInt(n(368))/6*(parseInt(n(370))/7)+parseInt(n(367))/8===110661)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const xt=[];function An(n,e){const t=Mn();return(An=function(r,i){return t[r-=365]})(n,e)}let Dn=null,bs=0;function Mn(){const n=["799144UpkRWz","356926NfeJZx","set","slice","237700RBIjTO","627444ELwjUL","76968OxbdcX","6xPMWky","172231EpHRtx","1480332fEizHX","push","buffer"];return(Mn=function(){return n})()}function pa(n){return!Dn&&function(){const e=An;Dn=new Uint8Array([0,0,0,1,65,154,255,255])[e(372)],xt[e(371)](new Uint8Array([0,0,0,1,39,100,0,13,172,87,5,6,100,0,0,0,1,40,238,60,176,0,0,0,1,37,184,32,0,203,255,38,29,217,24,192,161,96,0,0,12,229,174,166,6,7,20,3,84,0,247,96,193,181,229,128,0,32,32])[e(372)]),xt[e(371)](xt[0][e(376)](0)),new Uint8Array(xt[1])[e(375)]([16,0,50],27)}(),n?Dn:(bs^=1,xt[bs])}const xe=nr;(function(){const n=nr,e=Ln();for(;;)try{if(-parseInt(n(452))/1+-parseInt(n(412))/2+-parseInt(n(478))/3*(parseInt(n(441))/4)+-parseInt(n(485))/5*(-parseInt(n(415))/6)+-parseInt(n(400))/7+parseInt(n(460))/8*(-parseInt(n(486))/9)+-parseInt(n(437))/10*(-parseInt(n(470))/11)===412983)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const Ee=er(xe(424));let ht={licenseUrl:"",onFetch:void 0};const Ss={},ma=(n,e,t)=>{const r=xe,i=Uint8Array.BYTES_PER_ELEMENT;e*=i,t*=i;const o=(f=n)instanceof ArrayBuffer?f:f[xe(484)],c=n[r(483)],a=e;var f;let d=Math[r(432)](0,Math.min(a,c)),l=Math.min(d+Math[r(432)](t,0),c);return d/=i,l/=i,new Uint8Array(o,d,l-d)},Is=(n,e=0,t=1/0)=>ma(n,e,t);function ga(n,e,t=!1){const r=xe;if(!n)return"";let i=n;if(!t&&i[r(483)]%2!=0)throw Ee[r(393)](r(448)),new Error("Data does not seem to be UTF-16 encoded!");const o=Is(i);let c;if((o[0]===255&&o[1]===254||o[0]===254&&o[1]===255)&&(i=o[r(407)](2)),i instanceof ArrayBuffer)c=i;else{const l=new Uint8Array(i[r(483)]);l[r(396)](Is(i)),c=l[r(484)]}const a=Math[r(447)](i[r(483)]/2),f=new Uint16Array(a),d=new DataView(c);for(let l=0;l<a;l++)f[l]=d[r(398)](2*l,e);return function(l){const w=xe;let g="";for(let p=0;p<l[w(433)];p+=16e3){const m=l.subarray(p,p+16e3);g+=String[w(408)][w(467)](null,m)}return g}(f)}const Es=n=>{const e=xe;let t="";for(const r of n){let i=r.toString(16);i[e(433)]==1&&(i="0"+i),t+=i}return t};function Ln(){const n=["360308tFqTFd","usable for decryption (status: ","oct","decode","parse","license","parseFromString","message","8pQccIM","No clear key test key provided!","generateRequest","text/xml","Failed to update the session: ","output-downscaled","target","apply","bind","Failed to update the session","24280927IKsRHd","No PR challenge data!","kids","status","getElementsByTagName","rtcdrmerror","CK license request:","A128KW","3KcCnPp","createSession","License acquisition failed with error ","No media keys for media element!","stringify","byteLength","buffer","82765KyOCry","7206525fRtYVA","error","btoa","9a04f07998404286ab92e65be0885f95","set","[PR] License fetched:","getUint16","onFetch","4630892EspqDe","addEventListener","debug","has","json","Previous lic will be reused","internal-error","subarray","fromCharCode","expired","text","temporary","665922eWbQGg","then","[FPS] License fetched:","174puebov","Content-Type","update","POST","<Challenge","nodeValue","replace","sessionId","initData","[CDM]","[WV] License fetched:","No media element available!","CDM error generating license request: ","Failed to load previous EME session","initDataType","keyStatuses","forEach","max","length","indexOf","New lic will be requested","edef8ba979d64acea3c827dcd51d21ed","10DoxNsv","atob","catch","arrayBuffer","475444JqsldJ","No init data available!","append","warn","licenseUrl","dispatchEvent","floor","Data has an incorrect length, must be even.","EME createSession() failed - no DRM available","keystatuseschange","Failed to reuse previous EME session: "];return(Ln=function(){return n})()}let Pn=null;const ya=n=>{const e=xe;return window[e(394)](String[e(408)][e(467)](null,n))[e(421)](/\+/g,"-")[e(421)](/\//g,"_")[e(421)](/=*$/,"")},wa=(n,e)=>{const t=xe,r=(i=>{const o=xe,c=JSON[o(456)](new TextDecoder()[o(455)](i));if(Ee[o(402)](o(476),c),Pn===null)throw new Error(o(461));const a=[];for(const f of c[o(472)]){const d={kty:o(454),alg:o(477),kid:f,k:ya(Pn)};a.push(d)}return new TextEncoder().encode(JSON[o(482)]({keys:a}))})(e.message);e.target.update(r)[t(439)](function(i){const o=t;Ee[o(393)](o(469),i)})},Un=n=>{const e=xe,t=window[e(438)](n.replace(/-/g,"+")[e(421)](/_/g,"/")),r=new Uint8Array(t[e(433)]);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r},Bn=(n,e,...t)=>un(void 0,[n,e,...t],void 0,function*(r,i,o=!1){const c=xe,a=new Headers(Ss);o&&a[c(443)](c(416),c(463));const f={method:c(418),headers:a,body:i},d=yield ht[c(399)]?ht.onFetch(r,f):fetch(r,f);if(!d.ok)throw new Error(c(480)+d[c(473)]);return d}),va=(n,e)=>{const t=xe;Bn(ht[t(445)],e[t(459)])[t(413)](r=>r[t(404)]()).then(r=>{const i=t;Ee[i(402)](i(425),r[i(457)]);const o=Un(r[i(457)])[i(484)];e[i(466)][i(417)](o)[i(439)](c=>{const a=i;Ee[a(393)](a(469),c)})})[t(439)](r=>{const i=t;n[i(446)](new CustomEvent(i(475),{detail:{message:""+r}})),Ee[i(393)](r)})},ba=(n,e)=>{const t=xe,r=((i,o)=>{const c=xe,a=new DOMParser;try{const f=ga(o,!0);if(f[c(434)](c(419))>-1){const d=a[c(458)](f,c(463))[c(474)]("Challenge")[0].childNodes[0][c(420)];if(d===null)throw new Error(c(471));return Un(d)}Ee[c(444)]("[PR] Challenge node not found")}catch(f){i[c(446)](new CustomEvent(c(475),{detail:{message:""+f}})),Ee[c(393)](f)}return null})(n,e.message);if(r===null)return n[t(446)](new CustomEvent("rtcdrmerror",{detail:{message:t(471)}})),void Ee[t(393)](t(471));Bn(ht[t(445)],r[t(484)],!0)[t(413)](i=>i[t(440)]())[t(413)](i=>{const o=t;Ee[o(402)](o(397),i),e[o(466)][o(417)](i)[o(439)](function(c){const a=o;n[a(446)](new CustomEvent(a(475),{detail:{message:a(464)+c}})),Ee[a(393)]("Failed to update the session",c)})}).catch(i=>{const o=t;n.dispatchEvent(new CustomEvent(o(475),{detail:{message:""+i}})),Ee[o(393)](i)})},Sa=(n,e)=>{const t=xe;Bn(ht.licenseUrl,e[t(459)])[t(413)](r=>{const i=t,o=r[i(410)]();return Ee[i(402)](i(414),r,o),o})[t(413)](r=>{const i=t;e.target[i(417)](Un(r))})[t(439)](r=>{const i=t;n[i(446)](new CustomEvent(i(475),{detail:{message:""+r}})),Ee.error(r)})},Cs=(n,e)=>{Ss[n]=e},xs=Ye.isSafari;function nr(n,e){const t=Ln();return(nr=function(r,i){return t[r-=393]})(n,e)}let ir=!xs;const Rt=new Map;function Ia(n){return un(this,void 0,void 0,function*(){const e=nr;if(n.initData===null)throw new Error(e(442));const t=n[e(466)];if(t===null)throw new Error(e(426));const r=t.mediaKeys;if(r===null)throw new Error(e(481));const i=Es(new Uint8Array(n[e(423)])),o=i+t.id;let c=null;Rt[e(403)](o)&&(c=Rt.get(o),c!=null&&c.close(),Rt.delete(o)),Ee[e(402)](e(c?405:435));let a=null;try{a=r.createSession(ir?"persistent-license":"temporary")}catch(f){Ee[e(402)]("EME createSession(persistent) failed:",f)}if(!a&&ir){ir=!1;try{a=r[e(479)](e(411))}catch(f){Ee.error("EME createSession(temporary) failed:",f)}}if(a)if(a.addEventListener(e(450),f=>{const d=e;f[d(466)][d(430)][d(431)]((l,w)=>{const g=d;(l===g(409)||l==="output-restricted"||l===g(465)||l===g(406))&&t[g(446)](new CustomEvent(g(475),{detail:{message:"Key "+Es(new Uint8Array(w))+" is not "+(g(453)+l)+")",keyId:w}}))})}),xs?a[e(401)](e(459),Sa.bind(null,t),!1):i.indexOf(e(436))!==-1?a[e(401)](e(459),va[e(468)](null,t),!1):i[e(434)](e(395))!==-1?a.addEventListener(e(459),ba[e(468)](null,t),!1):a.addEventListener(e(459),wa[e(468)](null,t),!1),c)try{(yield a.load(c[e(422)]))?Rt[e(396)](o,a):t[e(446)](new CustomEvent(e(475),{detail:{message:e(428)}}))}catch(f){t[e(446)](new CustomEvent(e(475),{detail:{message:e(451)+f}}))}else a[e(462)](n[e(429)],n[e(423)])[e(413)](()=>{ir&&Rt[e(396)](o,a)})[e(439)](f=>{const d=e;t.dispatchEvent(new CustomEvent(d(475),{detail:{message:d(427)+f}}))});else t[e(446)](new CustomEvent(e(475),{detail:{message:e(449)}}))})}const re=or;(function(){const n=or,e=Nn();for(;;)try{if(-parseInt(n(462))/1*(-parseInt(n(532))/2)+-parseInt(n(543))/3+parseInt(n(682))/4+-parseInt(n(692))/5*(parseInt(n(588))/6)+-parseInt(n(539))/7+parseInt(n(496))/8+-parseInt(n(549))/9===672532)break;e.push(e.shift())}catch(t){e.push(e.shift())}})();const de=er(re(673)),Rs=Ye[re(607)],sr=Ye[re(540)],Ze=Ye[re(647)],Ts=Ye[re(489)],ks=Ye[re(478)],Ea=Ye.platform,As=Ye[re(620)],Ca=Ts||ks&&Ea===re(578),xa=1e6*(sr?82:Ze?220:120),Fn=sr?5e3:2e3,Ra=sr?1.5:.5;function On(n){const e=re;return typeof n!==e(672)||n===null||n instanceof Element||n instanceof _e?n:((t=n)==null?void 0:t[re(584)])instanceof ArrayBuffer&&(t!=null&&t.BYTES_PER_ELEMENT)?n[e(550)]():Array[e(636)](n)?n.reduce((r,i,o)=>(r[o]=On(i),r),[]):n instanceof Object?Object.keys(n).reduce((r,i)=>(r[i]=On(n[i]),r),{}):n;var t}class Ta{constructor(e){const t=re;this[t(547)]="",this[t(471)]="",this.keySystem="",this[t(603)]=[],this[t(479)]=On(e),this.jmuxer=null,this.keyFrameLogCntr=0,this[t(561)]=Date[t(658)](),this[t(585)]=0,this[t(602)]=0,this[t(490)]=-1,this[t(680)]=0,this[t(596)]=0,this[t(491)]=!0,this.keyFrameNeededPosted=!1,this[t(617)]=Fn,this[t(500)]=null,this.dbgMediaDump={video:null,audio:null}}}const ot=new Map,ka=new Uint8Array([60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60]),Aa=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),Da=new Uint8Array([213,251,214,184,46,217,62,78,249,138,228,9,49,238,51,183]);function Ma(n,e){const t=re;e!==void 0&&(n[t(479)].mediaBufferMs=e),(n[t(479)][t(571)]===void 0||n.config[t(571)]<0)&&(n[t(479)].mediaBufferMs=100,sr?n[t(479)][t(571)]=350:!Ze&&As&&(n.config[t(601)]==="PlayReady"||n[t(482)])&&(n.config[t(571)]=1400))}function Nn(){const n=["isSafari","ansform=$=>{let e=$.transformer;handleTransform(e.options.operation,e.readable,e.writable)}),onmessage=$=>{keyFra","status","DRM config:","key","Development"," will be used","Staging","const DUMMY_IDR_FRAME_SLICE_HDR0=new Uint8Array([32,0,203]),DUMMY_IDR_FRAME_SLICE_HDR1=new Uint8Array([16,0,50]);","enabled","playback at ","now",".experiment","seq","videoElement","data","btoa","PlayReady might not support '","logLevel","cbcs-1-9","encryption"," to ","offset","x-dt-custom-data","let brokenFrame=null,idrFrames=[];function initializeDummyFrames(){brokenFrame=new Uint8Array([0,0,0,1,65,154,255","object","[RTC-DRM]","not-allowed","durationMs","Default transform mode enabled, ","keySystem","timestamp","DRM config keyId must be an instance of 16-byte long Uint8Array.","lastKeyFrameTime","H264 is the only supported video codec.","2533916KeNZJm","out","Applying pre-configured certificate (","buffered","Widevine","x-dt-auth-token"," ms)","com.microsoft.playready.recommendation","error","currentTime","225RwtgWL","end","requestMediaKeySystemAccess","50705YjLCIv","onmessage","environment","wvLicenseUrl","a1d1f1"," requesting a new key frame (latency ","userId","ClearKey","createEncodedStreams","licenseUrl","PlayReady license acquisition might fail without output protection enabled (sessionId is ","feed","dbgMediaDump","jmuxer","MSE (re)init",",255]).buffer,idrFrames.push(new Uint8Array([0,0,0,1,39,100,0,13,172,87,5,6,100,0,0,0,1,40,238,60,176,0,0,0,1,37,","isChrome","config","forEach","Invalid config argument type, DRM config must be an object.","hwSecurity","audioEncrypted","setMediaKeys","fpsCertificate","Unable to create Worker!","GET","customTransform","isEdge","prevSeqNum","keyFrameNeeded","encrypted","targetLatency not set!","opus","FairPlay","7963992IJNztq","streamType","SampleAuxInfo extraction failed (video)"," seeking from ","worker","]: ","video","kind","audio","jitterBufferDelayHint","size","No target media element!","fpsCertificateUrl","wvCertificate","delimited","3000","pipeThrough","/license-server-fairplay/cert/","string",") not found in [","indexOf","warn","ignoreAudio","append","jitterBufferTarget","prLicenseUrl","sessionTypes","authToken","get","RTCRtpScriptTransform","audioElement","catch","trim","join","waitingForIdr","info","52hXHKkY","enqueue","). It has to be a string containing a JWT.","playbackRate","sai","persistent-license","Blob","2699340CvuQCI","isFirefox","transform",'rame:{type:$.type,timestamp:$.timestamp,data:$.data}}),"key"===$.type&&(keyFrameNeeded=!1),$.data=generateDummyFr',"554109usxuWq"," will not be created, use rtcDrmFeedFrame to push frames manually","bind","streams","serverCertificateUrl","includes","3473577nNrBJc","slice","URL","serverCertificate","length","Invalid authToken type (","addEventListener","', it's safer to use 'cbcs' instead.","srcObject","ClearKey is not supported by Safari.","meNeeded=$.data};","value","nextKeyFrameAllowedTime","Error recovery attempted","rtcdrmerror","184,32,0,203,255,38,29,217,24,192,161,96,0,0,12,229,174,166,6,7,20,3,84,0,247,96,193,181,229,128,0,32,32]).buffer"," bytes","both","debug","No valid DRM config found, call rtcDrmConfigure first.","dispatchEvent","certificate","mediaBufferMs","clear","merchant","src","sessionId","reportDiscontinuity","mediaBufferMs should be an integer.","Android","rtcDrmConfigure did not specify audioElement, audio will be dropped","/license-proxy-widevine/cenc/","arrayBuffer","). Edge only supports PlayReady, Widevine and ClearKey.","). Chrome only supports Widevine and ClearKey.","buffer","videoStartTimestamp",'audio/mp4; codecs="opus"',"set","175800AyhMKK","PlayReady","SampleAuxInfo extraction failed (audio)","cenc","codec","videoCapabilities",".. ","Duplicate/reordered frame, prev seq: ","bytesSinceKey","wvCertificateUrl","/license-proxy-headerauth/drmtoday/RightsManager.asmx","robustness","baseUrl","type","audioStartTimestamp","emeConfig","com.widevine.alpha","SW_SECURE_CRYPTO","fpsLicenseUrl","supportsRtpScriptTransform","Target video element (","?audioTransformFunction:videoTransformFunction});e.pipeThrough(a).pipeTo(x)}self.RTCTransformEvent&&(self.onrtctr","createObjectURL","playoutDelayHint","POSITIVE_INFINITY",'ame(keyFrameNeeded),e.enqueue($)}function handleTransform($,e,x){let a=new TransformStream({transform:"audio"===$',"track",'video/mp4; codecs="avc1.640032"',"cbcs","keyFrameRequestInterval","Frame gap: ","keyFrameNeededPosted","isWindows","HW_SECURE_ALL"," bytes, ","GOP is getting too long, requesting a new key frame","temporary","Safari does not support Opus, audio will not be rendered.","stringify","byteLength","message"," frame","H264","mediaDumps","h264","keyFrameLogCntr","requestMediaKeySystemAccess(","Safari doesn't support 'cenc'/AES-CTR, use 'cbcs' instead if possible.","isArray","Invalid DRM type (","DRM config iv must be an instance of 16-byte long Uint8Array.","keyId","pipeTo"," - ","receiver","isInteger","toString","onFetch","next"];return(Nn=function(){return n})()}function La(n){const e=re;let t=!1;if((n[e(479)][e(502)]&&n[e(479)].video[e(667)]!==e(572)&&n[e(479)][e(502)][e(599)]==="HW"||n[e(479)][e(504)]&&n[e(479)][e(504)][e(667)]!==e(572)&&n.config[e(504)][e(599)]==="HW")&&(t=!0),n.hwSecurity=t,Ma(n,n[e(479)][e(571)]),n.config[e(523)]===void 0){n[e(479)][e(468)]===void 0&&(n[e(479)][e(468)]="purchase"),n[e(479)][e(575)]===void 0&&(n.config[e(575)]=e(466));const o=window[e(663)](JSON[e(626)]({userId:n[e(479)].userId,sessionId:n.config.sessionId,merchant:n[e(479)].merchant}));Cs(e(670),o)}else Cs(e(687),n[e(479)][e(523)]);for(const o of[n[e(479)][e(504)],n[e(479)][e(502)]])o&&o.encryption!==e(572)&&(o.keyId||(o[e(639)]=Aa),o.iv||(o.iv=Da));n[e(552)]=void 0,n[e(547)]="",n[e(471)]="";const r=n[e(479)][e(464)][e(600)]();var i;if(n[e(479)].type===e(469)?(n[e(677)]="org.w3.clearkey",Pn=ka):n[e(479)][e(601)]===e(686)?(n[e(677)]=e(604),As&&t&&(n[e(677)]+=e(659)),n[e(479)][e(509)]?n[e(552)]=n[e(479)][e(509)]:n[e(479)][e(597)]?n[e(547)]=n.config[e(597)]:n[e(552)]=n.config[e(464)][e(570)](),n[e(479)].wvLicenseUrl?n[e(471)]=n.config[e(465)]:n[e(471)]=r+e(580)):n[e(479)][e(601)]===e(589)?(n.keySystem=e(689),n[e(479)][e(521)]?n[e(471)]=n[e(479)][e(521)]:n[e(471)]=r+e(598)):n.config[e(601)]===e(495)&&(n.keySystem="com.apple.fps",n[e(479)][e(485)]?n[e(552)]=n[e(479)][e(485)]:n[e(479)][e(508)]?n[e(547)]=n.config.fpsCertificateUrl:n[e(547)]=r+e(513)+n[e(479)][e(573)],n[e(479)].fpsLicenseUrl?n[e(471)]=n.config[e(606)]:n[e(471)]=r+"/license-server-fairplay/"),i={licenseUrl:n[e(471)],onFetch:n[e(479)][e(645)]},ht=i,n[e(603)]=[],n[e(479)][e(601)]!==e(495)){n[e(603)].push({initDataTypes:[e(591)],sessionTypes:[e(537),e(624)]});for(const o of[n[e(479)][e(502)],n.config[e(504)]])if(o&&o[e(667)]!==e(572)){const c=o==n.config[e(502)]?e(502):e(504);let a;n.config[e(601)]==="Widevine"?a=o[e(599)]==="HW"?e(621):e(605):n.config[e(601)]==="PlayReady"&&(a=o[e(599)]==="HW"?e(511):"2000"),c==="video"?n[e(603)][0][e(593)]=[{contentType:e(615),encryptionScheme:o[e(667)]===e(591)?e(591):"cbcs-1-9",robustness:a||void 0}]:n[e(603)][0].audioCapabilities=[{contentType:e(586),encryptionScheme:o[e(667)]===e(591)?e(591):e(666),robustness:a||void 0}]}}else n.emeConfig=[{initDataTypes:["sinf"],videoCapabilities:[{contentType:"video/mp4",robustness:""}],distinctiveIdentifier:e(674),persistentState:"not-allowed",sessionTypes:[e(624)]}];de[e(567)](e(650),n)}function Ds(n){const e=re;de[e(567)](e(476));let t=n[e(479)][e(661)];(!n[e(479)][e(502)]||n[e(479)][e(502)][e(667)]===e(572))&&(t=n.config.audioElement),n[e(475)]=null;const r=!n[e(518)]&&n[e(479)].audio&&n[e(479)][e(504)][e(667)]!==e(572),i=n[e(479)][e(502)]&&n[e(479)].video.encryption!==e(572);n[e(596)]=0,n.keyFrameNeeded=!0,n[e(619)]=!1,n[e(617)]=Fn,n[e(585)]=0,n[e(602)]=0,n[e(490)]=-1,n[e(680)]=0,n[e(475)]=new In({node:t,mode:e(r?i?566:504:502),fps:60,drm:n}),Ze&&n[e(479)][e(661)]&&n.config.videoElement.play().then(()=>{})[e(527)](()=>{})}function or(n,e){const t=Nn();return(or=function(r,i){return t[r-=461]})(n,e)}function Pa(n,e){const t=re;n.videoStartTimestamp===0&&(n.videoStartTimestamp=e.timestamp,n[t(617)]=Fn,n[t(561)]=Date.now()+2e3);let r=null,i=!1;if(e[t(662)][t(627)]<=4)de[t(517)]("Discarding corrupted video frame (too small)"),i=!0;else{const a=new Uint8Array(e[t(662)],0,4);a[0]!=0||a[1]!=0||a[2]!=0||a[3]!=1?(de.warn("Discarding corrupted video frame (no Annex B startcode)"),i=!0):(r=function(f,d){const l=Rn,w=new DataView(f.data),g=f.data[l(268)]-2,p=w[l(267)](g);if(p<g){let m=g-p;if(w[l(264)](g-1)!==69)return Ct[l(271)](l(260)),null;if(w[l(264)](m++)>>>4!==1)return Ct[l(271)]("Unsupported SampleAuxInfo version"),null;const R=new Uint8Array(p-2);let M=0,U=0;for(;m<g-1;){let E=w[l(264)](m++);U>1&&E===3&&(U=0,E=w.getUint8(m++)),E!==0?U=0:++U,R[M++]=E}const F=new DataView(R[l(256)]),v=d==="cenc"?16:0,S=v+2+6*F[l(267)](v);return S+2>M?(Ct[l(271)](l(270)),null):{sai:R[l(255)](0,S),offset:g-p,seq:F[l(267)](S)}}return null}(e,n.config[t(502)][t(667)]),!r&&(de.warn(t(498)),i=!0))}if(r)if(e[t(601)]===t(651))n[t(490)]=r.seq;else{if(n[t(490)]===-1)return 0;{let f=r[t(660)]-n[t(490)];if(f<-32767&&(f+=65536),f<=0)return de.debug(t(595)+n.prevSeqNum+", curr: "+r.seq),0;f>1&&(i=e[t(601)]!==t(651),de[t(517)](t(618)+n[t(490)]+t(641)+r[t(660)]+", restart required: "+i)),n.prevSeqNum=r[t(660)]}}let o=0;i&&!n[t(475)][t(530)]&&(o=-1,n[t(475)][t(576)]());const c=(e[t(678)]-n[t(585)])/9e4;return r&&n[t(475)][t(473)]({video:new Uint8Array(e[t(662)],0,r.offset),videoSampleAuxInfo:r[t(536)],timestamp:c})<0&&(o=-1,de[t(517)](t(562)),Ds(n)),o>=0&&e[t(601)]===t(651)&&(n[t(680)]=c),o}function Ua(n){const e=re,t=n[e(479)][e(661)];if(!t||t[e(685)][e(553)]<1||t.paused||t[e(691)]<Ra)return;const r=n[e(479)][e(571)];if(r===void 0||r<0)throw new Error(e(493));const i=t[e(685)].end(t.buffered[e(553)]-1),o=1e3*(i-t[e(691)])|0;if(!n[e(483)]&&function(c,a,f){const d=re;let l;l=a<3*f>>>2?.875:a<=f?1:a<7*f>>>2?1.125:a<9*f>>>2?1.25:a<11*f>>>2?1.375:1.5,l!==c.playbackRate&&(c[d(535)]=l)}(t,o,r),!(o<r+50||o<5*r>>>2))if(n[e(680)]>t[e(691)]+.1){const c=1e3*(i-n.lastKeyFrameTime)|0;c>40&&c>r-100?(de.debug(tr()+e(499)+(t[e(691)]+e(668)+n.lastKeyFrameTime+" (")+(n[e(680)]-t[e(691)])+")"),t[e(691)]=n[e(680)]):de[e(567)](tr()+" too close to seek, "+c)}else!n.keyFrameNeeded&&Date[e(658)]()>n[e(561)]&&o>r+100&&o>3*r>>>1&&(de[e(567)](tr()+e(467)+o+e(688)),n[e(491)]=!0,n[e(617)]<16e3&&(n[e(617)]<<=1))}function Ba(n,e){const t=re;var r;if(!n[t(475)]||n[t(518)])return 0;n[t(602)]===0&&(n.audioStartTimestamp=e[t(678)]);const i=(e[t(678)]-n[t(602)])/48e3;if(((r=n[t(479)][t(504)])===null||r===void 0?void 0:r[t(667)])===t(616))return n.jmuxer[t(473)]({audio:new Uint8Array(e[t(662)]),timestamp:i});const o=function(c){const a=Rn,f=new DataView(c[a(261)]),d=c.data[a(268)]-2,l=f[a(267)](d);if(l<d){let w=d-l;if(f[a(264)](d-1)!==69)return Ct.error("SampleAuxInfo corrupted (postfix not found)"),null;if(f[a(264)](w++)>>>4!==1)return Ct[a(271)]("Unsupported SampleAuxInfo version"),null;const p=new Uint8Array(l-2);let m=0;for(;w<d-1;){const I=f[a(264)](w++);if(p[m++]=I,m>=16)break}return{sai:p,offset:d-l}}return null}(e);return o?n.jmuxer[t(473)]({audio:new Uint8Array(e[t(662)],0,o[t(669)]),audioSampleAuxInfo:o[t(536)],timestamp:i}):(de[t(690)](t(590)),-1)}function Fa(n,e,t){const r=re,i=Ms(t);return n[r(601)]?_n(i,n,e):Vn(i,n,e)}function _n(n,e,t){const r=re;if(n[r(474)][r(502)]){Oe.mediaDumps[r(502)].in[r(510)]&&n[r(474)][r(502)][r(519)](new Uint8Array([0,0,0,1,9,80]));const o=e[r(678)]/90;n[r(474)][r(502)][r(519)](new Uint8Array(e[r(662)]),o)||(n[r(474)][r(502)]=null)}if(n[r(479)][r(502)]&&n[r(479)][r(502)][r(667)]==="clear")return t==null||t[r(533)](e),!1;const i=Date[r(658)]();if(e[r(601)]===r(651)){const o=Oe.logLevel>=4;++n[r(633)]<(o?Number[r(612)]:5)&&(de.debug(tr()+" "+e[r(601)]+", "+e.data.byteLength+r(622)+(r(657)+n.config[r(661)].currentTime)),o&&n.keyFrameLogCntr===1&&function(c,a=64,f=64){const d=re,l=new Uint8Array(c[d(662)]);let w="",g=0;for(let p=0;p<a&&p<l[d(553)];++p)w+=(l[p]<16?"0":"")+l[p][d(644)](16)+" ";if(g<l[d(553)])for(g<l[d(553)]-f&&(w+=d(594),g=l[d(553)]-f);g<l[d(553)];g++)w+=(l[g]<16?"0":"")+l[g][d(644)](16)+" ";de[d(531)]("["+((c[d(601)]||d(504))+d(629))+d(501)+w[d(528)]())}(e,128,8)),n.keyFrameNeeded=!1,n[r(596)]=0,n[r(561)]=i+n[r(617)]}return n[r(596)]+=e[r(662)][r(627)],!n[r(491)]&&n[r(596)]>xa&&(de.info(r(623)),n[r(491)]=!0),n[r(475)]&&(Pa(n,e)<0?n[r(491)]=!0:Ua(n)),t?(!n[r(491)]||!Ca)&&(e[r(662)]=pa(n[r(491)]),t[r(533)](e)):n[r(491)]!=n.keyFrameNeededPosted&&(n[r(500)]&&n.worker.postMessage(n[r(491)]),n.keyFrameNeededPosted=n[r(491)]),n.keyFrameNeeded}function Vn(n,e,t){const r=re;if(n.dbgMediaDump.audio){const i=e[r(678)]/48;n[r(474)][r(504)][r(519)](new Uint8Array(e.data),i)||(n.dbgMediaDump[r(504)]=null)}return n[r(479)].audio&&n[r(479)].audio[r(667)]!==r(572)?e[r(662)][r(627)]>0&&Ba(n,e):t&&t[r(533)](e),!1}function jn(n){const e=re;var t,r,i,o,c;if(!n||typeof n!==e(672))throw new TypeError(e(481));if(!(n.videoElement instanceof HTMLVideoElement))throw new TypeError("Invalid videoElement, it must be an instance of HTMLVideoElement.");if(n[e(526)]&&!(n[e(526)]instanceof HTMLMediaElement))throw new TypeError("Invalid audioElement, it must be an instance of HTMLMediaElement.");if(n[e(571)]!==void 0&&!Number[e(643)](n[e(571)]))throw new TypeError("DRM config mediaBufferMs should be an integer.");let a=!1,f=!1,d=!1;const l=[e(616),"cenc",e(572)],w=["SW","HW"];for(const p of[n.video,n[e(504)]])if(p){if(!l[e(548)](p[e(667)]))throw new RangeError("DRM config encryption value must be one of: "+l[e(529)](", "));if(Ze&&p.encryption===e(591))throw new RangeError(e(635));if(p[e(667)]!=="clear"){if(f=!0,p.keyId){if(!(p[e(639)]instanceof Uint8Array)||p[e(639)][e(553)]!==16)throw new TypeError(e(679));d=!0}else if(Ze)throw new ReferenceError(e(558));if(p.iv&&(!(p.iv instanceof Uint8Array)||p.iv[e(553)]!==16))throw new TypeError(e(638));if(p[e(599)]&&!w[e(548)](p[e(599)]))throw new RangeError("DRM config robustness can only be one of: "+w[e(529)](", "));if(p===n.video&&p.codec!==e(630))throw new RangeError(e(681));Ze&&p===n.audio&&p[e(592)]===e(494)&&(a=!0,de.warn(e(625))),n[e(601)]===e(589)&&(p[e(667)]!=="cenc"&&de[e(517)](e(664)+p[e(667)]+e(556)),n.sessionId===void 0||n[e(575)][e(548)]("f1")||de[e(517)](e(472)+n[e(575)]+", a1d1f1 is recommended)."))}}if(f){const p=[_e[e(652)],_e[e(654)],_e.Production];if(!p[e(548)](n[e(464)]))throw new RangeError("DRM config env value must be one of: "+p.join(", "));if(n[e(523)]&&typeof n.authToken!==e(514))throw new TypeError(e(554)+typeof n[e(523)]+e(534));if(n[e(601)]){if(Ze){if(n.type!=="FairPlay")throw new RangeError(e(637)+n[e(601)]+"). Safari only supports FairPlay.")}else if(ks){if(n[e(601)]!==e(686)&&n.type!=="ClearKey")throw new RangeError(e(637)+n[e(601)]+e(583))}else if(Ts&&n[e(601)]!==e(589)&&n[e(601)]!=="Widevine"&&n[e(601)]!==e(469))throw new RangeError(e(637)+n.type+e(582))}}if(n[e(665)]!==void 0&&(Oe[e(665)]=n[e(665)]),n.mediaDumps!==void 0){if(n.mediaDumps[e(502)]){const p=n[e(631)].video,m=Oe[e(631)][e(502)];!((t=p.in)===null||t===void 0)&&t.durationMs&&(m.in[e(675)]=p.in.durationMs),!((r=p.in)===null||r===void 0)&&r.delimited&&(m.in.delimited=p.in[e(510)]),!((i=p[e(683)])===null||i===void 0)&&i.durationMs&&(m[e(683)][e(675)]=p[e(683)].durationMs)}if(n[e(631)][e(504)]){const p=n[e(631)][e(504)],m=Oe[e(631)][e(504)];!((o=p.in)===null||o===void 0)&&o.durationMs&&(m.in.durationMs=p.in.durationMs),!((c=p.out)===null||c===void 0)&&c[e(675)]&&(m[e(683)][e(675)]=p[e(683)].durationMs)}}let g=ot[e(524)](n[e(661)]);!g&&(g=new Ta(n),ot[e(587)](n.videoElement,g)),g[e(656)]=f,g.ignoreAudio=a,g[e(483)]=!a&&g[e(479)][e(504)]&&g[e(479)][e(504)][e(667)]!==e(572),f&&(g[e(479)][e(601)]||(g[e(479)][e(601)]=Ze?"FairPlay":e(686)),d||g.config.type===e(469)||(g[e(479)][e(601)]=e(469)),La(g),function(p){un(this,void 0,void 0,function*(){const m=or;var I,R;let M=p.config[m(661)];if((!p.config[m(502)]||p[m(479)].video[m(667)]===m(572))&&(M=p[m(479)][m(526)]),!M)throw new Error(m(507));M[m(574)]="",M[m(557)]=null,yield M[m(484)](null);let U=null;try{U=yield navigator[m(461)](p[m(677)],p[m(603)])}catch(v){}if(!U&&p.emeConfig[0]){const v=(I=p.emeConfig[0][m(522)])===null||I===void 0?void 0:I[m(516)](m(537));if(v!==void 0&&v>=0){(R=p[m(603)][0][m(522)])===null||R===void 0||R.splice(v,1);try{U=yield navigator[m(461)](p[m(677)],p[m(603)])}catch(S){}}}if(!U){const v=m(634)+p[m(677)]+") failed";return M[m(569)](new CustomEvent(m(563),{detail:{message:v}})),void de[m(690)](v)}let F=null;try{F=yield U.createMediaKeys()}catch(v){}if(!F){const v="createMediaKeys("+p.keySystem+") failed";return M.dispatchEvent(new CustomEvent(m(563),{detail:{message:v}})),void de[m(690)](v)}if(p.serverCertificate)de[m(567)](m(684)+p[m(552)][m(627)]+" bytes)"),yield F.setServerCertificate(p[m(552)]);else if(p[m(547)]){const v={method:m(487)},S=p.serverCertificateUrl;try{const E=yield p.config[m(645)]?p[m(479)][m(645)](S,v):fetch(S,v);if(!E.ok){const x="Server certificate fetch failed with error "+E[m(649)];return void M[m(569)](new CustomEvent(m(563),{detail:{message:x}}))}const b=yield E[m(581)]();de[m(567)]("Fetched certificate from "+S+", "+b.byteLength+m(565)),yield F.setServerCertificate(b)}catch(E){const b=E.name+": "+E[m(628)];return de[m(690)](b),void M[m(569)](new CustomEvent("rtcdrmerror",{detail:{message:b}}))}}yield M[m(484)](F),M[m(555)](m(492),Ia),Ds(p)})}(g)),g[e(479)][e(661)][e(555)]("play",function(){const p=e;g[p(479)][p(661)][p(691)]>.5&&(g[p(561)]=Date[p(658)]())})}const Oa=re(655)+re(671)+re(477)+re(564)+'),idrFrames.push(idrFrames[0].slice());let $=new Uint8Array(idrFrames[1]);$.set([16,0,50],27)}let idrPicIdToggle=0;function generateDummyFrame($){return(brokenFrame||initializeDummyFrames(),$)?brokenFrame:idrFrames[idrPicIdToggle^=1]}function audioTransformFunction($,e){postMessage({streamType:"audio",frame:{timestamp:$.timestamp,data:$.data}}),e.enqueue($)}let keyFrameNeeded=!1;function videoTransformFunction($,e){postMessage({streamType:"video",f'+re(542)+re(613)+re(609)+re(648)+re(559);function Ms(n){const e=re;if(ot[e(506)]===0)throw new TypeError(e(568));let t;if(n&&n[e(661)])t=n.videoElement;else{if(ot[e(506)]!==1)throw new TypeError("Several DRM configs detected, rtcDrmOnTrack have to be called with target DRM config.");t=ot.keys()[e(646)]()[e(560)]}const r=ot[e(524)](t);if(!r){let i="";throw ot[e(480)]((o,c)=>{i+=c.id+", "}),i=i[e(550)](0,-2),new TypeError(e(608)+t.id+e(515)+i+"]")}return r}function Ls(n,e){const t=re;if(n&&n.config[t(661)]){const r=n.config[t(661)];if(r.buffered[t(553)]>0){const i=r.buffered[t(693)](r.buffered[t(553)]-1)-r.currentTime;e[t(611)]=e.jitterBufferDelayHint=e[t(520)]=i}setTimeout(Ls,1e3,n,e)}}function Na(n,e){const t=re;var r,i;const o=n[t(614)][t(503)];o===t(502)&&(n[t(642)][t(611)]=n.receiver[t(505)]=n[t(642)][t(520)]=0);const c=Ms(e),a=c[t(479)][t(661)],f=c.config.audioElement;if(c.enabled){const d=""+t(Rs?525:470);if(c[t(479)][t(488)])de[t(567)](d+t(544));else{if(de[t(567)](t(676)+d+t(653)),o===t(502)){const l=Oe[t(631)][t(502)].in[t(675)];l>0&&(c.dbgMediaDump[t(502)]=new yn(t(502),t(632),l))}else if(o===t(504)){const l=Oe[t(631)][t(504)].in[t(675)];l>0&&(c[t(474)][t(504)]=new yn(t(504),t(494),l))}if(Rs){if(c[t(500)]=function(l){const w=re,g=window[w(551)]||window.webkitURL,p=window[w(538)],m=window.Worker;if(!(g&&p&&m&&l))return null;const I=new p([l]);return new m(g[w(610)](I))}(Oa),c[t(500)]==null)throw new Error(t(486));c[t(500)][t(463)]=l=>{const w=t;l[w(662)][w(497)]===w(502)?_n(c,l.data.frame,null):Vn(c,l.data.frame,null)},n[t(642)][t(541)]=new RTCRtpScriptTransform(c.worker,{operation:o})}else{const l=o===t(502)?_n:Vn,w={drm:c,transform:(R,M)=>{l(c,R,M)}},g=n[t(642)][t(470)](),p=new TransformStream({transform:w[t(541)][t(545)](w)}),{readable:m,writable:I}=g;m[t(512)](p)[t(640)](I)}}if(o==="audio"&&((r=c.config[t(504)])===null||r===void 0?void 0:r.encryption)===t(572)){if(!f)return void de[t(517)](t(579));f[t(557)]!==n[t(546)][0]&&(f[t(557)]=n.streams[0]),c[t(479)][t(661)]&&(n[t(642)].playoutDelayHint=n.receiver.jitterBufferDelayHint=n[t(642)][t(520)]=c[t(479)][t(571)],Ls(c,n[t(642)]))}else o===t(502)&&((i=c[t(479)][t(502)])===null||i===void 0?void 0:i.encryption)===t(572)&&a[t(557)]!==n[t(546)][0]&&(a.srcObject=n[t(546)][0])}else a[t(557)]!==n[t(546)][0]&&(a.srcObject=n[t(546)][0])}const oe=qe.get("View");oe.setLevel(qe.DEBUG);const qn={metadata:!1,enableDRM:!1,disableVideo:!1,disableAudio:!1,peerConfig:{autoInitStats:!0,statsIntervalMs:1e3}};class _a extends cs{constructor(e,t,r=null,i=!0){e&&oe.warn("The streamName property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, set via token generator"),super(null,t,oe,i),this.payloadTypeCodec={},this.tracksMidValues={},this.drmOptionsMap=null,this.eventQueue=[],this.isMainStreamActive=!1,r&&(this.on(Le.track,o=>{r.srcObject=o.streams[0]}),oe.warn("The mediaElement property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, do this in either the `track` or the `active` broadcast event."))}async connect(e=qn){this.options=je(se(se({},qn),e),{peerConfig:se(se({},qn.peerConfig),e.peerConfig),setSDPToPeer:!1}),this.eventQueue.length=0,await this.initConnection({migrate:!1})}async select(e={}){oe.debug("Viewer select layer values: ",e),await this.signaling.cmd("select",{layer:e}),oe.info("Connected to streamName: ",this.streamName)}async addRemoteTrack(e,t){oe.info("Viewer adding remote track",e);const r=await this.webRTCPeer.addRemoteTrack(e,t);for(const i of t)i.addTrack(r.receiver.track);return r}async project(e,t){for(const r of t){if(!r.trackId&&!r.media)throw oe.error("Error in projection mapping, trackId or mediaId must be set"),new Error("Error in projection mapping, trackId or mediaId must be set");const i=this.webRTCPeer.getRTCPeer();if(r.mediaId&&!i.getTransceivers().find(o=>o.mid===r.mediaId.toString()))throw oe.error("Error in projection mapping, ".concat(r.mediaId," mid not found in local transceivers")),new Error("Error in projection mapping, ".concat(r.mediaId," mid not found in local transceivers"))}oe.debug("Viewer project source: layer mappings: ",e,t),await this.signaling.cmd("project",{sourceId:e,mapping:t}),oe.info("Projection done")}async unproject(e){oe.debug("Viewer unproject mediaIds: ",e),await this.signaling.cmd("unproject",{mediaIds:e}),oe.info("Unprojection done")}async replaceConnection(){oe.info("Migrating current connection"),await this.initConnection({migrate:!0})}stop(){var e,t;super.stop(),(e=this.drmOptionsMap)==null||e.clear(),this.DRMProfile=null,(t=this.worker)==null||t.terminate(),this.worker=null,this.payloadTypeCodec={},this.tracksMidValues={},this.eventQueue.length=0}async initConnection(e){var I;oe.debug("Viewer connect options values: ",this.options),this.stopReconnection=!1;let t;if(e.abrConfiguration&&(e.abrConfiguration.abrStrategy||(e.abrConfiguration.abrStrategy="quality"),e.abrConfiguration.metadata)){const R=e.abrConfiguration.metadata.bitrate;if(R&&R<0)throw new Error("Invalid bitrate ".concat(R," supplied for ABR. The value must be... TBD"))}if(!e.migrate&&this.isActive())throw oe.warn("Viewer currently subscribed"),new Error("Viewer currently subscribed");let r;try{r=await this.tokenGenerator(),this.options.peerConfig.iceServers=r==null?void 0:r.iceServers,this.options.peerConfig.encodedInsertableStreams=sn&&(this.options.enableDRM||this.options.metadata)}catch(R){throw oe.error("Error generating token."),R instanceof Kt&&(R.status===401||!this.autoReconnect?this.stopReconnection=!0:this.reconnect()),R}if(!r)throw oe.error("Error while subscribing. Subscriber data required"),new Error("Subscriber data required");const i=Qi(r.jwt);this.streamName=i.millicast.streamName;const o=new Kr({streamName:this.streamName,url:"".concat(r.urls[0],"?token=").concat(r.jwt)});r.subscriberToken&&(this.subscriberToken=r.subscriberToken);const c=e.migrate?new Je:this.webRTCPeer;await c.createRTCPeer(this.options.peerConfig),(I=this.stopReemitingWebRTCPeerInstanceEvents)==null||I.call(this),this.stopReemitingWebRTCPeerInstanceEvents=_t(c,this,Object.values(Le).filter(R=>R!==Le.track)),this.options.metadata&&(this.worker||(this.worker=new on),this.worker.onmessage=R=>{if(R.data.event==="metadata"){const M=new TextDecoder,U=R.data.metadata;if(U.mid=R.data.mid,U.track=this.tracksMidValues[R.data.mid],U.uuid){const F=U.uuid;U.uuid=F.reduce((v,S)=>v+S.toString(16).padStart(2,"0"),""),U.uuid=U.uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5")}if(U.timecode&&(U.timecode=new Date(M.decode(U.timecode))),U.unregistered){const F=M.decode(U.unregistered);try{const v=JSON.parse(F);U.unregistered=v}catch(v){oe.info("The content could not be converted to JSON, returning raw bytes instead")}}this.emit("metadata",U)}}),c.on(Le.track,R=>{if(!this.isMainStreamActive){this.eventQueue.push(R);return}this.onTrackEvent(R)}),o.on(He.broadcastEvent,async R=>{if(!this.isMainStreamActive&&R.name==="active"){if(this.mainSourceId=R.data.sourceId,!this.DRMProfile&&R.data.encryption){const M=await this.tokenGenerator();M.drmObject&&(this.DRMProfile=M.drmObject)}for(this.emit(He.broadcastEvent,R),this.isMainStreamActive=!0;this.eventQueue.length>0;)this.onTrackEvent(this.eventQueue.shift());return}R.name==="inactive"&&this.isMainStreamActive&&this.mainSourceId===R.data.sourceId&&(this.isMainStreamActive=!1),this.emit(He.broadcastEvent,R)});const a=c.getRTCLocalSDP(je(se({},this.options),{stereo:!0})),f=o.connect();t=await Promise.all([a,f]);const d=t[0];let l=this.signaling;this.signaling=o;const w=this.signaling.subscribe(d,je(se({},this.options),{vad:this.options.multiplexedAudioTracks>0})),g=c.peer.setLocalDescription(c.sessionDescription);t=await Promise.all([w,g]);const p=t[0];this.payloadTypeCodec=Ie.getCodecPayloadType(p),await c.setRTCRemoteSDP(p),oe.info("Connected to streamName: ",this.streamName);let m=this.webRTCPeer;this.webRTCPeer=c,this.setReconnect(),e.migrate&&this.webRTCPeer.on(Le.connectionStateChange,R=>{var M,U;R==="connected"?setTimeout(()=>{var F,v;(F=l==null?void 0:l.close)==null||F.call(l),(v=m==null?void 0:m.closeRTCPeer)==null||v.call(m),l=m=null,oe.info("Current connection migrated")},1e3):["disconnected","failed","closed"].includes(R)&&((M=l==null?void 0:l.close)==null||M.call(l),(U=m==null?void 0:m.closeRTCPeer)==null||U.call(m),l=m=null)})}onTrackEvent(e){var t,r,i;if(this.tracksMidValues[(t=e.transceiver)==null?void 0:t.mid]=e.track,this.isDRMOn){const o=e.transceiver.mid,c=this.getDRMConfiguration(o);try{Na(e,c)}catch(a){oe.error("Failed to apply DRM on media Id:",o,"error is: ",a),this.emit("error",new Error("Failed to apply DRM on media Id: "+o+" error is: "+a))}this.worker||(this.worker=new on),this.worker.addEventListener("message",a=>{a.data.event==="complete"&&Fa(a.data.frame,null,c)})}if(this.options.metadata){if(ds)e.receiver.transform=new RTCRtpScriptTransform(this.worker,{name:"receiverTransform",payloadTypeCodec:se({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(r=e.transceiver)==null?void 0:r.mid});else if(sn){const{readable:o,writable:c}=e.receiver.createEncodedStreams();this.worker.postMessage({action:"insertable-streams-receiver",payloadTypeCodec:se({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(i=e.transceiver)==null?void 0:i.mid,readable:o,writable:c},[o,c])}}this.emit(Le.track,e)}getDRMConfiguration(e){return this.drmOptionsMap?this.drmOptionsMap.get(e):null}async onRtcDrmFetch(e,t){return t.headers||(t.headers=new Headers),t.headers.get("x-dt-custom-data")&&t.headers.delete("x-dt-custom-data"),this.subscriberToken?t.headers.append("Authorization","Bearer ".concat(this.subscriberToken)):oe.warn("onRtcDrmFetch: no subscriberToken"),fetch(e,t)}configureDRM(e){if(!e)throw new Error("Required DRM options is not provided");this.drmOptionsMap||(this.drmOptionsMap=new Map);const t={merchant:"dolby",environment:_e.Production,customTransform:this.options.metadata,videoElement:e.videoElement,audioElement:e.audioElement,video:{codec:"H264",encryption:"cbcs",keyId:hs(e.videoEncryptionParams.keyId),iv:hs(e.videoEncryptionParams.iv)},audio:{codec:"opus",encryption:"clear"},onFetch:this.onRtcDrmFetch.bind(this)};e.mediaBufferMs&&(t.mediaBufferMs=e.mediaBufferMs),this.DRMProfile&&(this.DRMProfile.playReadyUrl&&(t.prLicenseUrl=this.DRMProfile.playReadyUrl),this.DRMProfile.widevineUrl&&(t.wvLicenseUrl=this.DRMProfile.widevineUrl),this.DRMProfile.fairPlayUrl&&(t.fpsLicenseUrl=this.DRMProfile.fairPlayUrl),this.DRMProfile.fairPlayCertUrl&&(t.fpsCertificateUrl=this.DRMProfile.fairPlayCertUrl));try{jn(t),this.drmOptionsMap.set(e.videoMid,t),e.audioMid&&this.drmOptionsMap.set(e.audioMid,t),t.videoElement.addEventListener("rtcdrmerror",r=>{oe.error("DRM error: ",r.detail.message,"in video element:",t.videoElement.id),this.emit("error",new Error(r.detail.message))})}catch(r){oe.error("Failed to configure DRM with options:",e,"error is:",r)}}removeDRMConfiguration(e){var t;(t=this.drmOptionsMap)==null||t.delete(e)}get isDRMOn(){return!!this.drmOptionsMap&&this.drmOptionsMap.size>0}exchangeDRMConfiguration(e,t){const r=this.getDRMConfiguration(e),i=this.getDRMConfiguration(t);if(r===null)throw new Error("No DRM configuration found for "+e);if(i===null)throw new Error("No DRM configuration found for "+t);ps(r.video,i.video,"keyId"),ps(r.video,i.video,"iv");try{jn(r)}catch(o){oe.error("Failed to configure DRM with options:",r,"error is:",o)}try{jn(i)}catch(o){oe.error("Failed to configure DRM with options:",i,"error is:",o)}}}ie.Director=$e,ie.Logger=qe,ie.PeerConnection=Je,ie.Publish=Zo,ie.Signaling=Kr,ie.View=_a,Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"})});
