(function(or){typeof define=="function"&&define.amd?define(or):or()})(function(){"use strict";var or=Object.defineProperty,qs=Object.defineProperties,_s=Object.getOwnPropertyDescriptors,ar=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable,oi=(r,e,t)=>e in r?or(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ne=(r,e)=>{for(var t in e||(e={}))ii.call(e,t)&&oi(r,t,e[t]);if(ar)for(var t of ar(e))si.call(e,t)&&oi(r,t,e[t]);return r},Je=(r,e)=>qs(r,_s(e)),Lt=(r,e)=>{var t={};for(var n in r)ii.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&ar)for(var n of ar(r))e.indexOf(n)<0&&si.call(r,n)&&(t[n]=r[n]);return t},cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ai={exports:{}};/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */(function(r){(function(e){var t={};t.VERSION="1.6.1";var n,i={},a=function(p,b){return function(){return b.apply(p,arguments)}},l=function(){var p=arguments,b=p[0],m,f;for(f=1;f<p.length;f++)for(m in p[f])!(m in b)&&p[f].hasOwnProperty(m)&&(b[m]=p[f][m]);return b},o=function(p,b){return{value:p,name:b}};t.TRACE=o(1,"TRACE"),t.DEBUG=o(2,"DEBUG"),t.INFO=o(3,"INFO"),t.TIME=o(4,"TIME"),t.WARN=o(5,"WARN"),t.ERROR=o(8,"ERROR"),t.OFF=o(99,"OFF");var h=function(p){this.context=p,this.setLevel(p.filterLevel),this.log=this.info};h.prototype={setLevel:function(p){p&&"value"in p&&(this.context.filterLevel=p)},getLevel:function(){return this.context.filterLevel},enabledFor:function(p){var b=this.context.filterLevel;return p.value>=b.value},trace:function(){this.invoke(t.TRACE,arguments)},debug:function(){this.invoke(t.DEBUG,arguments)},info:function(){this.invoke(t.INFO,arguments)},warn:function(){this.invoke(t.WARN,arguments)},error:function(){this.invoke(t.ERROR,arguments)},time:function(p){typeof p=="string"&&p.length>0&&this.invoke(t.TIME,[p,"start"])},timeEnd:function(p){typeof p=="string"&&p.length>0&&this.invoke(t.TIME,[p,"end"])},invoke:function(p,b){n&&this.enabledFor(p)&&n(b,l({level:p},this.context))}};var d=new h({filterLevel:t.OFF});(function(){var p=t;p.enabledFor=a(d,d.enabledFor),p.trace=a(d,d.trace),p.debug=a(d,d.debug),p.time=a(d,d.time),p.timeEnd=a(d,d.timeEnd),p.info=a(d,d.info),p.warn=a(d,d.warn),p.error=a(d,d.error),p.log=p.info})(),t.setHandler=function(p){n=p},t.setLevel=function(p){d.setLevel(p);for(var b in i)i.hasOwnProperty(b)&&i[b].setLevel(p)},t.getLevel=function(){return d.getLevel()},t.get=function(p){return i[p]||(i[p]=new h(l({name:p},d.context)))},t.createDefaultHandler=function(p){p=p||{},p.formatter=p.formatter||function(f,g){g.name&&f.unshift("["+g.name+"]")};var b={},m=function(f,g){Function.prototype.apply.call(f,console,g)};return typeof console>"u"?function(){}:function(f,g){f=Array.prototype.slice.call(f);var y=console.log,S;g.level===t.TIME?(S=(g.name?"["+g.name+"] ":"")+f[0],f[1]==="start"?console.time?console.time(S):b[S]=new Date().getTime():console.timeEnd?console.timeEnd(S):m(y,[S+": "+(new Date().getTime()-b[S])+"ms"])):(g.level===t.WARN&&console.warn?y=console.warn:g.level===t.ERROR&&console.error?y=console.error:g.level===t.INFO&&console.info?y=console.info:g.level===t.DEBUG&&console.debug?y=console.debug:g.level===t.TRACE&&console.trace&&(y=console.trace),p.formatter(f,g),m(y,f))}},t.useDefaults=function(p){t.setLevel(p&&p.defaultLevel||t.DEBUG),t.setHandler(t.createDefaultHandler(p))},t.setDefaults=t.useDefaults,r.exports?r.exports=t:(t._prevLogger=e.Logger,t.noConflict=function(){return e.Logger=t._prevLogger,t},e.Logger=t)})(cr)})(ai);var $s=ai.exports;const tt=Mt($s),ci="0.4.0",lr=60;var li;const eo=((li=window==null?void 0:window.navigator)==null?void 0:li.userAgent)||"No user agent available";let ur="",dr="",pr="",Pt="",Ut="",ui="",hr="",fr=0;const mr=[];function to(r){function e(t,n){return{ts:Math.round(n.timestamp)||"",ot:t==="audio"?"a":"v",bl:n.jitterBufferDelay||0,br:Math.round(n.bitrateBitsPerSecond||0),pld:n.packetsLostDeltaPerSecond||0,j:n.jitter||0,mtp:n.packetRate||0,mid:n.mid||"",mimeType:n.mimeType||""}}return r.stats=r.stats.reduce((t,n)=>{const i=n.audio.inbounds.length!==0?n.audio.inbounds.map(l=>e("audio",l)):n.audio.outbounds.map(l=>e("audio",l)),a=n.video.inbounds.length!==0?n.video.inbounds.map(l=>e("video",l)):n.video.outbounds.map(l=>e("video",l));return t.concat([...i,...a])},[]),r}const Re={initAccountId:r=>{ur=ur===""?r:ur},initStreamName:r=>{dr=dr===""?r:dr},initSubscriberId:r=>{pr=pr===""?r:pr},initStreamViewId:r=>{Pt=Pt===""?r:Pt},initFeedId:r=>{Ut=Ut===""?r:Ut},setConnectionTime:r=>{fr=fr===0?r:fr},setConnectionState:r=>{ui=r},setClusterId:r=>{hr=hr===""?r:hr},addStats:r=>{mr.length===lr&&mr.shift(),mr.push(r)},get:(r=lr,e="JSON")=>{let t;!Number.isInteger(r)||r>lr||r<=0?t=lr:t=r;const n={client:"@millicast/millicast-sdk",version:ci,timestamp:new Date().toISOString(),userAgent:eo,clusterId:hr,accountId:ur,streamName:dr,subscriberId:pr,connection:ui,stats:mr.slice(-t),connectionDurationMs:new Date().getTime()-fr};return Ut!==""?n.feedId=Ut:Pt!==""&&(n.streamViewId=Pt),e==="CMCD"?to(n):n}};tt.useDefaults({defaultLevel:tt.TRACE});const gr=["TRACE","DEBUG","INFO","WARN","ERROR"],di=(r,e)=>{r.unshift("[".concat(e.name||"Global","] ").concat(new Date().toISOString()," - ").concat(e.level.name," -"))},pi=(r,e)=>e?r.value>=rt[e].value:r.value>=br.value,ro=(r,e)=>{r=Array.prototype.slice.call(r),r=r.map(t=>typeof t=="object"?JSON.stringify(t):t),di(r,e),Vt!==0?(gt.push(r.join(" ")),gt.length>=Vt&&(gt=gt.slice(-Vt))):gt=[]},no=tt.createDefaultHandler({formatter:di});tt.setHandler((r,e)=>{ro(r,e),pi(e.level,e.name)&&no(r,e);for(const{handler:t,level:n}of hi)e.level.value>=n.value&&t(r,e)});let Vt=1e4,gt=[],br=tt.OFF;const rt={},hi=[],Ae=Je(ne({},tt),{enabledFor:pi,getHistory:()=>gt,getHistoryMaxSize:()=>Vt,setHistoryMaxSize:r=>{Vt=r},setLevel:r=>{br=r;for(const e in rt)rt[e]=r},getLevel:()=>br,get:r=>{rt[r]||(rt[r]=br);const e=tt.get(r);return e.setLevel=t=>{rt[r]=t},e.getLevel=()=>rt[r],e},setHandler:(r,e)=>{hi.push({handler:r,level:e})},diagnose:(r={})=>{let e;const t={statsCount:60,historySize:1e3,minLogLevel:"TRACE",statsFormat:"JSON"};typeof r=="number"?(t.statsCount=r,e=t):e=ne(ne({},t),r);const{statsCount:n,historySize:i,minLogLevel:a,statsFormat:l}=e,o=Re.get(n,l),h=Ae.getHistory();if(!Number.isInteger(i)||i<=0)throw new Error("Invalid Argument Exception : historySize must be a positive integer.");if(!gr.includes(a.toUpperCase()))throw new Error('Invalid Argument Exception : the minLogLevel parameter only excepts "trace", "debug", "info", "warn", and "error" as arguments.');if(gr.includes(a.toUpperCase())){const d=gr.slice(gr.indexOf(a.toUpperCase())),p=h.filter(b=>d.some(m=>b.includes(m)));o.history=p.slice(-i)}return o},JSON:"JSON",CMCD:"CMCD",VERSION:ci});var Br={exports:{}},bt=typeof Reflect=="object"?Reflect:null,fi=bt&&typeof bt.apply=="function"?bt.apply:function(r,e,t){return Function.prototype.apply.call(r,e,t)},yr;bt&&typeof bt.ownKeys=="function"?yr=bt.ownKeys:Object.getOwnPropertySymbols?yr=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:yr=function(r){return Object.getOwnPropertyNames(r)};function io(r){console&&console.warn&&console.warn(r)}var mi=Number.isNaN||function(r){return r!==r};function z(){z.init.call(this)}Br.exports=z,Br.exports.once=co,z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var gi=10;function vr(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return gi},set:function(r){if(typeof r!="number"||r<0||mi(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");gi=r}}),z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||mi(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function bi(r){return r._maxListeners===void 0?z.defaultMaxListeners:r._maxListeners}z.prototype.getMaxListeners=function(){return bi(this)},z.prototype.emit=function(r){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var n=r==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var o=i[r];if(o===void 0)return!1;if(typeof o=="function")fi(o,this,e);else for(var h=o.length,d=Ii(o,h),t=0;t<h;++t)fi(d[t],this,e);return!0};function yi(r,e,t,n){var i,a,l;if(vr(t),a=r._events,a===void 0?(a=r._events=Object.create(null),r._eventsCount=0):(a.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),a=r._events),l=a[e]),l===void 0)l=a[e]=t,++r._eventsCount;else if(typeof l=="function"?l=a[e]=n?[t,l]:[l,t]:n?l.unshift(t):l.push(t),i=bi(r),i>0&&l.length>i&&!l.warned){l.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=e,o.count=l.length,io(o)}return r}z.prototype.addListener=function(r,e){return yi(this,r,e,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(r,e){return yi(this,r,e,!0)};function so(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function vi(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=so.bind(n);return i.listener=t,n.wrapFn=i,i}z.prototype.once=function(r,e){return vr(e),this.on(r,vi(this,r,e)),this},z.prototype.prependOnceListener=function(r,e){return vr(e),this.prependListener(r,vi(this,r,e)),this},z.prototype.removeListener=function(r,e){var t,n,i,a,l;if(vr(e),n=this._events,n===void 0)return this;if(t=n[r],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[r],n.removeListener&&this.emit("removeListener",r,t.listener||e));else if(typeof t!="function"){for(i=-1,a=t.length-1;a>=0;a--)if(t[a]===e||t[a].listener===e){l=t[a].listener,i=a;break}if(i<0)return this;i===0?t.shift():oo(t,i),t.length===1&&(n[r]=t[0]),n.removeListener!==void 0&&this.emit("removeListener",r,l||e)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.removeAllListeners=function(r){var e,t,n;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[r]),this;if(arguments.length===0){var i=Object.keys(t),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[r],typeof e=="function")this.removeListener(r,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(r,e[n]);return this};function wi(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?ao(i):Ii(i,i.length)}z.prototype.listeners=function(r){return wi(this,r,!0)},z.prototype.rawListeners=function(r){return wi(this,r,!1)},z.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Si.call(r,e)},z.prototype.listenerCount=Si;function Si(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}z.prototype.eventNames=function(){return this._eventsCount>0?yr(this._events):[]};function Ii(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function oo(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function ao(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function co(r,e){return new Promise(function(t,n){function i(l){r.removeListener(e,a),n(l)}function a(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}Ri(r,e,a,{once:!0}),e!=="error"&&lo(r,i,{once:!0})})}function lo(r,e,t){typeof r.on=="function"&&Ri(r,"error",e,t)}function Ri(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(a){n.once&&r.removeEventListener(e,i),t(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Yr=Br.exports;const wr=Mt(Yr);var Or={exports:{}};Or.exports=Ci,Or.exports.filter=po;var uo=Yr.EventEmitter;function Ci(r,e,t){Array.isArray(t)||(t=[t]);var n=[];return t.forEach(function(i){var a=function(){var l=[].slice.call(arguments);l.unshift(i),e.emit.apply(e,l)};n.push(a),r.on(i,a)}),function(){t.forEach(function(i,a){r.removeListener(i,n[a])})}}function po(r,e){var t=new uo;return Ci(r,t,e),t}var ho=Or.exports;const ki=Mt(ho);var Ei={exports:{}};/*! For license information please see webrtc-stats.js.LICENSE.txt */(function(r,e){(function(t,n){r.exports=n()})(self,()=>{return t={7:i=>{var a,l=typeof Reflect=="object"?Reflect:null,o=l&&typeof l.apply=="function"?l.apply:function(v,Z,M){return Function.prototype.apply.call(v,Z,M)};a=l&&typeof l.ownKeys=="function"?l.ownKeys:Object.getOwnPropertySymbols?function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:function(v){return Object.getOwnPropertyNames(v)};var h=Number.isNaN||function(v){return v!=v};function d(){d.init.call(this)}i.exports=d,i.exports.once=function(v,Z){return new Promise(function(M,U){function N(B){v.removeListener(Z,V),U(B)}function V(){typeof v.removeListener=="function"&&v.removeListener("error",N),M([].slice.call(arguments))}L(v,Z,V,{once:!0}),Z!=="error"&&function(B,J){typeof B.on=="function"&&L(B,"error",J,{once:!0})}(v,N)})},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var p=10;function b(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}function m(v){return v._maxListeners===void 0?d.defaultMaxListeners:v._maxListeners}function f(v,Z,M,U){var N,V,B,J;if(b(M),(V=v._events)===void 0?(V=v._events=Object.create(null),v._eventsCount=0):(V.newListener!==void 0&&(v.emit("newListener",Z,M.listener?M.listener:M),V=v._events),B=V[Z]),B===void 0)B=V[Z]=M,++v._eventsCount;else if(typeof B=="function"?B=V[Z]=U?[M,B]:[B,M]:U?B.unshift(M):B.push(M),(N=m(v))>0&&B.length>N&&!B.warned){B.warned=!0;var ue=new Error("Possible EventEmitter memory leak detected. "+B.length+" "+String(Z)+" listeners added. Use emitter.setMaxListeners() to increase limit");ue.name="MaxListenersExceededWarning",ue.emitter=v,ue.type=Z,ue.count=B.length,J=ue,console&&console.warn&&console.warn(J)}return v}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(v,Z,M){var U={fired:!1,wrapFn:void 0,target:v,type:Z,listener:M},N=g.bind(U);return N.listener=M,U.wrapFn=N,N}function S(v,Z,M){var U=v._events;if(U===void 0)return[];var N=U[Z];return N===void 0?[]:typeof N=="function"?M?[N.listener||N]:[N]:M?function(V){for(var B=new Array(V.length),J=0;J<B.length;++J)B[J]=V[J].listener||V[J];return B}(N):x(N,N.length)}function C(v){var Z=this._events;if(Z!==void 0){var M=Z[v];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}function x(v,Z){for(var M=new Array(Z),U=0;U<Z;++U)M[U]=v[U];return M}function L(v,Z,M,U){if(typeof v.on=="function")U.once?v.once(Z,M):v.on(Z,M);else{if(typeof v.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v);v.addEventListener(Z,function N(V){U.once&&v.removeEventListener(Z,N),M(V)})}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(v){if(typeof v!="number"||v<0||h(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");p=v}}),d.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||h(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this},d.prototype.getMaxListeners=function(){return m(this)},d.prototype.emit=function(v){for(var Z=[],M=1;M<arguments.length;M++)Z.push(arguments[M]);var U=v==="error",N=this._events;if(N!==void 0)U=U&&N.error===void 0;else if(!U)return!1;if(U){var V;if(Z.length>0&&(V=Z[0]),V instanceof Error)throw V;var B=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw B.context=V,B}var J=N[v];if(J===void 0)return!1;if(typeof J=="function")o(J,this,Z);else{var ue=J.length,Ge=x(J,ue);for(M=0;M<ue;++M)o(Ge[M],this,Z)}return!0},d.prototype.addListener=function(v,Z){return f(this,v,Z,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(v,Z){return f(this,v,Z,!0)},d.prototype.once=function(v,Z){return b(Z),this.on(v,y(this,v,Z)),this},d.prototype.prependOnceListener=function(v,Z){return b(Z),this.prependListener(v,y(this,v,Z)),this},d.prototype.removeListener=function(v,Z){var M,U,N,V,B;if(b(Z),(U=this._events)===void 0)return this;if((M=U[v])===void 0)return this;if(M===Z||M.listener===Z)--this._eventsCount==0?this._events=Object.create(null):(delete U[v],U.removeListener&&this.emit("removeListener",v,M.listener||Z));else if(typeof M!="function"){for(N=-1,V=M.length-1;V>=0;V--)if(M[V]===Z||M[V].listener===Z){B=M[V].listener,N=V;break}if(N<0)return this;N===0?M.shift():function(J,ue){for(;ue+1<J.length;ue++)J[ue]=J[ue+1];J.pop()}(M,N),M.length===1&&(U[v]=M[0]),U.removeListener!==void 0&&this.emit("removeListener",v,B||Z)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(v){var Z,M,U;if((M=this._events)===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[v]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete M[v]),this;if(arguments.length===0){var N,V=Object.keys(M);for(U=0;U<V.length;++U)(N=V[U])!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(Z=M[v])=="function")this.removeListener(v,Z);else if(Z!==void 0)for(U=Z.length-1;U>=0;U--)this.removeListener(v,Z[U]);return this},d.prototype.listeners=function(v){return S(this,v,!0)},d.prototype.rawListeners=function(v){return S(this,v,!1)},d.listenerCount=function(v,Z){return typeof v.listenerCount=="function"?v.listenerCount(Z):C.call(v,Z)},d.prototype.listenerCount=C,d.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},156:function(i,a,l){var o=this&&this.__createBinding||(Object.create?function(b,m,f,g){g===void 0&&(g=f);var y=Object.getOwnPropertyDescriptor(m,f);y&&!("get"in y?!m.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return m[f]}}),Object.defineProperty(b,g,y)}:function(b,m,f,g){g===void 0&&(g=f),b[g]=m[f]}),h=this&&this.__exportStar||function(b,m){for(var f in b)f==="default"||Object.prototype.hasOwnProperty.call(m,f)||o(m,b,f)},d=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(a,"__esModule",{value:!0}),a.Logger=void 0;var p=l(586);Object.defineProperty(a,"Logger",{enumerable:!0,get:function(){return d(p).default}}),h(l(284),a),h(l(280),a),h(l(738),a),h(l(767),a)},185:(i,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.calculatePacketsLostRatio=a.calculateRate=a.getMediaKind=void 0,a.getMediaKind=l=>{let o=l.kind||l.mediaType;return["audio","video"].includes(o)||l.type!=="inbound-rtp"||(o=l.id.toLocaleLowerCase().includes("video")?"video":"audio"),o},a.calculateRate=(l,o,h,d)=>h&&d?(o-d)/((l-h)/1e3):0,a.calculatePacketsLostRatio=(l,o,h,d)=>{const p=l-(h??0),b=p+(o-(d??0));return b===0?0:p/b}},280:(i,a)=>{Object.defineProperty(a,"__esModule",{value:!0})},284:function(i,a,l){var o,h,d,p,b,m,f,g,y,S,C,x,L,v,Z,M,U=this&&this.__awaiter||function(D,P,G,W){return new(G||(G=Promise))(function(Y,A){function X(ae){try{fe(W.next(ae))}catch(me){A(me)}}function re(ae){try{fe(W.throw(ae))}catch(me){A(me)}}function fe(ae){var me;ae.done?Y(ae.value):(me=ae.value,me instanceof G?me:new G(function(Ne){Ne(me)})).then(X,re)}fe((W=W.apply(D,P||[])).next())})},N=this&&this.__classPrivateFieldSet||function(D,P,G,W,Y){if(W==="m")throw new TypeError("Private method is not writable");if(W==="a"&&!Y)throw new TypeError("Private accessor was defined without a setter");if(typeof P=="function"?D!==P||!Y:!P.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return W==="a"?Y.call(D,G):Y?Y.value=G:P.set(D,G),G},V=this&&this.__classPrivateFieldGet||function(D,P,G,W){if(G==="a"&&!W)throw new TypeError("Private accessor was defined without a getter");if(typeof P=="function"?D!==P||!W:!P.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return G==="m"?W:G==="a"?W.call(D):W?W.value:P.get(D)},B=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(a,"__esModule",{value:!0}),a.WebRTCStats=void 0;const J=l(7),ue=B(l(586)),Ge=l(738),Se=l(185);class xt extends J.EventEmitter{constructor(P){super(),o.add(this),h.set(this,void 0),d.set(this,void 0),p.set(this,void 0),b.set(this,null),m.set(this,void 0),f.set(this,null),this.start=()=>{V(this,m,"f").info("WebRTC statistics collection is starting..."),N(this,f,null,"f"),N(this,b,setInterval(V(this,g,"f"),V(this,d,"f")),"f")},this.stop=()=>{V(this,b,"f")&&(clearInterval(V(this,b,"f")),N(this,b,null,"f"),V(this,m,"f").info("WebRTC statistics collection has stopped."))},g.set(this,()=>U(this,void 0,void 0,function*(){let G,W;try{V(this,m,"f").trace("Requesting WebRTC statistics..."),G=yield V(this,h,"f").call(this),W=new Date().toISOString()}catch(X){return V(this,m,"f").error("Problem collecting the WebRTC statistics.",X),void this.emit("error","Problem collecting the WebRTC statistics - ".concat(X))}const Y=Array.from(G.values()),A={timestamp:W,input:{audio:[],video:[]},output:{audio:[],video:[]}};V(this,p,"f")&&(A.rawStats=G);for(let X=0;X<Object.keys(Y).length;X++){const re=Y[X];switch(re.type){case"outbound-rtp":const fe=re,ae=(0,Se.getMediaKind)(fe);ae==="audio"?yield V(this,o,"m",C).call(this,G,fe,A):ae==="video"&&(yield V(this,o,"m",x).call(this,G,fe,A));break;case"inbound-rtp":const me=re;let Ne=(0,Se.getMediaKind)(me);Ne==="audio"?yield V(this,o,"m",v).call(this,G,me,A):Ne==="video"&&(yield V(this,o,"m",Z).call(this,G,me,A));break;case"candidate-pair":const Le=re;Le.nominated&&V(this,o,"m",M).call(this,Le,A)}}N(this,f,A,"f"),this.emit("stats",A)})),N(this,m,ue.default.get("WebRTCStats"),"f"),N(this,h,P.getStats,"f"),N(this,d,P.getStatsInterval||1e3,"f"),N(this,p,!!P.includeRawStats,"f")}}a.WebRTCStats=xt,h=new WeakMap,d=new WeakMap,p=new WeakMap,b=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,o=new WeakSet,y=function(D,P){if(P){const G=D.get(P);if(G)return{mimeType:G.mimeType}}return{}},S=function(D,P,G){return U(this,void 0,void 0,function*(){var W,Y,A,X;const re=(0,Se.calculateRate)(P.timestamp,P.bytesSent,G==null?void 0:G.timestamp,G==null?void 0:G.totalBytesSent),fe=(0,Se.calculateRate)(P.timestamp,P.packetsSent,G==null?void 0:G.timestamp,G==null?void 0:G.totalPacketsSent),ae=V(this,o,"m",y).call(this,D,P.codecId);return Object.assign({id:P.id,timestamp:P.timestamp,mid:P.mid,totalBytesSent:P.bytesSent,bytesSentDelta:P.bytesSent-((W=G==null?void 0:G.totalBytesSent)!==null&&W!==void 0?W:0),totalPacketsSent:P.packetsSent,packetsSentDelta:P.packetsSent-((Y=G==null?void 0:G.totalPacketsSent)!==null&&Y!==void 0?Y:0),bitrate:re,packetRate:fe,targetBitrate:P.targetBitrate,retransmittedPacketsSent:P.retransmittedPacketsSent,retransmittedPacketsSentDelta:P.retransmittedPacketsSent-((A=G==null?void 0:G.retransmittedPacketsSent)!==null&&A!==void 0?A:0),retransmittedBytesSent:P.retransmittedBytesSent,retransmittedBytesSentDelta:P.retransmittedBytesSent-((X=G==null?void 0:G.retransmittedBytesSent)!==null&&X!==void 0?X:0)},ae)})},C=function(D,P,G){return U(this,void 0,void 0,function*(){var W;const Y=(W=V(this,f,"f"))===null||W===void 0?void 0:W.output.audio.find(re=>re.id===P.id);if(Y&&P.timestamp-Y.timestamp<=0)return;const A=yield V(this,o,"m",S).call(this,D,P,Y),X=Object.assign({},A);G.output.audio.push(X)})},x=function(D,P,G){return U(this,void 0,void 0,function*(){var W;const Y=(W=V(this,f,"f"))===null||W===void 0?void 0:W.output.video.find(fe=>fe.id===P.id);if(Y&&P.timestamp-Y.timestamp<=0)return;const A=yield V(this,o,"m",S).call(this,D,P,Y);let X=Ge.QualityLimitationReason.none;P.qualityLimitationReason&&(X=P.qualityLimitationReason);const re=Object.assign(Object.assign({},A),{frameWidth:P.frameWidth,frameHeight:P.frameHeight,framesPerSecond:P.framesPerSecond,framesSent:P.framesSent,qualityLimitationReason:X,qualityLimitationDurations:P.qualityLimitationDurations});G.output.video.push(re)})},L=function(D,P,G){return U(this,void 0,void 0,function*(){var W,Y;const A=(0,Se.calculateRate)(P.timestamp,P.bytesReceived,G==null?void 0:G.timestamp,G==null?void 0:G.totalBytesReceived),X=(0,Se.calculateRate)(P.timestamp,P.packetsReceived,G==null?void 0:G.timestamp,G==null?void 0:G.totalPacketsReceived),re=(0,Se.calculatePacketsLostRatio)(P.packetsLost,P.packetsReceived,G==null?void 0:G.totalPacketsLost,G==null?void 0:G.totalPacketsReceived),fe=((W=P.packetsLost)!==null&&W!==void 0?W:0)-((Y=G==null?void 0:G.totalPacketsLost)!==null&&Y!==void 0?Y:0),ae=V(this,o,"m",y).call(this,D,P.codecId);return Object.assign({id:P.id,timestamp:P.timestamp,mid:P.mid,trackIdentifier:P.trackIdentifier,jitter:P.jitter,jitterBufferDelay:P.jitterBufferDelay,jitterBufferEmittedCount:P.jitterBufferEmittedCount,totalBytesReceived:P.bytesReceived,totalPacketsReceived:P.packetsReceived,totalPacketsLost:P.packetsLost,bitrate:A,packetRate:X,packetLossRatio:re,packetLossDelta:fe},ae)})},v=function(D,P,G){return U(this,void 0,void 0,function*(){var W;const Y=(W=V(this,f,"f"))===null||W===void 0?void 0:W.input.audio.find(X=>X.id===P.id);if(Y&&P.timestamp-Y.timestamp<=0)return;const A=yield V(this,o,"m",L).call(this,D,P,Y);G.input.audio.push(A)})},Z=function(D,P,G){return U(this,void 0,void 0,function*(){var W;const Y=(W=V(this,f,"f"))===null||W===void 0?void 0:W.input.video.find(re=>re.id===P.id);if(Y&&P.timestamp-Y.timestamp<=0)return;const A=yield V(this,o,"m",L).call(this,D,P,Y),X=Object.assign(Object.assign({},A),{keyFramesDecoded:P.keyFramesDecoded,frameHeight:P.frameHeight,frameWidth:P.frameWidth,framesDecoded:P.framesDecoded,framesDropped:P.framesDropped,framesPerSecond:P.framesPerSecond,framesReceived:P.framesReceived});G.input.video.push(X)})},M=function(D,P){P.totalRoundTripTime=D.totalRoundTripTime,P.currentRoundTripTime=D.currentRoundTripTime,P.responsesReceived=D.responsesReceived,P.availableOutgoingBitrate=D.availableOutgoingBitrate,P.availableIncomingBitrate=D.availableIncomingBitrate}},586:function(i,a,l){var o,h;(function(){var d,p={VERSION:"1.6.1"},b={},m=function(x,L){return function(){return L.apply(x,arguments)}},f=function(){var x,L,v=arguments,Z=v[0];for(L=1;L<v.length;L++)for(x in v[L])!(x in Z)&&v[L].hasOwnProperty(x)&&(Z[x]=v[L][x]);return Z},g=function(x,L){return{value:x,name:L}};p.TRACE=g(1,"TRACE"),p.DEBUG=g(2,"DEBUG"),p.INFO=g(3,"INFO"),p.TIME=g(4,"TIME"),p.WARN=g(5,"WARN"),p.ERROR=g(8,"ERROR"),p.OFF=g(99,"OFF");var y=function(x){this.context=x,this.setLevel(x.filterLevel),this.log=this.info};y.prototype={setLevel:function(x){x&&"value"in x&&(this.context.filterLevel=x)},getLevel:function(){return this.context.filterLevel},enabledFor:function(x){var L=this.context.filterLevel;return x.value>=L.value},trace:function(){this.invoke(p.TRACE,arguments)},debug:function(){this.invoke(p.DEBUG,arguments)},info:function(){this.invoke(p.INFO,arguments)},warn:function(){this.invoke(p.WARN,arguments)},error:function(){this.invoke(p.ERROR,arguments)},time:function(x){typeof x=="string"&&x.length>0&&this.invoke(p.TIME,[x,"start"])},timeEnd:function(x){typeof x=="string"&&x.length>0&&this.invoke(p.TIME,[x,"end"])},invoke:function(x,L){d&&this.enabledFor(x)&&d(L,f({level:x},this.context))}};var S,C=new y({filterLevel:p.OFF});(S=p).enabledFor=m(C,C.enabledFor),S.trace=m(C,C.trace),S.debug=m(C,C.debug),S.time=m(C,C.time),S.timeEnd=m(C,C.timeEnd),S.info=m(C,C.info),S.warn=m(C,C.warn),S.error=m(C,C.error),S.log=S.info,p.setHandler=function(x){d=x},p.setLevel=function(x){for(var L in C.setLevel(x),b)b.hasOwnProperty(L)&&b[L].setLevel(x)},p.getLevel=function(){return C.getLevel()},p.get=function(x){return b[x]||(b[x]=new y(f({name:x},C.context)))},p.createDefaultHandler=function(x){(x=x||{}).formatter=x.formatter||function(Z,M){M.name&&Z.unshift("["+M.name+"]")};var L={},v=function(Z,M){Function.prototype.apply.call(Z,console,M)};return typeof console>"u"?function(){}:function(Z,M){Z=Array.prototype.slice.call(Z);var U,N=console.log;M.level===p.TIME?(U=(M.name?"["+M.name+"] ":"")+Z[0],Z[1]==="start"?console.time?console.time(U):L[U]=new Date().getTime():console.timeEnd?console.timeEnd(U):v(N,[U+": "+(new Date().getTime()-L[U])+"ms"])):(M.level===p.WARN&&console.warn?N=console.warn:M.level===p.ERROR&&console.error?N=console.error:M.level===p.INFO&&console.info?N=console.info:M.level===p.DEBUG&&console.debug?N=console.debug:M.level===p.TRACE&&console.trace&&(N=console.trace),x.formatter(Z,M),v(N,Z))}},p.useDefaults=function(x){p.setLevel(x&&x.defaultLevel||p.DEBUG),p.setHandler(p.createDefaultHandler(x))},p.setDefaults=p.useDefaults,(h=typeof(o=p)=="function"?o.call(a,l,a,i):o)===void 0||(i.exports=h)})()},738:(i,a)=>{var l;Object.defineProperty(a,"__esModule",{value:!0}),a.QualityLimitationReason=void 0,function(o){o[o.none=0]="none",o[o.cpu=1]="cpu",o[o.bandwidth=2]="bandwidth",o[o.other=3]="other"}(l||(a.QualityLimitationReason=l={}))},767:(i,a)=>{Object.defineProperty(a,"__esModule",{value:!0})}},n={},function i(a){var l=n[a];if(l!==void 0)return l.exports;var o=n[a]={exports:{}};return t[a].call(o.exports,o,o.exports,i),o.exports}(156);var t,n})})(Ei);var fo=Ei.exports;const Gt=Ae.get("PeerConnectionStats"),xi={stats:"stats"},mo=r=>{const e=r,t=Lt(e,["input","output","rawStats"]);return Je(ne({},t),{audio:{inbounds:r.input.audio.map(n=>{var i=n,{packetLossRatio:a,packetLossDelta:l,bitrate:o}=i,h=Lt(i,["packetLossRatio","packetLossDelta","bitrate"]);return ne({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:l,bitrateBitsPerSecond:o*8,bitrate:o},h)}),outbounds:r.output.audio.map(n=>{var i=n,{packetLossRatio:a,packetLossDelta:l,bitrate:o}=i,h=Lt(i,["packetLossRatio","packetLossDelta","bitrate"]);return ne({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:l,bitrateBitsPerSecond:o*8,bitrate:o},h)})},video:{inbounds:r.input.video.map(n=>{var i=n,{packetLossRatio:a,packetLossDelta:l,bitrate:o}=i,h=Lt(i,["packetLossRatio","packetLossDelta","bitrate"]);return ne({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:l,bitrateBitsPerSecond:o*8,bitrate:o},h)}),outbounds:r.output.video.map(n=>{var i=n,{packetLossRatio:a,packetLossDelta:l,bitrate:o}=i,h=Lt(i,["packetLossRatio","packetLossDelta","bitrate"]);return ne({packetsLostRatioPerSecond:a,packetsLostDeltaPerSecond:l,bitrateBitsPerSecond:o*8,bitrate:o},h)})},raw:r.rawStats})};class go extends wr{constructor(e,t={statsIntervalMs:1e3,autoInitStats:!0}){super(),this.peer=e,this.collection=null,this.initialized=!1,t.autoInitStats&&this.init(t.statsIntervalMs)}init(e){if(this.initialized){Gt.warn("PeerConnectionStats.init() has already been called. Automatic initialization occurs when the PeerConnectionStats object is constructed.");return}Gt.info("Initializing peer connection stats");const t=this.peer;try{this.collection=new fo.WebRTCStats({getStatsInterval:e,getStats:()=>t.getStats(),includeRawStats:!0}),this.collection.on("stats",n=>{const i=mo(n);Re.addStats(i),this.emit(xi.stats,i)}),this.collection.start(),this.initialized=!0}catch(n){Gt.error(n)}}parseStats(e){return Gt.warn("The parseStats method is deprecated and will be removed in future releases."),null}stop(){Gt.info("Stopping peer connection stats"),this.collection.stop()}}var le={},Oe={},Zi={},Ti={exports:{}},Li=Ti.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var e="candidate:%s %d %s %d %s %d typ %s";return e+=r.raddr!=null?" raddr %s rport %d":"%v%v",e+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(e+=" generation %d"),e+=r["network-id"]!=null?" network-id %d":"%v",e+=r["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var e="ssrc:%d";return r.attribute!=null&&(e+=" %s",r.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var e="mediaclk:";return e+=r.id!=null?"id=%s %s":"%v%s",e+=r.mediaClockValue!=null?"=%s":"",e+=r.rateNumerator!=null?" rate=%s":"",e+=r.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Li).forEach(function(r){var e=Li[r];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var Mi=Ti.exports;(function(r){var e=function(o){return String(Number(o))===o?Number(o):o},t=function(o,h,d,p){if(p&&!d)h[p]=e(o[1]);else for(var b=0;b<d.length;b+=1)o[b+1]!=null&&(h[d[b]]=e(o[b+1]))},n=function(o,h,d){var p=o.name&&o.names;o.push&&!h[o.push]?h[o.push]=[]:p&&!h[o.name]&&(h[o.name]={});var b=o.push?{}:p?h[o.name]:h;t(d.match(o.reg),b,o.names,o.name),o.push&&h[o.push].push(b)},i=Mi,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(o){var h={},d=[],p=h;return o.split(/(\r\n|\r|\n)/).filter(a).forEach(function(b){var m=b[0],f=b.slice(2);m==="m"&&(d.push({rtp:[],fmtp:[]}),p=d[d.length-1]);for(var g=0;g<(i[m]||[]).length;g+=1){var y=i[m][g];if(y.reg.test(f))return n(y,p,f)}}),h.media=d,h};var l=function(o,h){var d=h.split(/=(.+)/,2);return d.length===2?o[d[0]]=e(d[1]):d.length===1&&h.length>1&&(o[d[0]]=void 0),o};r.parseParams=function(o){return o.split(/;\s?/).reduce(l,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(o){return o.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(o){for(var h=[],d=o.split(" ").map(e),p=0;p<d.length;p+=3)h.push({component:d[p],ip:d[p+1],port:d[p+2]});return h},r.parseImageAttributes=function(o){return o.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(l,{})})},r.parseSimulcastStreamList=function(o){return o.split(";").map(function(h){return h.split(",").map(function(d){var p,b=!1;return d[0]!=="~"?p=e(d):(p=e(d.substring(1,d.length)),b=!0),{scid:p,paused:b}})})}})(Zi);var Kr=Mi,bo=/%[sdv%]/g,yo=function(r){var e=1,t=arguments,n=t.length;return r.replace(bo,function(i){if(e>=n)return i;var a=t[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})},Nt=function(r,e,t){var n=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,i=[r+"="+n];if(e.names)for(var a=0;a<e.names.length;a+=1){var l=e.names[a];e.name?i.push(t[e.name][l]):i.push(t[e.names[a]])}else i.push(t[e.name]);return yo.apply(null,i)},vo=["v","o","s","i","u","e","p","c","b","t","r","z","a"],wo=["i","c","b","a"],So=function(r,e){e=e||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var t=e.outerOrder||vo,n=e.innerOrder||wo,i=[];return t.forEach(function(a){Kr[a].forEach(function(l){l.name in r&&r[l.name]!=null?i.push(Nt(a,l,r)):l.push in r&&r[l.push]!=null&&r[l.push].forEach(function(o){i.push(Nt(a,l,o))})})}),r.media.forEach(function(a){i.push(Nt("m",Kr.m[0],a)),n.forEach(function(l){Kr[l].forEach(function(o){o.name in a&&a[o.name]!=null?i.push(Nt(l,o,a)):o.push in a&&a[o.push]!=null&&a[o.push].forEach(function(h){i.push(Nt(l,o,h))})})})}),i.join(`\r
`)+`\r
`},nt=Zi,Io=So;Oe.write=Io,Oe.parse=nt.parse,Oe.parseParams=nt.parseParams,Oe.parseFmtpConfig=nt.parseFmtpConfig,Oe.parsePayloads=nt.parsePayloads,Oe.parseRemoteCandidates=nt.parseRemoteCandidates,Oe.parseImageAttributes=nt.parseImageAttributes,Oe.parseSimulcastStreamList=nt.parseSimulcastStreamList;var Ro=function(r){const e=new Intl.Collator(r,{sensitivity:"base"});return(t,n)=>e.compare(t,n)==0};let Wt=class Ns{constructor(e,t,n,i,a,l,o,h,d){this.foundation=e,this.componentId=t,this.transport=n,this.priority=i,this.address=a,this.port=l,this.type=o,this.relAddr=h,this.relPort=d}equals(e){return e.foundation===this.foundation&&e.componentId===this.componentId&&e.transport===this.transport&&e.priority===this.priority&&e.address===this.address&&e.port===this.port&&e.type===this.type&&e.relAddr===this.relAddr&&e.relPort===this.relPort}clone(){return new Ns(this.foundation,this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.relAddr,this.relPort)}plain(){const e={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type};return this.relAddr&&(e.relAddr=this.relAddr),this.relPort&&(e.relPort=this.relPort),e}getFoundation(){return this.foundation}getComponentId(){return this.componentId}getTransport(){return this.transport}getPriority(){return this.priority}getAddress(){return this.address}getPort(){return this.port}getType(){return this.type}getRelAddr(){return this.relAddr}getRelPort(){return this.relPort}};Wt.expand=function(r){return r.constructor.name==="CandidateInfo"?r:(r=r,new Wt(r.foundation,r.componentId,r.transport,r.priority,r.address,r.port,r.type,r.relAddr,r.relPort))},Wt.clone=function(r){return r.constructor.name==="CandidateInfo"?r.clone():Wt.expand(r)};var Pi=Wt;let At=class Ws{constructor(e,t){this.id=e,this.params=t||[]}clone(){return new Ws(this.id,this.params)}plain(){return this.params.length?{id:this.id,params:this.params}:{id:this.id}}getId(){return this.id}getParams(){return this.params}};At.expand=function(r){return r.constructor.name==="RTCPFeedbackInfo"?r:(r=r,new At(r.id,r.params))},At.clone=function(r){return r.constructor.name==="RTCPFeedbackInfo"?r.clone():At.expand(r)};var jr=At;const Ui=jr;let it=class As{constructor(e,t,n){this.codec=e,this.type=t,this.params={},this.rtcpfbs=new Set,n&&this.addParams(n)}clone(){const e=new As(this.codec,this.type,this.params);this.hasRTX()&&e.setRTX(this.getRTX());for(const t of this.rtcpfbs)e.addRTCPFeedback(t.clone());return this.hasChannels()&&e.setChannels(this.getChannels()),e}plain(){const e={codec:this.codec,type:this.type};this.rtx&&(e.rtx=this.rtx),this.channels&&(e.channels=this.channels),Object.keys(this.params).length&&(e.params=this.params);for(const t of this.rtcpfbs)e.rtcpfbs||(e.rtcpfbs=[]),e.rtcpfbs.push(t.plain());return e}setRTX(e){this.rtx=e}getType(){return this.type}setType(e){this.type=e}getCodec(){return this.codec}getParams(){return this.params}addParams(e){for(const t in e)this.params[t]=e[t]}addParam(e,t){this.params[e]=t}hasParam(e){return Object.hasOwnProperty.call(this.params,e)}getParam(e,t=void 0){if(this.hasParam(e))return this.params[e];if(t===void 0)throw new Error("param ".concat(e," not found and no default value provided"));return""+t}hasRTX(){return this.rtx}getRTX(){return this.rtx}hasChannels(){return this.channels}getChannels(){return this.channels}setChannels(e){this.channels=e}addRTCPFeedback(e){this.rtcpfbs.add(e)}getRTCPFeedbacks(){return this.rtcpfbs}};it.expand=function(r){if(r.constructor.name==="CodecInfo")return r;r=r;const e=new it(r.codec,r.type,r.params);r.rtx&&e.setRTX(r.rtx),r.channels&&e.setChannels(r.channels);for(const t of r.rtcpfbs||[]){const n=Ui.expand(t);e.addRTCPFeedback(n)}return e},it.clone=function(r){return r.constructor.name==="CodecInfo"?r.clone():it.expand(r)},it.MapFromNames=function(r,e,t){var n;const i=new Map;let a=96;for(const l of r){let o;const h=l.split(";"),d=h.shift().toLowerCase().trim();d==="pcmu"?o=0:d==="pcma"?o=8:o=++a;const p=new it(d,o);d==="opus"?p.setChannels(2):d==="multiopus"&&p.setChannels(6),e&&d!=="ulpfec"&&d!=="flexfec-03"&&d!=="red"&&p.setRTX(++a);for(const b of t||[])p.addRTCPFeedback(new Ui(b.id,b.params));for(const b of h){let m=b.split("=");p.addParam(m[0].trim(),(n=m[1])===null||n===void 0?void 0:n.trim())}i.set(o,p)}return i};var Sr=it;function zr(){var r=this;if(!(this instanceof zr))return new(Function.prototype.bind.apply(zr,[null].concat(Array.prototype.slice.call(arguments))));Array.from(arguments).forEach(function(e){r[e]=Symbol.for("MEDOOZE_SEMANTIC_SDP_"+e)})}var Jr=zr;const Co=Jr,se=Co("ACTIVE","PASSIVE","ACTPASS","INACTIVE");se.byValue=function(r){switch(r){case se.ACTIVE:case se.PASSIVE:case se.ACTPASS:case se.INACTIVE:return r}return se[r.toUpperCase()]},se.toString=function(r){switch(r){case se.ACTIVE:return"active";case se.PASSIVE:return"passive";case se.ACTPASS:return"actpass";case se.INACTIVE:return"inactive"}},se.reverse=function(r,e){switch(r){case se.ACTIVE:return se.PASSIVE;case se.PASSIVE:return se.ACTIVE;case se.ACTPASS:return e?se.ACTIVE:se.PASSIVE;case se.INACTIVE:return se.INACTIVE}};var Hr=se;const Qr=Hr;let Dt=class Ds{constructor(e,t,n){this.setup=e,this.hash=t,this.fingerprint=n}clone(){return new Ds(this.setup,this.hash,this.fingerprint)}plain(){return{setup:Qr.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}}getFingerprint(){return this.fingerprint}getHash(){return this.hash}getSetup(){return this.setup}setSetup(e){this.setup=e}};Dt.expand=function(r){return r.constructor.name==="DTLSInfo"?r:(r=r,new Dt(r.setup?Qr.byValue(r.setup):Qr.ACTPASS,r.hash,r.fingerprint))},Dt.clone=function(r){return r.constructor.name==="DTLSInfo"?r.clone():Dt.expand(r)};var Vi=Dt;let Xt=class Xs{constructor(e,t,n,i){this.tag=e,this.suite=t,this.keyParams=n,this.sessionParams=i}clone(){return new Xs(this.tag,this.suite,this.keyParams,this.sessionParams)}plain(){return{tag:this.tag,suite:this.suite,keyParams:this.keyParams,sessionParams:this.sessionParams}}getSessionParams(){return this.sessionParams}getKeyParams(){return this.keyParams}getSuite(){return this.suite}getTag(){return this.tag}};Xt.expand=function(r){return r.constructor.name==="CryptoInfo"?r:(r=r,new Xt(r.tag,r.suite,r.keyParams,r.sessionParams))},Xt.clone=function(r){return r.constructor.name==="CryptoInfo"?r.clone():Xt.expand(r)};var Gi=Xt,qr={exports:{}},_r={exports:{}},Ni={},Ir={};Ir.byteLength=xo,Ir.toByteArray=To,Ir.fromByteArray=Po;for(var De=[],xe=[],ko=typeof Uint8Array<"u"?Uint8Array:Array,$r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yt=0,Eo=$r.length;yt<Eo;++yt)De[yt]=$r[yt],xe[$r.charCodeAt(yt)]=yt;xe[45]=62,xe[95]=63;function Wi(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function xo(r){var e=Wi(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Zo(r,e,t){return(e+t)*3/4-t}function To(r){var e,t=Wi(r),n=t[0],i=t[1],a=new ko(Zo(r,n,i)),l=0,o=i>0?n-4:n,h;for(h=0;h<o;h+=4)e=xe[r.charCodeAt(h)]<<18|xe[r.charCodeAt(h+1)]<<12|xe[r.charCodeAt(h+2)]<<6|xe[r.charCodeAt(h+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=e&255;return i===2&&(e=xe[r.charCodeAt(h)]<<2|xe[r.charCodeAt(h+1)]>>4,a[l++]=e&255),i===1&&(e=xe[r.charCodeAt(h)]<<10|xe[r.charCodeAt(h+1)]<<4|xe[r.charCodeAt(h+2)]>>2,a[l++]=e>>8&255,a[l++]=e&255),a}function Lo(r){return De[r>>18&63]+De[r>>12&63]+De[r>>6&63]+De[r&63]}function Mo(r,e,t){for(var n,i=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),i.push(Lo(n));return i.join("")}function Po(r){for(var e,t=r.length,n=t%3,i=[],a=16383,l=0,o=t-n;l<o;l+=a)i.push(Mo(r,l,l+a>o?o:l+a));return n===1?(e=r[t-1],i.push(De[e>>2]+De[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(De[e>>10]+De[e>>4&63]+De[e<<2&63]+"=")),i.join("")}var en={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */en.read=function(r,e,t,n,i){var a,l,o=i*8-n-1,h=(1<<o)-1,d=h>>1,p=-7,b=t?i-1:0,m=t?-1:1,f=r[e+b];for(b+=m,a=f&(1<<-p)-1,f>>=-p,p+=o;p>0;a=a*256+r[e+b],b+=m,p-=8);for(l=a&(1<<-p)-1,a>>=-p,p+=n;p>0;l=l*256+r[e+b],b+=m,p-=8);if(a===0)a=1-d;else{if(a===h)return l?NaN:(f?-1:1)*(1/0);l=l+Math.pow(2,n),a=a-d}return(f?-1:1)*l*Math.pow(2,a-n)},en.write=function(r,e,t,n,i,a){var l,o,h,d=a*8-i-1,p=(1<<d)-1,b=p>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,g=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,l=p):(l=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-l))<1&&(l--,h*=2),l+b>=1?e+=m/h:e+=m*Math.pow(2,1-b),e*h>=2&&(l++,h/=2),l+b>=p?(o=0,l=p):l+b>=1?(o=(e*h-1)*Math.pow(2,i),l=l+b):(o=e*Math.pow(2,b-1)*Math.pow(2,i),l=0));i>=8;r[t+f]=o&255,f+=g,o/=256,i-=8);for(l=l<<i|o,d+=i;d>0;r[t+f]=l&255,f+=g,l/=256,d-=8);r[t+f-g]|=y*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=Ir,t=en,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=o,r.SlowBuffer=x,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=a(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const s=new Uint8Array(1),c={foo:function(){return 42}};return Object.setPrototypeOf(c,Uint8Array.prototype),Object.setPrototypeOf(s,c),s.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function l(s){if(s>i)throw new RangeError('The value "'+s+'" is invalid for option "size"');const c=new Uint8Array(s);return Object.setPrototypeOf(c,o.prototype),c}function o(s,c,u){if(typeof s=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(s)}return h(s,c,u)}o.poolSize=8192;function h(s,c,u){if(typeof s=="string")return m(s,c);if(ArrayBuffer.isView(s))return g(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(ke(s,ArrayBuffer)||s&&ke(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ke(s,SharedArrayBuffer)||s&&ke(s.buffer,SharedArrayBuffer)))return y(s,c,u);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const w=s.valueOf&&s.valueOf();if(w!=null&&w!==s)return o.from(w,c,u);const R=S(s);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return o.from(s[Symbol.toPrimitive]("string"),c,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}o.from=function(s,c,u){return h(s,c,u)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function d(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function p(s,c,u){return d(s),s<=0?l(s):c!==void 0?typeof u=="string"?l(s).fill(c,u):l(s).fill(c):l(s)}o.alloc=function(s,c,u){return p(s,c,u)};function b(s){return d(s),l(s<0?0:C(s)|0)}o.allocUnsafe=function(s){return b(s)},o.allocUnsafeSlow=function(s){return b(s)};function m(s,c){if((typeof c!="string"||c==="")&&(c="utf8"),!o.isEncoding(c))throw new TypeError("Unknown encoding: "+c);const u=L(s,c)|0;let w=l(u);const R=w.write(s,c);return R!==u&&(w=w.slice(0,R)),w}function f(s){const c=s.length<0?0:C(s.length)|0,u=l(c);for(let w=0;w<c;w+=1)u[w]=s[w]&255;return u}function g(s){if(ke(s,Uint8Array)){const c=new Uint8Array(s);return y(c.buffer,c.byteOffset,c.byteLength)}return f(s)}function y(s,c,u){if(c<0||s.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<c+(u||0))throw new RangeError('"length" is outside of buffer bounds');let w;return c===void 0&&u===void 0?w=new Uint8Array(s):u===void 0?w=new Uint8Array(s,c):w=new Uint8Array(s,c,u),Object.setPrototypeOf(w,o.prototype),w}function S(s){if(o.isBuffer(s)){const c=C(s.length)|0,u=l(c);return u.length===0||s.copy(u,0,0,c),u}if(s.length!==void 0)return typeof s.length!="number"||Ie(s.length)?l(0):f(s);if(s.type==="Buffer"&&Array.isArray(s.data))return f(s.data)}function C(s){if(s>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return s|0}function x(s){return+s!=s&&(s=0),o.alloc(+s)}o.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==o.prototype},o.compare=function(s,c){if(ke(s,Uint8Array)&&(s=o.from(s,s.offset,s.byteLength)),ke(c,Uint8Array)&&(c=o.from(c,c.offset,c.byteLength)),!o.isBuffer(s)||!o.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===c)return 0;let u=s.length,w=c.length;for(let R=0,k=Math.min(u,w);R<k;++R)if(s[R]!==c[R]){u=s[R],w=c[R];break}return u<w?-1:w<u?1:0},o.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(s,c){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return o.alloc(0);let u;if(c===void 0)for(c=0,u=0;u<s.length;++u)c+=s[u].length;const w=o.allocUnsafe(c);let R=0;for(u=0;u<s.length;++u){let k=s[u];if(ke(k,Uint8Array))R+k.length>w.length?(o.isBuffer(k)||(k=o.from(k)),k.copy(w,R)):Uint8Array.prototype.set.call(w,k,R);else if(o.isBuffer(k))k.copy(w,R);else throw new TypeError('"list" argument must be an Array of Buffers');R+=k.length}return w};function L(s,c){if(o.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||ke(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);const u=s.length,w=arguments.length>2&&arguments[2]===!0;if(!w&&u===0)return 0;let R=!1;for(;;)switch(c){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return ht(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Xr(s).length;default:if(R)return w?-1:ht(s).length;c=(""+c).toLowerCase(),R=!0}}o.byteLength=L;function v(s,c,u){let w=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,c>>>=0,u<=c))return"";for(s||(s="utf8");;)switch(s){case"hex":return W(this,c,u);case"utf8":case"utf-8":return Se(this,c,u);case"ascii":return P(this,c,u);case"latin1":case"binary":return G(this,c,u);case"base64":return Ge(this,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,c,u);default:if(w)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),w=!0}}o.prototype._isBuffer=!0;function Z(s,c,u){const w=s[c];s[c]=s[u],s[u]=w}o.prototype.swap16=function(){const s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<s;c+=2)Z(this,c,c+1);return this},o.prototype.swap32=function(){const s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<s;c+=4)Z(this,c,c+3),Z(this,c+1,c+2);return this},o.prototype.swap64=function(){const s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<s;c+=8)Z(this,c,c+7),Z(this,c+1,c+6),Z(this,c+2,c+5),Z(this,c+3,c+4);return this},o.prototype.toString=function(){const s=this.length;return s===0?"":arguments.length===0?Se(this,0,s):v.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(s){if(!o.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:o.compare(this,s)===0},o.prototype.inspect=function(){let s="";const c=r.INSPECT_MAX_BYTES;return s=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(s+=" ... "),"<Buffer "+s+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(s,c,u,w,R){if(ke(s,Uint8Array)&&(s=o.from(s,s.offset,s.byteLength)),!o.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(c===void 0&&(c=0),u===void 0&&(u=s?s.length:0),w===void 0&&(w=0),R===void 0&&(R=this.length),c<0||u>s.length||w<0||R>this.length)throw new RangeError("out of range index");if(w>=R&&c>=u)return 0;if(w>=R)return-1;if(c>=u)return 1;if(c>>>=0,u>>>=0,w>>>=0,R>>>=0,this===s)return 0;let k=R-w,T=u-c;const j=Math.min(k,T),ce=this.slice(w,R),Q=s.slice(c,u);for(let ee=0;ee<j;++ee)if(ce[ee]!==Q[ee]){k=ce[ee],T=Q[ee];break}return k<T?-1:T<k?1:0};function M(s,c,u,w,R){if(s.length===0)return-1;if(typeof u=="string"?(w=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,Ie(u)&&(u=R?0:s.length-1),u<0&&(u=s.length+u),u>=s.length){if(R)return-1;u=s.length-1}else if(u<0)if(R)u=0;else return-1;if(typeof c=="string"&&(c=o.from(c,w)),o.isBuffer(c))return c.length===0?-1:U(s,c,u,w,R);if(typeof c=="number")return c=c&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(s,c,u):Uint8Array.prototype.lastIndexOf.call(s,c,u):U(s,[c],u,w,R);throw new TypeError("val must be string, number or Buffer")}function U(s,c,u,w,R){let k=1,T=s.length,j=c.length;if(w!==void 0&&(w=String(w).toLowerCase(),w==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(s.length<2||c.length<2)return-1;k=2,T/=2,j/=2,u/=2}function ce(ee,de){return k===1?ee[de]:ee.readUInt16BE(de*k)}let Q;if(R){let ee=-1;for(Q=u;Q<T;Q++)if(ce(s,Q)===ce(c,ee===-1?0:Q-ee)){if(ee===-1&&(ee=Q),Q-ee+1===j)return ee*k}else ee!==-1&&(Q-=Q-ee),ee=-1}else for(u+j>T&&(u=T-j),Q=u;Q>=0;Q--){let ee=!0;for(let de=0;de<j;de++)if(ce(s,Q+de)!==ce(c,de)){ee=!1;break}if(ee)return Q}return-1}o.prototype.includes=function(s,c,u){return this.indexOf(s,c,u)!==-1},o.prototype.indexOf=function(s,c,u){return M(this,s,c,u,!0)},o.prototype.lastIndexOf=function(s,c,u){return M(this,s,c,u,!1)};function N(s,c,u,w){u=Number(u)||0;const R=s.length-u;w?(w=Number(w),w>R&&(w=R)):w=R;const k=c.length;w>k/2&&(w=k/2);let T;for(T=0;T<w;++T){const j=parseInt(c.substr(T*2,2),16);if(Ie(j))return T;s[u+T]=j}return T}function V(s,c,u,w){return mt(ht(c,s.length-u),s,u,w)}function B(s,c,u,w){return mt(ft(c),s,u,w)}function J(s,c,u,w){return mt(Xr(c),s,u,w)}function ue(s,c,u,w){return mt(Tt(c,s.length-u),s,u,w)}o.prototype.write=function(s,c,u,w){if(c===void 0)w="utf8",u=this.length,c=0;else if(u===void 0&&typeof c=="string")w=c,u=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(u)?(u=u>>>0,w===void 0&&(w="utf8")):(w=u,u=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const R=this.length-c;if((u===void 0||u>R)&&(u=R),s.length>0&&(u<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");w||(w="utf8");let k=!1;for(;;)switch(w){case"hex":return N(this,s,c,u);case"utf8":case"utf-8":return V(this,s,c,u);case"ascii":case"latin1":case"binary":return B(this,s,c,u);case"base64":return J(this,s,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ue(this,s,c,u);default:if(k)throw new TypeError("Unknown encoding: "+w);w=(""+w).toLowerCase(),k=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ge(s,c,u){return c===0&&u===s.length?e.fromByteArray(s):e.fromByteArray(s.slice(c,u))}function Se(s,c,u){u=Math.min(s.length,u);const w=[];let R=c;for(;R<u;){const k=s[R];let T=null,j=k>239?4:k>223?3:k>191?2:1;if(R+j<=u){let ce,Q,ee,de;switch(j){case 1:k<128&&(T=k);break;case 2:ce=s[R+1],(ce&192)===128&&(de=(k&31)<<6|ce&63,de>127&&(T=de));break;case 3:ce=s[R+1],Q=s[R+2],(ce&192)===128&&(Q&192)===128&&(de=(k&15)<<12|(ce&63)<<6|Q&63,de>2047&&(de<55296||de>57343)&&(T=de));break;case 4:ce=s[R+1],Q=s[R+2],ee=s[R+3],(ce&192)===128&&(Q&192)===128&&(ee&192)===128&&(de=(k&15)<<18|(ce&63)<<12|(Q&63)<<6|ee&63,de>65535&&de<1114112&&(T=de))}}T===null?(T=65533,j=1):T>65535&&(T-=65536,w.push(T>>>10&1023|55296),T=56320|T&1023),w.push(T),R+=j}return D(w)}const xt=4096;function D(s){const c=s.length;if(c<=xt)return String.fromCharCode.apply(String,s);let u="",w=0;for(;w<c;)u+=String.fromCharCode.apply(String,s.slice(w,w+=xt));return u}function P(s,c,u){let w="";u=Math.min(s.length,u);for(let R=c;R<u;++R)w+=String.fromCharCode(s[R]&127);return w}function G(s,c,u){let w="";u=Math.min(s.length,u);for(let R=c;R<u;++R)w+=String.fromCharCode(s[R]);return w}function W(s,c,u){const w=s.length;(!c||c<0)&&(c=0),(!u||u<0||u>w)&&(u=w);let R="";for(let k=c;k<u;++k)R+=et[s[k]];return R}function Y(s,c,u){const w=s.slice(c,u);let R="";for(let k=0;k<w.length-1;k+=2)R+=String.fromCharCode(w[k]+w[k+1]*256);return R}o.prototype.slice=function(s,c){const u=this.length;s=~~s,c=c===void 0?u:~~c,s<0?(s+=u,s<0&&(s=0)):s>u&&(s=u),c<0?(c+=u,c<0&&(c=0)):c>u&&(c=u),c<s&&(c=s);const w=this.subarray(s,c);return Object.setPrototypeOf(w,o.prototype),w};function A(s,c,u){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+c>u)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(s,c,u){s=s>>>0,c=c>>>0,u||A(s,c,this.length);let w=this[s],R=1,k=0;for(;++k<c&&(R*=256);)w+=this[s+k]*R;return w},o.prototype.readUintBE=o.prototype.readUIntBE=function(s,c,u){s=s>>>0,c=c>>>0,u||A(s,c,this.length);let w=this[s+--c],R=1;for(;c>0&&(R*=256);)w+=this[s+--c]*R;return w},o.prototype.readUint8=o.prototype.readUInt8=function(s,c){return s=s>>>0,c||A(s,1,this.length),this[s]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(s,c){return s=s>>>0,c||A(s,2,this.length),this[s]|this[s+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(s,c){return s=s>>>0,c||A(s,2,this.length),this[s]<<8|this[s+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(s,c){return s=s>>>0,c||A(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(s,c){return s=s>>>0,c||A(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},o.prototype.readBigUInt64LE=Ee(function(s){s=s>>>0,We(s,"offset");const c=this[s],u=this[s+7];(c===void 0||u===void 0)&&_e(s,this.length-8);const w=c+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24,R=this[++s]+this[++s]*2**8+this[++s]*2**16+u*2**24;return BigInt(w)+(BigInt(R)<<BigInt(32))}),o.prototype.readBigUInt64BE=Ee(function(s){s=s>>>0,We(s,"offset");const c=this[s],u=this[s+7];(c===void 0||u===void 0)&&_e(s,this.length-8);const w=c*2**24+this[++s]*2**16+this[++s]*2**8+this[++s],R=this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+u;return(BigInt(w)<<BigInt(32))+BigInt(R)}),o.prototype.readIntLE=function(s,c,u){s=s>>>0,c=c>>>0,u||A(s,c,this.length);let w=this[s],R=1,k=0;for(;++k<c&&(R*=256);)w+=this[s+k]*R;return R*=128,w>=R&&(w-=Math.pow(2,8*c)),w},o.prototype.readIntBE=function(s,c,u){s=s>>>0,c=c>>>0,u||A(s,c,this.length);let w=c,R=1,k=this[s+--w];for(;w>0&&(R*=256);)k+=this[s+--w]*R;return R*=128,k>=R&&(k-=Math.pow(2,8*c)),k},o.prototype.readInt8=function(s,c){return s=s>>>0,c||A(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},o.prototype.readInt16LE=function(s,c){s=s>>>0,c||A(s,2,this.length);const u=this[s]|this[s+1]<<8;return u&32768?u|4294901760:u},o.prototype.readInt16BE=function(s,c){s=s>>>0,c||A(s,2,this.length);const u=this[s+1]|this[s]<<8;return u&32768?u|4294901760:u},o.prototype.readInt32LE=function(s,c){return s=s>>>0,c||A(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},o.prototype.readInt32BE=function(s,c){return s=s>>>0,c||A(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},o.prototype.readBigInt64LE=Ee(function(s){s=s>>>0,We(s,"offset");const c=this[s],u=this[s+7];(c===void 0||u===void 0)&&_e(s,this.length-8);const w=this[s+4]+this[s+5]*2**8+this[s+6]*2**16+(u<<24);return(BigInt(w)<<BigInt(32))+BigInt(c+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24)}),o.prototype.readBigInt64BE=Ee(function(s){s=s>>>0,We(s,"offset");const c=this[s],u=this[s+7];(c===void 0||u===void 0)&&_e(s,this.length-8);const w=(c<<24)+this[++s]*2**16+this[++s]*2**8+this[++s];return(BigInt(w)<<BigInt(32))+BigInt(this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+u)}),o.prototype.readFloatLE=function(s,c){return s=s>>>0,c||A(s,4,this.length),t.read(this,s,!0,23,4)},o.prototype.readFloatBE=function(s,c){return s=s>>>0,c||A(s,4,this.length),t.read(this,s,!1,23,4)},o.prototype.readDoubleLE=function(s,c){return s=s>>>0,c||A(s,8,this.length),t.read(this,s,!0,52,8)},o.prototype.readDoubleBE=function(s,c){return s=s>>>0,c||A(s,8,this.length),t.read(this,s,!1,52,8)};function X(s,c,u,w,R,k){if(!o.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>R||c<k)throw new RangeError('"value" argument is out of bounds');if(u+w>s.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(s,c,u,w){if(s=+s,c=c>>>0,u=u>>>0,!w){const T=Math.pow(2,8*u)-1;X(this,s,c,u,T,0)}let R=1,k=0;for(this[c]=s&255;++k<u&&(R*=256);)this[c+k]=s/R&255;return c+u},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(s,c,u,w){if(s=+s,c=c>>>0,u=u>>>0,!w){const T=Math.pow(2,8*u)-1;X(this,s,c,u,T,0)}let R=u-1,k=1;for(this[c+R]=s&255;--R>=0&&(k*=256);)this[c+R]=s/k&255;return c+u},o.prototype.writeUint8=o.prototype.writeUInt8=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,1,255,0),this[c]=s&255,c+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,2,65535,0),this[c]=s&255,this[c+1]=s>>>8,c+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,2,65535,0),this[c]=s>>>8,this[c+1]=s&255,c+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,4,4294967295,0),this[c+3]=s>>>24,this[c+2]=s>>>16,this[c+1]=s>>>8,this[c]=s&255,c+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,4,4294967295,0),this[c]=s>>>24,this[c+1]=s>>>16,this[c+2]=s>>>8,this[c+3]=s&255,c+4};function re(s,c,u,w,R){Dr(c,w,R,s,u,7);let k=Number(c&BigInt(4294967295));s[u++]=k,k=k>>8,s[u++]=k,k=k>>8,s[u++]=k,k=k>>8,s[u++]=k;let T=Number(c>>BigInt(32)&BigInt(4294967295));return s[u++]=T,T=T>>8,s[u++]=T,T=T>>8,s[u++]=T,T=T>>8,s[u++]=T,u}function fe(s,c,u,w,R){Dr(c,w,R,s,u,7);let k=Number(c&BigInt(4294967295));s[u+7]=k,k=k>>8,s[u+6]=k,k=k>>8,s[u+5]=k,k=k>>8,s[u+4]=k;let T=Number(c>>BigInt(32)&BigInt(4294967295));return s[u+3]=T,T=T>>8,s[u+2]=T,T=T>>8,s[u+1]=T,T=T>>8,s[u]=T,u+8}o.prototype.writeBigUInt64LE=Ee(function(s,c=0){return re(this,s,c,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Ee(function(s,c=0){return fe(this,s,c,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(s,c,u,w){if(s=+s,c=c>>>0,!w){const j=Math.pow(2,8*u-1);X(this,s,c,u,j-1,-j)}let R=0,k=1,T=0;for(this[c]=s&255;++R<u&&(k*=256);)s<0&&T===0&&this[c+R-1]!==0&&(T=1),this[c+R]=(s/k>>0)-T&255;return c+u},o.prototype.writeIntBE=function(s,c,u,w){if(s=+s,c=c>>>0,!w){const j=Math.pow(2,8*u-1);X(this,s,c,u,j-1,-j)}let R=u-1,k=1,T=0;for(this[c+R]=s&255;--R>=0&&(k*=256);)s<0&&T===0&&this[c+R+1]!==0&&(T=1),this[c+R]=(s/k>>0)-T&255;return c+u},o.prototype.writeInt8=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,1,127,-128),s<0&&(s=255+s+1),this[c]=s&255,c+1},o.prototype.writeInt16LE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,2,32767,-32768),this[c]=s&255,this[c+1]=s>>>8,c+2},o.prototype.writeInt16BE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,2,32767,-32768),this[c]=s>>>8,this[c+1]=s&255,c+2},o.prototype.writeInt32LE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,4,2147483647,-2147483648),this[c]=s&255,this[c+1]=s>>>8,this[c+2]=s>>>16,this[c+3]=s>>>24,c+4},o.prototype.writeInt32BE=function(s,c,u){return s=+s,c=c>>>0,u||X(this,s,c,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[c]=s>>>24,this[c+1]=s>>>16,this[c+2]=s>>>8,this[c+3]=s&255,c+4},o.prototype.writeBigInt64LE=Ee(function(s,c=0){return re(this,s,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Ee(function(s,c=0){return fe(this,s,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ae(s,c,u,w,R,k){if(u+w>s.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function me(s,c,u,w,R){return c=+c,u=u>>>0,R||ae(s,c,u,4),t.write(s,c,u,w,23,4),u+4}o.prototype.writeFloatLE=function(s,c,u){return me(this,s,c,!0,u)},o.prototype.writeFloatBE=function(s,c,u){return me(this,s,c,!1,u)};function Ne(s,c,u,w,R){return c=+c,u=u>>>0,R||ae(s,c,u,8),t.write(s,c,u,w,52,8),u+8}o.prototype.writeDoubleLE=function(s,c,u){return Ne(this,s,c,!0,u)},o.prototype.writeDoubleBE=function(s,c,u){return Ne(this,s,c,!1,u)},o.prototype.copy=function(s,c,u,w){if(!o.isBuffer(s))throw new TypeError("argument should be a Buffer");if(u||(u=0),!w&&w!==0&&(w=this.length),c>=s.length&&(c=s.length),c||(c=0),w>0&&w<u&&(w=u),w===u||s.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(u<0||u>=this.length)throw new RangeError("Index out of range");if(w<0)throw new RangeError("sourceEnd out of bounds");w>this.length&&(w=this.length),s.length-c<w-u&&(w=s.length-c+u);const R=w-u;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(c,u,w):Uint8Array.prototype.set.call(s,this.subarray(u,w),c),R},o.prototype.fill=function(s,c,u,w){if(typeof s=="string"){if(typeof c=="string"?(w=c,c=0,u=this.length):typeof u=="string"&&(w=u,u=this.length),w!==void 0&&typeof w!="string")throw new TypeError("encoding must be a string");if(typeof w=="string"&&!o.isEncoding(w))throw new TypeError("Unknown encoding: "+w);if(s.length===1){const k=s.charCodeAt(0);(w==="utf8"&&k<128||w==="latin1")&&(s=k)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(c<0||this.length<c||this.length<u)throw new RangeError("Out of range index");if(u<=c)return this;c=c>>>0,u=u===void 0?this.length:u>>>0,s||(s=0);let R;if(typeof s=="number")for(R=c;R<u;++R)this[R]=s;else{const k=o.isBuffer(s)?s:o.from(s,w),T=k.length;if(T===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(R=0;R<u-c;++R)this[R+c]=k[R%T]}return this};const Le={};function Zt(s,c,u){Le[s]=class extends u{constructor(){super(),Object.defineProperty(this,"message",{value:c.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(s,"]"),this.stack,delete this.name}get code(){return s}set code(w){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:w,writable:!0})}toString(){return"".concat(this.name," [").concat(s,"]: ").concat(this.message)}}}Zt("ERR_BUFFER_OUT_OF_BOUNDS",function(s){return s?"".concat(s," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),Zt("ERR_INVALID_ARG_TYPE",function(s,c){return'The "'.concat(s,'" argument must be of type number. Received type ').concat(typeof c)},TypeError),Zt("ERR_OUT_OF_RANGE",function(s,c,u){let w='The value of "'.concat(s,'" is out of range.'),R=u;return Number.isInteger(u)&&Math.abs(u)>2**32?R=sr(String(u)):typeof u=="bigint"&&(R=String(u),(u>BigInt(2)**BigInt(32)||u<-(BigInt(2)**BigInt(32)))&&(R=sr(R)),R+="n"),w+=" It must be ".concat(c,". Received ").concat(R),w},RangeError);function sr(s){let c="",u=s.length;const w=s[0]==="-"?1:0;for(;u>=w+4;u-=3)c="_".concat(s.slice(u-3,u)).concat(c);return"".concat(s.slice(0,u)).concat(c)}function Ar(s,c,u){We(c,"offset"),(s[c]===void 0||s[c+u]===void 0)&&_e(c,s.length-(u+1))}function Dr(s,c,u,w,R,k){if(s>u||s<c){const T=typeof c=="bigint"?"n":"";let j;throw c===0||c===BigInt(0)?j=">= 0".concat(T," and < 2").concat(T," ** ").concat((k+1)*8).concat(T):j=">= -(2".concat(T," ** ").concat((k+1)*8-1).concat(T,") and < 2 ** ")+"".concat((k+1)*8-1).concat(T),new Le.ERR_OUT_OF_RANGE("value",j,s)}Ar(w,R,k)}function We(s,c){if(typeof s!="number")throw new Le.ERR_INVALID_ARG_TYPE(c,"number",s)}function _e(s,c,u){throw Math.floor(s)!==s?(We(s,u),new Le.ERR_OUT_OF_RANGE("offset","an integer",s)):c<0?new Le.ERR_BUFFER_OUT_OF_BOUNDS:new Le.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(c),s)}const $e=/[^+/0-9A-Za-z-_]/g;function ri(s){if(s=s.split("=")[0],s=s.trim().replace($e,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function ht(s,c){c=c||1/0;let u;const w=s.length;let R=null;const k=[];for(let T=0;T<w;++T){if(u=s.charCodeAt(T),u>55295&&u<57344){if(!R){if(u>56319){(c-=3)>-1&&k.push(239,191,189);continue}else if(T+1===w){(c-=3)>-1&&k.push(239,191,189);continue}R=u;continue}if(u<56320){(c-=3)>-1&&k.push(239,191,189),R=u;continue}u=(R-55296<<10|u-56320)+65536}else R&&(c-=3)>-1&&k.push(239,191,189);if(R=null,u<128){if((c-=1)<0)break;k.push(u)}else if(u<2048){if((c-=2)<0)break;k.push(u>>6|192,u&63|128)}else if(u<65536){if((c-=3)<0)break;k.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((c-=4)<0)break;k.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return k}function ft(s){const c=[];for(let u=0;u<s.length;++u)c.push(s.charCodeAt(u)&255);return c}function Tt(s,c){let u,w,R;const k=[];for(let T=0;T<s.length&&!((c-=2)<0);++T)u=s.charCodeAt(T),w=u>>8,R=u%256,k.push(R),k.push(w);return k}function Xr(s){return e.toByteArray(ri(s))}function mt(s,c,u,w){let R;for(R=0;R<w&&!(R+u>=c.length||R>=s.length);++R)c[R+u]=s[R];return R}function ke(s,c){return s instanceof c||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===c.name}function Ie(s){return s!==s}const et=function(){const s="0123456789abcdef",c=new Array(256);for(let u=0;u<16;++u){const w=u*16;for(let R=0;R<16;++R)c[w+R]=s[u]+s[R]}return c}();function Ee(s){return typeof BigInt>"u"?O:s}function O(){throw new Error("BigInt not supported")}})(Ni);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(r,e){var t=Ni,n=t.Buffer;function i(l,o){for(var h in l)o[h]=l[h]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(i(t,e),e.Buffer=a);function a(l,o,h){return n(l,o,h)}a.prototype=Object.create(n.prototype),i(n,a),a.from=function(l,o,h){if(typeof l=="number")throw new TypeError("Argument must not be a number");return n(l,o,h)},a.alloc=function(l,o,h){if(typeof l!="number")throw new TypeError("Argument must be a number");var d=n(l);return o!==void 0?typeof h=="string"?d.fill(o,h):d.fill(o):d.fill(0),d},a.allocUnsafe=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return n(l)},a.allocUnsafeSlow=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(l)}})(_r,_r.exports);var Uo=_r.exports,tn=65536,Vo=4294967295;function Go(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var No=Uo.Buffer,Rr=cr.crypto||cr.msCrypto;Rr&&Rr.getRandomValues?qr.exports=Wo:qr.exports=Go;function Wo(r,e){if(r>Vo)throw new RangeError("requested too many random bytes");var t=No.allocUnsafe(r);if(r>0)if(r>tn)for(var n=0;n<r;n+=tn)Rr.getRandomValues(t.slice(n,n+tn));else Rr.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}var Ao=qr.exports;const Ai=Ao;let st=class Fs{constructor(e,t){this.ufrag=e,this.pwd=t,this.lite=!1,this.endOfCandidates=!1}clone(){const e=new Fs(this.ufrag,this.pwd);return e.setLite(this.lite),e.setEndOfCandidates(this.endOfCandidates),e}plain(){const e={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(e.lite=this.lite),this.endOfCandidates&&(e.endOfCandidates=this.endOfCandidates),e}getUfrag(){return this.ufrag}getPwd(){return this.pwd}isLite(){return this.lite}setLite(e){this.lite=e}isEndOfCandidates(){return this.endOfCandidates}setEndOfCandidates(e){this.endOfCandidates=e}};st.generate=function(r){const e=new st,t=Ai(8),n=Ai(24);return e.ufrag=t.toString("hex"),e.pwd=n.toString("hex"),e.lite=r,e},st.expand=function(r){if(r.constructor.name==="ICEInfo")return r;r=r;const e=new st(r.ufrag,r.pwd);return e.setLite(r.lite),e.setEndOfCandidates(r.endOfCandidates),e},st.clone=function(r){return r.constructor.name==="ICEInfo"?r.clone():st.expand(r)};var Di=st;const Do=Jr,Me=Do("SEND","RECV");Me.byValue=function(r){return Me[r.toUpperCase()]},Me.toString=function(r){switch(r){case Me.SEND:return"send";case Me.RECV:return"recv"}},Me.reverse=function(r){switch(r){case Me.SEND:return Me.RECV;case Me.RECV:return Me.SEND}};var Cr=Me;const Xi=Cr;let Ft=class Bs{constructor(e,t){this.id=e,this.direction=t,this.formats=[],this.params=new Map}clone(){var e=new Bs(this.id,this.direction);return e.setFormats(this.formats),e.setParams(this.params),e}plain(){var e={id:this.id,direction:Xi.toString(this.direction)};this.formats&&(e.formats=this.formats);for(var[t,n]of this.params.entries())e.params||(e.params={}),e.params[t]=n;return e}getId(){return this.id}getDirection(){return this.direction}setDirection(e){this.direction=e}getFormats(){return this.formats}setFormats(e){this.formats=[];for(let t=0;t<e.length;++t)this.formats.push(parseInt(e[t]))}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,t){this.params.set(e,t)}};Ft.expand=function(r){if(r.constructor.name==="RIDInfo")return r;r=r;const e=new Ft(r.id,Xi.byValue(r.direction));for(const[t,n]of Object.entries(r.params||{}))e.addParam(t,n);return r.formats&&e.setFormats(r.formats),e},Ft.clone=function(r){return r.constructor.name==="RIDInfo"?r.clone():Ft.expand(r)};var rn=Ft;let Bt=class Ys{constructor(e,t){this.paused=t,this.id=e}clone(){return new Ys(this.id,this.paused)}plain(){return{id:this.id,paused:this.paused}}isPaused(){return this.paused}getId(){return this.id}};Bt.expand=function(r){return r.constructor.name==="SimulcastStreamInfo"?r:(r=r,new Bt(r.id,r.paused))},Bt.clone=function(r){return r.constructor.name==="SimulcastStreamInfo"?r.clone():Bt.expand(r)};var nn=Bt;const Fi=nn,ot=Cr;let Yt=class Os{constructor(){this.send=[],this.recv=[]}clone(){const e=new Os;for(const t of this.send)e.addSimulcastAlternativeStreams(ot.SEND,t.map(n=>n.clone()));for(const t of this.recv)e.addSimulcastAlternativeStreams(ot.RECV,t.map(n=>n.clone()));return e}plain(){const e={send:[],recv:[]};for(const t of this.send)e.send.push(t.map(n=>n.plain()));for(const t of this.recv)e.recv.push(t.map(n=>n.plain()));return e}addSimulcastAlternativeStreams(e,t){return e===ot.SEND?this.send.push(t):this.recv.push(t)}addSimulcastStream(e,t){return e===ot.SEND?this.send.push([t]):this.recv.push([t])}getSimulcastStreams(e){return e===ot.SEND?this.send:this.recv}};Yt.expand=function(r){if(r.constructor.name==="SimulcastInfo")return r;r=r;const e=new Yt;for(const t of r.send||[])e.addSimulcastAlternativeStreams(ot.SEND,t.map(Fi.expand));for(const t of r.recv||[])e.addSimulcastAlternativeStreams(ot.RECV,t.map(Fi.expand));return e},Yt.clone=function(r){return r.constructor.name==="SimulcastInfo"?r.clone():Yt.expand(r)};var sn=Yt;const Xo=Jr,ge=Xo("SENDRECV","SENDONLY","RECVONLY","INACTIVE");ge.byValue=function(r){return ge[r.toUpperCase()]},ge.toString=function(r){switch(r){case ge.SENDRECV:return"sendrecv";case ge.SENDONLY:return"sendonly";case ge.RECVONLY:return"recvonly";case ge.INACTIVE:return"inactive"}},ge.reverse=function(r){switch(r){case ge.SENDRECV:return ge.SENDRECV;case ge.SENDONLY:return ge.RECVONLY;case ge.RECVONLY:return ge.SENDONLY;case ge.INACTIVE:return ge.INACTIVE}};var on=ge;let Ot=class Ks{constructor(e,t){this.port=e,this.maxMessageSize=t}clone(){return new Ks(this.port,this.maxMessageSize)}plain(){return{port:this.port,maxMessageSize:this.maxMessageSize}}getPort(){return this.port}getMaxMessageSize(){return this.maxMessageSize}};Ot.expand=function(r){return r.constructor.name==="DataChannelInfo"?r:(r=r,new Ot(r.port,r.maxMessageSize))},Ot.clone=function(r){return r.constructor.name==="DataChannelInfo"?r.clone():Ot.expand(r)};var an=Ot;const cn=Sr,Fo=rn,Bi=sn,vt=on,Kt=Cr,Yi=an;let at=class ni{constructor(e,t){this.id=e,this.type=t,this.direction=vt.SENDRECV,this.extensions=new Map,this.codecs=new Map,this.rids=new Map,this.simulcast=null,this.bitrate=0,this.control=null,this.dataChannel=null}clone(){const e=new ni(this.id,this.type);e.setDirection(this.direction),e.setBitrate(this.bitrate);for(const t of this.codecs.values())e.addCodec(t.clone());for(const[t,n]of this.extensions.entries())e.addExtension(t,n);for(const t of this.rids.values())e.addRID(t.clone());return this.simulcast&&e.setSimulcast(this.simulcast.clone()),this.control&&e.setControl(this.control),this.dataChannel&&e.setDataChannel(this.dataChannel.clone()),e}plain(){const e={id:this.id,type:this.type,direction:vt.toString(this.direction),codecs:[]};this.dataChannel&&(e.dataChannel=this.dataChannel.plain()),this.bitrate&&(e.bitrate=this.bitrate);for(const t of this.codecs.values())e.codecs.push(t.plain());for(const[t,n]of this.extensions.entries())e.extensions||(e.extensions={}),e.extensions[t]=n;for(const t of this.rids.values())e.rids||(e.rids=[]),e.rids.push(t.plain());return this.simulcast&&(e.simulcast=this.simulcast.plain()),this.control&&(e.control=this.control),e}getType(){return this.type}getId(){return this.id}setId(e){this.id=e}addExtension(e,t){this.extensions.set(e,t)}addRID(e){this.rids.set(e.getId(),e)}addCodec(e){this.codecs.set(e.getType(),e)}setCodecs(e){this.codecs=e}getCodecForType(e){return this.codecs.get(e)}getCodec(e){for(const t of this.codecs.values())if(t.getCodec().toLowerCase()===e.toLowerCase())return t;return null}hasCodec(e){return this.getCodec(e)!==null}getCodecs(){return this.codecs}hasRTX(){for(const e of this.codecs.values())if(e.hasRTX())return!0;return!1}getExtensions(){return this.extensions}getRIDs(){return this.rids}getRID(e){return this.rids.get(e)}getBitrate(){return this.bitrate}setBitrate(e){this.bitrate=e}getDirection(){return this.direction}setDirection(e){this.direction=e}hasControl(){return!!this.control}getControl(){return this.control}setControl(e){this.control=e}hasDataChannel(){return!!this.dataChannel}getDataChannel(){return this.dataChannel}setDataChannel(e){this.dataChannel=e}answer(e){const t=new ni(this.id,this.type);if(e){t.setDirection(vt.reverse(this.direction));const{codecs:n,dataChannel:i}=e;if(n){let l;Array.isArray(n)?l=cn.MapFromNames(n,e.rtx,e.rtcpfbs):l=n;for(let o of this.codecs.values())for(let h of l.values()){if(h.getCodec().toLowerCase()!==o.getCodec().toLowerCase()||h.getCodec()==="h264"&&h.hasParam("packetization-mode")&&h.getParam("packetization-mode")!=o.getParam("packetization-mode","0")||h.getCodec()==="h264"&&h.hasParam("profile-level-id")&&o.hasParam("profile-level-id")&&h.getParam("profile-level-id")!=o.getParam("profile-level-id")||h.getCodec()==="multiopus"&&h.hasParam("num_streams")&&o.hasParam("num_streams")&&h.getParam("num_streams")!=o.getParam("num_streams"))continue;const d=h.clone();d.setType(o.getType()),d.hasRTX()&&d.setRTX(o.getRTX()),o.hasChannels()&&d.setChannels(o.getChannels()),d.addParams(o.getParams()),t.addCodec(d);break}}const a=new Set(e.extensions);for(let[l,o]of this.extensions)a.has(o)&&t.addExtension(l,o);if(e.simulcast&&this.simulcast){const l=new Bi,o=this.simulcast.getSimulcastStreams(Kt.SEND);if(o)for(const d of o){const p=d.map(b=>b.clone());l.addSimulcastAlternativeStreams(Kt.RECV,p)}const h=this.simulcast.getSimulcastStreams(Kt.RECV);if(h)for(const d of h){const p=d.map(b=>b.clone());l.addSimulcastAlternativeStreams(Kt.SEND,p)}for(const d of this.rids.values()){const p=d.clone();p.setDirection(Kt.reverse(d.getDirection())),t.addRID(p)}t.setSimulcast(l)}if(i&&this.dataChannel){const l=new Yi(this.dataChannel.getPort(),i.maxMessageSize?i.maxMessageSize:this.dataChannel.getMaxMessageSize());t.setDataChannel(l)}}else t.setDirection(vt.INACTIVE);return t}getSimulcast(){return this.simulcast}setSimulcast(e){this.simulcast=e}};at.create=function(r,e,t){!t&&typeof e!="string"&&(t=e,e=r);const n=new at(r,e);if(t){const{codecs:i}=t;i&&(Array.isArray(i)?n.setCodecs(cn.MapFromNames(i,t.rtx,t.rtcpfbs)):n.setCodecs(i))}else n.setDirection(vt.INACTIVE);return n},at.expand=function(r){if(r.constructor.name==="MediaInfo")return r;r=r;const e=new at(r.id,r.type);if(r.direction&&e.setDirection(vt.byValue(r.direction)),e.setBitrate(r.bitrate),r.dataChannel){const t=Yi.expand(r.dataChannel);t&&e.setDataChannel(t)}for(const[t,n]of Object.entries(r.extensions))e.addExtension(Bo(t),n);for(const t of r.codecs){const n=cn.expand(t);n&&e.addCodec(n)}for(const t of r.rids||[]){const n=Fo.expand(t);e.addRID(n)}return r.simulcast&&e.setSimulcast(Bi.expand(r.simulcast)),r.control&&e.setControl(r.control),e},at.clone=function(r){return r.constructor.name==="MediaInfo"?r.clone():at.expand(r)};function Bo(r){const e=r.toString();if(!/^\d+$/.test(e))throw new Error("invalid integer ".concat(e));return parseInt(e)}var Oi=at;let jt=class js{constructor(e,t){this.semantics=e,this.ssrcs=[];for(let n=0;n<t.length;++n)this.ssrcs.push(parseInt(t[n]))}clone(){return new js(this.semantics,this.ssrcs)}plain(){const e={semantics:this.semantics,ssrcs:[]};for(let t=0;t<this.ssrcs.length;++t)e.ssrcs.push(this.ssrcs[t]);return e}getSemantics(){return this.semantics}getSSRCs(){return this.ssrcs}};jt.expand=function(r){return r.constructor.name==="SourceGroupInfo"?r:(r=r,new jt(r.semantics,r.ssrcs))},jt.clone=function(r){return r.constructor.name==="SourceGroupInfo"?r.clone():jt.expand(r)};var ln=jt;let zt=class zs{constructor(e){this.ssrc=e}clone(){const e=new zs(this.ssrc);return e.setCName(this.cname),e.setStreamId(this.streamId),e.setTrackId(this.trackId),e}plain(){const e={ssrc:this.ssrc};return this.cname&&(e.cname=this.cname),this.streamId&&(e.streamId=this.streamId),this.trackId&&(e.trackId=this.trackId),e}getCName(){return this.cname}setCName(e){this.cname=e}getStreamId(){return this.streamId}setStreamId(e){this.streamId=e}getTrackId(){return this.trackId}setTrackId(e){this.trackId=e}getSSRC(){return this.ssrc}};zt.expand=function(r){if(r.constructor.name==="SourceInfo")return r;r=r;const e=new zt(r.ssrc);return e.setCName(r.cname),e.setStreamId(r.streamId),e.setTrackId(r.trackId),e},zt.clone=function(r){return r.constructor.name==="SourceInfo"?r.clone():zt.expand(r)};var Ki=zt;const Yo=Sr;let Jt=class Js{constructor(e,t=!1){this.id=e,this.paused=t,this.codecs=new Map,this.params=new Map}clone(){var e=new Js(this.id,this.paused);for(let t of this.codecs.values())e.addCodec(t.clone());return e.setParams(this.params),e}plain(){var e={id:this.id,paused:this.paused,codecs:{},params:{}};for(var[t,n]of this.codecs.entries())e.codecs[t]=n.plain();for(var[t,i]of this.params.entries())e.params[t]=i;return e}getId(){return this.id}getCodecs(){return this.codecs}addCodec(e){this.codecs.set(e.getType(),e)}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,t){this.params.set(e,t)}isPaused(){return this.paused}};Jt.expand=function(r){if(r.constructor.name==="TrackEncodingInfo")return r;r=r;const e=new Jt(r.id,r.paused);for(const t of Object.values(r.codecs||{}))e.addCodec(Yo.expand(t));for(const[t,n]of Object.entries(r.params||{}))e.addParam(t,n);return e},Jt.clone=function(r){return r.constructor.name==="TrackEncodingInfo"?r.clone():Jt.expand(r)};var un=Jt;const dn=ln,ji=un;let Ht=class Hs{constructor(e,t){this.media=e,this.id=t,this.ssrcs=[],this.groups=[],this.encodings=[]}clone(){const e=new Hs(this.media,this.id);this.mediaId&&e.setMediaId(this.mediaId);for(let t=0;t<this.ssrcs.length;++t)e.addSSRC(this.ssrcs[t]);for(let t=0;t<this.groups.length;++t)e.addSourceGroup(this.groups[t].clone());for(let t=0;t<this.encodings.length;++t){const n=[];for(let i=0;i<this.encodings[t].length;++i)n.push(this.encodings[t][i].clone());e.addAlternativeEncodings(n)}return e}plain(){const e={media:this.media,id:this.id,ssrcs:[]};this.mediaId&&(e.mediaId=this.mediaId);for(let t=0;t<this.ssrcs.length;++t)e.ssrcs.push(this.ssrcs[t]);for(let t=0;t<this.groups.length;++t)e.groups||(e.groups=[]),e.groups.push(this.groups[t].plain());for(let t=0;t<this.encodings.length;++t){const n=[];for(let i=0;i<this.encodings[t].length;++i)n.push(this.encodings[t][i].plain());n.length&&(e.encodings||(e.encodings=[]),e.encodings.push(n))}return e}getMedia(){return this.media}setMediaId(e){this.mediaId=e}getMediaId(){return this.mediaId}getId(){return this.id}addSSRC(e){this.ssrcs.push(e)}getSSRCs(){return this.ssrcs}addSourceGroup(e){this.groups.push(e)}getSourceGroup(e){for(const t of this.groups)if(t.getSemantics().toLowerCase()===e.toLowerCase())return t;return null}getSourceGroups(){return this.groups}getSourceGroupsForMediaSSRC(e){return this.groups.filter(t=>t.getSSRCs()[0]===e)}hasSourceGroup(e){for(const t of this.groups)if(t.getSemantics().toLowerCase()===e.toLowerCase())return!0;return!1}getEncodings(){return this.encodings}addEncoding(e){this.encodings.push([e])}addAlternativeEncodings(e){this.encodings.push(e)}setEncodings(e){this.encodings=e}getEncodingSources(){const e=[];if(this.encodings.length)for(const t of this.encodings)for(const n of t){const i={id:n.getId(),rid:n.getId()},a=n.getParams(),l=a==null?void 0:a.get("ssrc");if(l!==void 0){i.media=parseInt(l);for(const o of this.getSourceGroupsForMediaSSRC(i.media))switch(o.getSemantics()){case"FID":i.rtx=o.getSSRCs()[1];break;case"FEC-FR":i.fec=o.getSSRCs()[1];break}}e.push(i)}else if(this.hasSourceGroup("SIM")){const t=this.getSourceGroup("SIM").getSSRCs();this.getSourceGroups();for(const n of t){const i={id:String(n),media:n};for(const a of this.getSourceGroupsForMediaSSRC(i.media))switch(a.getSemantics()){case"FID":i.rtx=a.getSSRCs()[1];break;case"FEC-FR":i.fec=a.getSSRCs()[1];break}e.push(i)}}else{const t={id:""};if(this.ssrcs.length){t.media=this.ssrcs[0];for(const n of this.getSourceGroupsForMediaSSRC(t.media))switch(n.getSemantics()){case"FID":t.rtx=n.getSSRCs()[1];break;case"FEC-FR":t.fec=n.getSSRCs()[1];break}}e.push(t)}return e}};Ht.expand=function(r){var e,t;if(r.constructor.name==="TrackInfo")return r;r=r;const n=new Ht(r.media,r.id);if(r.mediaId&&n.setMediaId(r.mediaId),Array.isArray(r.ssrcs))for(const i of r.ssrcs)n.addSSRC(i);else if(((e=r.ssrcs)===null||e===void 0?void 0:e.media)!==void 0){const i=r.ssrcs.media;if(n.addSSRC(i),r.ssrcs.rtx!==void 0){const a=r.ssrcs.rtx;n.addSSRC(a),n.addSourceGroup(new dn("FID",[i,a]))}if(r.ssrcs.fec!==void 0){const a=r.ssrcs.fec;n.addSSRC(a),n.addSourceGroup(new dn("FEC-FR",[i,a]))}}if(r.rid){const i=new ji(r.rid);((t=r.ssrcs)===null||t===void 0?void 0:t.media)!==void 0&&i.addParam("ssrc",r.ssrcs.media),n.addAlternativeEncodings([i])}for(const i of r.groups||[])n.addSourceGroup(dn.expand(i));for(const i of r.encodings||[]){const a=[];for(const l of i)a.push(ji.expand(l));n.addAlternativeEncodings(a)}return n},Ht.clone=function(r){return r.constructor.name==="TrackInfo"?r.clone():Ht.expand(r)};var pn=Ht;const Oo=pn;let Qt=class Qs{constructor(e){this.id=e,this.tracks=new Map}clone(){const e=new Qs(this.id);for(const t of this.tracks.values())e.addTrack(t.clone());return e}plain(){const e={id:this.id,tracks:[]};for(const t of this.tracks.values())e.tracks.push(t.plain());return e}getId(){return this.id}addTrack(e){this.tracks.set(e.getId(),e)}removeTrack(e){return this.tracks.delete(e.getId())}removeTrackById(e){return this.tracks.delete(e)}getFirstTrack(e){for(let t of this.tracks.values())if(t.getMedia().toLowerCase()===e.toLowerCase())return t;return null}getTracks(){return this.tracks}removeAllTracks(){this.tracks.clear()}getTrack(e){return this.tracks.get(e)}};Qt.expand=function(r){if(r.constructor.name==="StreamInfo")return r;r=r;const e=new Qt(r.id);for(const t of r.tracks||[]){const n=Oo.expand(t);n&&e.addTrack(n)}return e},Qt.clone=function(r){return r.constructor.name==="StreamInfo"?r.clone():Qt.expand(r)};var zi=Qt;const wt=Oe,Ze=Ro("en-US"),St=Pi,Ko=Sr,jo=jr,It=Vi,Rt=Gi,ct=Di,kr=Oi,hn=Hr,fn=on,lt=Cr,zo=ln,Jo=Ki,qt=zi,mn=pn,Ho=un,Qo=sn,Ji=nn,qo=rn,_o=an;let Pe=class Fr{constructor(e){this.version=e||1,this.streams=new Map,this.medias=new Array,this.candidates=new Array,this.ice=null,this.dtls=null,this.crypto=null,this.extmapAllowMixed=!0}clone(){const e=new Fr(this.version);for(const t of this.medias)e.addMedia(t.clone());for(const t of this.streams.values())e.addStream(t.clone());for(const t of this.candidates)e.addCandidate(t.clone());return e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e.setExtmapAllowMixed(this.extmapAllowMixed),e}plain(){const e={version:this.version,streams:[],medias:[],candidates:[]};for(const t of this.medias)e.medias.push(t.plain());for(const t of this.streams.values())e.streams.push(t.plain());for(const t of this.candidates)e.candidates.push(t.plain());return this.ice&&(e.ice=this.ice.plain()),this.dtls&&(e.dtls=this.dtls.plain()),this.crypto&&(e.crypto=this.crypto.plain()),this.extmapAllowMixed||(e.extmapAllowMixedNotSupported=!this.extmapAllowMixed),e}unify(){const e=new Fr(this.version);for(const n of this.medias)e.addMedia(n.clone());const t={audio:e.getMediasByType("audio"),video:e.getMediasByType("video")};for(const n of this.streams.values()){const i=n.clone();for(const a of i.getTracks().values()){let l=t[a.getMedia()].pop();l||(l=this.getMedia(a.getMedia()).clone(),l.setId(a.getId()),e.addMedia(l)),a.setMediaId(l.getId())}e.addStream(i)}for(const n of this.candidates)e.addCandidate(n.clone());return this.ice&&e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e}setVersion(e){this.version=e}addMedia(e){this.medias.push(e)}getMedia(e){for(let t in this.medias){let n=this.medias[t];if(Ze(n.getType(),e))return n}return null}getMediasByType(e){let t=[];for(let n in this.medias){let i=this.medias[n];Ze(i.getType(),e)&&t.push(i)}return t}getMediaById(e){for(const t of this.medias)if(Ze(t.getId(),e))return t;return null}replaceMedia(e){for(let t in this.medias)if(this.medias[t].getId()==e.getId())return this.medias[t]=e,!0;return!1}getMedias(){return this.medias}getVersion(){return this.version}getDTLS(){return this.dtls}setDTLS(e){this.dtls=e}hasCrypto(){return!!this.crypto}getCrypto(){return this.crypto}setCrypto(e){this.crypto=e}hasICE(){return!!this.ice}getICE(){return this.ice}setICE(e){this.ice=e}addCandidate(e){for(const t of this.candidates)if(t.equals(e))return;this.candidates.push(e)}addCandidates(e){for(const t of e)this.addCandidate(t)}getCandidates(){return this.candidates}getStream(e){return this.streams.get(e)}getStreams(){return this.streams}getFirstStream(){for(const e of this.streams.values())return e;return null}addStream(e){this.streams.set(e.getId(),e)}removeStream(e){return this.streams.delete(e.getId())}removeAllStreams(){this.streams.clear()}getTracksByMediaType(e){let t=[];for(const n of this.streams.values())for(const[i,a]of n.getTracks())Ze(a.getMedia(),e)&&t.push(a);return t}getTrackByMediaId(e){for(const t of this.streams.values())for(const[n,i]of t.getTracks())if(i.getMediaId()==e)return i;return null}getStreamByMediaId(e){for(const t of this.streams.values())for(const[n,i]of t.getTracks())if(i.getMediaId()==e)return t;return null}getExtmapAllowMixed(){return this.extmapAllowMixed}setExtmapAllowMixed(e){this.extmapAllowMixed=e}answer(e){const t=new Fr;e.ice&&(e.ice instanceof ct?t.setICE(e.ice.clone()):t.setICE(ct.expand(e.ice))),e.dtls&&(e.dtls instanceof It?t.setDTLS(e.dtls):t.setDTLS(It.expand(e.dtls))),e.crypto&&(e.crypto instanceof Rt?t.setCrypto(e.crypto):t.setCrypto(Rt.expand(e.crypto)));for(let n=0;e.candidates&&n<e.candidates.length;++n)e.candidates[n]instanceof St?t.addCandidate(e.candidates[n].clone()):t.addCandidate(St.expand(e.candidates[n]));for(const n of this.medias){const i=e&&e.capabilities&&e.capabilities[n.getType()];t.addMedia(n.answer(i))}return t.setExtmapAllowMixed(this.extmapAllowMixed),t}toString(){let e={version:0,media:[]};e.version=0,e.origin={username:"-",sessionId:new Date().getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"},e.name="semantic-sdp",e.connection={version:4,ip:"0.0.0.0"},e.timing={start:0,stop:0},this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),e.msidSemantic={semantic:"WMS",token:"*"},e.groups=[],this.extmapAllowMixed&&(e.extmapAllowMixed="extmap-allow-mixed");const t=[];for(const i of this.medias){let a={type:i.getType(),port:9,protocol:"",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};a.direction=fn.toString(i.getDirection()),this.extmapAllowMixed&&(a.extmapAllowMixed="extmap-allow-mixed"),a.mid=i.getId(),t.push(i.getId()),i.hasControl()&&(a.control=i.getControl()),i.getBitrate()>0&&(a.bandwidth.push({type:"AS",limit:i.getBitrate()}),a.bandwidth.push({type:"TIAS",limit:i.getBitrate()*1e3}));let l=this.getCandidates();for(const o of l)a.candidates.push({foundation:o.getFoundation(),component:o.getComponentId(),transport:o.getTransport(),priority:o.getPriority(),ip:o.getAddress(),port:o.getPort(),type:o.getType(),raddr:o.getRelAddr(),rport:o.getRelPort()});if(this.getICE()&&(a.iceUfrag=this.getICE().getUfrag(),a.icePwd=this.getICE().getPwd()),Ze("audio",i.getType())||Ze("video",i.getType())){a.rtcpMux="rtcp-mux",a.rtcpRsize="rtcp-rsize",this.getDTLS()?(a.protocol="UDP/TLS/RTP/SAVPF",a.fingerprint={type:this.getDTLS().getHash(),hash:this.getDTLS().getFingerprint()},a.setup=hn.toString(this.getDTLS().getSetup())):this.getCrypto()?(a.protocol="RTP/SAVPF",a.crypto=[{id:this.getCrypto().getTag(),suite:this.getCrypto().getSuite(),config:this.getCrypto().getKeyParams()}]):a.protocol="RTP/AVP";for(const d of i.getCodecs().values()){Ze("video",i.getType())?a.rtp.push({payload:d.getType(),codec:d.getCodec().toUpperCase(),rate:9e4}):Ze("opus",d.getCodec())?a.rtp.push({payload:d.getType(),codec:d.getCodec(),rate:48e3,encoding:d.getChannels()}):Ze("multiopus",d.getCodec())?a.rtp.push({payload:d.getType(),codec:d.getCodec(),rate:48e3,encoding:d.getChannels()}):a.rtp.push({payload:d.getType(),codec:d.getCodec(),rate:8e3});for(const b of d.getRTCPFeedbacks())a.rtcpFb.push({payload:d.getType(),type:b.getId(),subtype:b.getParams().join(" ")});d.hasRTX()&&(a.rtp.push({payload:d.getRTX(),codec:"rtx",rate:9e4}),a.fmtp.push({payload:d.getRTX(),config:"apt="+d.getType()}));const p=d.getParams();if(Object.keys(p).length){const b={payload:d.getType(),config:""};for(const m in p)b.config.length&&(b.config+=";"),Object.hasOwnProperty.call(p,m)?b.config+=m+"="+p[m]:b.config+=m;a.fmtp.push(b)}}const o=[];for(const d of a.rtp)o.push(d.payload);a.payloads=o.join(" ");for(let[d,p]of i.getExtensions().entries())a.ext.push({value:d,uri:p});for(let d of i.getRIDs().values()){let p={id:d.getId(),direction:lt.toString(d.getDirection()),params:""};d.getFormats().length&&(p.params="pt="+d.getFormats().join(","));for(let[b,m]of d.getParams().entries())p.params+=(p.params.length?";":"")+b+"="+m;a.rids.push(p)}const h=i.getSimulcast();if(h){let d=1;a.simulcast={};const p=h.getSimulcastStreams(lt.SEND),b=h.getSimulcastStreams(lt.RECV);if(p&&p.length){let m="";for(const f of p){let g="";for(const y of f)g+=(g.length?",":"")+(y.isPaused()?"~":"")+y.getId();m+=(m.length?";":"")+g}a.simulcast["dir"+d]="send",a.simulcast["list"+d]=m,d++}if(b&&b.length){let m="";for(const f of b){let g="";for(const y of f)g+=(g.length?",":"")+(y.isPaused()?"~":"")+y.getId();m+=(m.length?";":"")+g}a.simulcast["dir"+d]="recv",a.simulcast["list"+d]=m,d++}}}else if(i.hasDataChannel()){a.protocol="UDP/DTLS/SCTP",a.payloads="webrtc-datachannel";const o=i.getDataChannel();a.sctpPort=o.getPort(),a.maxMessageSize=o.getMaxMessageSize()}e.media.push(a)}for(let i of this.streams.values())for(let a of i.getTracks().values())for(let l in e.media){let o=e.media[l];if(a.getMediaId()){if(a.getMediaId()==o.mid){let h=a.getSourceGroups();for(let p in h){let b=h[p];o.ssrcGroups.push({semantics:b.getSemantics(),ssrcs:b.getSSRCs().join(" ")})}let d=a.getSSRCs();for(let p in d)o.ssrcs.push({id:d[p],attribute:"cname",value:i.getId()}),o.ssrcs.push({id:d[p],attribute:"msid",value:i.getId()+" "+a.getId()});o.msid=i.getId()+" "+a.getId();break}}else if(Ze(o.type,a.getMedia())){let h=a.getSourceGroups();for(let p in h){let b=h[p];o.ssrcGroups.push({semantics:b.getSemantics(),ssrcs:b.getSSRCs().join(" ")})}let d=a.getSSRCs();for(let p in d)o.ssrcs.push({id:d[p],attribute:"cname",value:i.getId()}),o.ssrcs.push({id:d[p],attribute:"msid",value:i.getId()+" "+a.getId()});break}}const n={type:"BUNDLE",mids:t.join(" ")};return e.groups.push(n),wt.write(e)}toIceFragmentString(){let e={version:0,media:[],candidates:[]};this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),this.getICE()&&(e.iceUfrag=this.getICE().getUfrag(),e.icePwd=this.getICE().getPwd());for(const t of this.getCandidates())e.candidates.push({foundation:t.getFoundation(),component:t.getComponentId(),transport:t.getTransport(),priority:t.getPriority(),ip:t.getAddress(),port:t.getPort(),type:t.getType(),raddr:t.getRelAddr(),rport:t.getRelPort()});return wt.write(e).slice(10)}};Pe.create=function(r){var e;const t=new Pe;if(r.streams)for(const l of r.streams)t.addStream(qt.expand(l));r.ice&&(r.ice instanceof ct?t.setICE(r.ice.clone()):t.setICE(ct.expand(r.ice))),r.dtls&&(r.dtls instanceof It?t.setDTLS(r.dtls):t.setDTLS(It.expand(r.dtls))),r.crypto&&(r.crypto instanceof Rt?t.setCrypto(r.crypto):t.setCrypto(Rt.expand(r.crypto)));for(const l of r.candidates||[])l instanceof St?t.addCandidate(l.clone()):t.addCandidate(St.expand(l));let n=96,i=1,a=0;for(const[l,o]of Object.entries(r.capabilities||{}))if(r.unified&&!((e=r.streams)===null||e===void 0)&&e.length)for(const h of t.getTracksByMediaType(l)){const d=kr.create(h.getMediaId(),l,o);for(const[p,b]of d.getCodecs())b.getType()>=96&&b.setType(n++),b.getRTX()&&b.setRTX(n++);if(o.extensions)for(let p of o.extensions)i===15&&i++,d.addExtension(i++,p);t.addMedia(d)}else{const h=kr.create(r.unified?String(a++):l,l,o);for(const[d,p]of h.getCodecs())p.getType()>=96&&p.setType(n++),p.getRTX()&&p.setRTX(n++);if(o.extensions)for(let d of o.extensions)i===15&&i++,h.addExtension(i++,d);t.addMedia(h)}return t},Pe.expand=function(r){if(r.constructor.name==="SDPInfo")return r;r=r;const e=new Pe(r.version);for(const t of r.medias||[]){const n=kr.expand(t);n&&e.addMedia(n)}for(const t of r.streams||[]){const n=qt.expand(t);n&&e.addStream(n)}for(const t of r.candidates||[]){const n=St.expand(t);n&&e.addCandidate(n)}return r.ice&&e.setICE(ct.expand(r.ice)),r.dtls&&e.setDTLS(It.expand(r.dtls)),r.crypto&&e.setCrypto(Rt.expand(r.crypto)),r.extmapAllowMixedNotSupported&&(this.extmapAllowMixed=!r.extmapAllowMixedNotSupported),e},Pe.clone=function(r){return r.constructor.name==="SDPInfo"?r.clone():Pe.expand(r)},Pe.process=function(r){return Pe.parse(r)},Pe.parse=function(r){const e=wt.parse(r),t=new Pe;if(t.setVersion(e.version),e.iceUfrag&&e.icePwd){const n=String(e.iceUfrag),i=String(e.icePwd),a=new ct(n,i);a.setLite(e.icelite=="ice-lite"),a.setEndOfCandidates(e.endOfCandidates=="end-of-candidates"),t.setICE(a)}for(let n in e.media){const i=e.media[n],a=i.type,l=i.mid?i.mid.toString():n,o=new kr(l,a);if(i.iceUfrag&&i.icePwd){const y=String(i.iceUfrag),S=String(i.icePwd),C=new ct(y,S);C.setLite(e.icelite=="ice-lite"),C.setEndOfCandidates(i.endOfCandidates=="end-of-candidates"),t.setICE(C)}for(let y=0;i.candidates&&y<i.candidates.length;++y){const S=i.candidates[y],C=new St(S.foundation,S.component,S.transport,S.priority,S.ip,S.port,S.type,S.raddr,S.rport);t.addCandidate(C)}const h=i.fingerprint||e.fingerprint;if(h){const y=h.type,S=h.hash;let C=hn.ACTPASS;i.setup&&(C=hn.byValue(i.setup)),t.setDTLS(new It(C,y,S))}if(i.crypto){const y=i.crypto[0];t.setCrypto(new Rt(y.id,y.suite,y.config,y.sessionConfig))}let d=fn.SENDRECV;i.direction&&(d=fn.byValue(i.direction),o.setDirection(d)),i.control&&o.setControl(i.control),t.setExtmapAllowMixed(i.extmapAllowMixed=="extmap-allow-mixed"||e.extmapAllowMixed=="extmap-allow-mixed");const p=new Map;for(let y in i.rtp){const S=i.rtp[y],C=S.payload,x=S.codec;if(x.toUpperCase()==="RED"||x.toUpperCase()==="ULPFEC")continue;let L={};for(let v in i.fmtp){const Z=i.fmtp[v];if(Z.payload===C){const M=Z.config.split(";");for(let U in M){const N=M[U].split("="),V=N[0].trim(),B=N.splice(1).join("=").trim();L[V]=B}}}if(x.toUpperCase()==="RTX")p.set(parseInt(L.apt),C);else{const v=new Ko(x,C,L);S.encoding>1&&v.setChannels(S.encoding),o.addCodec(v)}}for(let y of p.entries()){const S=o.getCodecForType(y[0]);S&&S.setRTX(y[1])}for(let y=0;i.rtcpFb&&y<i.rtcpFb.length;++y){const S=o.getCodecForType(i.rtcpFb[y].payload);if(S){const C=i.rtcpFb[y].type,x=i.rtcpFb[y].subtype?i.rtcpFb[y].subtype.split(" "):null;S.addRTCPFeedback(new jo(C,x))}}const b=i.ext;for(let y in b){const S=b[y];o.addExtension(S.value,S.uri)}const m=i.rids;for(let y in m){const S=m[y],C=new qo(S.id,lt.byValue(S.direction));let x=[];const L=new Map;if(S.params){const v=wt.parseParams(S.params);for(let Z in v)Z==="pt"?x=v[Z].split(","):L.set(Z,v[Z]);C.setFormats(x),C.setParams(L)}o.addRID(C)}const f=[];if(i.simulcast){const y=new Qo;if(i.simulcast.dir1){const S=lt.byValue(i.simulcast.dir1),C=wt.parseSimulcastStreamList(i.simulcast.list1);for(let x=0;x<C.length;++x){const L=[];for(let v=0;v<C[x].length;++v)L.push(new Ji(C[x][v].scid,C[x][v].paused));y.addSimulcastAlternativeStreams(S,L)}}if(i.simulcast.dir2){const S=lt.byValue(i.simulcast.dir2),C=wt.parseSimulcastStreamList(i.simulcast.list2);for(let x=0;x<C.length;++x){const L=[];for(let v=0;v<C[x].length;++v)L.push(new Ji(C[x][v].scid,C[x][v].paused));y.addSimulcastAlternativeStreams(S,L)}}for(let S of y.getSimulcastStreams(lt.SEND)){const C=[];for(let x=0;x<S.length;x++){const L=new Ho(S[x].getId(),S[x].isPaused()),v=o.getRID(L.getId());if(v){const Z=v.getFormats();for(let M=0;Z&&M<Z.length;++M){const U=o.getCodecForType(Z[M]);U&&L.addCodec(U)}L.setParams(v.getParams()),C.push(L)}}C.length&&f.push(C)}o.setSimulcast(y)}const g=new Map;if(i.ssrcs)for(let y in i.ssrcs){let S=i.ssrcs[y],C=S.id,x=S.attribute,L=S.value,v=g.get(C);if(v||(v=new Jo(C),g.set(v.getSSRC(),v)),Ze("cname",x))v.setCName(L);else if(Ze("msid",x)){let Z=L.split(" "),M=Z[0],U=Z[1];v.setStreamId(M),v.setTrackId(U);let N=t.getStream(M);N||(N=new qt(M),t.addStream(N));let V=N.getTrack(U);V||(V=new mn(a,U),V.setMediaId(l),V.setEncodings(f),N.addTrack(V)),V.addSSRC(C)}}if(i.msid){let y=i.msid.split(" "),S=y[0],C=y[1],x=t.getStream(S);x||(x=new qt(S),t.addStream(x));let L=x.getTrack(C);L||(L=new mn(a,C),L.setMediaId(l),L.setEncodings(f),x.addTrack(L));for(let[v,Z]of g.entries())Z.getStreamId()||(Z.setStreamId(S),Z.setTrackId(C),L.addSSRC(v))}for(let[y,S]of g.entries())if(!S.getStreamId()){let C=S.getCName(),x=l;S.setStreamId(C),S.setTrackId(x);let L=t.getStream(C);L||(L=new qt(C),t.addStream(L));let v=L.getTrack(x);v||(v=new mn(a,x),v.setMediaId(l),v.setEncodings(f),L.addTrack(v)),v.addSSRC(y)}if(i.ssrcGroups)for(let y in i.ssrcGroups){let S=i.ssrcGroups[y],C=S.ssrcs.split(" "),x=new zo(S.semantics,C),L=g.get(parseInt(C[0]));L&&t.getStream(L.getStreamId()).getTrack(L.getTrackId()).addSourceGroup(x)}if(i.type=="application"&&i.payloads=="webrtc-datachannel"){const y=new _o(i.sctpPort,i.maxMessageSize);o.setDataChannel(y)}t.addMedia(o)}return t};var $o=Pe;Object.defineProperty(le,"__esModule",{value:!0});var _t=le.SDPInfo=$o;le.CandidateInfo=Pi,le.CodecInfo=Sr,le.DTLSInfo=Vi,le.CryptoInfo=Gi,le.ICEInfo=Di;var ea=le.MediaInfo=Oi;le.Setup=Hr,le.SourceGroupInfo=ln,le.SourceInfo=Ki,le.StreamInfo=zi,le.TrackInfo=pn,le.RTCPFeedbackInfo=jr,le.TrackEncodingInfo=un,le.RIDInfo=rn,le.SimulcastInfo=sn,le.SimulcastStreamInfo=nn,le.DataChannelInfo=an;var ta=le.Direction=on,gn={exports:{}};(function(r,e){(function(t,n){var i="0.7.39",a="",l="?",o="function",h="undefined",d="object",p="string",b="major",m="model",f="name",g="type",y="vendor",S="version",C="architecture",x="console",L="mobile",v="tablet",Z="smarttv",M="wearable",U="embedded",N=500,V="Amazon",B="Apple",J="ASUS",ue="BlackBerry",Ge="Browser",Se="Chrome",xt="Edge",D="Firefox",P="Google",G="Huawei",W="LG",Y="Microsoft",A="Motorola",X="Opera",re="Samsung",fe="Sharp",ae="Sony",me="Xiaomi",Ne="Zebra",Le="Facebook",Zt="Chromium OS",sr="Mac OS",Ar=" Browser",Dr=function(O,s){var c={};for(var u in O)s[u]&&s[u].length%2===0?c[u]=s[u].concat(O[u]):c[u]=O[u];return c},We=function(O){for(var s={},c=0;c<O.length;c++)s[O[c].toUpperCase()]=O[c];return s},_e=function(O,s){return typeof O===p?$e(s).indexOf($e(O))!==-1:!1},$e=function(O){return O.toLowerCase()},ri=function(O){return typeof O===p?O.replace(/[^\d\.]/g,a).split(".")[0]:n},ht=function(O,s){if(typeof O===p)return O=O.replace(/^\s\s*/,a),typeof s===h?O:O.substring(0,N)},ft=function(O,s){for(var c=0,u,w,R,k,T,j;c<s.length&&!T;){var ce=s[c],Q=s[c+1];for(u=w=0;u<ce.length&&!T&&ce[u];)if(T=ce[u++].exec(O),T)for(R=0;R<Q.length;R++)j=T[++w],k=Q[R],typeof k===d&&k.length>0?k.length===2?typeof k[1]==o?this[k[0]]=k[1].call(this,j):this[k[0]]=k[1]:k.length===3?typeof k[1]===o&&!(k[1].exec&&k[1].test)?this[k[0]]=j?k[1].call(this,j,k[2]):n:this[k[0]]=j?j.replace(k[1],k[2]):n:k.length===4&&(this[k[0]]=j?k[3].call(this,j.replace(k[1],k[2])):n):this[k]=j||n;c+=2}},Tt=function(O,s){for(var c in s)if(typeof s[c]===d&&s[c].length>0){for(var u=0;u<s[c].length;u++)if(_e(s[c][u],O))return c===l?n:c}else if(_e(s[c],O))return c===l?n:c;return s.hasOwnProperty("*")?s["*"]:O},Xr={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},mt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ke={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,S],[/opios[\/ ]+([\w\.]+)/i],[S,[f,X+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[f,X+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[f,X]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[f,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[f,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[f,"UC"+Ge]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[f,"Smart Lenovo "+Ge]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+Ge],S],[/\bfocus\/([\w\.]+)/i],[S,[f,D+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[f,X+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[f,X+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[f,"MIUI "+Ge]],[/fxios\/([-\w\.]+)/i],[S,[f,D]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360"+Ar]],[/\b(qq)\/([\w\.]+)/i],[[f,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1"+Ar],S],[/samsungbrowser\/([\w\.]+)/i],[S,[f,re+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],S],[/metasr[\/ ]?([\d\.]+)/i],[S,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,Le],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[f,Se+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,Se+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[f,"Android "+Ge]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[S,Tt,Xr]],[/(webkit|khtml)\/([\w\.]+)/i],[f,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],S],[/(wolvic)\/([\w\.]+)/i],[f,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[f,D+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[f,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[f,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,$e]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,a,$e]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,$e]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[y,re],[g,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[m,[y,re],[g,L]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[m,[y,B],[g,L]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[y,B],[g,v]],[/(macintosh);/i],[m,[y,B]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[y,fe],[g,L]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[y,G],[g,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[y,G],[g,L]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[m,/_/g," "],[y,me],[g,L]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[y,me],[g,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[y,"OPPO"],[g,L]],[/\b(opd2\d{3}a?) bui/i],[m,[y,"OPPO"],[g,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[y,"Vivo"],[g,L]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[m,[y,"Realme"],[g,L]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[y,A],[g,L]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[y,A],[g,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[y,W],[g,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[y,W],[g,L]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[y,"Lenovo"],[g,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[y,"Nokia"],[g,L]],[/(pixel c)\b/i],[m,[y,P],[g,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[y,P],[g,L]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[y,ae],[g,L]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[y,ae],[g,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[y,"OnePlus"],[g,L]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[y,V],[g,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[y,V],[g,L]],[/(playbook);[-\w\),; ]+(rim)/i],[m,y,[g,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[y,ue],[g,L]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[y,J],[g,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[y,J],[g,L]],[/(nexus 9)/i],[m,[y,"HTC"],[g,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[m,/_/g," "],[g,L]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[m,[y,"TCL"],[g,v]],[/(itel) ((\w+))/i],[[y,$e],m,[g,Tt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[y,"Acer"],[g,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[y,"Meizu"],[g,L]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[m,[y,"Ulefone"],[g,L]],[/droid.+; (a(?:015|06[35]|142p?))/i],[m,[y,"Nothing"],[g,L]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[y,m,[g,L]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,m,[g,v]],[/(surface duo)/i],[m,[y,Y],[g,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[y,"Fairphone"],[g,L]],[/(u304aa)/i],[m,[y,"AT&T"],[g,L]],[/\bsie-(\w*)/i],[m,[y,"Siemens"],[g,L]],[/\b(rct\w+) b/i],[m,[y,"RCA"],[g,v]],[/\b(venue[\d ]{2,7}) b/i],[m,[y,"Dell"],[g,v]],[/\b(q(?:mv|ta)\w+) b/i],[m,[y,"Verizon"],[g,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[y,"Barnes & Noble"],[g,v]],[/\b(tm\d{3}\w+) b/i],[m,[y,"NuVision"],[g,v]],[/\b(k88) b/i],[m,[y,"ZTE"],[g,v]],[/\b(nx\d{3}j) b/i],[m,[y,"ZTE"],[g,L]],[/\b(gen\d{3}) b.+49h/i],[m,[y,"Swiss"],[g,L]],[/\b(zur\d{3}) b/i],[m,[y,"Swiss"],[g,v]],[/\b((zeki)?tb.*\b) b/i],[m,[y,"Zeki"],[g,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],m,[g,v]],[/\b(ns-?\w{0,9}) b/i],[m,[y,"Insignia"],[g,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[y,"NextBook"],[g,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],m,[g,L]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],m,[g,L]],[/\b(ph-1) /i],[m,[y,"Essential"],[g,L]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[y,"Envizen"],[g,v]],[/\b(trio[-\w\. ]+) b/i],[m,[y,"MachSpeed"],[g,v]],[/\btu_(1491) b/i],[m,[y,"Rotor"],[g,v]],[/(shield[\w ]+) b/i],[m,[y,"Nvidia"],[g,v]],[/(sprint) (\w+)/i],[y,m,[g,L]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[y,Y],[g,L]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[y,Ne],[g,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[y,Ne],[g,L]],[/smart-tv.+(samsung)/i],[y,[g,Z]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[y,re],[g,Z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,W],[g,Z]],[/(apple) ?tv/i],[y,[m,B+" TV"],[g,Z]],[/crkey/i],[[m,Se+"cast"],[y,P],[g,Z]],[/droid.+aft(\w+)( bui|\))/i],[m,[y,V],[g,Z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[y,fe],[g,Z]],[/(bravia[\w ]+)( bui|\))/i],[m,[y,ae],[g,Z]],[/(mitv-\w{5}) bui/i],[m,[y,me],[g,Z]],[/Hbbtv.*(technisat) (.*);/i],[y,m,[g,Z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,ht],[m,ht],[g,Z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,m,[g,x]],[/droid.+; (shield) bui/i],[m,[y,"Nvidia"],[g,x]],[/(playstation [345portablevi]+)/i],[m,[y,ae],[g,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[y,Y],[g,x]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[m,[y,re],[g,M]],[/((pebble))app/i],[y,m,[g,M]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[y,B],[g,M]],[/droid.+; (glass) \d/i],[m,[y,P],[g,M]],[/droid.+; (wt63?0{2,3})\)/i],[m,[y,Ne],[g,M]],[/(quest( \d| pro)?)/i],[m,[y,Le],[g,M]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[g,U]],[/(aeobc)\b/i],[m,[y,V],[g,U]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[m,[g,L]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[g,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,L]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[f,xt+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,S],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[S,Tt,mt]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,Tt,mt],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,sr],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,S],[/\(bb(10);/i],[S,[f,ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[f,D+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[f,Se+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,Zt],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,S],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,S]]},Ie=function(O,s){if(typeof O===d&&(s=O,O=n),!(this instanceof Ie))return new Ie(O,s).getResult();var c=typeof t!==h&&t.navigator?t.navigator:n,u=O||(c&&c.userAgent?c.userAgent:a),w=c&&c.userAgentData?c.userAgentData:n,R=s?Dr(ke,s):ke,k=c&&c.userAgent==u;return this.getBrowser=function(){var T={};return T[f]=n,T[S]=n,ft.call(T,u,R.browser),T[b]=ri(T[S]),k&&c&&c.brave&&typeof c.brave.isBrave==o&&(T[f]="Brave"),T},this.getCPU=function(){var T={};return T[C]=n,ft.call(T,u,R.cpu),T},this.getDevice=function(){var T={};return T[y]=n,T[m]=n,T[g]=n,ft.call(T,u,R.device),k&&!T[g]&&w&&w.mobile&&(T[g]=L),k&&T[m]=="Macintosh"&&c&&typeof c.standalone!==h&&c.maxTouchPoints&&c.maxTouchPoints>2&&(T[m]="iPad",T[g]=v),T},this.getEngine=function(){var T={};return T[f]=n,T[S]=n,ft.call(T,u,R.engine),T},this.getOS=function(){var T={};return T[f]=n,T[S]=n,ft.call(T,u,R.os),k&&!T[f]&&w&&w.platform&&w.platform!="Unknown"&&(T[f]=w.platform.replace(/chrome os/i,Zt).replace(/macos/i,sr)),T},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return u},this.setUA=function(T){return u=typeof T===p&&T.length>N?ht(T,N):T,this},this.setUA(u),this};Ie.VERSION=i,Ie.BROWSER=We([f,S,b]),Ie.CPU=We([C]),Ie.DEVICE=We([m,y,g,x,L,Z,v,M,U]),Ie.ENGINE=Ie.OS=We([f,S]),r.exports&&(e=r.exports=Ie),e.UAParser=Ie;var et=typeof t!==h&&(t.jQuery||t.Zepto);if(et&&!et.ua){var Ee=new Ie;et.ua=Ee.getResult(),et.ua.get=function(){return Ee.getUA()},et.ua.set=function(O){Ee.setUA(O);var s=Ee.getResult();for(var c in s)et.ua[c]=s[c]}}})(typeof window=="object"?window:cr)})(gn,gn.exports);var ra=gn.exports;const na=Mt(ra),ia=["iOS"];class $t extends na{constructor(){super(window.navigator.userAgent)}isChromium(){return this.getUA().match(/Chrome/i)}isChrome(){const e=this.getBrowser();if(!e.name)return!1;const t=this.getOS();let n=!0;return n=!new RegExp(ia.join("|"),"i").test(t.name),e.name.match(/Chrome/i)&&n}isFirefox(){const e=this.getBrowser();return e.name?e.name.match(/Firefox/i):!1}isOpera(){const e=this.getBrowser();return e.name?e.name.match(/Opera/i):!1}isSafari(){const e=this.getBrowser();return e.name?e.name.match(/Safari/i):!1}}const te=Ae.get("SdpParser"),Hi=35,sa=65,Qi=96,oa=127,aa=Array.from({length:sa-Hi+1},(r,e)=>e+Hi),ca=Array.from({length:oa-Qi+1},(r,e)=>e+Qi),qi=1,la=14,_i=16,ua=255,da=Array.from({length:la-qi+1},(r,e)=>e+qi),pa=Array.from({length:ua-_i+1},(r,e)=>e+_i),be={setSimulcast(r,e){if(te.info("Setting simulcast. Codec: ",e),!new $t().isChromium())return te.warn("Your browser does not appear to support Simulcast. For a better experience, use a Chromium based browser."),r;if(e!=="h264"&&e!=="vp8")return te.warn("Your selected codec ".concat(e," does not appear to support Simulcast.  To broadcast using simulcast, please use H.264 or VP8.")),r;if(!/m=video/.test(r))return te.warn("There is no available video for simulcast to be enabled."),r;try{const t=new RegExp("m=video.*?a=ssrc:(\\d*) cname:(.+?)\\r\\n","s"),n=new RegExp("m=video.*?a=ssrc:(\\d*) msid:(.+?)\\r\\n","s"),i=t.exec(r),a=i[1],l=i[2],o=n.exec(r)[2],h=2,d=[a];for(let p=0;p<h;++p){const b=100+p*2,m=b+1;d.push(b),r+="a=ssrc-group:FID "+b+" "+m+`\r
a=ssrc:`+b+" cname:"+l+`\r
a=ssrc:`+b+" msid:"+o+`\r
a=ssrc:`+m+" cname:"+l+`\r
a=ssrc:`+m+" msid:"+o+`\r
`}return r+="a=ssrc-group:SIM "+d.join(" ")+`\r
`,te.info("Simulcast setted"),te.debug("Simulcast SDP: ",r),r}catch(t){throw te.error("Error setting SDP for simulcast: ",t),t}},setStereo(r){return te.info("Replacing SDP response for support stereo"),r=r.replace(/useinbandfec=1/g,"useinbandfec=1; stereo=1"),te.info("Replaced SDP response for support stereo"),te.debug("New SDP value: ",r),r},setDTX(r){return te.info("Replacing SDP response for support dtx"),r=r.replace("useinbandfec=1","useinbandfec=1; usedtx=1"),te.info("Replaced SDP response for support dtx"),te.debug("New SDP value: ",r),r},setAbsoluteCaptureTime(r){const e="a=extmap:"+be.getAvailableHeaderExtensionIdRange(r)[0]+` http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time\r
`,t=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return r=r.replace(t,(n,i,a)=>i+e+a),te.info("Replaced SDP response for setting absolute capture time"),te.debug("New SDP value: ",r),r},setDependencyDescriptor(r){const e="a=extmap:"+be.getAvailableHeaderExtensionIdRange(r)[0]+` https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension\r
`,t=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return r=r.replace(t,(n,i,a)=>i+e+a),te.info("Replaced SDP response for setting depency descriptor"),te.debug("New SDP value: ",r),r},setVideoBitrate(r,e){if(e<1)te.info("Remove bitrate restrictions"),r=r.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");else{const t=_t.parse(r),n=t.getMedia("video");te.info("Setting video bitrate"),n.setBitrate(e),r=t.toString()}return r},removeSdpLine(r,e){return te.debug("SDP before trimming: ",r),r=r.split(`
`).filter(t=>t.trim()!==e).join(`
`),te.debug("SDP trimmed result: ",r),r},adaptCodecName(r,e,t){if(!r)return r;const n=new RegExp("".concat(e),"i");return r.replace(n,t)},setMultiopus(r,e){if(!new $t().isFirefox()&&(!e||ha(e)))if(r.includes("multiopus/48000/6"))te.info("Multiopus already setted");else{te.info("Setting multiopus");const t=/m=audio 9 UDP\/TLS\/RTP\/SAVPF (.*)\r\n/.exec(r)[0],n=be.getAvailablePayloadTypeRange(r)[0],i=t.replace(`\r
`," ")+n+`\r
a=rtpmap:`+n+` multiopus/48000/6\r
a=fmtp:`+n+` channel_mapping=0,4,1,2,3,5;coupled_streams=2;minptime=10;num_streams=4;useinbandfec=1\r
`;r=r.replace(t,i),te.info("Multiopus offer created"),te.debug("SDP parsed for multioups: ",r)}return r},getAvailablePayloadTypeRange(r){const e=/m=(?:.*) (?:.*) UDP\/TLS\/RTP\/SAVPF (.*)\r\n/gm,t=r.matchAll(e);let n=ca.concat(aa);for(const i of t){const a=i[1].split(" ").map(l=>parseInt(l));n=n.filter(l=>!a.includes(l))}return n},getAvailableHeaderExtensionIdRange(r){const e=/a=extmap:(\d+)(?:.*)\r\n/gm,t=r.matchAll(e);let n=da.concat(pa);for(const i of t){const a=i[1].split(" ").map(l=>parseInt(l));n=n.filter(l=>!a.includes(l))}return n},renegotiate(r,e){const t=_t.parse(r),n=_t.parse(e);for(const i of t.getMedias()){let a=n.getMediaById(i.getId());if(!a){a=new ea(i.getId(),i.getType()),a.setDirection(ta.reverse(i.getDirection()));const l=n.getMedia(i.getType());if(l){a.setCodecs(l.getCodecs());for(const[o,h]of l.getExtensions())a.addExtension(o,h)}n.addMedia(a)}}return n.toString()},updateMissingVideoExtensions(r,e){var t;const n=_t.parse(r),i=(t=_t.parse(e).getMediasByType("video")[0])==null?void 0:t.getExtensions();if(!(!i&&!i.length)){for(const a of n.getMediasByType("video")){const l=a.getExtensions();i.forEach((o,h)=>{if(!l.get(h)){const d=a.getId(),p="a=extmap:"+h+" "+o+`\r
`,b=new RegExp("(a=mid:"+d+`\r
(?:.*\r
)*?)`,"g");r=r.replace(b,(m,f,g)=>f+p)}})}return r}},getCodecPayloadType(r){const e=/a=rtpmap:(\d+) (\w+)\/\d+/g,t=r.matchAll(e),n={};for(const i of t)n[i[1]]=i[2];return n}},ha=r=>r.getAudioTracks().some(e=>e.getSettings().channelCount>2),Ke={VP8:"vp8",VP9:"vp9",H264:"h264",AV1:"av1",H265:"h265"},fa={OPUS:"opus",MULTIOPUS:"multiopus"},F=Ae.get("PeerConnection"),bn={Publisher:"Publisher",Viewer:"Viewer"},Ue={track:"track",connectionStateChange:"connectionStateChange"},$i={stereo:!1,mediaStream:null,codec:"h264",simulcast:!1,scalabilityMode:null,disableAudio:!1,disableVideo:!1,setSDPToPeer:!0};class er extends wr{constructor(){super(),this.mode=null,this.sessionDescription=null,this.peer=null,this.peerConnectionStats=null,this.transceiverMap=new Map}async createRTCPeer(e={autoInitStats:!0,statsIntervalMs:1e3},t=bn.Viewer){F.info("Creating new RTCPeerConnection"),F.debug("RTC configuration provided by user: ",e),this.peer=ga(this,e),this.mode=t,e.autoInitStats&&this.initStats(e)}getRTCPeer(){return F.info("Getting RTC Peer"),this.peer}async closeRTCPeer(){var e;F.info("Closing RTCPeerConnection"),(e=this.peer)==null||e.close(),this.peer=null,this.stopStats(),this.emit(Ue.connectionStateChange,"closed")}async setRTCRemoteSDP(e){F.info("Setting RTC Remote SDP");const t={type:"answer",sdp:e};try{await this.peer.setRemoteDescription(t),F.info("RTC Remote SDP was set successfully."),F.debug("RTC Remote SDP new value: ",e)}catch(n){throw F.error("Error while setting RTC Remote SDP: ",n),n}}async getRTCLocalSDP(e=$i){F.info("Getting RTC Local SDP"),e=ne(ne({},$i),e),F.debug("Options: ",e);const t=ma(e.mediaStream);t?va(this.peer,t,e):wa(this.peer,e),F.info("Creating peer offer");const n=await this.peer.createOffer();return F.info("Peer offer created"),F.debug("Peer offer response: ",n.sdp),this.sessionDescription=n,e.disableAudio||(e.stereo&&(this.sessionDescription.sdp=be.setStereo(this.sessionDescription.sdp)),e.dtx&&(this.sessionDescription.sdp=be.setDTX(this.sessionDescription.sdp)),this.sessionDescription.sdp=be.setMultiopus(this.sessionDescription.sdp,t)),!e.disableVideo&&e.simulcast&&(this.sessionDescription.sdp=be.setSimulcast(this.sessionDescription.sdp,e.codec)),e.absCaptureTime&&(this.sessionDescription.sdp=be.setAbsoluteCaptureTime(this.sessionDescription.sdp)),e.dependencyDescriptor&&(this.sessionDescription.sdp=be.setDependencyDescriptor(this.sessionDescription.sdp)),e.setSDPToPeer&&(await this.peer.setLocalDescription(this.sessionDescription),F.info("Peer local description set")),this.sessionDescription.sdp}async addRemoteTrack(e,t){return new Promise((n,i)=>{try{const a=this.peer.addTransceiver(e,{direction:"recvonly",streams:t});this.transceiverMap.set(a,n)}catch(a){i(a)}})}updateBandwidthRestriction(e,t){if(this.mode===bn.Viewer)throw F.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");return F.info("Updating bandwidth restriction, bitrate value: ",t),F.debug("SDP value: ",e),be.setVideoBitrate(e,t)}async updateBitrate(e=0){if(this.mode===bn.Viewer)throw F.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");if(!this.peer)throw F.error("Cannot update bitrate. No peer found."),new Error("Cannot update bitrate. No peer found.");F.info("Updating bitrate to value: ",e),this.sessionDescription=await this.peer.createOffer(),await this.peer.setLocalDescription(this.sessionDescription);const t=this.updateBandwidthRestriction(this.peer.remoteDescription.sdp,e);await this.setRTCRemoteSDP(t),F.info("Bitrate restrictions updated: ","".concat(e>0?e:"unlimited"," kbps"))}getRTCPeerStatus(){if(F.info("Getting RTC peer status"),!this.peer)return null;const e=Sa(this.peer);return F.info("RTC peer status getted, value: ",e),e}replaceTrack(e){if(!this.peer){F.error("Could not change track if there is not an active connection.");return}const t=this.peer.getSenders().find(n=>n.track.kind===e.kind);t?t.replaceTrack(e):F.error("There is no ".concat(e.kind," track in active broadcast."))}static getCapabilities(e){const t=new $t,n=RTCRtpSender.getCapabilities(e);if(n){const i={};let a=new RegExp("^video/(".concat(Object.values(Ke).join("|"),")x?$"),"i");e==="audio"&&(a=new RegExp("^audio/(".concat(Object.values(fa).join("|"),")$"),"i"),t.isChrome()&&(i.multiopus={mimeType:"audio/multiopus",channels:6}));for(const l of n.codecs){const o=l.mimeType.match(a);if(o){const h=o[1].toLowerCase();if(i[h]=Je(ne({},i[h]),{mimeType:l.mimeType}),l.scalabilityModes){let d=i[h].scalabilityModes||[];d=[...d,...l.scalabilityModes],i[h].scalabilityModes=[...new Set(d)]}l.channels&&(i[h].channels=l.channels)}}n.codecs=Object.keys(i).map(l=>ne({codec:l},i[l]))}return n}getTracks(){var e,t;return(t=(e=this.peer)==null?void 0:e.getSenders())==null?void 0:t.map(n=>n.track)}initStats(e){this.peerConnectionStats?F.warn("PeerConnection.initStats() has already been called. Automatic initialization occurs via View.connect(), Publish.connect() or this.createRTCPeer(). See options"):this.peer?(this.peerConnectionStats=new go(this.peer,e),ki(this.peerConnectionStats,this,[xi.stats])):F.warn("Cannot init peer stats: RTCPeerConnection not initialized")}stopStats(){var e;(e=this.peerConnectionStats)==null||e.stop(),this.peerConnectionStats=null}}const es=r=>(r==null?void 0:r.getAudioTracks().length)<=1&&(r==null?void 0:r.getVideoTracks().length)<=1,ma=r=>{if(!r)return null;if(r instanceof MediaStream&&es(r))return r;if(!(r instanceof MediaStream)){F.info("Creating MediaStream to add received tracks.");const e=new MediaStream;for(const t of r)e.addTrack(t);if(es(e))return e}throw F.error("MediaStream must have 1 audio track and 1 video track, or at least one of them."),new Error("MediaStream must have 1 audio track and 1 video track, or at least one of them.")},ga=(r,e)=>{const t=new RTCPeerConnection(e);return ya(r,t),t};async function ba(r){return new Promise(e=>setTimeout(e,r))}const ya=(r,e)=>{e.ontrack=async t=>{F.info("New track from peer."),F.debug("Track event value: ",t);const n=r.transceiverMap.get(t.transceiver);if(n){for(;!t.transceiver.mid;)await ba(100);n(t.transceiver),r.transceiverMap.delete(t.transceiver)}setTimeout(()=>{r.emit(Ue.track,t)},0)},e.connectionState?e.onconnectionstatechange=t=>{F.info("Peer connection state change: ",e.connectionState),r.emit(Ue.connectionStateChange,e.connectionState)}:e.oniceconnectionstatechange=t=>{F.info("Peer ICE connection state change: ",e.iceConnectionState),r.emit(Ue.connectionStateChange,e.iceConnectionState)},e.onnegotiationneeded=async t=>{if(!e.remoteDescription)return;F.info("Peer onnegotiationneeded, updating local description");const n=await e.createOffer();F.info("Peer onnegotiationneeded, got local offer",n.sdp),n.sdp=be.updateMissingVideoExtensions(n.sdp,e.remoteDescription.sdp),await e.setLocalDescription(n);const i=be.renegotiate(n.sdp,e.remoteDescription.sdp);F.info("Peer onnegotiationneeded, updating remote description",i),await e.setRemoteDescription({type:"answer",sdp:i}),F.info("Peer onnegotiationneeded, renegotiation done")}},va=(r,e,t)=>{F.info("Adding mediaStream tracks to RTCPeerConnection");for(const n of e.getTracks()){const i={streams:[e]};n.kind==="audio"&&(i.direction=t.disableAudio?"inactive":"sendonly"),n.kind==="video"&&(i.direction=t.disableVideo?"inactive":"sendonly",t.scalabilityMode&&new $t().isChrome()?(F.debug("Video track with scalability mode: ".concat(t.scalabilityMode,".")),i.sendEncodings=[{scalabilityMode:t.scalabilityMode}]):t.scalabilityMode&&F.warn("SVC is only supported in Google Chrome")),r.addTransceiver(n,i),F.info("Track '".concat(n.label,"' added: "),"id: ".concat(n.id),"kind: ".concat(n.kind))}},wa=(r,e)=>{const t=new $t;if(!e.disableVideo){const n=r.addTransceiver("video",{direction:"recvonly"});t.isOpera()&&n.setCodecPreferences(RTCRtpReceiver.getCapabilities("video").codecs.filter(i=>i.mimeType!=="video/H264"||i.sdpFmtpLine.includes("profile-level-id=4")))}e.disableAudio||r.addTransceiver("audio",{direction:"recvonly"});for(let n=0;n<e.multiplexedAudioTracks;n++)r.addTransceiver("audio",{direction:"recvonly"})},Sa=r=>{var e;const t=(e=r.connectionState)!=null?e:r.iceConnectionState;switch(t){case"checking":return"connecting";case"completed":return"connected";default:return t}};var yn={};Object.defineProperty(yn,"__esModule",{value:!0}),yn.TypedEmitter=Yr.EventEmitter;const{TypedEmitter:ts}=yn;class Ia extends ts{constructor(e,t){super(),this.namespace=e,this.tm=t}cmd(e,t){return this.tm.cmd(e,t,this.namespace)}event(e,t){return this.tm.event(e,t,this.namespace)}close(){return this.tm.namespaces.delete(this.namespace)}}class Ra extends ts{constructor(e){super(),this.maxId=0,this.namespaces=new Map,this.transactions=new Map,this.transport=e,this.listener=t=>{let n;try{n=JSON.parse(t.utf8Data||t.data||t)}catch{return}switch(n.type){case"cmd":const{transId:a}=n,l={name:n.name,data:n.data,namespace:n.namespace,accept:h=>{this._send({type:"response",transId:a,data:h})},reject:h=>{this._send({type:"error",transId:a,data:h})}};if(l.namespace){const h=this.namespaces.get(l.namespace);h?h.emit("cmd",l):this.emit("cmd",l)}else this.emit("cmd",l);break;case"response":{const h=this.transactions.get(n.transId);if(!h)return;this.transactions.delete(n.transId),h.resolve(n.data);break}case"error":{const h=this.transactions.get(n.transId);if(!h)return;this.transactions.delete(n.transId),h.reject(n.data);break}case"event":const o={name:n.name,data:n.data,namespace:n.namespace};if(o.namespace){var i=this.namespaces.get(o.namespace);i?i.emit("event",o):this.emit("event",o)}else this.emit("event",o);break}},this.transport.addListener?this.transport.addListener("message",this.listener):this.transport.addEventListener("message",this.listener)}_send(e){this.transport.send(JSON.stringify(e))}cmd(e,t,n=void 0){return new Promise((i,a)=>{if(!e||e.length===0)throw new Error("Bad command name");const l={type:"cmd",transId:this.maxId++,name:e,data:t};n&&(l.namespace=n),this.transactions.set(l.transId,Je(ne({},l),{resolve:i,reject:a}));try{this._send(l)}catch(o){throw this.transactions.delete(l.transId),o}})}event(e,t,n=void 0){if(!e||e.length===0)throw new Error("Bad event name");const i={type:"event",name:e,data:t};n&&(i.namespace=n),this._send(i)}namespace(e){let t=this.namespaces.get(e);return t||(t=new Ia(e,this),this.namespaces.set(e,t),t)}close(){for(const e of this.namespaces.values())e.close();this.transport.removeListener?this.transport.removeListener("message",this.listener):this.transport.removeEventListener("message",this.listener)}}var Ca=Ra;const ka=Mt(Ca),ie=Ae.get("Signaling"),je={connectionSuccess:"wsConnectionSuccess",connectionError:"wsConnectionError",connectionClose:"wsConnectionClose",broadcastEvent:"broadcastEvent"};class Ea extends wr{constructor(e={streamName:null,url:"ws://localhost:8080/"}){super(),this.streamName=e.streamName,this.wsUrl=e.url,this.webSocket=null,this.transactionManager=null,this.serverId=null,this.clusterId=null,this.streamViewId=null}async connect(){var e;return ie.info("Connecting to Signaling Server"),this.transactionManager&&((e=this.webSocket)==null?void 0:e.readyState)===WebSocket.OPEN?(ie.info("Connected to server: ",this.webSocket.url),ie.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(je.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),this.webSocket):new Promise((t,n)=>{this.webSocket=new WebSocket(this.wsUrl),this.transactionManager=new ka(this.webSocket),this.webSocket.onopen=()=>{ie.info("WebSocket opened"),this.transactionManager.on("event",i=>{this.emit(je.broadcastEvent,i)}),ie.info("Connected to server: ",this.webSocket.url),ie.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(je.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),t(this.webSocket)},this.webSocket.onerror=()=>{ie.error("WebSocket not connected: ",this.webSocket.url),this.emit(je.connectionError,this.webSocket.url),n(this.webSocket.url)},this.webSocket.onclose=()=>{this.webSocket=null,this.transactionManager=null,ie.info("Connection closed with Signaling Server."),this.emit(je.connectionClose)}})}close(){var e;ie.info("Closing connection with Signaling Server."),(e=this.webSocket)==null||e.close()}async subscribe(e,t,n=null,i=null){var a,l,o,h;ie.info("Starting subscription to streamName: ",this.streamName),ie.debug("Subcription local description: ",e);const d=xa(t,n,i);e=be.adaptCodecName(e,"AV1X",Ke.AV1);const p=["active","inactive","layers","viewercount","vad","updated","migrate","stopped"];let b={sdp:e,streamId:this.streamName,pinnedSourceId:d.pinnedSourceId,excludedSourceIds:d.excludedSourceIds,events:p};d.vad&&(b.vad=!0),Array.isArray(d.events)&&(b.events=d.events),d.forcePlayoutDelay&&(b.forcePlayoutDelay=d.forcePlayoutDelay),d.layer&&(b.layer=d.layer),d.forceSmooth&&(b.forceSmooth=t.forceSmooth),d.customKeys&&(b=ne(ne({},b),d.customKeys));try{if(d.disableVideo&&d.disableAudio)throw new Error("Not attempting to connect as video and audio are disabled");await this.connect(),ie.info("Sending view command",b);const m=await this.transactionManager.cmd("view",b),f=(h=(o=(l=(a=RTCRtpReceiver.getCapabilities)==null?void 0:a.call(RTCRtpReceiver,"video"))==null?void 0:l.codecs)==null?void 0:o.find)==null?void 0:h.call(o,g=>g.mimeType==="video/AV1X");return m.sdp=f?be.adaptCodecName(m.sdp,Ke.AV1,"AV1X"):m.sdp,ie.info("Command sent, subscriberId: ",m.subscriberId),ie.debug("Command result: ",m),this.serverId=m.subscriberId,this.clusterId=m.clusterId,this.streamViewId=m.streamViewId,Re.initStreamName(this.streamName),Re.initSubscriberId(this.serverId),Re.initStreamViewId(m.streamViewId),Re.setClusterId(this.clusterId),m.sdp}catch(m){throw ie.error("Error sending view command, error: ",m),m}}async publish(e,t,n=null,i=null){var a,l,o,h,d,p,b,m;const f=Za(t,n,i);ie.info("Starting publishing to streamName: ".concat(this.streamName,", codec: ").concat(f.codec)),ie.debug("Publishing local description: ",e);const g=(h=(o=(l=(a=er.getCapabilities)==null?void 0:a.call(er,"video"))==null?void 0:l.codecs)==null?void 0:o.map(C=>C.codec))!=null?h:[],y=Object.values(Ke);if(y.indexOf(f.codec)===-1)throw ie.error("Invalid codec ".concat(f.codec,". Possible values are: "),y),new Error("Invalid codec ".concat(f.codec,". Possible values are: ").concat(y));if(g.length>0&&g.indexOf(f.codec)===-1)throw ie.error("Unsupported codec ".concat(f.codec,". Possible values are: "),g),new Error("Unsupported codec ".concat(f.codec,". Possible values are: ").concat(g));f.codec===Ke.AV1&&(e=be.adaptCodecName(e,"AV1X",Ke.AV1));const S={name:this.streamName,sdp:e,codec:f.codec,sourceId:f.sourceId};if(f.priority)if(Number.isInteger(f.priority)&&f.priority>=-2147483648&&f.priority<=2147483647)S.priority=f.priority;else throw new Error("Invalid value for priority option. It should be a decimal integer between the range [-2^31, +2^31 - 1]");f.record!==null&&(S.record=f.record),Array.isArray(f.events)&&(S.events=f.events);try{if(f.disableVideo&&f.disableAudio)throw new Error("Not attempting to connect as video and audio are disabled");await this.connect(),ie.info("Sending publish command");const C=await this.transactionManager.cmd("publish",S);if(f.codec===Ke.AV1){const x=(m=(b=(p=(d=RTCRtpSender.getCapabilities)==null?void 0:d.call(RTCRtpSender,"video"))==null?void 0:p.codecs)==null?void 0:b.find)==null?void 0:m.call(b,L=>L.mimeType==="video/AV1X");C.sdp=x?be.adaptCodecName(C.sdp,Ke.AV1,"AV1X"):C.sdp}return ie.info("Command sent, publisherId: ",C.publisherId),ie.debug("Command result: ",C),this.serverId=C.publisherId,this.clusterId=C.clusterId,Re.initStreamName(this.streamName),Re.initSubscriberId(this.serverId),Re.initFeedId(C.feedId),Re.setClusterId(this.clusterId),C.sdp}catch(C){throw ie.error("Error sending publish command, error: ",C),C}}async cmd(e,t){return ie.info("Sending cmd: ".concat(e)),this.transactionManager.cmd(e,t)}}const xa=(r,e,t)=>{let n=typeof r=="object"?r:{};return Object.keys(n).length===0&&(n={vad:r,pinnedSourceId:e,excludedSourceIds:t}),n},Za=(r,e,t)=>{let n=typeof r=="object"?r:{};if(Object.keys(n).length===0){const i=Ke.H264;n={codec:r??i,record:e,sourceId:t}}return n};class vn extends Error{constructor(e,t){super(e),this.name="FetchError",this.status=t}}const Ct=Ae.get("Director"),Ta={WEBRTC:"WebRtc",RTMP:"Rtmp"};let rs="",ns="https://director.millicast.com";const Xe={setEndpoint:r=>{ns=r.replace(/\/$/,"")},getEndpoint:()=>ns,setLiveDomain:r=>{rs=r.replace(/\/$/,"")},getLiveDomain:()=>rs,getPublisher:async(r,e=null,t=Ta.WEBRTC)=>{const n=La(r,e,t);Ct.info("Getting publisher connection path for stream name: ",n.streamName);const i={streamName:n.streamName,streamType:n.streamType},a={"Content-Type":"application/json",Authorization:"Bearer ".concat(n.token)},l="".concat(Xe.getEndpoint(),"/api/director/publish");try{const o=await fetch(l,{method:"POST",headers:a,body:JSON.stringify(i)});let h=await o.json();if(h.status==="fail")throw new vn(h.data.message,o.status);return h=is(h),Ct.debug("Getting publisher response: ",h),Re.initAccountId(h.data.streamAccountId),h.data}catch(o){throw Ct.error("Error while getting publisher connection path. ",o),o}},getSubscriber:async(r,e=null,t=null)=>{const n=Ma(r,e,t);Re.initAccountId(n.streamAccountId),Ct.info("Getting subscriber connection data for stream name: ".concat(n.streamName," and account id: ").concat(n.streamAccountId));const i={streamAccountId:n.streamAccountId,streamName:n.streamName};let a={"Content-Type":"application/json"};n.subscriberToken&&(a=Je(ne({},a),{Authorization:"Bearer ".concat(n.subscriberToken)}));const l="".concat(Xe.getEndpoint(),"/api/director/subscribe");try{const o=await fetch(l,{method:"POST",headers:a,body:JSON.stringify(i)});let h=await o.json();if(h.status==="fail")throw new vn(h.data.message,o.status);return h=is(h),Ct.debug("Getting subscriber response: ",h),n.subscriberToken&&(h.data.subscriberToken=n.subscriberToken),h.data}catch(o){throw Ct.error("Error while getting subscriber connection path. ",o),o}}},La=(r,e,t)=>{let n=typeof r=="object"?r:{};return Object.keys(n).length===0&&(n={token:r,streamName:e,streamType:t}),n},Ma=(r,e,t)=>{let n=typeof r=="object"?r:{};return Object.keys(n).length===0&&(n={streamName:r,streamAccountId:e,subscriberToken:t}),n},is=r=>{if(Xe.getLiveDomain()){const e=/\/\/(.*?)\//,t=r.data.urls.map(n=>{const i=e.exec(n);return n.replace(i[1],Xe.getLiveDomain())});r.data.urls=t}if(r.data.drmObject){const e=r.data.drmObject.playReadyUrl;e&&(r.data.drmObject.playReadyUrl="".concat(Xe.getEndpoint()).concat(e));const t=r.data.drmObject.widevineUrl;t&&(r.data.drmObject.widevineUrl="".concat(Xe.getEndpoint()).concat(t));const n=r.data.drmObject.fairPlayUrl;n&&(r.data.drmObject.fairPlayUrl="".concat(Xe.getEndpoint()).concat(n));const i=r.data.drmObject.fairPlayCertUrl;i&&(r.data.drmObject.fairPlayCertUrl="".concat(Xe.getEndpoint()).concat(i))}return r};function wn(r){this.message=r}wn.prototype=new Error,wn.prototype.name="InvalidCharacterError";var ss=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new wn("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,a=0,l="";n=e.charAt(a++);~n&&(t=i%4?64*t+n:n,i++%4)?l+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return l};function Pa(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(ss(t).replace(/(.)/g,function(n,i){var a=i.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(e)}catch{return ss(e)}}function Er(r){this.message=r}function Ua(r,e){if(typeof r!="string")throw new Er("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Pa(r.split(".")[t]))}catch(n){throw new Er("Invalid token specified: "+n.message)}}Er.prototype=new Error,Er.prototype.name="InvalidTokenError";var os={exports:{}};(function(r,e){(function(t){if(e!=null&&typeof e.nodeType!="number")r.exports=t();else{var n=t(),i=typeof self<"u"?self:$.global;typeof i.btoa!="function"&&(i.btoa=n.btoa),typeof i.atob!="function"&&(i.atob=n.atob)}})(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(l){this.message=l}n.prototype=new Error,n.prototype.name="InvalidCharacterError";function i(l){for(var o=String(l),h,d,p,b,m=0,f="";m<o.length;){if(h=o.charCodeAt(m++),d=o.charCodeAt(m++),p=o.charCodeAt(m++),h>255||d>255||p>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");b=h<<16|d<<8|p,f+=t.charAt(b>>18&63)+t.charAt(b>>12&63)+t.charAt(b>>6&63)+t.charAt(b&63)}switch(o.length%3){case 0:return f;case 1:return f.slice(0,-2)+"==";case 2:return f.slice(0,-1)+"="}}function a(l){var o=String(l).replace(/[=]+$/,"");if(o.length%4===1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var h=0,d,p,b=0,m="";p=o.charAt(b++);~p&&(d=h%4?d*64+p:p,h++%4)?m+=String.fromCharCode(255&d>>(-2*h&6)):0)p=t.indexOf(p);return m}return{btoa:i,atob:a}})})(os,os.exports);let kt;const Va=32e3,as=1e3;class Ga extends wr{constructor(e,t,n,i){if(super(),kt=n,!t)throw kt.error("Token generator is required to construct this module."),new Error("Token generator is required to construct this module.");this.webRTCPeer=new er,this.signaling=null,this.autoReconnect=i,this.reconnectionInterval=as,this.alreadyDisconnected=!1,this.firstReconnection=!0,this.stopReconnection=!1,this.isReconnecting=!1,this.tokenGenerator=t,this.options=null}getRTCPeerConnection(){return this.webRTCPeer?this.webRTCPeer.getRTCPeer():null}stop(){var e;kt.info("Stopping"),this.webRTCPeer.closeRTCPeer(),(e=this.signaling)==null||e.close(),this.signaling=null,this.stopReconnection=!0,this.webRTCPeer=new er}isActive(){const e=this.webRTCPeer.getRTCPeerStatus();return kt.info("Broadcast status: ",e||"not_established"),e==="connected"}setReconnect(){this.signaling.on("migrate",()=>this.replaceConnection()),this.autoReconnect&&(this.signaling.on(je.connectionError,()=>{(this.firstReconnection||!this.alreadyDisconnected)&&(this.firstReconnection=!1,this.reconnect({error:new Error("Signaling error: wsConnectionError")}))}),this.webRTCPeer.on(Ue.connectionStateChange,e=>{Re.setConnectionState(e),e==="connected"&&Re.setConnectionTime(new Date),(e==="failed"||e==="disconnected"&&this.alreadyDisconnected)&&this.firstReconnection?(this.firstReconnection=!1,this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")})):e==="disconnected"?(this.alreadyDisconnected=!0,setTimeout(()=>this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")}),1500)):this.alreadyDisconnected=!1}))}async reconnect(e){try{kt.info("Attempting to reconnect..."),!this.isActive()&&!this.stopReconnection&&!this.isReconnecting&&(this.stop(),this.emit("reconnect",{timeout:cs(this.reconnectionInterval),error:e!=null&&e.error?e==null?void 0:e.error:new Error("Attempting to reconnect")}),this.isReconnecting=!0,await this.connect(this.options),this.alreadyDisconnected=!1,this.reconnectionInterval=as,this.firstReconnection=!0,this.isReconnecting=!1)}catch(t){this.isReconnecting=!1,this.reconnectionInterval=cs(this.reconnectionInterval),kt.error("Reconnection failed, retrying in ".concat(this.reconnectionInterval,"ms. "),t),setTimeout(()=>this.reconnect({error:t}),this.reconnectionInterval)}}}const cs=r=>r<Va?r*2:r,ls=window.RTCRtpSender&&!!RTCRtpSender.prototype.createEncodedStreams&&window.RTCRtpReceiver&&!!RTCRtpReceiver.prototype.createEncodedStreams,Na="RTCRtpScriptTransform"in window,us="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBXPXR5cGVvZiBnbG9iYWxUaGlzPCJ1Ij9nbG9iYWxUaGlzOnR5cGVvZiB3aW5kb3c8InUiP3dpbmRvdzp0eXBlb2YgZ2xvYmFsPCJ1Ij9nbG9iYWw6dHlwZW9mIHNlbGY8InUiP3NlbGY6e307ZnVuY3Rpb24geih0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiZGVmYXVsdCIpP3QuZGVmYXVsdDp0fXZhciBCPXtleHBvcnRzOnt9fTsvKiEKICoganMtbG9nZ2VyIC0gaHR0cDovL2dpdGh1Yi5jb20vam9ubnlyZWV2ZXMvanMtbG9nZ2VyCiAqIEpvbm55IFJlZXZlcywgaHR0cDovL2pvbm55cmVldmVzLmNvLnVrLwogKiBqcy1sb2dnZXIgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqLyhmdW5jdGlvbih0KXsoZnVuY3Rpb24obil7dmFyIGU9e307ZS5WRVJTSU9OPSIxLjYuMSI7dmFyIGkscj17fSxvPWZ1bmN0aW9uKHMsdSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHUuYXBwbHkocyxhcmd1bWVudHMpfX0sYT1mdW5jdGlvbigpe3ZhciBzPWFyZ3VtZW50cyx1PXNbMF0saCxjO2ZvcihjPTE7YzxzLmxlbmd0aDtjKyspZm9yKGggaW4gc1tjXSkhKGggaW4gdSkmJnNbY10uaGFzT3duUHJvcGVydHkoaCkmJih1W2hdPXNbY11baF0pO3JldHVybiB1fSxkPWZ1bmN0aW9uKHMsdSl7cmV0dXJue3ZhbHVlOnMsbmFtZTp1fX07ZS5UUkFDRT1kKDEsIlRSQUNFIiksZS5ERUJVRz1kKDIsIkRFQlVHIiksZS5JTkZPPWQoMywiSU5GTyIpLGUuVElNRT1kKDQsIlRJTUUiKSxlLldBUk49ZCg1LCJXQVJOIiksZS5FUlJPUj1kKDgsIkVSUk9SIiksZS5PRkY9ZCg5OSwiT0ZGIik7dmFyIGw9ZnVuY3Rpb24ocyl7dGhpcy5jb250ZXh0PXMsdGhpcy5zZXRMZXZlbChzLmZpbHRlckxldmVsKSx0aGlzLmxvZz10aGlzLmluZm99O2wucHJvdG90eXBlPXtzZXRMZXZlbDpmdW5jdGlvbihzKXtzJiYidmFsdWUiaW4gcyYmKHRoaXMuY29udGV4dC5maWx0ZXJMZXZlbD1zKX0sZ2V0TGV2ZWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb250ZXh0LmZpbHRlckxldmVsfSxlbmFibGVkRm9yOmZ1bmN0aW9uKHMpe3ZhciB1PXRoaXMuY29udGV4dC5maWx0ZXJMZXZlbDtyZXR1cm4gcy52YWx1ZT49dS52YWx1ZX0sdHJhY2U6ZnVuY3Rpb24oKXt0aGlzLmludm9rZShlLlRSQUNFLGFyZ3VtZW50cyl9LGRlYnVnOmZ1bmN0aW9uKCl7dGhpcy5pbnZva2UoZS5ERUJVRyxhcmd1bWVudHMpfSxpbmZvOmZ1bmN0aW9uKCl7dGhpcy5pbnZva2UoZS5JTkZPLGFyZ3VtZW50cyl9LHdhcm46ZnVuY3Rpb24oKXt0aGlzLmludm9rZShlLldBUk4sYXJndW1lbnRzKX0sZXJyb3I6ZnVuY3Rpb24oKXt0aGlzLmludm9rZShlLkVSUk9SLGFyZ3VtZW50cyl9LHRpbWU6ZnVuY3Rpb24ocyl7dHlwZW9mIHM9PSJzdHJpbmciJiZzLmxlbmd0aD4wJiZ0aGlzLmludm9rZShlLlRJTUUsW3MsInN0YXJ0Il0pfSx0aW1lRW5kOmZ1bmN0aW9uKHMpe3R5cGVvZiBzPT0ic3RyaW5nIiYmcy5sZW5ndGg+MCYmdGhpcy5pbnZva2UoZS5USU1FLFtzLCJlbmQiXSl9LGludm9rZTpmdW5jdGlvbihzLHUpe2kmJnRoaXMuZW5hYmxlZEZvcihzKSYmaSh1LGEoe2xldmVsOnN9LHRoaXMuY29udGV4dCkpfX07dmFyIGY9bmV3IGwoe2ZpbHRlckxldmVsOmUuT0ZGfSk7KGZ1bmN0aW9uKCl7dmFyIHM9ZTtzLmVuYWJsZWRGb3I9byhmLGYuZW5hYmxlZEZvcikscy50cmFjZT1vKGYsZi50cmFjZSkscy5kZWJ1Zz1vKGYsZi5kZWJ1Zykscy50aW1lPW8oZixmLnRpbWUpLHMudGltZUVuZD1vKGYsZi50aW1lRW5kKSxzLmluZm89byhmLGYuaW5mbykscy53YXJuPW8oZixmLndhcm4pLHMuZXJyb3I9byhmLGYuZXJyb3IpLHMubG9nPXMuaW5mb30pKCksZS5zZXRIYW5kbGVyPWZ1bmN0aW9uKHMpe2k9c30sZS5zZXRMZXZlbD1mdW5jdGlvbihzKXtmLnNldExldmVsKHMpO2Zvcih2YXIgdSBpbiByKXIuaGFzT3duUHJvcGVydHkodSkmJnJbdV0uc2V0TGV2ZWwocyl9LGUuZ2V0TGV2ZWw9ZnVuY3Rpb24oKXtyZXR1cm4gZi5nZXRMZXZlbCgpfSxlLmdldD1mdW5jdGlvbihzKXtyZXR1cm4gcltzXXx8KHJbc109bmV3IGwoYSh7bmFtZTpzfSxmLmNvbnRleHQpKSl9LGUuY3JlYXRlRGVmYXVsdEhhbmRsZXI9ZnVuY3Rpb24ocyl7cz1zfHx7fSxzLmZvcm1hdHRlcj1zLmZvcm1hdHRlcnx8ZnVuY3Rpb24ocCxfKXtfLm5hbWUmJnAudW5zaGlmdCgiWyIrXy5uYW1lKyJdIil9O3ZhciB1PXt9LGg9ZnVuY3Rpb24oYyxwKXtGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChjLGNvbnNvbGUscCl9O3JldHVybiB0eXBlb2YgY29uc29sZT4idSI/ZnVuY3Rpb24oKXt9OmZ1bmN0aW9uKGMscCl7Yz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjKTt2YXIgXz1jb25zb2xlLmxvZyxnO3AubGV2ZWw9PT1lLlRJTUU/KGc9KHAubmFtZT8iWyIrcC5uYW1lKyJdICI6IiIpK2NbMF0sY1sxXT09PSJzdGFydCI/Y29uc29sZS50aW1lP2NvbnNvbGUudGltZShnKTp1W2ddPW5ldyBEYXRlKCkuZ2V0VGltZSgpOmNvbnNvbGUudGltZUVuZD9jb25zb2xlLnRpbWVFbmQoZyk6aChfLFtnKyI6ICIrKG5ldyBEYXRlKCkuZ2V0VGltZSgpLXVbZ10pKyJtcyJdKSk6KHAubGV2ZWw9PT1lLldBUk4mJmNvbnNvbGUud2Fybj9fPWNvbnNvbGUud2FybjpwLmxldmVsPT09ZS5FUlJPUiYmY29uc29sZS5lcnJvcj9fPWNvbnNvbGUuZXJyb3I6cC5sZXZlbD09PWUuSU5GTyYmY29uc29sZS5pbmZvP189Y29uc29sZS5pbmZvOnAubGV2ZWw9PT1lLkRFQlVHJiZjb25zb2xlLmRlYnVnP189Y29uc29sZS5kZWJ1ZzpwLmxldmVsPT09ZS5UUkFDRSYmY29uc29sZS50cmFjZSYmKF89Y29uc29sZS50cmFjZSkscy5mb3JtYXR0ZXIoYyxwKSxoKF8sYykpfX0sZS51c2VEZWZhdWx0cz1mdW5jdGlvbihzKXtlLnNldExldmVsKHMmJnMuZGVmYXVsdExldmVsfHxlLkRFQlVHKSxlLnNldEhhbmRsZXIoZS5jcmVhdGVEZWZhdWx0SGFuZGxlcihzKSl9LGUuc2V0RGVmYXVsdHM9ZS51c2VEZWZhdWx0cyx0LmV4cG9ydHM/dC5leHBvcnRzPWU6KGUuX3ByZXZMb2dnZXI9bi5Mb2dnZXIsZS5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIG4uTG9nZ2VyPWUuX3ByZXZMb2dnZXIsZX0sbi5Mb2dnZXI9ZSl9KShXKX0pKEIpO3ZhciBWPUIuZXhwb3J0cyxEPXooVik7Y2xhc3Mgd3tjb25zdHJ1Y3RvcihuKXt0aGlzLmRhdGE9bix0aGlzLmJpdE9mZnNldD0wfXJlYWRCaXRzKG4pe2lmKHRoaXMuYml0T2Zmc2V0K24+dGhpcy5kYXRhLmxlbmd0aCo4KXRocm93IG5ldyBFcnJvcigiQXR0ZW1wdGVkIHRvIHJlYWQgcGFzdCB0aGUgZW5kIG9mIHRoZSBiaXRzdHJlYW0iKTtsZXQgZT0wO2ZvcihsZXQgaT0wO2k8bjtpKyspe2NvbnN0IHI9TWF0aC5mbG9vcih0aGlzLmJpdE9mZnNldC84KSxvPTctdGhpcy5iaXRPZmZzZXQlOCxhPXRoaXMuZGF0YVtyXT4+byYxO2V8PWE8PG4tMS1pLHRoaXMuYml0T2Zmc2V0Kyt9cmV0dXJuIGV9c2tpcChuKXt0aGlzLmJpdE9mZnNldCs9bn1yZWFkRXhwR29sb21iVW5zaWduZWQoKXtsZXQgbj0tMTtmb3IobGV0IGU9MDtlPT09MDtuKyspZT10aGlzLnJlYWRCaXRzKDEpO3JldHVybigxPDxuKS0xK3RoaXMucmVhZEJpdHMobil9cmVhZEV4cEdvbG9tYlNpZ25lZCgpe2NvbnN0IG49dGhpcy5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtyZXR1cm4gbiUyPT09MD8tKG4vMik6KG4rMSkvMn19Y29uc3QgbT17U0xJQ0VfTk9OX0lEUjoxLFNMSUNFX1BBUlRJVElPTl9BOjIsU0xJQ0VfSURSOjUsU0VJX0gyNjQ6NixTRUlfSDI2NV9QUkVGSVg6MzksU0VJX0gyNjVfU1VGRklYOjQwLFNQU19IMjY0OjcsU1BTX0gyNjU6MzMsUFBTX0gyNjQ6OCxQUFNfSDI2NTozNH0sUj17UElDX1RJTUlORzoxLFVTRVJfREFUQV9VTlJFR0lTVEVSRUQ6NX0seT17TEVHQUNZOjEsTkVXOjIsVElNRUNPREU6MyxPVEhFUjo0fSxqPSI2ZTljZmQyYS01OTA3LTQ5ZmYtYjM2My04OTc4YTZlODM0MGUiLHE9IjlhMjFmM2JlLTMxZjAtNGI3OC1iMGJlLWM3ZjdkYmI5NzI1MCIsTD0iZDQwZTM4ZWEtZDQxOS00YzYyLTk0ZWQtMjBhYzM3YjRlNGZhIjtjbGFzcyBZe2NvbnN0cnVjdG9yKG49IkgyNjQiKXt0aGlzLnNwcz1uZXcgTWFwLHRoaXMucHBzPW5ldyBNYXAsdGhpcy5hY3RpdmVTUFM9bnVsbCx0aGlzLmNvZGVjPW59Y29sbGVjdFBQUyhuKXt0aGlzLmNvZGVjPT09IkgyNjQiP3RoaXMuY29sbGVjdEgyNjRQUFMobik6dGhpcy5jb2xsZWN0SDI2NVBQUyhuKX1jb2xsZWN0U1BTKG4pe3RoaXMuY29kZWM9PT0iSDI2NCI/dGhpcy5jb2xsZWN0SDI2NFNQUyhuKTp0aGlzLmNvbGxlY3RIMjY1U1BTKG4pfWNvbGxlY3RIMjY0U1BTKG4pe2NvbnN0IGU9bmV3IHcobiksaT1lLnJlYWRCaXRzKDgpLHI9WzEwMCwxMTAsMTIyLDI0NCw0NCw4Myw4NiwxMTgsMTI4LDEzOCwxMzksMTM0LDEzNV07ZS5za2lwKDgpLGUuc2tpcCg4KTtjb25zdCBvPWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7aWYobz4zMXx8bzwwKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBzZXFfcGFyYW1ldGVyX3NldF9pZCIpO2lmKHIuaW5jbHVkZXMoaSkpe2NvbnN0IGw9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtpZihsPT09MyYmZS5za2lwKDEpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnNraXAoMSksZS5yZWFkQml0cygxKSl7Y29uc3Qgcz1sIT09Mz84OjEyO2ZvcihsZXQgdT0wO3U8czt1KyspaWYoZS5yZWFkQml0cygxKSl7Y29uc3QgaD11PDY/MTY6NjQ7bGV0IGM9OCxwPTg7Zm9yKGxldCBfPTA7XzxoO18rKyl7aWYocCE9PTApe2NvbnN0IGc9ZS5yZWFkRXhwR29sb21iU2lnbmVkKCk7cD0oYytnKzI1NiklMjU2fWM9cD09PTA/YzpwfX19fWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7Y29uc3QgYT1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2lmKGE9PT0wKWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7ZWxzZSBpZihhPT09MSl7ZS5za2lwKDEpLGUucmVhZEV4cEdvbG9tYlNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlNpZ25lZCgpO2NvbnN0IGw9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtmb3IobGV0IGY9MDtmPGw7ZisrKWUucmVhZEV4cEdvbG9tYlNpZ25lZCgpfWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5za2lwKDEpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnJlYWRCaXRzKDEpPT09MCYmZS5za2lwKDEpLGUuc2tpcCgxKSxlLnJlYWRCaXRzKDEpJiYoZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSk7bGV0IGQ7aWYoZS5yZWFkQml0cygxKSl7bGV0IGY9ZnVuY3Rpb24oYyl7Y29uc3QgcD1jLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2Muc2tpcCg0KSxjLnNraXAoNCk7Zm9yKGxldCB4PTA7eDw9cDt4KyspYy5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxjLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGMuc2tpcCgxKTtjLnNraXAoNSk7Y29uc3QgXz1jLnJlYWRCaXRzKDUpLGc9Yy5yZWFkQml0cyg1KSxBPWMucmVhZEJpdHMoNSk7cmV0dXJue2NwYl9yZW1vdmFsX2RlbGF5X2xlbmd0aF9taW51czE6XyxkcGJfb3V0cHV0X2RlbGF5X2xlbmd0aF9taW51czE6Zyx0aW1lX29mZnNldF9sZW5ndGg6QX19O2UucmVhZEJpdHMoMSkmJmUucmVhZEJpdHMoOCk9PT0yNTUmJihlLnNraXAoMTYpLGUuc2tpcCgxNikpLGUucmVhZEJpdHMoMSkmJmUuc2tpcCgxKSxlLnJlYWRCaXRzKDEpJiYoZS5za2lwKDMpLGUuc2tpcCgxKSxlLnJlYWRCaXRzKDEpJiZlLnNraXAoMjQpKSxlLnJlYWRCaXRzKDEpJiYoZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpKTtjb25zdCBsPWUucmVhZEJpdHMoMSk/e251bV91bml0c19pbl90aWNrOmUucmVhZEJpdHMoMzIpLHRpbWVfc2NhbGU6ZS5yZWFkQml0cygzMiksZml4ZWRfZnJhbWVfcmF0ZV9mbGFnOmUucmVhZEJpdHMoMSl9OnZvaWQgMCxzPWUucmVhZEJpdHMoMSk/ZihlKTp2b2lkIDAsdT1lLnJlYWRCaXRzKDEpP2YoZSk6dm9pZCAwOyhzfHx1KSYmZS5za2lwKDEpO2NvbnN0IGg9ZS5yZWFkQml0cygxKTtkPXt0aW1pbmdfaW5mbzpsLG5hbF9ocmRfcGFyYW1ldGVyczpzLHZjbF9ocmRfcGFyYW1ldGVyczp1LHBpY19zdHJ1Y3RfcHJlc2VudF9mbGFnOmh9fXRoaXMuc3BzLnNldChvLHt2dWlfcGFyYW1ldGVyczpkfSl9Y29sbGVjdEgyNjVTUFMobil7fWNvbGxlY3RIMjY0UFBTKG4pe2NvbnN0IGU9bmV3IHcobiksaT1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2lmKGk+MjU1fHxpPDApdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBpY19wYXJhbWV0ZXJfc2V0X2lkIik7Y29uc3Qgcj1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO3RoaXMucHBzLnNldChpLHtzZXFfcGFyYW1ldGVyX3NldF9pZDpyfSl9Y29sbGVjdEgyNjVQUFMobil7fWZpbmRBY3RpdmVTUFMobil7Y29uc3QgZT1uZXcgdyhuKTtlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7Y29uc3QgaT1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLHI9dGhpcy5wcHMuZ2V0KGkpO2lmKHIpe2NvbnN0IG89dGhpcy5zcHMuZ2V0KHIuc2VxX3BhcmFtZXRlcl9zZXRfaWQpO2lmKG8pe3RoaXMuYWN0aXZlU1BTPW87cmV0dXJufX10aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIHRoZSBhY3RpdmUgU1BTIil9fWNvbnN0IEU9bmV3IFk7ZnVuY3Rpb24gRyh0LG4pe2Zvcig7bjx0LmJ5dGVMZW5ndGgtNDspe2lmKHRbbl09PT0wJiZ0W24rMV09PT0wJiYodFtuKzJdPT09MXx8dFtuKzJdPT09MCYmdFtuKzNdPT09MSkpcmV0dXJuIG47bis9MX1yZXR1cm4tMX1mdW5jdGlvbiBVKHQpe2NvbnN0IG49bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoKTtsZXQgZT0wLGk9MDtmb3IobGV0IHI9MjtyPHQuYnl0ZUxlbmd0aDtyKyspdFtyXT09PTMmJnRbci0xXT09PTAmJnRbci0yXT09PTAmJihuLnNldCh0LnN1YmFycmF5KGksciksZSksZSs9ci1pLGk9cisxKTtyZXR1cm4gaTx0LmJ5dGVMZW5ndGgmJm4uc2V0KHQuc3ViYXJyYXkoaSksZSksbn1mdW5jdGlvbiBYKHQsbil7bGV0IGU9MDtjb25zdCBpPW49PT0iSDI2NCI/MToyLHI9W107Zm9yKDtlPHQuYnl0ZUxlbmd0aC00Oyl7Y29uc3Qgbz1HKHQsZSk7aWYobz49ZSl7Y29uc3QgYT10W28rMl09PT0xPzM6NCxkPUcodCxvK2EraSk7aWYoZD5vKXIucHVzaCh0LnN1YmFycmF5KG8sZCkpLGU9ZDtlbHNle3IucHVzaCh0LnN1YmFycmF5KG8pKTticmVha319ZWxzZSBicmVha31yZXR1cm4gcn1mdW5jdGlvbiAkKHQsbil7bGV0IGU9ITA7cmV0dXJuIFgodCxuKS5maWx0ZXIoaT0+e2NvbnN0IHI9aVsyXT09PTE/Mzo0LG89bj09PSJIMjY0Ij8xOjIsYT1pW3JdLGQ9bj09PSJIMjY0Ij9hJjMxOmE+PjEmNjM7aWYoZSlzd2l0Y2goZCl7Y2FzZSBtLlBQU19IMjY0OmNhc2UgbS5QUFNfSDI2NTpFLmNvbGxlY3RQUFMoVShpLnN1YmFycmF5KHIrbykpKTticmVhaztjYXNlIG0uU1BTX0gyNjQ6Y2FzZSBtLlNQU19IMjY1OkUuY29sbGVjdFNQUyhVKGkuc3ViYXJyYXkocitvKSkpO2JyZWFrO2Nhc2UgbS5TTElDRV9JRFI6Y2FzZSBtLlNMSUNFX05PTl9JRFI6Y2FzZSBtLlNMSUNFX1BBUlRJVElPTl9BOnRyeXtFLmZpbmRBY3RpdmVTUFMoVShpLnN1YmFycmF5KHIrbykpKSxlPSExfWNhdGNoKGwpe2NvbnNvbGUuaW5mbygiRmFpbGVkIHRvIGZpbmQgYWN0aXZlIFNQUy4gV2lsbCBub3QgYmUgYWJsZSB0byBleHRyYWN0IFBJQyB0aW1pbmcgbWV0YWRhdGEiKX1icmVha31yZXR1cm5bbS5TRUlfSDI2NCxtLlNFSV9IMjY1X1BSRUZJWCxtLlNFSV9IMjY1X1NVRkZJWF0uaW5jbHVkZXMoZCl9KX1mdW5jdGlvbiBKKHQpe2xldCBuPTAsZT0wO2Zvcig7dFtlXT09PTI1NTspbis9MjU1LGUrKztuKz10W2VdLGUrKztsZXQgaT0wO2Zvcig7dFtlXT09PTI1NTspaSs9MjU1LGUrKztyZXR1cm4gaSs9dFtlXSxlKysse3R5cGU6bixjb250ZW50OnQuc3ViYXJyYXkoZSxlK2kpfX1mdW5jdGlvbiBLKHQpe2NvbnN0IG49bmV3IFVpbnQ4QXJyYXkoVChxKSksZT1uZXcgVWludDhBcnJheShUKGopKSxpPW5ldyBVaW50OEFycmF5KFQoTCkpO3JldHVybiBuLmV2ZXJ5KChyLG8pPT5yPT09dFtvXSk/eS5USU1FQ09ERTplLmV2ZXJ5KChyLG8pPT5yPT09dFtvXSk/eS5MRUdBQ1k6aS5ldmVyeSgocixvKT0+cj09PXRbb10pP3kuTkVXOnkuT1RIRVJ9ZnVuY3Rpb24gWih0LG4pe2xldCBlPTA7dC51dWlkPW4uc3ViYXJyYXkoZSxlKzE2KSxlKz0xNjtjb25zdCBpPUsodC51dWlkKSxyPW4uc3ViYXJyYXkoZSk7c3dpdGNoKGkpe2Nhc2UgeS5MRUdBQ1k6Y2FzZSB5Lk9USEVSOnQudW5yZWdpc3RlcmVkPXI7YnJlYWs7Y2FzZSB5LlRJTUVDT0RFOnQudGltZWNvZGU9TyhyKTticmVhaztjYXNlIHkuTkVXOntsZXQgbz0wO2NvbnN0IGE9QyhEYXRlLm5vdygpKS5sZW5ndGgsZD1yLnN1YmFycmF5KG8sYSk7bys9YTtjb25zdCBsPXIuc3ViYXJyYXkobyk7dC50aW1lY29kZT1PKGQpLHQudW5yZWdpc3RlcmVkPWw7YnJlYWt9fX1mdW5jdGlvbiBPKHQpe2NvbnN0IG49dC5yZWR1Y2UoKG8sYSk9PihvPDxCaWdJbnQoOCkpK0JpZ0ludChhKSxCaWdJbnQoMCkpLGU9TnVtYmVyKG4pLGk9bmV3IERhdGUoZSk7cmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShpLnRvSVNPU3RyaW5nKCkpfWZ1bmN0aW9uIFEodCxuKXt2YXIgZixzLHUsaCxjO2lmKCFFLmFjdGl2ZVNQUyl7Y29uc29sZS53YXJuKCJDYW5ub3QgZmluZCB0aGUgYWN0aXZlIFNQUyIpO3JldHVybn1jb25zdCBlPShmPUUuYWN0aXZlU1BTLnZ1aV9wYXJhbWV0ZXJzLm5hbF9ocmRfcGFyYW1ldGVycykhPW51bGw/ZjpFLmFjdGl2ZVNQUy52dWlfcGFyYW1ldGVycy52Y2xfaHJkX3BhcmFtZXRlcnMsaT17Y3BiX2RwYl9kZWxheXNfcHJlc2VudF9mbGFnOmU/MTowLGNwYl9yZW1vdmFsX2RlbGF5X2xlbmd0aF9taW51czE6KHM9ZT09bnVsbD92b2lkIDA6ZS5jcGJfcmVtb3ZhbF9kZWxheV9sZW5ndGhfbWludXMxKSE9bnVsbD9zOjIzLGRwYl9vdXRwdXRfZGVsYXlfbGVuZ3RoX21pbnVzMToodT1lPT1udWxsP3ZvaWQgMDplLmRwYl9vdXRwdXRfZGVsYXlfbGVuZ3RoX21pbnVzMSkhPW51bGw/dToyMyx0aW1lX29mZnNldF9sZW5ndGg6ZT8oaD1lLnRpbWVfb2Zmc2V0X2xlbmd0aCkhPW51bGw/aDoyNDp2b2lkIDAscGljX3N0cnVjdF9wcmVzZW50X2ZsYWc6KGM9RS5hY3RpdmVTUFMudnVpX3BhcmFtZXRlcnMucGljX3N0cnVjdF9wcmVzZW50X2ZsYWcpIT1udWxsP2M6MH07aWYoIWkucGljX3N0cnVjdF9wcmVzZW50X2ZsYWcpe2NvbnNvbGUud2FybigicGljX3N0cnVjdF9wcmVzZW50X2ZsYWcgaXMgbm90IHByZXNlbnQiKTtyZXR1cm59Y29uc3Qgcj1uZXcgdyhuKTtpLmNwYl9kcGJfZGVsYXlzX3ByZXNlbnRfZmxhZyYmKHIuc2tpcChpLmNwYl9yZW1vdmFsX2RlbGF5X2xlbmd0aF9taW51czErMSksci5za2lwKGkuZHBiX291dHB1dF9kZWxheV9sZW5ndGhfbWludXMxKzEpKTtjb25zdCBvPVsxLDEsMSwyLDIsMywzLDIsM10sYT1yLnJlYWRCaXRzKDQpO2lmKGE+PW8ubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwaWNfc3RydWN0Iik7Y29uc3QgZD1vW2FdLGw9W107Zm9yKGxldCBwPTA7cDxkO3ArKylpZihyLnJlYWRCaXRzKDEpKXtjb25zdCBnPXt9O3Iuc2tpcCgyKSxyLnNraXAoMSksci5za2lwKDUpO2NvbnN0IEE9ci5yZWFkQml0cygxKTtpZihyLnNraXAoMiksZy5uX2ZyYW1lcz1yLnJlYWRCaXRzKDgpLEE/KGcuc2Vjb25kc192YWx1ZT1yLnJlYWRCaXRzKDYpLGcubWludXRlc192YWx1ZT1yLnJlYWRCaXRzKDYpLGcuaG91cnNfdmFsdWU9ci5yZWFkQml0cyg1KSk6ci5yZWFkQml0cygxKSYmKGcuc2Vjb25kc192YWx1ZT1yLnJlYWRCaXRzKDYpLHIucmVhZEJpdHMoMSkmJihnLm1pbnV0ZXNfdmFsdWU9ci5yZWFkQml0cyg2KSxyLnJlYWRCaXRzKDEpJiYoZy5ob3Vyc192YWx1ZT1yLnJlYWRCaXRzKDUpKSkpLGkudGltZV9vZmZzZXRfbGVuZ3RoKXRyeXtnLnRpbWVfb2Zmc2V0PXIucmVhZEJpdHMoaS50aW1lX29mZnNldF9sZW5ndGgpfWNhdGNoKHgpe2NvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byByZWFkIHRpbWVfb2Zmc2V0Iix4KSxnLnRpbWVfb2Zmc2V0PTB9ZWxzZSBnLnRpbWVfb2Zmc2V0PTA7bC5wdXNoKGcpfXQuc2VpUGljVGltaW5nVGltZUNvZGVBcnJheT1sfWZ1bmN0aW9uIGVlKHQsbil7aWYobiE9PSJIMjY0IiYmbiE9PSJIMjY1Iil0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGNvZGVjICIuY29uY2F0KG4pKTtjb25zdCBlPXt9O3JldHVybiBFLmNvZGVjPW4sJChuZXcgVWludDhBcnJheSh0LmRhdGEpLG4pLmZvckVhY2goaT0+e2NvbnN0IHI9aVsyXT09PTE/Mzo0LG89bj09PSJIMjY0Ij8xOjIsYT1VKGkuc3ViYXJyYXkocitvKSksZD1KKGEpO3N3aXRjaChkLnR5cGUpe2Nhc2UgUi5QSUNfVElNSU5HOlEoZSxkLmNvbnRlbnQpO2JyZWFrO2Nhc2UgUi5VU0VSX0RBVEFfVU5SRUdJU1RFUkVEOlooZSxkLmNvbnRlbnQpO2JyZWFrfX0pLGV9ZnVuY3Rpb24gdGUodCl7cmV0dXJuL15bMC05YS1mQS1GXXs4fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXsxMn0kLy50ZXN0KHQpfWZ1bmN0aW9uIFQodCl7cmV0dXJuIHQucmVwbGFjZSgvLS9nLCIiKS5tYXRjaCgvLnsxLDJ9L2cpLm1hcChuPT5wYXJzZUludChuLDE2KSl9ZnVuY3Rpb24gbmUodCxuLGUpe2NvbnN0IGk9bmV3IFVpbnQ4QXJyYXkoVCh0KSkscj1DKGUpLG89bmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpTT04uc3RyaW5naWZ5KG4pKSxhPW5ldyBVaW50OEFycmF5KGkubGVuZ3RoK3IubGVuZ3RoK28ubGVuZ3RoKTtyZXR1cm4gYS5zZXQoaSksYS5zZXQocixpLmxlbmd0aCksYS5zZXQobyxyLmxlbmd0aCtpLmxlbmd0aCksYX1mdW5jdGlvbiByZSh0KXtjb25zdCBuPVtdLGU9TWF0aC5mbG9vcih0LmJ5dGVMZW5ndGgvMjU1KSxpPXQuYnl0ZUxlbmd0aCUyNTU7Zm9yKGxldCByPTA7cjxlO3IrKyluLnB1c2goMjU1KTtyZXR1cm4gbi5wdXNoKGkpLG5ldyBVaW50OEFycmF5KFs1LC4uLm5dKX1mdW5jdGlvbiBpZSh0KXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8dC5ieXRlTGVuZ3RoO2UrKyllKzI8dC5ieXRlTGVuZ3RoJiZbMCwxLDIsM10uaW5jbHVkZXModFtlKzJdKSYmdFtlXT09PTAmJnRbZSsxXT09PTA/KG4ucHVzaCh0W2VdKSxuLnB1c2godFtlKzFdKSxlKz0yLG4ucHVzaCgzKSk6bi5wdXNoKHRbZV0pO3JldHVybiBuLnB1c2goMTI4KSxuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBDKHQpe2NvbnN0IG49W107aWYoIWlzTmFOKHQpKXtjb25zdCBlPUJpZ0ludCh0KTtmb3IobGV0IGk9MDtpPE1hdGguY2VpbChNYXRoLmZsb29yKE1hdGgubG9nMihuZXcgTnVtYmVyKHQpKSsxKS84KTtpKyspbi51bnNoaWZ0KG5ldyBOdW1iZXIoZT4+QmlnSW50KDgqaSkmQmlnSW50KDI1NSkpKX1yZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9ZnVuY3Rpb24gc2Uoe3V1aWQ6dCxwYXlsb2FkOm4sdGltZWNvZGU6ZX0pe2NvbnN0IGk9WzAsMCwwLDFdLHI9WzEwMl0sbz1uZSh0LG4sZSksYT1yZShvKSxkPWllKG8pLGw9bmV3IFVpbnQ4QXJyYXkoaS5sZW5ndGgrci5sZW5ndGgrYS5sZW5ndGgrZC5sZW5ndGgpO3JldHVybiBsLnNldChpKSxsLnNldChyLGkubGVuZ3RoKSxsLnNldChhLGkubGVuZ3RoK3IubGVuZ3RoKSxsLnNldChkLGkubGVuZ3RoK3IubGVuZ3RoK2EubGVuZ3RoKSxsfWZ1bmN0aW9uIG9lKHt1dWlkOnQscGF5bG9hZDpuLHRpbWVjb2RlOmV9LGkpe2lmKHQ9PT0iInx8bj09PSIiKXRocm93IG5ldyBFcnJvcigidXVpZCBhbmQgcGF5bG9hZCBjYW5ub3QgYmUgZW1wdHkiKTt0ZSh0KXx8KGNvbnNvbGUud2FybigiSW52YWxpZCBVVUlELiBVc2luZyBkZWZhdWx0IFVVSUQuIiksdD1MLGU9RGF0ZS5ub3coKSk7Y29uc3Qgcj1zZSh7dXVpZDp0LHBheWxvYWQ6bix0aW1lY29kZTplfSksbz1uZXcgRGF0YVZpZXcoaS5kYXRhKSxhPW5ldyBBcnJheUJ1ZmZlcihpLmRhdGEuYnl0ZUxlbmd0aCtyLmJ5dGVMZW5ndGgpLGQ9bmV3IERhdGFWaWV3KGEpO2ZvcihsZXQgbD0wO2w8aS5kYXRhLmJ5dGVMZW5ndGg7bCsrKWQuc2V0VWludDgobCxvLmdldFVpbnQ4KGwpKTtmb3IobGV0IGw9MDtsPHIuYnl0ZUxlbmd0aDtsKyspZC5zZXRVaW50OChpLmRhdGEuYnl0ZUxlbmd0aCtsLHJbbF0pO2kuZGF0YT1hfUQuZ2V0KCJUcmFuc2Zvcm1Xb3JrZXIiKS5zZXRMZXZlbChELkRFQlVHKTtjb25zdCBhZT0yZTMsYj1bXTtsZXQgUz0iIixQPXt9O2NvbnN0IHY9e307bGV0IEk9W107ZnVuY3Rpb24gSCh0KXtyZXR1cm4gbmV3IFRyYW5zZm9ybVN0cmVhbSh7c3RhcnQoKXt9LGZsdXNoKCl7fSxhc3luYyB0cmFuc2Zvcm0obixlKXt2YXIgaSxyO2lmKE0obikpe2NvbnN0IG89KChpPVBbbi5nZXRNZXRhZGF0YSgpLnBheWxvYWRUeXBlXSk9PW51bGw/dm9pZCAwOmkudG9VcHBlckNhc2UoKSl8fChTPT1udWxsP3ZvaWQgMDpTLnRvVXBwZXJDYXNlKCkpO2lmKG89PT0iSDI2NCIpe2NvbnN0IGE9ZWUobixvKTsoYS50aW1lY29kZXx8YS51bnJlZ2lzdGVyZWR8fCgocj1hLnNlaVBpY1RpbWluZ1RpbWVDb2RlQXJyYXkpPT1udWxsP3ZvaWQgMDpyLmxlbmd0aCk+MCkmJnNlbGYucG9zdE1lc3NhZ2Uoe2V2ZW50OiJtZXRhZGF0YSIsbWlkOnQsbWV0YWRhdGE6YX0pfXNlbGYucG9zdE1lc3NhZ2Uoe2V2ZW50OiJjb21wbGV0ZSIsZnJhbWU6e3R5cGU6bi50eXBlLHRpbWVzdGFtcDpuLnRpbWVzdGFtcCxkYXRhOm4uZGF0YX19KX1lLmVucXVldWUobil9fSl9ZnVuY3Rpb24gTSh0KXtpZih0eXBlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWU8InUiKXRyeXtpZih0IGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpcmV0dXJuITB9Y2F0Y2gobil7fXJldHVybiEhKHQuY29uc3RydWN0b3ImJnQuY29uc3RydWN0b3IubmFtZT09PSJSVENFbmNvZGVkVmlkZW9GcmFtZSJ8fHR5cGVvZiB0LndpZHRoPT0ibnVtYmVyIiYmdHlwZW9mIHQuaGVpZ2h0PT0ibnVtYmVyInx8dC50eXBlPT09InZpZGVvIil9ZnVuY3Rpb24gTigpe09iamVjdC5rZXlzKHYpLnNvcnQoKS5qb2luKCk9PT1JLnNvcnQoKS5qb2luKCkmJihiLnNoaWZ0KCksST1bXSl9ZnVuY3Rpb24gY2UodCl7Y29uc3Qgbj1uZXcgRGF0ZSgpLmdldFRpbWUoKTt2W3RdPW4sT2JqZWN0LmtleXModikuZmlsdGVyKGk9Pm4tdltpXT5hZSkuZm9yRWFjaChpPT57ZGVsZXRlIHZbaV0sZGVsZXRlIElbaV19KSxOKCl9ZnVuY3Rpb24gRigpe3JldHVybiBuZXcgVHJhbnNmb3JtU3RyZWFtKHtzdGFydCgpe30sZmx1c2goKXt9LGFzeW5jIHRyYW5zZm9ybSh0LG4pe2lmKE0odCkpe2NvbnN0IGk9dC5nZXRNZXRhZGF0YSgpLnN5bmNocm9uaXphdGlvblNvdXJjZTtpZihjZShpKSwhSS5pbmNsdWRlcyhpKSYmYi5sZW5ndGgpdHJ5e2lmKCEvKGgyNls0XSkvLnRlc3QoUykpdGhyb3cgbmV3IEVycm9yKCJTZW5kaW5nIG1ldGFkYXRhIGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBhbnkgb3RoZXIgY29kZWMgb3RoZXIgdGhhbiBILjI2NCIpO2JbMF0udXVpZD09PUwmJihiWzBdLnRpbWVjb2RlPURhdGUubm93KCkpLG9lKGJbMF0sdCksSS5wdXNoKGkpfWNhdGNoKHIpe2NvbnNvbGUuZXJyb3Iocil9ZmluYWxseXtOKCl9fW4uZW5xdWV1ZSh0KX19KX1mdW5jdGlvbiBrKHtyZWFkYWJsZTp0LHdyaXRhYmxlOm59LGUpe3QucGlwZVRocm91Z2goZSkucGlwZVRvKG4pfWFkZEV2ZW50TGlzdGVuZXIoInJ0Y3RyYW5zZm9ybSIsdD0+e2xldCBuO2lmKHQudHJhbnNmb3JtZXIub3B0aW9ucy5uYW1lPT09InNlbmRlclRyYW5zZm9ybSIpUz10LnRyYW5zZm9ybWVyLm9wdGlvbnMuY29kZWMsbj1GKCk7ZWxzZSBpZih0LnRyYW5zZm9ybWVyLm9wdGlvbnMubmFtZT09PSJyZWNlaXZlclRyYW5zZm9ybSIpUD10LnRyYW5zZm9ybWVyLm9wdGlvbnMucGF5bG9hZFR5cGVDb2RlY3x8e30sUz10LnRyYW5zZm9ybWVyLm9wdGlvbnMuY29kZWN8fCIiLG49SCh0LnRyYW5zZm9ybWVyLm9wdGlvbnMubWlkKTtlbHNlIHJldHVybjtrKHQudHJhbnNmb3JtZXIsbil9KSxhZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIix0PT57Y29uc3R7YWN0aW9uOm59PXQuZGF0YTtzd2l0Y2gobil7Y2FzZSJpbnNlcnRhYmxlLXN0cmVhbXMtc2VuZGVyIjpTPXQuZGF0YS5jb2RlYyxrKHQuZGF0YSxGKCkpO2JyZWFrO2Nhc2UiaW5zZXJ0YWJsZS1zdHJlYW1zLXJlY2VpdmVyIjpQPXQuZGF0YS5wYXlsb2FkVHlwZUNvZGVjfHx7fSxTPXQuZGF0YS5jb2RlY3x8IiIsayh0LmRhdGEsSCh0LmRhdGEubWlkKSk7YnJlYWs7Y2FzZSJtZXRhZGF0YS1zZWktdXNlci1kYXRhLXVucmVnaXN0ZXJlZCI6Yi5wdXNoKHt1dWlkOnQuZGF0YS51dWlkLHBheWxvYWQ6dC5kYXRhLnBheWxvYWR9KTticmVha319KX0pKCk7Cg==",Wa=r=>Uint8Array.from(atob(r),e=>e.charCodeAt(0)),ds=typeof self<"u"&&self.Blob&&new Blob([Wa(us)],{type:"text/javascript;charset=utf-8"});function ps(r){let e;try{if(e=ds&&(self.URL||self.webkitURL).createObjectURL(ds),!e)throw"";const t=new Worker(e,{name:r==null?void 0:r.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+us,{name:r==null?void 0:r.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}Ae.get("Publish");function hs(r){if(!r)return new Uint8Array;const e=r.length,t=new Uint8Array(e/2);for(let n=0;n<e;n+=2)t[n/2]=parseInt(r.substr(n,2),16);return t}function fs(r,e,t){if(Object.prototype.hasOwnProperty.call(r,t)&&Object.prototype.hasOwnProperty.call(e,t)){const n=r[t];r[t]=e[t],e[t]=n}else console.error('One or both objects do not have the property "'.concat(t,'"'))}function Sn(r,e,t,n){return new(t||(t=Promise))(function(i,a){function l(d){try{h(n.next(d))}catch(p){a(p)}}function o(d){try{h(n.throw(d))}catch(p){a(p)}}function h(d){var p;d.done?i(d.value):(p=d.value,p instanceof t?p:new t(function(b){b(p)})).then(l,o)}h((n=n.apply(r,e||[])).next())})}const Fe=Rn;var In;function Rn(r,e){const t=xn();return(Rn=function(n,i){return t[n-=440]})(r,e)}(function(){const r=Rn,e=xn();for(;;)try{if(-parseInt(r(447))/1+parseInt(r(445))/2+parseInt(r(449))/3*(parseInt(r(454))/4)+parseInt(r(453))/5+-parseInt(r(456))/6+parseInt(r(450))/7+-parseInt(r(441))/8*(-parseInt(r(455))/9)===847340)break;e.push(e.shift())}catch{e.push(e.shift())}})();const Cn=navigator&&navigator[Fe(448)]||"",Aa=navigator&&navigator[Fe(443)]||"",Da=!!(window!=null&&window.RTCRtpScriptTransform),xr=Cn.includes("Firefox"),kn=!xr&&Aa.includes("Apple"),ms=!xr&&!kn&&Cn[Fe(440)](Fe(451)),Xa=!xr&&!kn&&!ms&&Cn[Fe(440)](Fe(446)),En=((In=navigator==null?void 0:navigator[Fe(442)])===null||In===void 0?void 0:In[Fe(452)])||(navigator==null?void 0:navigator[Fe(452)])||"";function xn(){const r=["1583117AOxBcs","userAgent","153Sdjzsk","5371359GvUFPp","Edg","platform","7141470dfeDnP","10068LWEgOs","243621EPkoPw","8310150fEFCnA","includes","328VMcnkw","userAgentData","vendor","Win32","763310RGZQro","Chrome"];return(xn=function(){return r})()}const ze={supportsRtpScriptTransform:Da,isFirefox:xr,isSafari:kn,isEdge:ms,isChrome:Xa,platform:En,isWindows:En==="Windows"||En===Fe(444)},Ce=Zr;function Zr(r,e){const t=Zn();return(Zr=function(n,i){return t[n-=300]})(r,e)}(function(){const r=Zr,e=Zn();for(;;)try{if(-parseInt(r(327))/1+parseInt(r(304))/2*(parseInt(r(300))/3)+-parseInt(r(332))/4*(parseInt(r(316))/5)+-parseInt(r(322))/6*(parseInt(r(311))/7)+parseInt(r(308))/8*(-parseInt(r(307))/9)+parseInt(r(314))/10*(parseInt(r(302))/11)+parseInt(r(329))/12===997665)break;e.push(e.shift())}catch{e.push(e.shift())}})();class Fa{constructor(e){this[Zr(310)]=e}[Ce(323)](...e){const t=Ce;Te[t(319)]>=4&&console[t(323)](this[t(310)],...e)}[Ce(331)](...e){const t=Ce;Te[t(319)]>=3&&console[t(331)](this[t(310)],...e)}[Ce(320)](...e){const t=Ce;Te[t(319)]>=2&&console[t(320)](this[t(310)],...e)}error(...e){Te[Ce(319)]>=1&&console.error(this.tag,...e)}}function Tr(r){return new Fa(r)}const Te={logLevel:3,mediaDumps:{video:{in:{durationMs:0,delimited:!0},out:{durationMs:0}},audio:{in:{durationMs:0},out:{durationMs:0}}}};function Lr(){return new Date()[Ce(317)]().slice(11,-1)}function Zn(){const r=["mediaBuffer","click","529321KfbOwo","endTimestampMs","28972188cmcnxe","containerFileExt","info","4ZlZeJQ","9kyfNFe","mediaType","172953TzXwsI","byteLength","1327806tybvjI","href","createObjectURL","1089qysnCz","112088WLFXHK","substring","tag","692993ZcAeLj","set","download","810qiScYX","startTimestampMs","8821555KArxhe","toISOString","application/octet-stream","logLevel","warn","revokeObjectURL","42PDuKrJ","debug","targetDurationMs"];return(Zn=function(){return r})()}class Tn{constructor(e,t,n){const i=Ce;this[i(325)]=null,this[i(315)]=-1,this.endTimestampMs=-1,this[i(301)]=e,this[i(330)]=t,this[i(324)]=n,n>0&&(this[i(325)]=new Uint8Array)}append(e,t){const n=Ce;if(!this[n(325)])return!1;if(this[n(325)]=function(i,a){const l=Ce,o=new Uint8Array((0|i[l(303)])+(0|a.byteLength));return o[l(312)](i,0),o[l(312)](a,0|i.byteLength),o}(this[n(325)],e),t!==void 0){if(this[n(315)]===-1)this.startTimestampMs=t,this[n(328)]=t+this[n(324)];else if(t>=this[n(328)]){const i=new Date()[n(317)]()[n(309)](0,19).replace(/:/g,"-"),a=this.mediaType+"-"+i+"."+this.containerFileExt;return function(l,o,h=Ce(318)){const d=Ce,p=document.createElement("a"),b=new Blob([l],{type:h});p.href=URL[d(306)](b),p[d(313)]=o,p[d(326)](),URL[d(321)](p[d(305)])}(this[n(325)],a),this.mediaBuffer=null,!1}}return!0}}const I=Ln;(function(){const r=Ln,e=Un();for(;;)try{if(parseInt(r(160))/1+-parseInt(r(363))/2+-parseInt(r(321))/3*(-parseInt(r(401))/4)+parseInt(r(229))/5+-parseInt(r(276))/6+parseInt(r(400))/7*(-parseInt(r(153))/8)+-parseInt(r(223))/9===858456)break;e.push(e.shift())}catch{e.push(e.shift())}})();const pe=Tr("[MUX]"),Ba=ze[I(387)];function gs(r,e){const t=I;let n=new Uint8Array((0|r[t(413)])+(0|e[t(413)]));return n.set(r,0),n[t(251)](e,0|r[t(413)]),n}const Ya=(r,e,t,n)=>{const i=I,a=n[i(425)]||1;e*=a,t*=a;const l=(d=r)instanceof ArrayBuffer?d:d[I(366)],o=(r[i(188)]||0)+r[i(413)],h=(r[i(188)]||0)+e;var d;let p=Math[i(177)](0,Math[i(291)](h,o)),b=Math[i(291)](p+Math[i(177)](t,0),o);return p/=a,b/=a,new n(l,p,b-p)};function Ln(r,e){const t=Un();return(Ln=function(n,i){return t[n-=147]})(r,e)}function Mn(r,e=0,t=1/0){return Ya(r,e,t,Uint8Array)}function bs(r){const e=I,t=Array.from(r)[e(238)](n=>n[e(384)](0));return new Uint8Array(t)}function Oa(r){const e=function(t){const n=I;let i="";for(let a=0;a<t[n(268)];a+=16e3){const l=t.subarray(a,a+16e3);i+=String[n(358)].apply(null,l)}return i}(Mn(r));return btoa(e)}class q{static get[I(449)](){return 1}static get[I(427)](){return 5}static get SEI(){return 6}static get[I(324)](){return 7}static get[I(379)](){return 8}static get[I(272)](){return 9}static get[I(159)](){const e=I;return{[q[e(427)]]:e(427),[q[e(273)]]:e(273),[q[e(324)]]:e(324),[q.PPS]:"PPS",[q[e(449)]]:"NDR",[q.AUD]:e(272)}}static[I(234)](e){const t=I;return e[t(186)]in q[t(159)]?q[t(159)][e.ntype]:t(344)}constructor(e){const t=I;this[t(452)]=e,this[t(402)]=(96&this[t(452)][0])>>5,this[t(186)]=31&this[t(452)][0],this.isvcl=this[t(186)]==1||this[t(186)]==5,this[t(309)]="",this.isfmb=!1}[I(365)](){const e=I;return q[e(234)](this)+": NRI: "+this[e(209)]()}[I(209)](){return this[I(402)]}[I(234)](){return this[I(186)]}[I(306)](){return this[I(186)]===q.IDR}[I(203)](){return this[I(452)]}[I(327)](){return this[I(452)].byteLength}[I(194)](){return 4+this[I(327)]()}[I(341)](){const e=I,t=new Uint8Array(this[e(194)]());return new DataView(t[e(366)]).setUint32(0,this[e(194)]()-4),t[e(251)](this.getPayload(),4),t}}class ys{constructor(e){const t=I;this[t(316)]=e,this[t(368)]=0,this[t(157)]=8*e.byteLength}[I(433)](e){const t=I;this.data=e,this[t(368)]=0,this.bitLength=8*e[t(413)]}get[I(451)](){return this[I(157)]-this.index}skipBits(e){const t=I;if(this[t(451)]<e)return!1;this[t(368)]+=e}[I(338)](e,t=!0){const n=I;return this[n(259)](e,this[n(368)],t)}getBits(e,t,n=!0){const i=I;if(this[i(451)]<e)return 0;const a=t%8,l=this.data[t/8|0]&255>>>a,o=8-a;if(o>=e)return n&&(this[i(368)]+=e),l>>o-e;{n&&(this[i(368)]+=o);const h=e-o;return l<<h|this[i(259)](h,t+o,n)}}[I(444)](){const e=I;let t;for(t=0;t<this[e(157)]-this[e(368)];++t)if(this[e(259)](1,this[e(368)]+t,!1)!==0)return this[e(368)]+=t,t;return t}[I(334)](){const e=I;this[e(155)](1+this[e(444)]())}skipEG(){const e=I;this[e(155)](1+this[e(444)]())}[I(179)](){const e=I,t=this.skipLZ();return this[e(338)](t+1)-1}[I(248)](){const e=this[I(179)]();return 1&e?1+e>>>1:-1*(e>>>1)}[I(239)](){return this[I(338)](1)===1}[I(419)](e=1){return this.readBits(8*e)}[I(232)](){return this.readBits(16)}readUInt(){return this[I(338)](32)}}class ut{static[I(267)](e,t){const n=I;let i=[],a=!1,l=!1,o=!1,h=!1,d=0,p=0,b=0,m=[];for(;d<=e.byteLength;){if(d<e.byteLength){const y=e[d++];y!==0?(y===1&&p>1&&(b=p>2?4:3,m.push(d)),p=0):++p}else b=0,m.push(d++);if(m.length>1){const y=m.shift(),S=m[0]-b;if(y<S){let C=!1;const x=31&e[y];if(x===q.NDR?l=!0:x===q.IDR?a=!0:x===q.SPS?(C=o,o=!0):x===q.PPS&&(C=h,h=!0),!C)if(!t||x!==q.NDR&&x!==q.IDR)i.push(e.subarray(y,S));else{const L=new Uint8Array(S-y);let v=0;for(d=y,p=0;d<S;){let Z=e[d++];p>1&&Z===3&&(p=0,Z=e[d++]),Z!==0?p=0:++p,L[v++]=Z}i.push(L.subarray(0,v))}}}}let f=!0,g=!1;return l||a?l&&a&&(pe[n(265)](n(331)),f=!1):(pe[n(265)]("[H264Parser] No VCL NALUs found"),f=!1),a&&(o&&h?g=!0:pe.warn(n(158))),{valid:f,idr:g,nalus:i}}static[I(333)](e,t){let n,i=8,a=8;for(let l=0;l<t;l++)a!==0&&(n=e.readEG(),a=(i+n+256)%256),i=a===0?i:a}static[I(432)](e){const t=I;let n,i,a,l,o,h,d=new ys(e),p=0,b=0,m=0,f=0,g=1;if(d.readUByte(),n=d[t(419)](),d.readBits(5),d[t(155)](3),d[t(419)](),d[t(334)](),n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128){var y=d.readUEG();if(y===3&&d[t(155)](1),d[t(334)](),d[t(334)](),d[t(155)](1),d[t(239)]()){h=y!==3?8:12;for(let C=0;C<h;++C)d[t(239)]()&&(C<6?ut[t(333)](d,16):ut[t(333)](d,64))}}d[t(334)]();var S=d[t(179)]();if(S===0)d.readUEG();else if(S===1){d.skipBits(1),d[t(221)](),d[t(221)](),i=d[t(179)]();for(let C=0;C<i;++C)d[t(221)]()}if(d[t(334)](),d.skipBits(1),a=d[t(179)](),l=d.readUEG(),o=d[t(338)](1),o===0&&d[t(155)](1),d[t(155)](1),d.readBoolean()&&(p=d[t(179)](),b=d[t(179)](),m=d[t(179)](),f=d[t(179)]()),d[t(239)]()){if(d.readBoolean()){let C;switch(d.readUByte()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:C=[d[t(419)]()<<8|d[t(419)](),d[t(419)]()<<8|d[t(419)]()]}C&&C[0]>0&&C[1]>0&&(g=C[0]/C[1])}d.readBoolean()&&d[t(155)](1),d[t(239)]()&&(d[t(155)](4),d[t(239)]()&&d[t(155)](24)),d[t(239)]()&&(d[t(334)](),d[t(334)]()),d.readBoolean()&&(d.readUInt(),d[t(187)](),d.readBoolean())}return{width:Math[t(440)]((16*(a+1)-2*p-2*b)*g),height:(2-o)*(l+1)*16-(o?2:4)*(m+f)}}static[I(386)](e){const t=I;let n=new ys(e[t(203)]());n[t(419)](),e[t(196)]=n[t(179)]()===0,e[t(309)]=n[t(179)]()}constructor(e){const t=I;this.remuxer=e,this[t(233)]=e.mp4track}[I(256)](e){const t=I;var n=ut[t(432)](new Uint8Array(e));this.track[t(237)]=n.width,this[t(233)].height=n.height,this.track[t(382)]=[new Uint8Array(e)],this.track[t(210)]=t(292);let i=new DataView(e.buffer,e[t(188)]+1,4);for(let l=0;l<3;++l){var a=i[t(313)](l)[t(365)](16);a[t(268)]<2&&(a="0"+a),this.track[t(210)]+=a}}[I(345)](e){const t=I;this[t(233)][t(434)]=[new Uint8Array(e)]}[I(378)](e){const t=I;if(!e)return!1;let n=!1;switch(e[t(234)]()){case q[t(427)]:case q.NDR:n=!0;break;case q[t(379)]:!this[t(233)][t(434)]&&(this[t(345)](e.getPayload()),!this[t(175)][t(296)]&&this[t(233)][t(434)]&&this.track[t(382)]&&(this.remuxer[t(296)]=!0)),n=!0;break;case q[t(324)]:!this.track.sps&&(this[t(256)](e[t(203)]()),!this[t(175)][t(296)]&&this[t(233)].pps&&this[t(233)][t(382)]&&(this.remuxer[t(296)]=!0)),n=!0;break;case q[t(272)]:break;case q.SEI:n=!0}return n}}class Pn{constructor(e){const t=I;this.listener={},this[t(234)]=""|e}on(e,t){const n=I;return!this[n(270)][e]&&(this.listener[e]=[]),this[n(270)][e].push(t),!0}off(e,t){const n=I;if(this[n(270)][e]){var i=this[n(270)][e].indexOf(t);return i>-1&&this[n(270)][e][n(369)](i,1),!0}return!1}[I(219)](){this.listener={}}[I(225)](e,t){const n=I;return!!this[n(270)][e]&&(this[n(270)][e].map(i=>{i[n(200)](null,[t])}),!0)}}class E{constructor(e){var t,n;const i=I;this[i(285)]=e,this.saiIvSize={video:((t=e.config[i(415)])==null?void 0:t[i(201)])==="cenc"?16:0,audio:((n=e[i(154)][i(407)])==null?void 0:n[i(201)])==="cenc"?16:0},E[i(212)]={avc1:[],encv:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],Opus:[],dOps:[],enca:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],pssh:[],sinf:[],frma:[],schm:[],schi:[],tenc:[],saiz:[],saio:[],senc:[]};for(let m in E[i(212)])E.types[m]=[m[i(384)](0),m[i(384)](1),m[i(384)](2),m.charCodeAt(3)];const a=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),l=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);E.HDLR_TYPES={video:a,audio:l};const o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),h=new Uint8Array([0,0,0,0,0,0,0,0]);E.STTS=E[i(377)]=E[i(213)]=h,E.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),E[i(438)]=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),E[i(307)]=new Uint8Array([0,0,0,0,0,0,0,0]),E[i(168)]=new Uint8Array([0,0,0,0,0,0,0,1]);const d=new Uint8Array([105,115,111,109]),p=new Uint8Array([97,118,99,49]),b=new Uint8Array([0,0,0,1]);E[i(183)]=E[i(347)](E[i(212)].ftyp,d,b,d,p),E[i(147)]=E[i(347)](E.types.dinf,E[i(347)](E[i(212)][i(280)],o))}static box(e,...t){const n=I;let i,a=8,l=t.length,o=l;for(;l--;)t[l]&&(a+=t[l].byteLength);for(i=new Uint8Array(a),i[0]=a>>>24,i[1]=a>>>16&255,i[2]=a>>>8&255,i[3]=255&a,i[n(251)](e,4),l=0,a=8;l<o;++l)t[l]&&(i[n(251)](t[l],a),a+=t[l][n(413)]);return i}[I(190)](e){const t=I;return E[t(347)](E[t(212)][t(190)],E[t(418)][e])}[I(244)](e){const t=I;return E[t(347)](E[t(212)][t(244)],e)}[I(380)](e,t){const n=I;return E[n(347)](E[n(212)][n(380)],new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e,0,0,0,0,85,196,0,0]))}[I(215)](e){const t=I;return E[t(347)](E[t(212)].mdia,this[t(380)](e[t(274)],e[t(290)]),this[t(190)](e[t(234)]),this[t(230)](e))}[I(443)](e){const t=I;return E.box(E[t(212)][t(443)],new Uint8Array([0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e]))}[I(230)](e){const t=I;return e[t(234)]===t(407)?E[t(347)](E[t(212)][t(230)],E.box(E.types[t(255)],E.SMHD),E[t(147)],this[t(362)](e)):E[t(347)](E.types[t(230)],E[t(147)],this[t(362)](e),E[t(347)](E[t(212)].vmhd,E[t(438)]))}[I(370)](e,t,n){const i=I;return E[i(347)](E.types.moof,this[i(443)](e),this[i(293)](n,t))}[I(295)](e,t,n){const i=I;let a=e[i(268)],l=[];for(;a--;)l[a]=this.trak(e[a]);return E.box[i(200)](null,[E[i(212)][i(295)],this[i(240)](n,t),this[i(447)](e)][i(389)](l)[i(389)](this[i(322)](e)))}[I(322)](e){const t=I;let n=e[t(268)],i=[];for(;n--;)i[n]=this[t(305)](e[n]);return E[t(347)][t(200)](null,[E[t(212)][t(322)]][t(389)](i))}[I(240)](e,t){const n=I;let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return E[n(347)](E.types.mvhd,i)}[I(420)](e){const t=I;let n=e[t(428)]||[],i=new Uint8Array(4+n.length);for(let a=0;a<n[t(268)];a++){const l=n[a][t(375)];i[a+4]=l.dependsOn<<4|l[t(149)]<<2|l[t(422)]}return E[t(347)](E[t(212)][t(420)],i)}[I(362)](e){const t=I;return E[t(347)](E.types[t(362)],this[t(165)](e),E.box(E[t(212)][t(329)],E[t(421)]),E[t(347)](E.types[t(227)],E[t(377)]),E[t(347)](E.types[t(235)],E[t(218)]),E[t(347)](E[t(212)].stco,E[t(213)]))}[I(303)](e){const t=I;let n,i,a,l=[],o=[];for(n=0;n<e[t(382)].length;n++)i=e.sps[n],a=i[t(413)],l.push(a>>>8&255),l.push(255&a),l=l[t(389)](Array.prototype[t(314)][t(395)](i));for(n=0;n<e[t(434)][t(268)];n++)i=e[t(434)][n],a=i[t(413)],o[t(406)](a>>>8&255),o[t(406)](255&a),o=o.concat(Array.prototype[t(314)].call(i));const h=E[t(347)](E[t(212)][t(408)],new Uint8Array([1,l[3],l[4],l[5],255,224|e.sps[t(268)]].concat(l)[t(389)]([e[t(434)][t(268)]]).concat(o))),d=e[t(237)],p=e[t(374)],b=E[t(347)](E.types[t(441)],E.box(E[t(212)][t(318)],new Uint8Array([97,118,99,49])),E[t(347)](E[t(212)][t(349)],new Uint8Array([0,0,0,0,...bs(this[t(285)][t(154)][t(415)][t(201)]),0,1,0,0])),E.box(E.types[t(217)],this[t(298)](t(415))));return E[t(347)](E[t(212)].encv,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>>8&255,255&d,p>>>8&255,255&p,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,65,86,67,32,67,111,100,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),h,b)}[I(372)](e){const t=I;let n=e[t(154)][t(413)],i=new Uint8Array(26+n+3);return i[t(251)]([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5,n]),i[t(251)](e[t(154)],26),i.set([6,1,2],26+n),i}[I(403)](e){const t=I,n=e[t(354)];return E[t(347)](E[t(212)][t(403)],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,n>>>8&255,255&n,0,0]),E[t(347)](E[t(212)][t(372)],this[t(372)](e)))}[I(266)](e){const t=I,n=e[t(354)];return new Uint8Array([0,e[t(390)],1,56,0,0,n>>>8&255,255&n,0,0,0])}[I(416)](e){const t=I,n=e.audiosamplerate;return E[t(347)](E.types[t(416)],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,n>>>8&255,255&n,0,0]),E[t(347)](E[t(212)][t(266)],this[t(266)](e)))}[I(394)](e){const t=I,n=E[t(347)](E.types[t(266)],this.dOps(e)),i=E[t(347)](E.types[t(441)],E.box(E.types.frma,new Uint8Array([79,112,117,115])),E[t(347)](E.types.schm,new Uint8Array([0,0,0,0,...bs(this[t(285)][t(154)].audio[t(201)]),0,1,0,0])),E.box(E.types[t(217)],this[t(298)](t(407)))),a=e[t(354)];return E[t(347)](E[t(212)].enca,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e[t(390)],0,16,0,0,0,0,a>>>8&255,255&a,0,0]),n,i)}[I(165)](e){const t=I;return e[t(234)]===t(407)?E[t(347)](E[t(212)][t(165)],E[t(168)],e[t(199)]?this[t(394)](e):this[t(416)](e)):E[t(347)](E.types[t(165)],E[t(168)],this[t(303)](e))}[I(278)](e){const t=I,n=e.id,i=e[t(290)],a=e[t(237)],l=e[t(374)],o=e[t(388)];return E[t(347)](E[t(212)].tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,255&o,o%1*10&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>>8&255,255&a,0,0,l>>>8&255,255&l,0,0]))}[I(293)](e,t){var n;const i=I,a=e.id,l=e[i(428)][0][i(171)],o=e.samples[0][i(290)],h=e[i(428)][0].flags,d=E[i(347)](E[i(212)].tfhd,new Uint8Array([0,2,0,58,a>>>24,a>>>16&255,a>>>8&255,255&a,0,0,0,1,o>>>24,a>>>16&255,o>>>8&255,255&o,l>>>24,l>>>16&255,l>>>8&255,255&l,0,h[i(264)],0,0])),p=E[i(347)](E[i(212)].tfdt,new Uint8Array([0,0,0,0,t>>>24,t>>>16&255,t>>>8&255,255&t]));if(e.encrypted){let b,m;if(e[i(234)]===i(415)?(b=!0,m=this[i(350)][i(415)]+((n=e.samples[0][i(191)])==null?void 0:n.byteLength)):(b=!1,m=this[i(350)].audio),m>0){const f=this[i(242)](m),g=this[i(340)](e[i(428)],b),y=f[i(268)]+20+g[i(268)]+d[i(268)]+p[i(268)]+8+16+8+8,S=this[i(271)](e,y);return E[i(347)](E[i(212)][i(293)],d,p,S,f,this.saio(y-g[i(268)]+S.length+8),g)}{const f=this[i(340)](null,!1),g=f.length+d[i(268)]+p[i(268)]+8+16+8+8,y=this[i(271)](e,g);return E[i(347)](E.types[i(293)],d,p,y,f)}}return E.box(E[i(212)].traf,d,p,this.trun(e,d[i(268)]+p.length+8+16+8+8))}trak(e){const t=I;return e.duration=e[t(290)]||4294967295,E.box(E[t(212)].trak,this[t(278)](e),this[t(215)](e))}[I(305)](e){const t=I,n=e.id;return E[t(347)](E.types[t(305)],new Uint8Array([0,0,0,0,n>>>24,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,16,0,0,0,0,0,0,0,0]))}trun(e,t){const n=I;let i=(e[n(428)]||[])[n(268)],a=new Uint8Array(12);return t+=20,a.set([0,0,0,1,i>>>24,i>>>16&255,i>>>8&255,255&i,t>>>24,t>>>16&255,t>>>8&255,255&t],0),E[n(347)](E.types[n(271)],a)}[I(224)](e,t){const n=I,i=n(445),a=Oa(function(l){const o=I,h=[];return h[o(406)](l[3]),h[o(406)](l[2]),h.push(l[1]),h.push(l[0]),h[o(406)](l[5]),h[o(406)](l[4]),h.push(l[7]),h.push(l[6]),(l=Mn(l))[o(251)](h,0),l}(e));return Mn(function(l,o){const h=I,d=new Uint8Array(2*l[h(268)]),p=new DataView(d[h(366)]);for(let b=0;b<l[h(268)];++b){const m=l.charCodeAt(b);p[h(253)](2*b,m,o)}return d[h(366)]}([n(328)+i+'" version="4.3.0.0">',n(308),"<PROTECTINFO>",n(398),n(353),n(216)+a+'"',">",n(412),n(249),n(391),t?"<LA_URL>"+t+n(423):"",n(351),n(269)].join(""),!0))}pssh(e){const t=I;if(this[t(285)][t(383)][t(202)](t(178)))return E[t(347)](E.types[t(447)],new Uint8Array([0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,18,18,16,...this[t(285)][t(154)][e[0][t(234)]].keyId]));if(this[t(285)][t(383)]===t(356)){const n=this[t(224)](this[t(285)][t(154)][e[0][t(234)]][t(429)],this.drm[t(371)]),i=n[t(413)];return E[t(347)](E[t(212)][t(447)],new Uint8Array([0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,i>>>24,i>>>16&255,i>>>8&255,255&i,...n]))}return this.drm[t(383)]===t(323)?E[t(347)](E[t(212)][t(447)],new Uint8Array([1,0,0,0,16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75,0,0,0,1,...this.drm[t(154)][e[0].type].keyId,0,0,0,0])):this.drm[t(383)]===t(397)?null:void pe[t(189)](t(393)+this[t(285)][t(383)])}[I(298)](e){const t=I;let n,i,a=this[t(285)][t(154)][e];return a[t(201)]===t(226)?(n=new Uint8Array([16,...a.iv]),i=25):(n=new Uint8Array([]),i=0),E[t(347)](E[t(212)][t(298)],new Uint8Array([1,0,0,0,0,i,1,this[t(350)][e],...a[t(429)],...n]))}[I(242)](e){const t=I;return E[t(347)](E[t(212)][t(242)],new Uint8Array([0,0,0,0,e,0,0,0,1]))}[I(204)](e){const t=I;return E[t(347)](E[t(212)][t(204)],new Uint8Array([0,0,0,0,0,0,0,1,e>>>24,e>>>16&255,e>>>8&255,255&e]))}[I(340)](e,t){const n=I;let i=null;return e&&(e[n(268)]!==1&&pe[n(189)](n(182)+e[n(268)]+" samples - expected 1"),i=e[0][n(191)]),i&&i[n(413)]?E[n(347)](E[n(212)].senc,new Uint8Array([0,0,0,t?2:0,0,0,0,1,...i])):E.box(E[n(212)][n(340)],new Uint8Array([0,0,0,0,0,0,0,1]))}[I(439)](e,t,n){const i=I,a=this[i(295)](e,t,n);let l=new Uint8Array(E[i(183)].byteLength+a[i(413)]);return l[i(251)](E[i(183)]),l[i(251)](a,E[i(183)][i(413)]),l}}let Ka=1;class Mr{constructor(){this.seq=1}static[I(411)](){return Ka++}[I(246)](){const e=I;this.mp4track[e(263)]=0,this[e(207)][e(428)]=[]}[I(211)](){const e=I;return!(!this[e(296)]||!this[e(428)][e(268)])}}class ja extends Mr{constructor(e){const t=I;super(),this[t(296)]=!0,this[t(222)]=0,this.dts=0,this.mp4track={id:Mr[t(411)](),type:t(407),channelCount:2,audiosamplerate:48e3,len:0,fragmented:!0,timescale:e,duration:e,samples:[],codec:t(364),encrypted:!0},this[t(428)]=[]}resetTrack(){const e=I;this[e(437)]=1,this[e(222)]=0,this[e(336)]=0}[I(181)](e,t,n){const i=I;if(e[i(268)]>0)for(let a=0;a<e.length;a++){let l=e[a],o=l[i(392)],h=o[i(413)];this.samples[i(406)]({units:o,size:h,duration:l.duration,sampleAuxInfo:t,timestamp:n}),this[i(207)][i(263)]+=h}}[I(161)](){const e=I;if(!this.samples)return null;let t,n=this[e(207)][e(428)];for(;this[e(428)][e(268)];){let i=this.samples[e(342)](),a=(1e3*i.timestamp|0)-this[e(222)]|0;a<5&&(a=5),this[e(336)]=this[e(222)],this.nextDts+=a,t={size:i[e(171)],duration:a,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1},sampleAuxInfo:i[e(191)]};let l=new Uint8Array(i[e(171)]);return l[e(251)](i.units,0),n[e(406)](t),new Uint8Array(l[e(366)],0,i[e(171)])}return null}}class za extends Mr{constructor(e,t){const n=I;super(),this[n(296)]=!1,this[n(222)]=0,this[n(336)]=0,this[n(361)]=t,this[n(207)]={id:Mr[n(411)](),type:n(415),len:0,fragmented:!0,sps:"",pps:"",width:0,height:0,timescale:e,duration:e,samples:[],encrypted:!0},this[n(428)]=[],this[n(302)]=new ut(this)}[I(297)](){const e=I;this[e(437)]=1,this[e(296)]=!1,this[e(207)][e(382)]="",this.mp4track[e(434)]="",this.nextDts=0,this.dts=0}remux(e,t,n){const i=I;for(let a of e){let l=[],o=0;for(let h of a[i(392)])this[i(302)].parseNAL(h)&&(l[i(406)](h),o+=h[i(194)]());l[i(268)]>0&&this.readyToDecode&&(this[i(207)][i(263)]+=o,this[i(428)].push({units:l,size:o,keyFrame:a.keyFrame,duration:a[i(290)],sampleAuxInfo:t,timestamp:n}))}}[I(161)](){const e=I;if(!this[e(211)]()||!this[e(428)])return null;let t,n=this.mp4track[e(428)],i=this.samples[e(342)](),a=i.units,l=(1e3*i[e(332)]|0)-this[e(222)]|0;l<5&&(l=5),l>5e3&&pe[e(381)](e(430)+(l/1e3|0)+" s"),this.dts=this[e(222)],this[e(222)]+=l,t={size:i.size,duration:l,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:i[e(148)]?0:1,dependsOn:i[e(148)]?2:1},sampleAuxInfo:i[e(191)]};let o=0;for(const p of a)o+=p[e(194)]();let h=0,d=new Uint8Array(o);for(const p of a)d[e(251)](p[e(341)](),h),h+=p[e(194)]();return n.push(t),new Uint8Array(d[e(366)],0,o)}}class Ja extends Pn{constructor(e,t){const n=I;super(n(175)),this[n(260)]=!1,this.trackTypes=[],this[n(357)]={},this[n(274)]=1e3,this[n(163)]=0,this[n(361)]=e,this.mp4=t}[I(281)](e){const t=I;(e==="video"||e==="both")&&(this[t(357)][t(415)]=new za(this.timescale,this[t(361)]),this[t(335)][t(406)](t(415))),(e===t(407)||e===t(417))&&(this[t(357)][t(407)]=new ja(this.timescale),this.trackTypes[t(406)](t(407)))}[I(250)](){const e=I;for(let t of this[e(335)])this.tracks[t].resetTrack();this[e(260)]=!1}[I(262)](){const e=I;this.tracks={},this[e(219)]()}[I(246)](){const e=I;if(this[e(260)])for(let t of this[e(335)]){let n=this[e(357)][t];for(;;){let i=n[e(161)]();if(!i||!i.byteLength)break;let a={type:t,payload:gs(this[e(164)][e(370)](n[e(437)]++,n[e(336)],n[e(207)]),this.mp4[e(244)](i)),dts:n[e(336)]};this[e(225)](e(366),a),n[e(246)]()}}else this[e(211)]()&&(this[e(225)]("ready"),this.initSegment(),this[e(260)]=!0,this[e(246)]())}[I(439)](){const e=I;for(let t of this[e(335)]){let n=this[e(357)][t],i={type:t,payload:this[e(164)][e(439)]([n[e(207)]],this[e(163)],this.timescale)};this[e(225)]("buffer",i)}}isReady(){const e=I;for(let t of this[e(335)])if(!this.tracks[t][e(296)]||!this[e(357)][t][e(428)][e(268)])return!1;return!0}[I(181)](e){const t=I;for(let n of this[t(335)]){let i=e[n];i.length>0&&this[t(357)][n][t(181)](i,n==="audio"?e.audioSampleAuxInfo:e[t(310)],e[t(332)])}this[t(246)]()}}function Un(){const r=["stsd","isSupported","src","STSD","endMSE","abort","size","appendBufferError","addSourceBuffer","setupMSE","remuxer","addEventListener","max","com.widevine","readUEG"," - ","remux","Received ","FTYP","readyState","valid","ntype","readUInt","byteOffset","error","hdlr","sampleAuxInfo","webkitsourceopen","Checking codec","getSize","irrecoverableError","isfmb","[MSE] buffer error:","url","encrypted","apply","encryption","startsWith","getPayload","saio","open","[MSE] source buffer error","mp4track","append","getNri","codec","isReady","types","STCO","feed","mdia",'VALUE="',"schi","STSZ","offAll","jmuxer","skipEG","nextDts","1036611gAoRea","generatePlayReadyHeader","dispatch","cbcs","stsc","endOfStream","6576815frVeWy","minf","releaseBuffer","readUShort","track","type","stsz","isvcl","width","map","readBoolean","mvhd","onReady","saiz","reportDiscontinuity","mdat","bufferControllers","flush","patchSampleAuxinfo","readEG","</KIDS>","reset","set","onMSEClose","setUint16","idr","smhd","parseSPS","bind","message","getBits","initialized","sourceBuffer","destroy","len","isNonSync","warn","dOps","extractNALUs","length","</WRMHEADER>","listener","trun","AUD","SEI","timescale","Num frames in chunk: ","7620738FWzrwf","mode","tkhd","dbgMediaDump","dref","addTrack","doAppend","options","[MSE] sourceclose","drm","mediaSource","Failure: Browser doesn't support MSE/MMS",'/mp4; codecs="',"function","duration","min","avc1.","traf","[MSE] sourceopen","moov","readyToDecode","resetTrack","tenc","onMSEOpen","MediaSource","removeSourceBuffer","h264","encv","sourceopen","trex","isKeyframe","SMHD","<DATA>","stype","videoSampleAuxInfo","ended","getElementById","getUint8","slice","audioSampleAuxInfo","data","ready","frma","mseReady","string","4760043VatbTq","mvex","org.w3.clearkey","SPS","buffered","no video element were found to render, provide a valid video element","getPayloadSize",'<WRMHEADER xmlns="',"stts","start","[H264Parser] Both IDR and non-IDR VCL NALUs found in the same frame","timestamp","skipScalingList","skipUEG","trackTypes","dts","queue","readBits","mseEnded","senc","getData","shift","[MSE] error: ","UNKNOWN","parsePPS","appendBuffer","box","initBrowser","schm","saiIvSize","</DATA>","out",'<KID ALGID="AESCTR" ',"audiosamplerate","reduce","com.microsoft.playready.recommendation","tracks","fromCharCode","updating","calculateExpectedSizeFromSai","videoElement","stbl","1159252OkMfWN","opus","toString","buffer","nalus","index","splice","moof","licenseUrl","esds","disableRemotePlayback","height","flags","createBuffer","STSC","parseNAL","PPS","mdhd","debug","sps","keySystem","charCodeAt","mse","parseHeader","isSafari","volume","concat","channelCount","</PROTECTINFO>","units","Unsupported DRM type ","enca","call","POSITIVE_INFINITY","com.apple.fps","<KIDS>","getVideoFrames","646233hEZDuD","4LuRDMh","nri","mp4a","ManagedMediaSource","buffer error","push","audio","avcC","onError","Buffered range ","getTrackID","</KID>","byteLength","No A/V data","video","Opus","both","HDLR_TYPES","readUByte","sdtp","STTS","hasRedundancy","</LA_URL>","revokeObjectURL","BYTES_PER_ELEMENT","webkitsourceclose","IDR","samples","keyId","timestamp gap: ","node","readSPS","setData","pps","onBuffer","remuxController","seq","VMHD","initSegment","ceil","sinf","sourceclose","mfhd","skipLZ","http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader","Browser does not support codec","pssh","mediasource is not available to end: ","NDR","isReset","bitsAvailable","payload","DINF","keyFrame","isDependedOn","isTypeSupported","assign","waitingForIdr","8hmeyto","config","skipBits","remove","bitLength","[H264Parser] IDR without SPS/PPS, not suitable for recovery","TYPES","13659xNePtU","getFramePayload","onBufferError","mediaDuration","mp4"];return(Un=function(){return r})()}class Ha extends Pn{constructor(e,t,n){var i;const a=I;super(a(366)),this[a(234)]=t,this[a(337)]=new Uint8Array;const l=(i=Te.mediaDumps[t])==null?void 0:i[a(352)].durationMs;l>0&&(this[a(279)]=new Tn(t,a(164),l)),this.sourceBuffer=e,this[a(385)]=n,this[a(195)]=!1,this[a(261)].addEventListener(a(189),o=>{const h=a;pe.warn(h(206),o,this.type),this[h(195)]=!0,this.dispatch("error",{type:this[h(234)],name:h(366),error:h(405)})})}[I(262)](){const e=I;this[e(337)]=null,this[e(279)]=null;try{this[e(261)]&&(this.sourceBuffer[e(170)](),this.mse[e(301)](this[e(261)]),this.sourceBuffer=null)}catch{}this.offAll()}[I(282)](){const e=I;if(this[e(337)][e(268)]&&this[e(261)]&&!this.sourceBuffer.updating){if(this[e(261)].buffered.length>1){for(let t=0;t<this[e(261)][e(325)][e(268)];++t){const n=t<this[e(261)].buffered.length-1;pe[e(381)](e(410)+t+(n?" (remove)":"")+": "+this[e(261)][e(325)][e(330)](t)+e(180)+this[e(261)][e(325)].end(t)),n&&this[e(261)][e(156)](this[e(261)].buffered[e(330)](t),this[e(261)][e(325)].end(t))}if(this[e(261)][e(359)])return}try{this[e(261)][e(346)](this[e(337)]),this[e(337)]=new Uint8Array}catch(t){this[e(225)](e(189),{type:this.type,name:e(172),error:t})}}}[I(214)](e,t){const n=I;this.dbgMediaDump&&(this[n(279)][n(208)](e,t)||(this[n(279)]=null)),this[n(195)]||(this.queue=gs(this.queue,e)),this[n(282)]()}}class Vn extends Pn{static isSupported(e){const t=I;return window[t(404)]?window.ManagedMediaSource[t(150)](e):!!window[t(300)]&&window[t(300)][t(150)](e)}constructor(e){const t=I;super(t(220)),this[t(195)]=!1,this[t(152)]=!0,this[t(450)]=!1,this[t(319)]=!1,this.mseEnded=!1;let n={node:"",mode:t(415),debug:!1,onReady:function(){},onError:function(i){}};this.options=Object[t(151)]({},n,e),this[t(431)]=typeof this.options[t(431)]===t(320)?document[t(312)](this[t(283)][t(431)]):this[t(283)][t(431)],this[t(285)]=e.drm,this[t(164)]=new E(this[t(285)]),this[t(436)]=new Ja(this.node,this[t(164)]),this[t(436)][t(281)](this[t(283)][t(277)]),this[t(436)].on(t(366),this.onBuffer[t(257)](this)),this[t(436)].on(t(317),this[t(376)][t(257)](this)),this[t(348)]()}[I(348)](){const e=I;typeof this[e(283)][e(431)]===e(320)&&this.options[e(431)]==""&&pe[e(189)](e(326)),this[e(319)]=!1,this[e(174)]()}[I(174)](){const e=I;if(!window.ManagedMediaSource&&!window[e(300)])throw e(287);window.ManagedMediaSource?(this.node[e(373)]=!0,this[e(286)]=new ManagedMediaSource):this[e(286)]=new MediaSource,this[e(198)]=URL.createObjectURL(this[e(286)]),this.node[e(167)]=this[e(198)],this[e(339)]=!1,this[e(286)][e(176)](e(304),this[e(299)][e(257)](this)),this.mediaSource.addEventListener(e(442),this[e(252)][e(257)](this)),this.mediaSource.addEventListener(e(192),this[e(299)][e(257)](this)),this[e(286)][e(176)](e(426),this[e(252)][e(257)](this)),this[e(286)][e(176)](e(189),function(t){const n=e;pe[n(189)](n(343),t[n(258)])})}[I(169)](){const e=I;if(!this.mseEnded)try{this[e(339)]=!0,this[e(286)][e(184)]===e(205)&&this[e(286)][e(228)]()}catch(t){pe[e(189)](e(448),t)}}[I(243)](){const e=I;pe[e(381)]("Discontinuity!"),this[e(152)]=!0}feed(e){const t=I;let n={video:[],audio:[]};if(this[t(195)]||this[t(339)]||!e||!this.remuxController)return-1;if(e[t(415)]){n[t(332)]=e.timestamp;const i=this[t(360)](e[t(310)],this[t(164)][t(350)][t(415)]),a=i!=e.video[t(413)];let l=ut[t(267)](e[t(415)],a);if(!l[t(185)]||l[t(367)].length<1)return 0;if(this.waitingForIdr){if(!l[t(254)])return 0;this[t(152)]=!1}if(!Ba&&e[t(310)]){const o=l[t(367)][t(355)]((h,d)=>h+4+d[t(413)],0);o!==i&&this.patchSampleAuxinfo(e[t(310)],this[t(164)][t(350)][t(415)],o-i)}n[t(415)]=this[t(399)](l[t(367)]),n[t(310)]=e[t(310)]}return e[t(407)]&&(n[t(332)]=e.timestamp,n[t(407)]=[{units:e[t(407)]}],n[t(315)]=e[t(315)]),e[t(415)]||e[t(407)]?(this[t(436)][t(181)](n),0):(pe[t(189)](t(414)),0)}[I(399)](e){const t=I;let n=[],i=[],a=!1,l=!1;for(let o of e){let h=new q(o);h[t(234)]()!==q[t(427)]&&h[t(234)]()!==q[t(449)]||ut[t(386)](h),n.length&&l&&(h[t(196)]||!h[t(236)])&&(i[t(406)]({units:n,keyFrame:a}),n=[],a=!1,l=!1),n.push(h),a=a||h.isKeyframe(),l=l||h[t(236)]}if(n[t(268)])if(l)i.push({units:n,keyFrame:a});else{let o=i[t(268)]-1;o>=0&&(i[o][t(392)]=i[o][t(392)].concat(n))}return i[t(268)]!==1&&pe.warn(t(275)+i[t(268)]),i}[I(360)](e,t){if(!e)return 0;const n=(e[0]<<8)+e[1],i=t+2+4;let a=0,l=2;for(;0<n&&l+i<=e.byteLength;){l+=t;const o=(e[l]<<8)+e[l+1],h=(e[l+2]<<24)+(e[l+3]<<16)+(e[l+4]<<8)+e[l+5];l+=6,a+=o+h}return a}[I(247)](e,t,n){let i=2;if(0<(e[0]<<8)+e[1]&&i+(t+2+4)<=e.byteLength){i+=t;let a=(e[i]<<8)+e[i+1];a+=n,a>=0&&(e[i]=a>>>8&255,e[i+1]=255&a)}return 0}[I(376)](){const e=I;if(this[e(319)]&&this[e(436)]&&this[e(436)][e(211)]()&&!this[e(245)]){this[e(245)]={};for(let t in this[e(436)][e(357)]){let n=this.remuxController[e(357)][t];const i=""[e(389)](t,e(288)).concat(n.mp4track[e(210)],'"');if(pe[e(381)](e(193),i),!Vn[e(166)](i))return pe.error(e(446)),!1;let a=this.mediaSource[e(173)](i);this[e(245)][t]=new Ha(a,t,this[e(286)]),this[e(245)][t].on(e(189),this[e(162)][e(257)](this))}}}[I(231)](){const e=I;for(let t in this.bufferControllers)this[e(245)][t][e(282)]()}[I(435)](e){const t=I;this[t(319)]&&this[t(245)]&&this[t(245)][e[t(234)]]&&this[t(245)][e[t(234)]].feed(e[t(452)],e[t(336)])}onMSEOpen(){const e=I;pe[e(381)](e(294)),this[e(286)].readyState!==e(311)&&(this[e(286)][e(290)]=Number[e(396)],this[e(319)]=!0,typeof this[e(283)].onReady===e(289)&&this[e(283)][e(241)][e(395)](null,this.isReset),URL[e(424)](this[e(198)]),this[e(376)]())}[I(252)](){const e=I;pe[e(381)](e(284)),this.mseReady=!1,this[e(169)]()}onBufferError(e){const t=I;pe.warn(t(197),e),this[t(195)]=!0,this.endMSE(),typeof this.options[t(409)]===t(289)&&this[t(283)][t(409)][t(395)](null,e)}}function vs(r,e){const t=Gn();return(vs=function(n,i){return t[n-=182]})(r,e)}(function(){const r=vs,e=Gn();for(;;)try{if(parseInt(r(182))/1+parseInt(r(192))/2*(parseInt(r(184))/3)+-parseInt(r(185))/4+-parseInt(r(187))/5+parseInt(r(193))/6+-parseInt(r(183))/7*(parseInt(r(190))/8)+-parseInt(r(186))/9===553943)break;e.push(e.shift())}catch{e.push(e.shift())}})();function Gn(){const r=["1247170HwkwNv","__dev_time__","gitVersion","352GaBvIm","toISOString","14XlATBT","2568948xDjIMf","1027225mjPCDe","19691yiLZrh","195999uPnZlk","3038288UlnUQm","2033937CLMUfn"];return(Gn=function(){return r})()}const oe=Wn;function Nn(){const r=["1236858jPUtaw","certificate","11225xsjioT","275391VrsSlK","5816evMpkd","CrsCCAMSEKDc0WAwLAQT1SB2ogyBJEwYv4Tx7gUijgIwggEKAoIBAQC8Xc/GTRwZDtlnBThq8","7299lkgbxa","1470Lkqtku","production","Development","charCodeAt","xUuwokpsqVIHZrJfu62ar+BF8UVUKdK5oYQoiTZd9OzK3kr29kqGGk3lSgM0/p499p/FUL8oH","baseUrl","375060LzZhzk","230861ZKueQt","12pvGCSu","https://lic.drmtoday.com","35fxICRY","pQnNI61gzHO42XZOMuxytMm0F6puNHTTqhyY3Z290YqvSDdOB+UY5QJuXJgjhvOUD9+oaLlvT","Production","development","https://lic.test.drmtoday.com","UrTEfQxfPR4dJTquE+IDLAi5yeVVxzbAgMBAAE6DGNhc3RsYWJzLmNvbUABEoADMmGXpXg/0q","from","RL9KsD0v7ysBQVdUXEbJotcFz71tI5qc3jwr6GjYIPA3VzusD17PN6AGQniMwxJV12z/EgnUo","baigovcoURAZcr1d/G0rpREjLdVLG0Gjqk63Gx688W5gh3TKemsK3R1jV0dOfj3e6uV/kTpsN","pcFB13osydpD2AaDsgWo5RWJcNf+fzCgtUQx/0Au9+xVm5LQBdv8Ja4f2oiHN3dw","V382D1oJAM0F/YgCQtNDLz7vTWJ+QskNGi5Dd2qzO4s48Cnx5BLvL4H0xCRSw2Ed6ekHSdrRU","27eI5MATX39gYtCnn7dDXVxo4/rCYK0A4VemC3HRai2X3pSGcsKY7+6we7h4IycjqtuGtYg8A","HzgsJ7Hajdsyzn0Vs3+VysAgaJAkXZ+k+N6Ka0WBiZlCtcunVJDiHQbz1sF9GvcePUUi2fM/h","Staging","staging","name"];return(Nn=function(){return r})()}(function(){const r=Wn,e=Nn();for(;;)try{if(parseInt(r(326))/1+parseInt(r(325))/2+parseInt(r(315))/3+parseInt(r(327))/4*(-parseInt(r(314))/5)+-parseInt(r(312))/6+parseInt(r(329))/7*(parseInt(r(316))/8)+-parseInt(r(318))/9*(parseInt(r(319))/10)===181728)break;e.push(e.shift())}catch{e.push(e.shift())}})();const Qa=oe(317)+oe(306)+"wyoYOE+M/t1oIbccwlTQ7o+BpV1X6TB7fxFyx1jsBtRsBWphU65w121zqmSiwzZzJ4xsXVQCJ"+oe(330)+"+vwmV2/NJWxKqHBKdL9JqvOnNiQUF0hDI7Wf8Wb63RYSXKE27Ky31hKgx1wuq7TTWkA+kHnJT"+oe(334)+oe(323)+oe(308)+"7hyskG5ZLAyJMzTvgnV3D8/I5Y6mCFBPb/+/Ri+9bEvquPF3Ff9ip3yEHu9mcQeEYCeGe9zR/"+oe(307)+oe(304)+oe(336)+oe(305),qa=Uint8Array[oe(335)](window.atob(Qa),r=>r[oe(322)](0));class Ve{constructor(e){this[oe(311)]=e}toString(){return this.name}[oe(324)](){const e=oe;switch(this[e(311)]){case"staging":return"https://lic.staging.drmtoday.com";case"development":return e(333);default:return e(328)}}[oe(313)](){return qa}}function Wn(r,e){const t=Nn();return(Wn=function(n,i){return t[n-=304]})(r,e)}Ve[oe(309)]=new Ve(oe(310)),Ve[oe(331)]=new Ve(oe(320)),Ve[oe(321)]=new Ve(oe(332));const An=Dn;function Dn(r,e){const t=Xn();return(Dn=function(n,i){return t[n-=252]})(r,e)}function Xn(){const r=["SampleAuxInfo corrupted","error","50012RXzLep","3301necisu","[RTC-DRM]","subarray","buffer","64zGPhLV","162pDdDkb","659466dfDPqj","SampleAuxInfo corrupted (postfix not found)","data","4199670WddvRf","95WaGAXy","getUint8","137436hbCkvG","1351035XuhSnW","getUint16","byteLength","184863QcuifQ"];return(Xn=function(){return r})()}(function(){const r=Dn,e=Xn();for(;;)try{if(-parseInt(r(253))/1*(parseInt(r(258))/2)+parseInt(r(259))/3+parseInt(r(252))/4*(-parseInt(r(263))/5)+-parseInt(r(265))/6+-parseInt(r(269))/7*(-parseInt(r(257))/8)+-parseInt(r(266))/9+parseInt(r(262))/10===173102)break;e.push(e.shift())}catch{e.push(e.shift())}})();const tr=Tr(An(254));(function(){const r=Fn,e=Yn();for(;;)try{if(parseInt(r(369))/1+parseInt(r(374))/2+parseInt(r(366))/3+-parseInt(r(373))/4+-parseInt(r(365))/5+-parseInt(r(368))/6*(parseInt(r(370))/7)+parseInt(r(367))/8===110661)break;e.push(e.shift())}catch{e.push(e.shift())}})();const rr=[];function Fn(r,e){const t=Yn();return(Fn=function(n,i){return t[n-=365]})(r,e)}let Bn=null,ws=0;function Yn(){const r=["799144UpkRWz","356926NfeJZx","set","slice","237700RBIjTO","627444ELwjUL","76968OxbdcX","6xPMWky","172231EpHRtx","1480332fEizHX","push","buffer"];return(Yn=function(){return r})()}function _a(r){return!Bn&&function(){const e=Fn;Bn=new Uint8Array([0,0,0,1,65,154,255,255])[e(372)],rr[e(371)](new Uint8Array([0,0,0,1,39,100,0,13,172,87,5,6,100,0,0,0,1,40,238,60,176,0,0,0,1,37,184,32,0,203,255,38,29,217,24,192,161,96,0,0,12,229,174,166,6,7,20,3,84,0,247,96,193,181,229,128,0,32,32])[e(372)]),rr[e(371)](rr[0][e(376)](0)),new Uint8Array(rr[1])[e(375)]([16,0,50],27)}(),r?Bn:(ws^=1,rr[ws])}const we=Pr;(function(){const r=Pr,e=On();for(;;)try{if(-parseInt(r(452))/1+-parseInt(r(412))/2+-parseInt(r(478))/3*(parseInt(r(441))/4)+-parseInt(r(485))/5*(-parseInt(r(415))/6)+-parseInt(r(400))/7+parseInt(r(460))/8*(-parseInt(r(486))/9)+-parseInt(r(437))/10*(-parseInt(r(470))/11)===412983)break;e.push(e.shift())}catch{e.push(e.shift())}})();const ye=Tr(we(424));let Et={licenseUrl:"",onFetch:void 0};const Ss={},$a=(r,e,t)=>{const n=we,i=Uint8Array.BYTES_PER_ELEMENT;e*=i,t*=i;const a=(h=r)instanceof ArrayBuffer?h:h[we(484)],l=r[n(483)],o=e;var h;let d=Math[n(432)](0,Math.min(o,l)),p=Math.min(d+Math[n(432)](t,0),l);return d/=i,p/=i,new Uint8Array(a,d,p-d)},Is=(r,e=0,t=1/0)=>$a(r,e,t);function ec(r,e,t=!1){const n=we;if(!r)return"";let i=r;if(!t&&i[n(483)]%2!=0)throw ye[n(393)](n(448)),new Error("Data does not seem to be UTF-16 encoded!");const a=Is(i);let l;if((a[0]===255&&a[1]===254||a[0]===254&&a[1]===255)&&(i=a[n(407)](2)),i instanceof ArrayBuffer)l=i;else{const p=new Uint8Array(i[n(483)]);p[n(396)](Is(i)),l=p[n(484)]}const o=Math[n(447)](i[n(483)]/2),h=new Uint16Array(o),d=new DataView(l);for(let p=0;p<o;p++)h[p]=d[n(398)](2*p,e);return function(p){const b=we;let m="";for(let f=0;f<p[b(433)];f+=16e3){const g=p.subarray(f,f+16e3);m+=String[b(408)][b(467)](null,g)}return m}(h)}const Rs=r=>{const e=we;let t="";for(const n of r){let i=n.toString(16);i[e(433)]==1&&(i="0"+i),t+=i}return t};function On(){const r=["360308tFqTFd","usable for decryption (status: ","oct","decode","parse","license","parseFromString","message","8pQccIM","No clear key test key provided!","generateRequest","text/xml","Failed to update the session: ","output-downscaled","target","apply","bind","Failed to update the session","24280927IKsRHd","No PR challenge data!","kids","status","getElementsByTagName","rtcdrmerror","CK license request:","A128KW","3KcCnPp","createSession","License acquisition failed with error ","No media keys for media element!","stringify","byteLength","buffer","82765KyOCry","7206525fRtYVA","error","btoa","9a04f07998404286ab92e65be0885f95","set","[PR] License fetched:","getUint16","onFetch","4630892EspqDe","addEventListener","debug","has","json","Previous lic will be reused","internal-error","subarray","fromCharCode","expired","text","temporary","665922eWbQGg","then","[FPS] License fetched:","174puebov","Content-Type","update","POST","<Challenge","nodeValue","replace","sessionId","initData","[CDM]","[WV] License fetched:","No media element available!","CDM error generating license request: ","Failed to load previous EME session","initDataType","keyStatuses","forEach","max","length","indexOf","New lic will be requested","edef8ba979d64acea3c827dcd51d21ed","10DoxNsv","atob","catch","arrayBuffer","475444JqsldJ","No init data available!","append","warn","licenseUrl","dispatchEvent","floor","Data has an incorrect length, must be even.","EME createSession() failed - no DRM available","keystatuseschange","Failed to reuse previous EME session: "];return(On=function(){return r})()}let Kn=null;const tc=r=>{const e=we;return window[e(394)](String[e(408)][e(467)](null,r))[e(421)](/\+/g,"-")[e(421)](/\//g,"_")[e(421)](/=*$/,"")},rc=(r,e)=>{const t=we,n=(i=>{const a=we,l=JSON[a(456)](new TextDecoder()[a(455)](i));if(ye[a(402)](a(476),l),Kn===null)throw new Error(a(461));const o=[];for(const h of l[a(472)]){const d={kty:a(454),alg:a(477),kid:h,k:tc(Kn)};o.push(d)}return new TextEncoder().encode(JSON[a(482)]({keys:o}))})(e.message);e.target.update(n)[t(439)](function(i){const a=t;ye[a(393)](a(469),i)})},jn=r=>{const e=we,t=window[e(438)](r.replace(/-/g,"+")[e(421)](/_/g,"/")),n=new Uint8Array(t[e(433)]);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n},zn=(r,e,...t)=>Sn(void 0,[r,e,...t],void 0,function*(n,i,a=!1){const l=we,o=new Headers(Ss);a&&o[l(443)](l(416),l(463));const h={method:l(418),headers:o,body:i},d=yield Et[l(399)]?Et.onFetch(n,h):fetch(n,h);if(!d.ok)throw new Error(l(480)+d[l(473)]);return d}),nc=(r,e)=>{const t=we;zn(Et[t(445)],e[t(459)])[t(413)](n=>n[t(404)]()).then(n=>{const i=t;ye[i(402)](i(425),n[i(457)]);const a=jn(n[i(457)])[i(484)];e[i(466)][i(417)](a)[i(439)](l=>{const o=i;ye[o(393)](o(469),l)})})[t(439)](n=>{const i=t;r[i(446)](new CustomEvent(i(475),{detail:{message:""+n}})),ye[i(393)](n)})},ic=(r,e)=>{const t=we,n=((i,a)=>{const l=we,o=new DOMParser;try{const h=ec(a,!0);if(h[l(434)](l(419))>-1){const d=o[l(458)](h,l(463))[l(474)]("Challenge")[0].childNodes[0][l(420)];if(d===null)throw new Error(l(471));return jn(d)}ye[l(444)]("[PR] Challenge node not found")}catch(h){i[l(446)](new CustomEvent(l(475),{detail:{message:""+h}})),ye[l(393)](h)}return null})(r,e.message);if(n===null)return r[t(446)](new CustomEvent("rtcdrmerror",{detail:{message:t(471)}})),void ye[t(393)](t(471));zn(Et[t(445)],n[t(484)],!0)[t(413)](i=>i[t(440)]())[t(413)](i=>{const a=t;ye[a(402)](a(397),i),e[a(466)][a(417)](i)[a(439)](function(l){const o=a;r[o(446)](new CustomEvent(o(475),{detail:{message:o(464)+l}})),ye[o(393)]("Failed to update the session",l)})}).catch(i=>{const a=t;r.dispatchEvent(new CustomEvent(a(475),{detail:{message:""+i}})),ye[a(393)](i)})},sc=(r,e)=>{const t=we;zn(Et.licenseUrl,e[t(459)])[t(413)](n=>{const i=t,a=n[i(410)]();return ye[i(402)](i(414),n,a),a})[t(413)](n=>{const i=t;e.target[i(417)](jn(n))})[t(439)](n=>{const i=t;r[i(446)](new CustomEvent(i(475),{detail:{message:""+n}})),ye.error(n)})},Cs=(r,e)=>{Ss[r]=e},ks=ze.isSafari;function Pr(r,e){const t=On();return(Pr=function(n,i){return t[n-=393]})(r,e)}let Ur=!ks;const nr=new Map;function oc(r){return Sn(this,void 0,void 0,function*(){const e=Pr;if(r.initData===null)throw new Error(e(442));const t=r[e(466)];if(t===null)throw new Error(e(426));const n=t.mediaKeys;if(n===null)throw new Error(e(481));const i=Rs(new Uint8Array(r[e(423)])),a=i+t.id;let l=null;nr[e(403)](a)&&(l=nr.get(a),l!=null&&l.close(),nr.delete(a)),ye[e(402)](e(l?405:435));let o=null;try{o=n.createSession(Ur?"persistent-license":"temporary")}catch(h){ye[e(402)]("EME createSession(persistent) failed:",h)}if(!o&&Ur){Ur=!1;try{o=n[e(479)](e(411))}catch(h){ye.error("EME createSession(temporary) failed:",h)}}if(o)if(o.addEventListener(e(450),h=>{const d=e;h[d(466)][d(430)][d(431)]((p,b)=>{const m=d;(p===m(409)||p==="output-restricted"||p===m(465)||p===m(406))&&t[m(446)](new CustomEvent(m(475),{detail:{message:"Key "+Rs(new Uint8Array(b))+" is not "+(m(453)+p)+")",keyId:b}}))})}),ks?o[e(401)](e(459),sc.bind(null,t),!1):i.indexOf(e(436))!==-1?o[e(401)](e(459),nc[e(468)](null,t),!1):i[e(434)](e(395))!==-1?o.addEventListener(e(459),ic[e(468)](null,t),!1):o.addEventListener(e(459),rc[e(468)](null,t),!1),l)try{(yield o.load(l[e(422)]))?nr[e(396)](a,o):t[e(446)](new CustomEvent(e(475),{detail:{message:e(428)}}))}catch(h){t[e(446)](new CustomEvent(e(475),{detail:{message:e(451)+h}}))}else o[e(462)](r[e(429)],r[e(423)])[e(413)](()=>{Ur&&nr[e(396)](a,o)})[e(439)](h=>{const d=e;t.dispatchEvent(new CustomEvent(d(475),{detail:{message:d(427)+h}}))});else t[e(446)](new CustomEvent(e(475),{detail:{message:e(449)}}))})}const K=Gr;(function(){const r=Gr,e=Qn();for(;;)try{if(-parseInt(r(462))/1*(-parseInt(r(532))/2)+-parseInt(r(543))/3+parseInt(r(682))/4+-parseInt(r(692))/5*(parseInt(r(588))/6)+-parseInt(r(539))/7+parseInt(r(496))/8+-parseInt(r(549))/9===672532)break;e.push(e.shift())}catch{e.push(e.shift())}})();const _=Tr(K(673)),Es=ze[K(607)],Vr=ze[K(540)],He=ze[K(647)],xs=ze[K(489)],Zs=ze[K(478)],ac=ze.platform,Ts=ze[K(620)],cc=xs||Zs&&ac===K(578),lc=1e6*(Vr?82:He?220:120),Jn=Vr?5e3:2e3,uc=Vr?1.5:.5;function Hn(r){const e=K;return typeof r!==e(672)||r===null||r instanceof Element||r instanceof Ve?r:((t=r)==null?void 0:t[K(584)])instanceof ArrayBuffer&&t!=null&&t.BYTES_PER_ELEMENT?r[e(550)]():Array[e(636)](r)?r.reduce((n,i,a)=>(n[a]=Hn(i),n),[]):r instanceof Object?Object.keys(r).reduce((n,i)=>(n[i]=Hn(r[i]),n),{}):r;var t}class dc{constructor(e){const t=K;this[t(547)]="",this[t(471)]="",this.keySystem="",this[t(603)]=[],this[t(479)]=Hn(e),this.jmuxer=null,this.keyFrameLogCntr=0,this[t(561)]=Date[t(658)](),this[t(585)]=0,this[t(602)]=0,this[t(490)]=-1,this[t(680)]=0,this[t(596)]=0,this[t(491)]=!0,this.keyFrameNeededPosted=!1,this[t(617)]=Jn,this[t(500)]=null,this.dbgMediaDump={video:null,audio:null}}}const dt=new Map,pc=new Uint8Array([60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60]),hc=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),fc=new Uint8Array([213,251,214,184,46,217,62,78,249,138,228,9,49,238,51,183]);function mc(r,e){const t=K;e!==void 0&&(r[t(479)].mediaBufferMs=e),(r[t(479)][t(571)]===void 0||r.config[t(571)]<0)&&(r[t(479)].mediaBufferMs=100,Vr?r[t(479)][t(571)]=350:!He&&Ts&&(r.config[t(601)]==="PlayReady"||r[t(482)])&&(r.config[t(571)]=1400))}function Qn(){const r=["isSafari","ansform=$=>{let e=$.transformer;handleTransform(e.options.operation,e.readable,e.writable)}),onmessage=$=>{keyFra","status","DRM config:","key","Development"," will be used","Staging","const DUMMY_IDR_FRAME_SLICE_HDR0=new Uint8Array([32,0,203]),DUMMY_IDR_FRAME_SLICE_HDR1=new Uint8Array([16,0,50]);","enabled","playback at ","now",".experiment","seq","videoElement","data","btoa","PlayReady might not support '","logLevel","cbcs-1-9","encryption"," to ","offset","x-dt-custom-data","let brokenFrame=null,idrFrames=[];function initializeDummyFrames(){brokenFrame=new Uint8Array([0,0,0,1,65,154,255","object","[RTC-DRM]","not-allowed","durationMs","Default transform mode enabled, ","keySystem","timestamp","DRM config keyId must be an instance of 16-byte long Uint8Array.","lastKeyFrameTime","H264 is the only supported video codec.","2533916KeNZJm","out","Applying pre-configured certificate (","buffered","Widevine","x-dt-auth-token"," ms)","com.microsoft.playready.recommendation","error","currentTime","225RwtgWL","end","requestMediaKeySystemAccess","50705YjLCIv","onmessage","environment","wvLicenseUrl","a1d1f1"," requesting a new key frame (latency ","userId","ClearKey","createEncodedStreams","licenseUrl","PlayReady license acquisition might fail without output protection enabled (sessionId is ","feed","dbgMediaDump","jmuxer","MSE (re)init",",255]).buffer,idrFrames.push(new Uint8Array([0,0,0,1,39,100,0,13,172,87,5,6,100,0,0,0,1,40,238,60,176,0,0,0,1,37,","isChrome","config","forEach","Invalid config argument type, DRM config must be an object.","hwSecurity","audioEncrypted","setMediaKeys","fpsCertificate","Unable to create Worker!","GET","customTransform","isEdge","prevSeqNum","keyFrameNeeded","encrypted","targetLatency not set!","opus","FairPlay","7963992IJNztq","streamType","SampleAuxInfo extraction failed (video)"," seeking from ","worker","]: ","video","kind","audio","jitterBufferDelayHint","size","No target media element!","fpsCertificateUrl","wvCertificate","delimited","3000","pipeThrough","/license-server-fairplay/cert/","string",") not found in [","indexOf","warn","ignoreAudio","append","jitterBufferTarget","prLicenseUrl","sessionTypes","authToken","get","RTCRtpScriptTransform","audioElement","catch","trim","join","waitingForIdr","info","52hXHKkY","enqueue","). It has to be a string containing a JWT.","playbackRate","sai","persistent-license","Blob","2699340CvuQCI","isFirefox","transform",'rame:{type:$.type,timestamp:$.timestamp,data:$.data}}),"key"===$.type&&(keyFrameNeeded=!1),$.data=generateDummyFr',"554109usxuWq"," will not be created, use rtcDrmFeedFrame to push frames manually","bind","streams","serverCertificateUrl","includes","3473577nNrBJc","slice","URL","serverCertificate","length","Invalid authToken type (","addEventListener","', it's safer to use 'cbcs' instead.","srcObject","ClearKey is not supported by Safari.","meNeeded=$.data};","value","nextKeyFrameAllowedTime","Error recovery attempted","rtcdrmerror","184,32,0,203,255,38,29,217,24,192,161,96,0,0,12,229,174,166,6,7,20,3,84,0,247,96,193,181,229,128,0,32,32]).buffer"," bytes","both","debug","No valid DRM config found, call rtcDrmConfigure first.","dispatchEvent","certificate","mediaBufferMs","clear","merchant","src","sessionId","reportDiscontinuity","mediaBufferMs should be an integer.","Android","rtcDrmConfigure did not specify audioElement, audio will be dropped","/license-proxy-widevine/cenc/","arrayBuffer","). Edge only supports PlayReady, Widevine and ClearKey.","). Chrome only supports Widevine and ClearKey.","buffer","videoStartTimestamp",'audio/mp4; codecs="opus"',"set","175800AyhMKK","PlayReady","SampleAuxInfo extraction failed (audio)","cenc","codec","videoCapabilities",".. ","Duplicate/reordered frame, prev seq: ","bytesSinceKey","wvCertificateUrl","/license-proxy-headerauth/drmtoday/RightsManager.asmx","robustness","baseUrl","type","audioStartTimestamp","emeConfig","com.widevine.alpha","SW_SECURE_CRYPTO","fpsLicenseUrl","supportsRtpScriptTransform","Target video element (","?audioTransformFunction:videoTransformFunction});e.pipeThrough(a).pipeTo(x)}self.RTCTransformEvent&&(self.onrtctr","createObjectURL","playoutDelayHint","POSITIVE_INFINITY",'ame(keyFrameNeeded),e.enqueue($)}function handleTransform($,e,x){let a=new TransformStream({transform:"audio"===$',"track",'video/mp4; codecs="avc1.640032"',"cbcs","keyFrameRequestInterval","Frame gap: ","keyFrameNeededPosted","isWindows","HW_SECURE_ALL"," bytes, ","GOP is getting too long, requesting a new key frame","temporary","Safari does not support Opus, audio will not be rendered.","stringify","byteLength","message"," frame","H264","mediaDumps","h264","keyFrameLogCntr","requestMediaKeySystemAccess(","Safari doesn't support 'cenc'/AES-CTR, use 'cbcs' instead if possible.","isArray","Invalid DRM type (","DRM config iv must be an instance of 16-byte long Uint8Array.","keyId","pipeTo"," - ","receiver","isInteger","toString","onFetch","next"];return(Qn=function(){return r})()}function gc(r){const e=K;let t=!1;if((r[e(479)][e(502)]&&r[e(479)].video[e(667)]!==e(572)&&r[e(479)][e(502)][e(599)]==="HW"||r[e(479)][e(504)]&&r[e(479)][e(504)][e(667)]!==e(572)&&r.config[e(504)][e(599)]==="HW")&&(t=!0),r.hwSecurity=t,mc(r,r[e(479)][e(571)]),r.config[e(523)]===void 0){r[e(479)][e(468)]===void 0&&(r[e(479)][e(468)]="purchase"),r[e(479)][e(575)]===void 0&&(r.config[e(575)]=e(466));const a=window[e(663)](JSON[e(626)]({userId:r[e(479)].userId,sessionId:r.config.sessionId,merchant:r[e(479)].merchant}));Cs(e(670),a)}else Cs(e(687),r[e(479)][e(523)]);for(const a of[r[e(479)][e(504)],r[e(479)][e(502)]])a&&a.encryption!==e(572)&&(a.keyId||(a[e(639)]=hc),a.iv||(a.iv=fc));r[e(552)]=void 0,r[e(547)]="",r[e(471)]="";const n=r[e(479)][e(464)][e(600)]();var i;if(r[e(479)].type===e(469)?(r[e(677)]="org.w3.clearkey",Kn=pc):r[e(479)][e(601)]===e(686)?(r[e(677)]=e(604),Ts&&t&&(r[e(677)]+=e(659)),r[e(479)][e(509)]?r[e(552)]=r[e(479)][e(509)]:r[e(479)][e(597)]?r[e(547)]=r.config[e(597)]:r[e(552)]=r.config[e(464)][e(570)](),r[e(479)].wvLicenseUrl?r[e(471)]=r.config[e(465)]:r[e(471)]=n+e(580)):r[e(479)][e(601)]===e(589)?(r.keySystem=e(689),r[e(479)][e(521)]?r[e(471)]=r[e(479)][e(521)]:r[e(471)]=n+e(598)):r.config[e(601)]===e(495)&&(r.keySystem="com.apple.fps",r[e(479)][e(485)]?r[e(552)]=r[e(479)][e(485)]:r[e(479)][e(508)]?r[e(547)]=r.config.fpsCertificateUrl:r[e(547)]=n+e(513)+r[e(479)][e(573)],r[e(479)].fpsLicenseUrl?r[e(471)]=r.config[e(606)]:r[e(471)]=n+"/license-server-fairplay/"),i={licenseUrl:r[e(471)],onFetch:r[e(479)][e(645)]},Et=i,r[e(603)]=[],r[e(479)][e(601)]!==e(495)){r[e(603)].push({initDataTypes:[e(591)],sessionTypes:[e(537),e(624)]});for(const a of[r[e(479)][e(502)],r.config[e(504)]])if(a&&a[e(667)]!==e(572)){const l=a==r.config[e(502)]?e(502):e(504);let o;r.config[e(601)]==="Widevine"?o=a[e(599)]==="HW"?e(621):e(605):r.config[e(601)]==="PlayReady"&&(o=a[e(599)]==="HW"?e(511):"2000"),l==="video"?r[e(603)][0][e(593)]=[{contentType:e(615),encryptionScheme:a[e(667)]===e(591)?e(591):"cbcs-1-9",robustness:o||void 0}]:r[e(603)][0].audioCapabilities=[{contentType:e(586),encryptionScheme:a[e(667)]===e(591)?e(591):e(666),robustness:o||void 0}]}}else r.emeConfig=[{initDataTypes:["sinf"],videoCapabilities:[{contentType:"video/mp4",robustness:""}],distinctiveIdentifier:e(674),persistentState:"not-allowed",sessionTypes:[e(624)]}];_[e(567)](e(650),r)}function Ls(r){const e=K;_[e(567)](e(476));let t=r[e(479)][e(661)];(!r[e(479)][e(502)]||r[e(479)][e(502)][e(667)]===e(572))&&(t=r.config.audioElement),r[e(475)]=null;const n=!r[e(518)]&&r[e(479)].audio&&r[e(479)][e(504)][e(667)]!==e(572),i=r[e(479)][e(502)]&&r[e(479)].video.encryption!==e(572);r[e(596)]=0,r.keyFrameNeeded=!0,r[e(619)]=!1,r[e(617)]=Jn,r[e(585)]=0,r[e(602)]=0,r[e(490)]=-1,r[e(680)]=0,r[e(475)]=new Vn({node:t,mode:e(n?i?566:504:502),fps:60,drm:r}),He&&r[e(479)][e(661)]&&r.config.videoElement.play().then(()=>{})[e(527)](()=>{})}function Gr(r,e){const t=Qn();return(Gr=function(n,i){return t[n-=461]})(r,e)}function bc(r,e){const t=K;r.videoStartTimestamp===0&&(r.videoStartTimestamp=e.timestamp,r[t(617)]=Jn,r[t(561)]=Date.now()+2e3);let n=null,i=!1;if(e[t(662)][t(627)]<=4)_[t(517)]("Discarding corrupted video frame (too small)"),i=!0;else{const o=new Uint8Array(e[t(662)],0,4);o[0]!=0||o[1]!=0||o[2]!=0||o[3]!=1?(_.warn("Discarding corrupted video frame (no Annex B startcode)"),i=!0):(n=function(h,d){const p=An,b=new DataView(h.data),m=h.data[p(268)]-2,f=b[p(267)](m);if(f<m){let g=m-f;if(b[p(264)](m-1)!==69)return tr[p(271)](p(260)),null;if(b[p(264)](g++)>>>4!==1)return tr[p(271)]("Unsupported SampleAuxInfo version"),null;const y=new Uint8Array(f-2);let S=0,C=0;for(;g<m-1;){let Z=b[p(264)](g++);C>1&&Z===3&&(C=0,Z=b.getUint8(g++)),Z!==0?C=0:++C,y[S++]=Z}const x=new DataView(y[p(256)]),L=d==="cenc"?16:0,v=L+2+6*x[p(267)](L);return v+2>S?(tr[p(271)](p(270)),null):{sai:y[p(255)](0,v),offset:m-f,seq:x[p(267)](v)}}return null}(e,r.config[t(502)][t(667)]),!n&&(_.warn(t(498)),i=!0))}if(n)if(e[t(601)]===t(651))r[t(490)]=n.seq;else{if(r[t(490)]===-1)return 0;{let o=n[t(660)]-r[t(490)];if(o<-32767&&(o+=65536),o<=0)return _.debug(t(595)+r.prevSeqNum+", curr: "+n.seq),0;o>1&&(i=e[t(601)]!==t(651),_[t(517)](t(618)+r[t(490)]+t(641)+n[t(660)]+", restart required: "+i)),r.prevSeqNum=n[t(660)]}}let a=0;i&&!r[t(475)][t(530)]&&(a=-1,r[t(475)][t(576)]());const l=(e[t(678)]-r[t(585)])/9e4;return n&&r[t(475)][t(473)]({video:new Uint8Array(e[t(662)],0,n.offset),videoSampleAuxInfo:n[t(536)],timestamp:l})<0&&(a=-1,_[t(517)](t(562)),Ls(r)),a>=0&&e[t(601)]===t(651)&&(r[t(680)]=l),a}function yc(r){const e=K,t=r[e(479)][e(661)];if(!t||t[e(685)][e(553)]<1||t.paused||t[e(691)]<uc)return;const n=r[e(479)][e(571)];if(n===void 0||n<0)throw new Error(e(493));const i=t[e(685)].end(t.buffered[e(553)]-1),a=1e3*(i-t[e(691)])|0;if(!r[e(483)]&&function(l,o,h){const d=K;let p;p=o<3*h>>>2?.875:o<=h?1:o<7*h>>>2?1.125:o<9*h>>>2?1.25:o<11*h>>>2?1.375:1.5,p!==l.playbackRate&&(l[d(535)]=p)}(t,a,n),!(a<n+50||a<5*n>>>2))if(r[e(680)]>t[e(691)]+.1){const l=1e3*(i-r.lastKeyFrameTime)|0;l>40&&l>n-100?(_.debug(Lr()+e(499)+(t[e(691)]+e(668)+r.lastKeyFrameTime+" (")+(r[e(680)]-t[e(691)])+")"),t[e(691)]=r[e(680)]):_[e(567)](Lr()+" too close to seek, "+l)}else!r.keyFrameNeeded&&Date[e(658)]()>r[e(561)]&&a>n+100&&a>3*n>>>1&&(_[e(567)](Lr()+e(467)+a+e(688)),r[e(491)]=!0,r[e(617)]<16e3&&(r[e(617)]<<=1))}function vc(r,e){const t=K;var n;if(!r[t(475)]||r[t(518)])return 0;r[t(602)]===0&&(r.audioStartTimestamp=e[t(678)]);const i=(e[t(678)]-r[t(602)])/48e3;if(((n=r[t(479)][t(504)])===null||n===void 0?void 0:n[t(667)])===t(616))return r.jmuxer[t(473)]({audio:new Uint8Array(e[t(662)]),timestamp:i});const a=function(l){const o=An,h=new DataView(l[o(261)]),d=l.data[o(268)]-2,p=h[o(267)](d);if(p<d){let b=d-p;if(h[o(264)](d-1)!==69)return tr.error("SampleAuxInfo corrupted (postfix not found)"),null;if(h[o(264)](b++)>>>4!==1)return tr[o(271)]("Unsupported SampleAuxInfo version"),null;const m=new Uint8Array(p-2);let f=0;for(;b<d-1;){const g=h[o(264)](b++);if(m[f++]=g,f>=16)break}return{sai:m,offset:d-p}}return null}(e);return a?r.jmuxer[t(473)]({audio:new Uint8Array(e[t(662)],0,a[t(669)]),audioSampleAuxInfo:a[t(536)],timestamp:i}):(_[t(690)](t(590)),-1)}function wc(r,e,t){const n=K,i=Ms(t);return r[n(601)]?qn(i,r,e):_n(i,r,e)}function qn(r,e,t){const n=K;if(r[n(474)][n(502)]){Te.mediaDumps[n(502)].in[n(510)]&&r[n(474)][n(502)][n(519)](new Uint8Array([0,0,0,1,9,80]));const a=e[n(678)]/90;r[n(474)][n(502)][n(519)](new Uint8Array(e[n(662)]),a)||(r[n(474)][n(502)]=null)}if(r[n(479)][n(502)]&&r[n(479)][n(502)][n(667)]==="clear")return t==null||t[n(533)](e),!1;const i=Date[n(658)]();if(e[n(601)]===n(651)){const a=Te.logLevel>=4;++r[n(633)]<(a?Number[n(612)]:5)&&(_.debug(Lr()+" "+e[n(601)]+", "+e.data.byteLength+n(622)+(n(657)+r.config[n(661)].currentTime)),a&&r.keyFrameLogCntr===1&&function(l,o=64,h=64){const d=K,p=new Uint8Array(l[d(662)]);let b="",m=0;for(let f=0;f<o&&f<p[d(553)];++f)b+=(p[f]<16?"0":"")+p[f][d(644)](16)+" ";if(m<p[d(553)])for(m<p[d(553)]-h&&(b+=d(594),m=p[d(553)]-h);m<p[d(553)];m++)b+=(p[m]<16?"0":"")+p[m][d(644)](16)+" ";_[d(531)]("["+((l[d(601)]||d(504))+d(629))+d(501)+b[d(528)]())}(e,128,8)),r.keyFrameNeeded=!1,r[n(596)]=0,r[n(561)]=i+r[n(617)]}return r[n(596)]+=e[n(662)][n(627)],!r[n(491)]&&r[n(596)]>lc&&(_.info(n(623)),r[n(491)]=!0),r[n(475)]&&(bc(r,e)<0?r[n(491)]=!0:yc(r)),t?(!r[n(491)]||!cc)&&(e[n(662)]=_a(r[n(491)]),t[n(533)](e)):r[n(491)]!=r.keyFrameNeededPosted&&(r[n(500)]&&r.worker.postMessage(r[n(491)]),r.keyFrameNeededPosted=r[n(491)]),r.keyFrameNeeded}function _n(r,e,t){const n=K;if(r.dbgMediaDump.audio){const i=e[n(678)]/48;r[n(474)][n(504)][n(519)](new Uint8Array(e.data),i)||(r.dbgMediaDump[n(504)]=null)}return r[n(479)].audio&&r[n(479)].audio[n(667)]!==n(572)?e[n(662)][n(627)]>0&&vc(r,e):t&&t[n(533)](e),!1}function $n(r){const e=K;var t,n,i,a,l;if(!r||typeof r!==e(672))throw new TypeError(e(481));if(!(r.videoElement instanceof HTMLVideoElement))throw new TypeError("Invalid videoElement, it must be an instance of HTMLVideoElement.");if(r[e(526)]&&!(r[e(526)]instanceof HTMLMediaElement))throw new TypeError("Invalid audioElement, it must be an instance of HTMLMediaElement.");if(r[e(571)]!==void 0&&!Number[e(643)](r[e(571)]))throw new TypeError("DRM config mediaBufferMs should be an integer.");let o=!1,h=!1,d=!1;const p=[e(616),"cenc",e(572)],b=["SW","HW"];for(const f of[r.video,r[e(504)]])if(f){if(!p[e(548)](f[e(667)]))throw new RangeError("DRM config encryption value must be one of: "+p[e(529)](", "));if(He&&f.encryption===e(591))throw new RangeError(e(635));if(f[e(667)]!=="clear"){if(h=!0,f.keyId){if(!(f[e(639)]instanceof Uint8Array)||f[e(639)][e(553)]!==16)throw new TypeError(e(679));d=!0}else if(He)throw new ReferenceError(e(558));if(f.iv&&(!(f.iv instanceof Uint8Array)||f.iv[e(553)]!==16))throw new TypeError(e(638));if(f[e(599)]&&!b[e(548)](f[e(599)]))throw new RangeError("DRM config robustness can only be one of: "+b[e(529)](", "));if(f===r.video&&f.codec!==e(630))throw new RangeError(e(681));He&&f===r.audio&&f[e(592)]===e(494)&&(o=!0,_.warn(e(625))),r[e(601)]===e(589)&&(f[e(667)]!=="cenc"&&_[e(517)](e(664)+f[e(667)]+e(556)),r.sessionId===void 0||r[e(575)][e(548)]("f1")||_[e(517)](e(472)+r[e(575)]+", a1d1f1 is recommended)."))}}if(h){const f=[Ve[e(652)],Ve[e(654)],Ve.Production];if(!f[e(548)](r[e(464)]))throw new RangeError("DRM config env value must be one of: "+f.join(", "));if(r[e(523)]&&typeof r.authToken!==e(514))throw new TypeError(e(554)+typeof r[e(523)]+e(534));if(r[e(601)]){if(He){if(r.type!=="FairPlay")throw new RangeError(e(637)+r[e(601)]+"). Safari only supports FairPlay.")}else if(Zs){if(r[e(601)]!==e(686)&&r.type!=="ClearKey")throw new RangeError(e(637)+r[e(601)]+e(583))}else if(xs&&r[e(601)]!==e(589)&&r[e(601)]!=="Widevine"&&r[e(601)]!==e(469))throw new RangeError(e(637)+r.type+e(582))}}if(r[e(665)]!==void 0&&(Te[e(665)]=r[e(665)]),r.mediaDumps!==void 0){if(r.mediaDumps[e(502)]){const f=r[e(631)].video,g=Te[e(631)][e(502)];!((t=f.in)===null||t===void 0)&&t.durationMs&&(g.in[e(675)]=f.in.durationMs),!((n=f.in)===null||n===void 0)&&n.delimited&&(g.in.delimited=f.in[e(510)]),!((i=f[e(683)])===null||i===void 0)&&i.durationMs&&(g[e(683)][e(675)]=f[e(683)].durationMs)}if(r[e(631)][e(504)]){const f=r[e(631)][e(504)],g=Te[e(631)][e(504)];!((a=f.in)===null||a===void 0)&&a.durationMs&&(g.in.durationMs=f.in.durationMs),!((l=f.out)===null||l===void 0)&&l[e(675)]&&(g[e(683)][e(675)]=f[e(683)].durationMs)}}let m=dt[e(524)](r[e(661)]);!m&&(m=new dc(r),dt[e(587)](r.videoElement,m)),m[e(656)]=h,m.ignoreAudio=o,m[e(483)]=!o&&m[e(479)][e(504)]&&m[e(479)][e(504)][e(667)]!==e(572),h&&(m[e(479)][e(601)]||(m[e(479)][e(601)]=He?"FairPlay":e(686)),d||m.config.type===e(469)||(m[e(479)][e(601)]=e(469)),gc(m),function(f){Sn(this,void 0,void 0,function*(){const g=Gr;var y,S;let C=f.config[g(661)];if((!f.config[g(502)]||f[g(479)].video[g(667)]===g(572))&&(C=f[g(479)][g(526)]),!C)throw new Error(g(507));C[g(574)]="",C[g(557)]=null,yield C[g(484)](null);let x=null;try{x=yield navigator[g(461)](f[g(677)],f[g(603)])}catch{}if(!x&&f.emeConfig[0]){const v=(y=f.emeConfig[0][g(522)])===null||y===void 0?void 0:y[g(516)](g(537));if(v!==void 0&&v>=0){(S=f[g(603)][0][g(522)])===null||S===void 0||S.splice(v,1);try{x=yield navigator[g(461)](f[g(677)],f[g(603)])}catch{}}}if(!x){const v=g(634)+f[g(677)]+") failed";return C[g(569)](new CustomEvent(g(563),{detail:{message:v}})),void _[g(690)](v)}let L=null;try{L=yield x.createMediaKeys()}catch{}if(!L){const v="createMediaKeys("+f.keySystem+") failed";return C.dispatchEvent(new CustomEvent(g(563),{detail:{message:v}})),void _[g(690)](v)}if(f.serverCertificate)_[g(567)](g(684)+f[g(552)][g(627)]+" bytes)"),yield L.setServerCertificate(f[g(552)]);else if(f[g(547)]){const v={method:g(487)},Z=f.serverCertificateUrl;try{const M=yield f.config[g(645)]?f[g(479)][g(645)](Z,v):fetch(Z,v);if(!M.ok){const N="Server certificate fetch failed with error "+M[g(649)];return void C[g(569)](new CustomEvent(g(563),{detail:{message:N}}))}const U=yield M[g(581)]();_[g(567)]("Fetched certificate from "+Z+", "+U.byteLength+g(565)),yield L.setServerCertificate(U)}catch(M){const U=M.name+": "+M[g(628)];return _[g(690)](U),void C[g(569)](new CustomEvent("rtcdrmerror",{detail:{message:U}}))}}yield C[g(484)](L),C[g(555)](g(492),oc),Ls(f)})}(m)),m[e(479)][e(661)][e(555)]("play",function(){const f=e;m[f(479)][f(661)][f(691)]>.5&&(m[f(561)]=Date[f(658)]())})}const Sc=K(655)+K(671)+K(477)+K(564)+'),idrFrames.push(idrFrames[0].slice());let $=new Uint8Array(idrFrames[1]);$.set([16,0,50],27)}let idrPicIdToggle=0;function generateDummyFrame($){return(brokenFrame||initializeDummyFrames(),$)?brokenFrame:idrFrames[idrPicIdToggle^=1]}function audioTransformFunction($,e){postMessage({streamType:"audio",frame:{timestamp:$.timestamp,data:$.data}}),e.enqueue($)}let keyFrameNeeded=!1;function videoTransformFunction($,e){postMessage({streamType:"video",f'+K(542)+K(613)+K(609)+K(648)+K(559);function Ms(r){const e=K;if(dt[e(506)]===0)throw new TypeError(e(568));let t;if(r&&r[e(661)])t=r.videoElement;else{if(dt[e(506)]!==1)throw new TypeError("Several DRM configs detected, rtcDrmOnTrack have to be called with target DRM config.");t=dt.keys()[e(646)]()[e(560)]}const n=dt[e(524)](t);if(!n){let i="";throw dt[e(480)]((a,l)=>{i+=l.id+", "}),i=i[e(550)](0,-2),new TypeError(e(608)+t.id+e(515)+i+"]")}return n}function Ps(r,e){const t=K;if(r&&r.config[t(661)]){const n=r.config[t(661)];if(n.buffered[t(553)]>0){const i=n.buffered[t(693)](n.buffered[t(553)]-1)-n.currentTime;e[t(611)]=e.jitterBufferDelayHint=e[t(520)]=i}setTimeout(Ps,1e3,r,e)}}function Ic(r,e){const t=K;var n,i;const a=r[t(614)][t(503)];a===t(502)&&(r[t(642)][t(611)]=r.receiver[t(505)]=r[t(642)][t(520)]=0);const l=Ms(e),o=l[t(479)][t(661)],h=l.config.audioElement;if(l.enabled){const d=""+t(Es?525:470);if(l[t(479)][t(488)])_[t(567)](d+t(544));else{if(_[t(567)](t(676)+d+t(653)),a===t(502)){const p=Te[t(631)][t(502)].in[t(675)];p>0&&(l.dbgMediaDump[t(502)]=new Tn(t(502),t(632),p))}else if(a===t(504)){const p=Te[t(631)][t(504)].in[t(675)];p>0&&(l[t(474)][t(504)]=new Tn(t(504),t(494),p))}if(Es){if(l[t(500)]=function(p){const b=K,m=window[b(551)]||window.webkitURL,f=window[b(538)],g=window.Worker;if(!(m&&f&&g&&p))return null;const y=new f([p]);return new g(m[b(610)](y))}(Sc),l[t(500)]==null)throw new Error(t(486));l[t(500)][t(463)]=p=>{const b=t;p[b(662)][b(497)]===b(502)?qn(l,p.data.frame,null):_n(l,p.data.frame,null)},r[t(642)][t(541)]=new RTCRtpScriptTransform(l.worker,{operation:a})}else{const p=a===t(502)?qn:_n,b={drm:l,transform:(S,C)=>{p(l,S,C)}},m=r[t(642)][t(470)](),f=new TransformStream({transform:b[t(541)][t(545)](b)}),{readable:g,writable:y}=m;g[t(512)](f)[t(640)](y)}}if(a==="audio"&&((n=l.config[t(504)])===null||n===void 0?void 0:n.encryption)===t(572)){if(!h)return void _[t(517)](t(579));h[t(557)]!==r[t(546)][0]&&(h[t(557)]=r.streams[0]),l[t(479)][t(661)]&&(r[t(642)].playoutDelayHint=r.receiver.jitterBufferDelayHint=r[t(642)][t(520)]=l[t(479)][t(571)],Ps(l,r[t(642)]))}else a===t(502)&&((i=l[t(479)][t(502)])===null||i===void 0?void 0:i.encryption)===t(572)&&o[t(557)]!==r[t(546)][0]&&(o.srcObject=r[t(546)][0])}else o[t(557)]!==r[t(546)][0]&&(o.srcObject=r[t(546)][0])}const H=Ae.get("View");H.setLevel(Ae.DEBUG);const ei={metadata:!1,enableDRM:!1,disableVideo:!1,disableAudio:!1,peerConfig:{autoInitStats:!0,statsIntervalMs:1e3}};class Rc extends Ga{constructor(e,t,n=null,i=!0){e&&H.warn("The streamName property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, set via token generator"),super(null,t,H,i),this.payloadTypeCodec={},this.tracksMidValues={},this.drmOptionsMap=null,this.eventQueue=[],this.isMainStreamActive=!1,n&&(this.on(Ue.track,a=>{n.srcObject=a.streams[0]}),H.warn("The mediaElement property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, do this in either the `track` or the `active` broadcast event."))}async connect(e=ei){this.options=Je(ne(ne({},ei),e),{peerConfig:ne(ne({},ei.peerConfig),e.peerConfig),setSDPToPeer:!1}),this.eventQueue.length=0,await this.initConnection({migrate:!1})}async select(e={}){H.debug("Viewer select layer values: ",e),await this.signaling.cmd("select",{layer:e}),H.info("Connected to streamName: ",this.streamName)}async addRemoteTrack(e,t){H.info("Viewer adding remote track",e);const n=await this.webRTCPeer.addRemoteTrack(e,t);for(const i of t)i.addTrack(n.receiver.track);return n}async project(e,t){for(const n of t){if(!n.trackId&&!n.media)throw H.error("Error in projection mapping, trackId or mediaId must be set"),new Error("Error in projection mapping, trackId or mediaId must be set");const i=this.webRTCPeer.getRTCPeer();if(n.mediaId&&!i.getTransceivers().find(a=>a.mid===n.mediaId.toString()))throw H.error("Error in projection mapping, ".concat(n.mediaId," mid not found in local transceivers")),new Error("Error in projection mapping, ".concat(n.mediaId," mid not found in local transceivers"))}H.debug("Viewer project source: layer mappings: ",e,t),await this.signaling.cmd("project",{sourceId:e,mapping:t}),H.info("Projection done")}async unproject(e){H.debug("Viewer unproject mediaIds: ",e),await this.signaling.cmd("unproject",{mediaIds:e}),H.info("Unprojection done")}async replaceConnection(){H.info("Migrating current connection"),await this.initConnection({migrate:!0})}stop(){var e,t;super.stop(),(e=this.drmOptionsMap)==null||e.clear(),this.DRMProfile=null,(t=this.worker)==null||t.terminate(),this.worker=null,this.payloadTypeCodec={},this.tracksMidValues={},this.eventQueue.length=0}async initConnection(e){var t;H.debug("Viewer connect options values: ",this.options),this.stopReconnection=!1;let n;if(!e.migrate&&this.isActive())throw H.warn("Viewer currently subscribed"),new Error("Viewer currently subscribed");let i;try{i=await this.tokenGenerator(),this.options.peerConfig.iceServers=i==null?void 0:i.iceServers,this.options.peerConfig.encodedInsertableStreams=ls&&(this.options.enableDRM||this.options.metadata)}catch(S){throw H.error("Error generating token."),S instanceof vn&&(S.status===401||!this.autoReconnect?this.stopReconnection=!0:this.reconnect()),S}if(!i)throw H.error("Error while subscribing. Subscriber data required"),new Error("Subscriber data required");const a=Ua(i.jwt);this.streamName=a.millicast.streamName;const l=new Ea({streamName:this.streamName,url:"".concat(i.urls[0],"?token=").concat(i.jwt)});i.subscriberToken&&(this.subscriberToken=i.subscriberToken);const o=e.migrate?new er:this.webRTCPeer;await o.createRTCPeer(this.options.peerConfig),(t=this.stopReemitingWebRTCPeerInstanceEvents)==null||t.call(this),this.stopReemitingWebRTCPeerInstanceEvents=ki(o,this,Object.values(Ue).filter(S=>S!==Ue.track)),this.options.metadata&&(this.worker||(this.worker=new ps),this.worker.onmessage=S=>{if(S.data.event==="metadata"){const C=new TextDecoder,x=S.data.metadata;if(x.mid=S.data.mid,x.track=this.tracksMidValues[S.data.mid],x.uuid){const L=x.uuid;x.uuid=L.reduce((v,Z)=>v+Z.toString(16).padStart(2,"0"),""),x.uuid=x.uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5")}if(x.timecode&&(x.timecode=new Date(C.decode(x.timecode))),x.unregistered){const L=C.decode(x.unregistered);try{const v=JSON.parse(L);x.unregistered=v}catch{H.info("The content could not be converted to JSON, returning raw bytes instead")}}this.emit("metadata",x)}}),o.on(Ue.track,S=>{if(!this.isMainStreamActive){this.eventQueue.push(S);return}this.onTrackEvent(S)}),l.on(je.broadcastEvent,async S=>{if(!this.isMainStreamActive&&S.name==="active"){if(this.mainSourceId=S.data.sourceId,!this.DRMProfile&&S.data.encryption){const C=await this.tokenGenerator();C.drmObject&&(this.DRMProfile=C.drmObject)}for(this.emit(je.broadcastEvent,S),this.isMainStreamActive=!0;this.eventQueue.length>0;)this.onTrackEvent(this.eventQueue.shift());return}S.name==="inactive"&&this.isMainStreamActive&&this.mainSourceId===S.data.sourceId&&(this.isMainStreamActive=!1),this.emit(je.broadcastEvent,S)});const h=o.getRTCLocalSDP(Je(ne({},this.options),{stereo:!0})),d=l.connect();n=await Promise.all([h,d]);const p=n[0];let b=this.signaling;this.signaling=l;const m=this.signaling.subscribe(p,Je(ne({},this.options),{vad:this.options.multiplexedAudioTracks>0})),f=o.peer.setLocalDescription(o.sessionDescription);n=await Promise.all([m,f]);const g=n[0];this.payloadTypeCodec=be.getCodecPayloadType(g),await o.setRTCRemoteSDP(g),H.info("Connected to streamName: ",this.streamName);let y=this.webRTCPeer;this.webRTCPeer=o,this.setReconnect(),e.migrate&&this.webRTCPeer.on(Ue.connectionStateChange,S=>{var C,x;S==="connected"?setTimeout(()=>{var L,v;(L=b==null?void 0:b.close)==null||L.call(b),(v=y==null?void 0:y.closeRTCPeer)==null||v.call(y),b=y=null,H.info("Current connection migrated")},1e3):["disconnected","failed","closed"].includes(S)&&((C=b==null?void 0:b.close)==null||C.call(b),(x=y==null?void 0:y.closeRTCPeer)==null||x.call(y),b=y=null)})}onTrackEvent(e){var t,n,i;if(this.tracksMidValues[(t=e.transceiver)==null?void 0:t.mid]=e.track,this.isDRMOn){const a=e.transceiver.mid,l=this.getDRMConfiguration(a);try{Ic(e,l)}catch(o){H.error("Failed to apply DRM on media Id:",a,"error is: ",o),this.emit("error",new Error("Failed to apply DRM on media Id: "+a+" error is: "+o))}this.worker||(this.worker=new ps),this.worker.addEventListener("message",o=>{o.data.event==="complete"&&wc(o.data.frame,null,l)})}if(this.options.metadata){if(Na)e.receiver.transform=new RTCRtpScriptTransform(this.worker,{name:"receiverTransform",payloadTypeCodec:ne({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(n=e.transceiver)==null?void 0:n.mid});else if(ls){const{readable:a,writable:l}=e.receiver.createEncodedStreams();this.worker.postMessage({action:"insertable-streams-receiver",payloadTypeCodec:ne({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(i=e.transceiver)==null?void 0:i.mid,readable:a,writable:l},[a,l])}}this.emit(Ue.track,e)}getDRMConfiguration(e){return this.drmOptionsMap?this.drmOptionsMap.get(e):null}async onRtcDrmFetch(e,t){return t.headers||(t.headers=new Headers),t.headers.get("x-dt-custom-data")&&t.headers.delete("x-dt-custom-data"),this.subscriberToken?t.headers.append("Authorization","Bearer ".concat(this.subscriberToken)):H.warn("onRtcDrmFetch: no subscriberToken"),fetch(e,t)}configureDRM(e){if(!e)throw new Error("Required DRM options is not provided");this.drmOptionsMap||(this.drmOptionsMap=new Map);const t={merchant:"dolby",environment:Ve.Production,customTransform:this.options.metadata,videoElement:e.videoElement,audioElement:e.audioElement,video:{codec:"H264",encryption:"cbcs",keyId:hs(e.videoEncryptionParams.keyId),iv:hs(e.videoEncryptionParams.iv)},audio:{codec:"opus",encryption:"clear"},onFetch:this.onRtcDrmFetch.bind(this)};e.mediaBufferMs&&(t.mediaBufferMs=e.mediaBufferMs),this.DRMProfile&&(this.DRMProfile.playReadyUrl&&(t.prLicenseUrl=this.DRMProfile.playReadyUrl),this.DRMProfile.widevineUrl&&(t.wvLicenseUrl=this.DRMProfile.widevineUrl),this.DRMProfile.fairPlayUrl&&(t.fpsLicenseUrl=this.DRMProfile.fairPlayUrl),this.DRMProfile.fairPlayCertUrl&&(t.fpsCertificateUrl=this.DRMProfile.fairPlayCertUrl));try{$n(t),this.drmOptionsMap.set(e.videoMid,t),e.audioMid&&this.drmOptionsMap.set(e.audioMid,t),t.videoElement.addEventListener("rtcdrmerror",n=>{H.error("DRM error: ",n.detail.message,"in video element:",t.videoElement.id),this.emit("error",new Error(n.detail.message))})}catch(n){H.error("Failed to configure DRM with options:",e,"error is:",n)}}removeDRMConfiguration(e){var t;(t=this.drmOptionsMap)==null||t.delete(e)}get isDRMOn(){return!!this.drmOptionsMap&&this.drmOptionsMap.size>0}exchangeDRMConfiguration(e,t){const n=this.getDRMConfiguration(e),i=this.getDRMConfiguration(t);if(n===null)throw new Error("No DRM configuration found for "+e);if(i===null)throw new Error("No DRM configuration found for "+t);fs(n.video,i.video,"keyId"),fs(n.video,i.video,"iv");try{$n(n)}catch(a){H.error("Failed to configure DRM with options:",n,"error is:",a)}try{$n(i)}catch(a){H.error("Failed to configure DRM with options:",i,"error is:",a)}}}window.Logger=Ae,Xe.setEndpoint("https://director.millicast.com");const Qe=new Proxy(new URLSearchParams(window.location.search),{get:(r,e)=>r.get(e)}),Cc=Qe.accountId||"kMH4vs",Us=Qe.streamName||"98",kc=Qe.metadata==="true",Nr=Qe.drm==="true",Ec=Qe.token||void 0,xc=Qe.disableVideo==="true",Zc=Qe.disableAudio==="true",Tc=Qe.forceSmooth==="true",Lc={events:["active","inactive","layers"],metadata:kc,enableDRM:Nr,disableVideo:xc,disableAudio:Zc,forceSmooth:Tc},pt="0",qe="main";let ir,ti,Vs,ve={},Be={},Gs={};const Mc=()=>Xe.getSubscriber(Us,Cc,Ec,Nr);let he;document.addEventListener("DOMContentLoaded",async()=>{ir=document.getElementById("remoteVideos"),ti=document.getElementById("mid-0"),Vs=document.getElementById("mid-1");try{he=new Rc(Us,Mc),he.on("metadata",r=>{console.log(`Metadata event from ${Be[r.mid]||"main"}:`,r)}),he.on("broadcastEvent",r=>{const{name:e,data:t}=r;switch(e){case"active":{const n=t.sourceId||qe;n===qe?Uc(t):Pc(t),Xc(n);break}case"inactive":{const n=t.sourceId||qe;Gc(n),Fc(n);break}case"layers":{Ye.value&&Nc(t.medias);break}}}),he.on("track",r=>{console.log("track Event",r),!he.isDRMOn&&r.streams.length>0&&r.track.kind==="video"&&Vc(r.streams[0],r.transceiver.mid)}),await he.connect(Lc)}catch(r){console.error(r),he.reconnect()}});const Pc=async r=>{var d;const e=r.sourceId,t=new MediaStream,n=Wc(),i=Ac(),a=r.tracks.map(async p=>{const{media:b}=p,m=await he.addRemoteTrack(b,[t]);return{...p,mediaId:m.mid}}),l=await Promise.all(a),o=l.find(p=>p.media==="video").mediaId,h=(d=l.find(p=>p.media==="audio"))==null?void 0:d.mediaId;if(n.id="mid-"+o,h&&(i.id="mid-"+h),r.encryption&&Nr){const p={videoElement:n,audioElement:i,videoEncryptionParams:r.encryption,videoMid:o};h&&(p.audioMid=h),he.configureDRM(p)}Be[o]=e,ve[e]=l,Dc(o),r.encryption||(n.srcObject=t),await he.project(e,l)},Uc=async r=>{console.log("add main source");const e=r.tracks.map(t=>{const{media:n}=t;return{...t,mediaId:n==="video"?pt:"1"}});if(console.log("tracks mapping",e),r.encryption&&Nr){const t={videoElement:ti,audioElement:Vs,videoEncryptionParams:r.encryption,videoMid:pt},n=e.find(i=>i.media==="audio");n&&(t.audioMid=n.mediaId),he.configureDRM(t)}Be[pt]=qe,ve[qe]=e,console.log(Be),console.log("***",ve),ti.hidden=!1},Vc=(r,e)=>{const t=document.getElementById("mid-"+e);t.srcObject=r,t.muted=!0,t.autoPlay=!0,t.playsInline=!0,t.addEventListener("error",n=>{console.error("failed to play video: ",n)}),t.play()},Gc=async r=>{var l;const e=ve[r].find(o=>o.media==="video").mediaId,t=(l=ve[r].find(o=>o.media==="audio"))==null?void 0:l.mediaId,n=ve[r].map(o=>o.mediaId),i=document.getElementById("mid-"+e),a=document.getElementById("mid-"+t);await he.unproject(n),e!==pt?(ir.removeChild(i),he.removeDRMConfiguration(e),t&&he.removeDRMConfiguration(t),a&&ir.removeChild(a)):(i.hidden=!0,i.pause(),a==null||a.pause()),delete ve[r],delete Be[e]},Ye=document.getElementById("sourcesDropDown"),Wr=document.getElementById("layersDropDown"),Nc=r=>{var a,l,o;const e=Ye.value;Gs=r;const t=(l=(a=ve[e])==null?void 0:a.find(h=>h.media==="video"))==null?void 0:l.mediaId,n=((o=r[t])==null?void 0:o.active)||[],i=Wr.value;Wr.innerHTML="<option hidden selected>Select a source</option>"+n.map(h=>`<option value="${h.id}" ${h.id===i?"selected":""}>${h.width}p</option>`).join("")},Wc=()=>{const r=document.createElement("video");return r.autoplay=!0,r.playsInline=!0,r.controls=!0,r.muted=!0,ir.appendChild(r),r},Ac=()=>{const r=document.createElement("audio");return r.autoplay=!0,r.muted=!0,r.hidden=!0,ir.appendChild(r),r},Dc=r=>{Be[r];const e=document.getElementById("mid-"+r);e.addEventListener("click",async()=>{const t=Be[r],n=Be[pt];console.log("switch main source from:",n,"to:",t),he.isDRMOn&&he.exchangeDRMConfiguration(r,pt),await he.project(n===qe?null:n,ve[t]),await he.project(t===qe?null:t,ve[n]);const i=ve[t];ve[t]=ve[n],ve[n]=i,Be[pt]=t,Be[r]=n,e.play()})},Xc=r=>{r===qe&&(Ye.value=r);const e=document.createElement("option");e.value=r,e.text=r,Ye.add(e)},Fc=r=>{const e=Ye.querySelector(`option[value="${r}"]`);e&&Ye.removeChild(e)};Ye.addEventListener("change",()=>{var n;const r=Ye.value==="main"?null:Ye.value,e=ve[r].find(i=>i.trackId==="video").mediaId,t=((n=Gs[e])==null?void 0:n.active)||[];Wr.innerHTML="<option hidden selected>Select a source</option>"+t.map(i=>`<option value="${i.id}">${i.width}p</option>`).join("")}),Wr.addEventListener("change",async r=>{const e=r.target.value,t=Ye.value,n=ve[t].find(a=>a.media==="video"),i=t==="main"?null:t;await he.project(i,[{...n,layer:{encodingId:e}}])})});
